       /*! cornerstone-tools - 6.0.6 - 2021-11-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */ !function e(t, n) { "object" == typeof exports && "object" == typeof module ? module.exports = n() : "function" == typeof define && define.amd ? define("cornerstone-tools", [], n) : "object" == typeof exports ? exports["cornerstone-tools"] = n() : t.cornerstoneTools = n() }(window, function () { return function (e) { var t, n, a, o, i = window.webpackHotUpdate; window.webpackHotUpdate = function e(t, n) { (function e(t, n) { if ($[t] && x[t]) { for (var o in x[t] = !1, n) Object.prototype.hasOwnProperty.call(n, o) && (a[o] = n[o]); 0 == --h && 0 === v && _() } })(t, n), i && i(t, n) }; var r = !0, l = "21a11c272658d5ed67ff", s = {}, u = [], d = []; function c(e) { var n = j[e]; if (!n) return S; var a = function (a) { return n.hot.active ? (j[a] ? -1 === j[a].parents.indexOf(e) && j[a].parents.push(e) : (u = [e], t = a), -1 === n.children.indexOf(a) && n.children.push(a)) : (console.warn("[HMR] unexpected require(" + a + ") from disposed module " + e), u = []), S(a) }, o = function e(t) { return { configurable: !0, enumerable: !0, get: function () { return S[t] }, set: function (e) { S[t] = e } } }; for (var i in S) Object.prototype.hasOwnProperty.call(S, i) && "e" !== i && "t" !== i && Object.defineProperty(a, i, o(i)); return a.e = function (e) { return "ready" === g && m("prepare"), v++, S.e(e).then(t, function (e) { throw t(), e }); function t() { v--, "prepare" === g && (p[e] || b(e), 0 === v && 0 === h && _()) } }, a.t = function (e, t) { return 1 & t && (e = a(e)), S.t(e, -2 & t) }, a } var f = [], g = "idle"; function m(e) { g = e; for (var t = 0; t < f.length; t++)f[t].call(null, e) } var h = 0, v = 0, p = {}, x = {}, $ = {}; function y(e) { return +e + "" === e ? +e : e } function T(e) { if ("idle" !== g) throw Error("check() is only allowed in idle status"); r = e, m("check"); var t = 1e4; return (t = t || 1e4, new Promise(function (e, n) { if ("undefined" == typeof XMLHttpRequest) return n(Error("No browser support")); try { var a = new XMLHttpRequest, o = S.p + "" + l + ".hot-update.json"; a.open("GET", o, !0), a.timeout = t, a.send(null) } catch (i) { return n(i) } a.onreadystatechange = function () { if (4 === a.readyState) { if (0 === a.status) n(Error("Manifest request to " + o + " timed out.")); else if (404 === a.status) e(); else if (200 !== a.status && 304 !== a.status) n(Error("Manifest request to " + o + " failed.")); else { try { var t = JSON.parse(a.responseText) } catch (i) { n(i); return } e(t) } } } })).then(function (e) { if (!e) return m("idle"), null; x = {}, p = {}, $ = e.c, o = e.h, m("prepare"); var t = new Promise(function (e, t) { n = { resolve: e, reject: t } }); return a = {}, b("cornerstoneTools"), "prepare" === g && 0 === v && 0 === h && _(), t }) } function b(e) { if ($[e]) { var t, n; x[e] = !0, h++, t = e, (n = document.createElement("script")).charset = "utf-8", n.src = S.p + "" + t + "." + l + ".hot-update.js", document.head.appendChild(n) } else p[e] = !0 } function _() { m("ready"); var e = n; if (n = null, e) { if (r) Promise.resolve().then(function () { return C(r) }).then(function (t) { e.resolve(t) }, function (t) { e.reject(t) }); else { var t = []; for (var o in a) Object.prototype.hasOwnProperty.call(a, o) && t.push(y(o)); e.resolve(t) } } } function C(t) { if ("ready" !== g) throw Error("apply() is only allowed in ready status"); function n(e) { for (var t = [e], n = {}, a = t.map(function (e) { return { chain: [e], id: e } }); a.length > 0;) { var o = a.pop(), r = o.id, l = o.chain; if ((C = j[r]) && !C.hot._selfAccepted) { if (C.hot._selfDeclined) return { type: "self-declined", chain: l, moduleId: r }; if (C.hot._main) return { type: "unaccepted", chain: l, moduleId: r }; for (var s = 0; s < C.parents.length; s++) { var u = C.parents[s], d = j[u]; if (d) { if (d.hot._declinedDependencies[r]) return { type: "declined", chain: l.concat([u]), moduleId: r, parentId: u }; if (-1 === t.indexOf(u)) { if (d.hot._acceptedDependencies[r]) { n[u] || (n[u] = []), i(n[u], [r]); continue } delete n[u], t.push(u), a.push({ chain: l.concat([u]), id: u }) } } } } } return { type: "accepted", moduleId: e, outdatedModules: t, outdatedDependencies: n } } function i(e, t) { for (var n = 0; n < t.length; n++) { var a = t[n]; -1 === e.indexOf(a) && e.push(a) } } t = t || {}; var r, d, c, f = {}, h = [], v = {}, p = function e() { console.warn("[HMR] unexpected require(" + M.moduleId + ") to disposed module") }; for (var x in a) if (Object.prototype.hasOwnProperty.call(a, x)) { w = y(x), M = a[x] ? n(w) : { type: "disposed", moduleId: x }; var T, b, _, C, w, M, E = !1, I = !1, P = !1, k = ""; switch (M.chain && (k = "\nUpdate propagation: " + M.chain.join(" -> ")), M.type) { case "self-declined": t.onDeclined && t.onDeclined(M), t.ignoreDeclined || (E = Error("Aborted because of self decline: " + M.moduleId + k)); break; case "declined": t.onDeclined && t.onDeclined(M), t.ignoreDeclined || (E = Error("Aborted because of declined dependency: " + M.moduleId + " in " + M.parentId + k)); break; case "unaccepted": t.onUnaccepted && t.onUnaccepted(M), t.ignoreUnaccepted || (E = Error("Aborted because " + w + " is not accepted" + k)); break; case "accepted": t.onAccepted && t.onAccepted(M), I = !0; break; case "disposed": t.onDisposed && t.onDisposed(M), P = !0; break; default: throw Error("Unexception type " + M.type) }if (E) return m("abort"), Promise.reject(E); if (I) for (w in v[w] = a[w], i(h, M.outdatedModules), M.outdatedDependencies) Object.prototype.hasOwnProperty.call(M.outdatedDependencies, w) && (f[w] || (f[w] = []), i(f[w], M.outdatedDependencies[w])); P && (i(h, [M.moduleId]), v[w] = p) } var D = []; for (b = 0; b < h.length; b++)j[w = h[b]] && j[w].hot._selfAccepted && v[w] !== p && D.push({ module: w, errorHandler: j[w].hot._selfAccepted }); m("dispose"), Object.keys($).forEach(function (e) { if (!1 === $[e]) { var t; t = e, delete installedChunks[t] } }); for (var L = h.slice(); L.length > 0;)if (C = j[w = L.pop()]) { var O = {}, A = C.hot._disposeHandlers; for (_ = 0; _ < A.length; _++)(T = A[_])(O); for (s[w] = O, C.hot.active = !1, delete j[w], delete f[w], _ = 0; _ < C.children.length; _++) { var H = j[C.children[_]]; H && (r = H.parents.indexOf(w)) >= 0 && H.parents.splice(r, 1) } } for (w in f) if (Object.prototype.hasOwnProperty.call(f, w) && (C = j[w])) for (_ = 0, c = f[w]; _ < c.length; _++)d = c[_], (r = C.children.indexOf(d)) >= 0 && C.children.splice(r, 1); for (w in m("apply"), l = o, v) Object.prototype.hasOwnProperty.call(v, w) && (e[w] = v[w]); var R = null; for (w in f) if (Object.prototype.hasOwnProperty.call(f, w) && (C = j[w])) { c = f[w]; var B = []; for (b = 0; b < c.length; b++)if (d = c[b], T = C.hot._acceptedDependencies[d]) { if (-1 !== B.indexOf(T)) continue; B.push(T) } for (b = 0; b < B.length; b++) { T = B[b]; try { T(c) } catch (F) { t.onErrored && t.onErrored({ type: "accept-errored", moduleId: w, dependencyId: c[b], error: F }), t.ignoreErrored || R || (R = F) } } } for (b = 0; b < D.length; b++) { var U = D[b]; u = [w = U.module]; try { S(w) } catch (N) { if ("function" == typeof U.errorHandler) try { U.errorHandler(N) } catch (V) { t.onErrored && t.onErrored({ type: "self-accept-error-handler-errored", moduleId: w, error: V, originalError: N }), t.ignoreErrored || R || (R = V), R || (R = N) } else t.onErrored && t.onErrored({ type: "self-accept-errored", moduleId: w, error: N }), t.ignoreErrored || R || (R = N) } } return R ? (m("fail"), Promise.reject(R)) : (m("idle"), new Promise(function (e) { e(h) })) } var j = {}; function S(n) { if (j[n]) return j[n].exports; var a, o, i = j[n] = { i: n, l: !1, exports: {}, hot: (a = n, o = { _acceptedDependencies: {}, _declinedDependencies: {}, _selfAccepted: !1, _selfDeclined: !1, _disposeHandlers: [], _main: t !== a, active: !0, accept: function (e, t) { if (void 0 === e) o._selfAccepted = !0; else if ("function" == typeof e) o._selfAccepted = e; else if ("object" == typeof e) for (var n = 0; n < e.length; n++)o._acceptedDependencies[e[n]] = t || function () { }; else o._acceptedDependencies[e] = t || function () { } }, decline: function (e) { if (void 0 === e) o._selfDeclined = !0; else if ("object" == typeof e) for (var t = 0; t < e.length; t++)o._declinedDependencies[e[t]] = !0; else o._declinedDependencies[e] = !0 }, dispose: function (e) { o._disposeHandlers.push(e) }, addDisposeHandler: function (e) { o._disposeHandlers.push(e) }, removeDisposeHandler: function (e) { var t = o._disposeHandlers.indexOf(e); t >= 0 && o._disposeHandlers.splice(t, 1) }, check: T, apply: C, status: function (e) { if (!e) return g; f.push(e) }, addStatusHandler: function (e) { f.push(e) }, removeStatusHandler: function (e) { var t = f.indexOf(e); t >= 0 && f.splice(t, 1) }, data: s[a] }, t = void 0, o), parents: (d = u, u = [], d), children: [] }; return e[n].call(i.exports, i, i.exports, c(n)), i.l = !0, i.exports } return S.m = e, S.c = j, S.d = function (e, t, n) { S.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: n }) }, S.r = function (e) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, S.t = function (e, t) { if (1 & t && (e = S(e)), 8 & t || 4 & t && "object" == typeof e && e && e.__esModule) return e; var n = Object.create(null); if (S.r(n), Object.defineProperty(n, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var a in e) S.d(n, a, (function (t) { return e[t] }).bind(null, a)); return n }, S.n = function (e) { var t = e && e.__esModule ? function t() { return e.default } : function t() { return e }; return S.d(t, "a", t), t }, S.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, S.p = "", S.h = function () { return l }, c("./index.js")(S.s = "./index.js") }({ "../node_modules/@babel/runtime/helpers/arrayWithHoles.js": function (e, t) { e.exports = function e(t) { if (Array.isArray(t)) return t } }, "../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js": function (e, t) { e.exports = function e(t) { if (Array.isArray(t)) { for (var n = 0, a = Array(t.length); n < t.length; n++)a[n] = t[n]; return a } } }, "../node_modules/@babel/runtime/helpers/assertThisInitialized.js": function (e, t) { e.exports = function e(t) { if (void 0 === t) throw ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } }, "../node_modules/@babel/runtime/helpers/asyncToGenerator.js": function (e, t) { function n(e, t, n, a, o, i, r) { try { var l = e[i](r), s = l.value } catch (u) { n(u); return } l.done ? t(s) : Promise.resolve(s).then(a, o) } e.exports = function e(t) { return function () { var e = this, a = arguments; return new Promise(function (o, i) { var r = t.apply(e, a); function l(e) { n(r, o, i, l, s, "next", e) } function s(e) { n(r, o, i, l, s, "throw", e) } l(void 0) }) } } }, "../node_modules/@babel/runtime/helpers/classCallCheck.js": function (e, t) { e.exports = function e(t, n) { if (!(t instanceof n)) throw TypeError("Cannot call a class as a function") } }, "../node_modules/@babel/runtime/helpers/createClass.js": function (e, t) { function n(e, t) { for (var n = 0; n < t.length; n++) { var a = t[n]; a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a) } } e.exports = function e(t, a, o) { return a && n(t.prototype, a), o && n(t, o), t } }, "../node_modules/@babel/runtime/helpers/defineProperty.js": function (e, t) { e.exports = function e(t, n, a) { return n in t ? Object.defineProperty(t, n, { value: a, enumerable: !0, configurable: !0, writable: !0 }) : t[n] = a, t } }, "../node_modules/@babel/runtime/helpers/getPrototypeOf.js": function (e, t) { function n(t) { return e.exports = n = Object.setPrototypeOf ? Object.getPrototypeOf : function e(t) { return t.__proto__ || Object.getPrototypeOf(t) }, n(t) } e.exports = n }, "../node_modules/@babel/runtime/helpers/inherits.js": function (e, t, n) { var a = n(/*! ./setPrototypeOf */ "../node_modules/@babel/runtime/helpers/setPrototypeOf.js"); e.exports = function e(t, n) { if ("function" != typeof n && null !== n) throw TypeError("Super expression must either be null or a function"); t.prototype = Object.create(n && n.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), n && a(t, n) } }, "../node_modules/@babel/runtime/helpers/iterableToArray.js": function (e, t) { e.exports = function e(t) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) return Array.from(t) } }, "../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js": function (e, t) { e.exports = function e(t, n) { var a = [], o = !0, i = !1, r = void 0; try { for (var l, s = t[Symbol.iterator](); !(o = (l = s.next()).done) && (a.push(l.value), !n || a.length !== n); o = !0); } catch (u) { i = !0, r = u } finally { try { o || null == s.return || s.return() } finally { if (i) throw r } } return a } }, "../node_modules/@babel/runtime/helpers/nonIterableRest.js": function (e, t) { e.exports = function e() { throw TypeError("Invalid attempt to destructure non-iterable instance") } }, "../node_modules/@babel/runtime/helpers/nonIterableSpread.js": function (e, t) { e.exports = function e() { throw TypeError("Invalid attempt to spread non-iterable instance") } }, "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js": function (e, t, n) { var a = n(/*! ../helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n(/*! ./assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"); e.exports = function e(t, n) { return n && ("object" === a(n) || "function" == typeof n) ? n : o(t) } }, "../node_modules/@babel/runtime/helpers/setPrototypeOf.js": function (e, t) { function n(t, a) { return e.exports = n = Object.setPrototypeOf || function e(t, n) { return t.__proto__ = n, t }, n(t, a) } e.exports = n }, "../node_modules/@babel/runtime/helpers/slicedToArray.js": function (e, t, n) { var a = n(/*! ./arrayWithHoles */ "../node_modules/@babel/runtime/helpers/arrayWithHoles.js"), o = n(/*! ./iterableToArrayLimit */ "../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"), i = n(/*! ./nonIterableRest */ "../node_modules/@babel/runtime/helpers/nonIterableRest.js"); e.exports = function e(t, n) { return a(t) || o(t, n) || i() } }, "../node_modules/@babel/runtime/helpers/toConsumableArray.js": function (e, t, n) { var a = n(/*! ./arrayWithoutHoles */ "../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js"), o = n(/*! ./iterableToArray */ "../node_modules/@babel/runtime/helpers/iterableToArray.js"), i = n(/*! ./nonIterableSpread */ "../node_modules/@babel/runtime/helpers/nonIterableSpread.js"); e.exports = function e(t) { return a(t) || o(t) || i() } }, "../node_modules/@babel/runtime/helpers/typeof.js": function (e, t) { function n(e) { return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function e(t) { return typeof t } : function e(t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(e) } function a(t) { return "function" == typeof Symbol && "symbol" === n(Symbol.iterator) ? e.exports = a = function e(t) { return n(t) } : e.exports = a = function e(t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : n(t) }, a(t) } e.exports = a }, "../node_modules/@babel/runtime/regenerator/index.js": function (e, t, n) { e.exports = n(/*! regenerator-runtime */ "../node_modules/regenerator-runtime/runtime-module.js") }, "../node_modules/ms/index.js": function (e, t) { var n = 36e5, a = 24 * n, o = 7 * a, i = 365.25 * a; function r(e, t, n, a) { return Math.round(e / n) + " " + a + (t >= 1.5 * n ? "s" : "") } e.exports = function (e, t) { t = t || {}; var l, s, u, d, c = typeof e; if ("string" === c && e.length > 0) return function e(t) { if (!((t = String(t)).length > 100)) { var r = /^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t); if (r) { var l = parseFloat(r[1]), s = (r[2] || "ms").toLowerCase(); switch (s) { case "years": case "year": case "yrs": case "yr": case "y": return l * i; case "weeks": case "week": case "w": return l * o; case "days": case "day": case "d": return l * a; case "hours": case "hour": case "hrs": case "hr": case "h": return l * n; case "minutes": case "minute": case "mins": case "min": case "m": return 6e4 * l; case "seconds": case "second": case "secs": case "sec": case "s": return 1e3 * l; case "milliseconds": case "millisecond": case "msecs": case "msec": case "ms": return l; default: return } } } }(e); if ("number" === c && !1 === isNaN(e)) { return t.long ? (l = e, s = Math.abs(l), s >= a ? r(l, s, a, "day") : s >= n ? r(l, s, n, "hour") : s >= 6e4 ? r(l, s, 6e4, "minute") : s >= 1e3 ? r(l, s, 1e3, "second") : l + " ms") : (u = e, d = Math.abs(u), d >= a ? Math.round(u / a) + "d" : d >= n ? Math.round(u / n) + "h" : d >= 6e4 ? Math.round(u / 6e4) + "m" : d >= 1e3 ? Math.round(u / 1e3) + "s" : u + "ms") } throw Error("val is not a non-empty string or a valid number. val=" + JSON.stringify(e)) } }, "../node_modules/process/browser.js": function (e, t) { var n, a, o, i = e.exports = {}; function r() { throw Error("setTimeout has not been defined") } function l() { throw Error("clearTimeout has not been defined") } function s(e) { if (n === setTimeout) return setTimeout(e, 0); if ((n === r || !n) && setTimeout) return n = setTimeout, setTimeout(e, 0); try { return n(e, 0) } catch (t) { try { return n.call(null, e, 0) } catch (a) { return n.call(this, e, 0) } } } !function () { try { n = "function" == typeof setTimeout ? setTimeout : r } catch (e) { n = r } try { a = "function" == typeof clearTimeout ? clearTimeout : l } catch (t) { a = l } }(); var u = [], d = !1, c = -1; function f() { d && o && (d = !1, o.length ? u = o.concat(u) : c = -1, u.length && g()) } function g() { if (!d) { var e = s(f); d = !0; for (var t = u.length; t;) { for (o = u, u = []; ++c < t;)o && o[c].run(); c = -1, t = u.length } o = null, d = !1, function e(t) { if (a === clearTimeout) return clearTimeout(t); if ((a === l || !a) && clearTimeout) return a = clearTimeout, clearTimeout(t); try { return a(t) } catch (n) { try { return a.call(null, t) } catch (o) { return a.call(this, t) } } }(e) } } function m(e, t) { this.fun = e, this.array = t } function h() { } i.nextTick = function (e) { var t = Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)t[n - 1] = arguments[n]; u.push(new m(e, t)), 1 !== u.length || d || s(g) }, m.prototype.run = function () { this.fun.apply(null, this.array) }, i.title = "browser", i.browser = !0, i.env = {}, i.argv = [], i.version = "", i.versions = {}, i.on = h, i.addListener = h, i.once = h, i.off = h, i.removeListener = h, i.removeAllListeners = h, i.emit = h, i.prependListener = h, i.prependOnceListener = h, i.listeners = function (e) { return [] }, i.binding = function (e) { throw Error("process.binding is not supported") }, i.cwd = function () { return "/" }, i.chdir = function (e) { throw Error("process.chdir is not supported") }, i.umask = function () { return 0 } }, "../node_modules/regenerator-runtime/runtime-module.js": function (e, t, n) { var a = function () { return this || "object" == typeof self && self }() || Function("return this")(), o = a.regeneratorRuntime && Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime") >= 0, i = o && a.regeneratorRuntime; if (a.regeneratorRuntime = void 0, e.exports = n(/*! ./runtime */ "../node_modules/regenerator-runtime/runtime.js"), o) a.regeneratorRuntime = i; else try { delete a.regeneratorRuntime } catch (r) { a.regeneratorRuntime = void 0 } }, "../node_modules/regenerator-runtime/runtime.js": function (e, t) { !function (t) { "use strict"; var n, a = Object.prototype, o = a.hasOwnProperty, i = "function" == typeof Symbol ? Symbol : {}, r = i.iterator || "@@iterator", l = i.asyncIterator || "@@asyncIterator", s = i.toStringTag || "@@toStringTag", u = "object" == typeof e, d = t.regeneratorRuntime; if (d) { u && (e.exports = d); return } function c(e, t, n, a) { var o, i, r, l, s = Object.create((t && t.prototype instanceof p ? t : p).prototype), u = new E(a || []); return s._invoke = (o = e, i = n, r = u, l = g, function e(t, n) { if (l === m) throw Error("Generator is already running"); if (l === h) { if ("throw" === t) throw n; return P() } for (r.method = t, r.arg = n; ;) { var a = r.delegate; if (a) { var s = S(a, r); if (s) { if (s === v) continue; return s } } if ("next" === r.method) r.sent = r._sent = r.arg; else if ("throw" === r.method) { if (l === g) throw l = h, r.arg; r.dispatchException(r.arg) } else "return" === r.method && r.abrupt("return", r.arg); l = m; var u = f(o, i, r); if ("normal" === u.type) { if (l = r.done ? h : "suspendedYield", u.arg === v) continue; return { value: u.arg, done: r.done } } "throw" === u.type && (l = h, r.method = "throw", r.arg = u.arg) } }), s } function f(e, t, n) { try { return { type: "normal", arg: e.call(t, n) } } catch (a) { return { type: "throw", arg: a } } } (d = t.regeneratorRuntime = u ? e.exports : {}).wrap = c; var g = "suspendedStart", m = "executing", h = "completed", v = {}; function p() { } function x() { } function $() { } var y = {}; y[r] = function () { return this }; var T = Object.getPrototypeOf, b = T && T(T(I([]))); b && b !== a && o.call(b, r) && (y = b); var _ = $.prototype = p.prototype = Object.create(y); function C(e) { ["next", "throw", "return"].forEach(function (t) { e[t] = function (e) { return this._invoke(t, e) } }) } function j(e) { var t; this._invoke = function n(a, i) { function r() { return new Promise(function (t, n) { !function t(n, a, i, r) { var l = f(e[n], e, a); if ("throw" === l.type) r(l.arg); else { var s = l.arg, u = s.value; return u && "object" == typeof u && o.call(u, "__await") ? Promise.resolve(u.__await).then(function (e) { t("next", e, i, r) }, function (e) { t("throw", e, i, r) }) : Promise.resolve(u).then(function (e) { s.value = e, i(s) }, function (e) { return t("throw", e, i, r) }) } }(a, i, t, n) }) } return t = t ? t.then(r, r) : r() } } function S(e, t) { var a = e.iterator[t.method]; if (a === n) { if (t.delegate = null, "throw" === t.method) { if (e.iterator.return && (t.method = "return", t.arg = n, S(e, t), "throw" === t.method)) return v; t.method = "throw", t.arg = TypeError("The iterator does not provide a 'throw' method") } return v } var o = f(a, e.iterator, t.arg); if ("throw" === o.type) return t.method = "throw", t.arg = o.arg, t.delegate = null, v; var i = o.arg; return i ? i.done ? (t[e.resultName] = i.value, t.next = e.nextLoc, "return" !== t.method && (t.method = "next", t.arg = n), t.delegate = null, v) : i : (t.method = "throw", t.arg = TypeError("iterator result is not an object"), t.delegate = null, v) } function w(e) { var t = { tryLoc: e[0] }; 1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t) } function M(e) { var t = e.completion || {}; t.type = "normal", delete t.arg, e.completion = t } function E(e) { this.tryEntries = [{ tryLoc: "root" }], e.forEach(w, this), this.reset(!0) } function I(e) { if (e) { var t = e[r]; if (t) return t.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var a = -1, i = function t() { for (; ++a < e.length;)if (o.call(e, a)) return t.value = e[a], t.done = !1, t; return t.value = n, t.done = !0, t }; return i.next = i } } return { next: P } } function P() { return { value: n, done: !0 } } x.prototype = _.constructor = $, $.constructor = x, $[s] = x.displayName = "GeneratorFunction", d.isGeneratorFunction = function (e) { var t = "function" == typeof e && e.constructor; return !!t && (t === x || "GeneratorFunction" === (t.displayName || t.name)) }, d.mark = function (e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, $) : (e.__proto__ = $, s in e || (e[s] = "GeneratorFunction")), e.prototype = Object.create(_), e }, d.awrap = function (e) { return { __await: e } }, C(j.prototype), j.prototype[l] = function () { return this }, d.AsyncIterator = j, d.async = function (e, t, n, a) { var o = new j(c(e, t, n, a)); return d.isGeneratorFunction(t) ? o : o.next().then(function (e) { return e.done ? e.value : o.next() }) }, C(_), _[s] = "Generator", _[r] = function () { return this }, _.toString = function () { return "[object Generator]" }, d.keys = function (e) { var t = []; for (var n in e) t.push(n); return t.reverse(), function n() { for (; t.length;) { var a = t.pop(); if (a in e) return n.value = a, n.done = !1, n } return n.done = !0, n } }, d.values = I, E.prototype = { constructor: E, reset: function (e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = n, this.done = !1, this.delegate = null, this.method = "next", this.arg = n, this.tryEntries.forEach(M), !e) for (var t in this) "t" === t.charAt(0) && o.call(this, t) && !isNaN(+t.slice(1)) && (this[t] = n) }, stop: function () { this.done = !0; var e = this.tryEntries[0].completion; if ("throw" === e.type) throw e.arg; return this.rval }, dispatchException: function (e) { if (this.done) throw e; var t = this; function a(a, o) { return l.type = "throw", l.arg = e, t.next = a, o && (t.method = "next", t.arg = n), !!o } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var r = this.tryEntries[i], l = r.completion; if ("root" === r.tryLoc) return a("end"); if (r.tryLoc <= this.prev) { var s = o.call(r, "catchLoc"), u = o.call(r, "finallyLoc"); if (s && u) { if (this.prev < r.catchLoc) return a(r.catchLoc, !0); if (this.prev < r.finallyLoc) return a(r.finallyLoc) } else if (s) { if (this.prev < r.catchLoc) return a(r.catchLoc, !0) } else if (u) { if (this.prev < r.finallyLoc) return a(r.finallyLoc) } else throw Error("try statement without catch or finally") } } }, abrupt: function (e, t) { for (var n = this.tryEntries.length - 1; n >= 0; --n) { var a = this.tryEntries[n]; if (a.tryLoc <= this.prev && o.call(a, "finallyLoc") && this.prev < a.finallyLoc) { var i = a; break } } i && ("break" === e || "continue" === e) && i.tryLoc <= t && t <= i.finallyLoc && (i = null); var r = i ? i.completion : {}; return (r.type = e, r.arg = t, i) ? (this.method = "next", this.next = i.finallyLoc, v) : this.complete(r) }, complete: function (e, t) { if ("throw" === e.type) throw e.arg; return "break" === e.type || "continue" === e.type ? this.next = e.arg : "return" === e.type ? (this.rval = this.arg = e.arg, this.method = "return", this.next = "end") : "normal" === e.type && t && (this.next = t), v }, finish: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var n = this.tryEntries[t]; if (n.finallyLoc === e) return this.complete(n.completion, n.afterLoc), M(n), v } }, catch: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var n = this.tryEntries[t]; if (n.tryLoc === e) { var a = n.completion; if ("throw" === a.type) { var o = a.arg; M(n) } return o } } throw Error("illegal catch attempt") }, delegateYield: function (e, t, a) { return this.delegate = { iterator: I(e), resultName: t, nextLoc: a }, "next" === this.method && (this.arg = n), v } } }(function () { return this || "object" == typeof self && self }() || Function("return this")()) }, "./drawing/draw.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { e.save(), t(e), e.restore() } }, "./drawing/drawArrow.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./drawLine.js */ "./drawing/drawLine.js"), o = n(/*! ./drawJoinedLines.js */ "./drawing/drawJoinedLines.js"); t.default = function (e, t, n, i, r, l) { var s = Math.atan2(n.y - t.y, n.x - t.x), u = { color: i, lineWidth: r }; l && (u.lineDash = l), Object(a.default)(e, void 0, t, n, u, "canvas"), u = { color: i, lineWidth: r, fillStyle: i }; var d = [{ x: n.x - 10 * Math.cos(s - Math.PI / 7), y: n.y - 10 * Math.sin(s - Math.PI / 7) }, { x: n.x - 10 * Math.cos(s + Math.PI / 7), y: n.y - 10 * Math.sin(s + Math.PI / 7) }, n]; Object(o.default)(e, void 0, n, d, u, "canvas") } }, "./drawing/drawCircle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"); t.default = function (e, t, n, i, r) { var l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel"; "pixel" === l && (n = a.default.cornerstone.pixelToCanvas(t, n)), Object(o.default)(e, r, function (e) { e.arc(n.x, n.y, i, 0, 2 * Math.PI) }) } }, "./drawing/drawEllipse.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"), i = n(/*! ../util/pointProjector.js */ "./util/pointProjector.js"); t.default = function (e, t, n, r, l) { var s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel", u = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : 0; "pixel" === s && (n = a.default.cornerstone.pixelToCanvas(t, n), r = a.default.cornerstone.pixelToCanvas(t, r)); var d = a.default.cornerstone.getViewport(t), c = t.clientWidth, f = t.clientHeight, g = d.scale, m = d.translation, h = d.rotation - u, v = { x: c / 2 + m.x * g, y: f / 2 + m.y * g }; Math.abs(h) > .05 && (n = Object(i.rotatePoint)(n, v, -h), r = Object(i.rotatePoint)(r, v, -h)); var p, x = Math.abs(n.x - r.x), $ = Math.abs(n.y - r.y), y = { x: Math.min(n.x, r.x) + x / 2, y: Math.min(n.y, r.y) + $ / 2 }; Math.abs(h) > .05 && (y = Object(i.rotatePoint)(y, v, h)); var T = h * Math.PI / 180; Object(o.default)(e, l, function (e) { e.ellipse(y.x, y.y, x / 2, $ / 2, T, 0, 2 * Math.PI), e.closePath() }) } }, "./drawing/drawHandles.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), i = n(/*! ./../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), r = n(/*! ./path.js */ "./drawing/path.js"), l = n(/*! ./../store/index.js */ "./store/index.js"); t.default = function (e, t, n) { var s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {}, u = t.element, d = i.default.getToolColor(); e.strokeStyle = s.color || d; for (var c = Object.keys(n), f = 0; f < c.length; f++)if ("continue" === function t(i) { var d = n[c[i]]; if (!0 === d.drawnIndependently || !0 === s.drawHandlesIfActive && !d.active || s.hideHandlesIfMoving && d.moving) return "continue"; var f, g = { lineWidth: d.active ? o.default.getActiveWidth() : o.default.getToolWidth(), fillStyle: s.fill }; s.lineDash && (g.lineDash = s.lineDash), Object(r.default)(e, g, function (e) { var t = a.default.cornerstone.pixelToCanvas(u, d), n = d.radius || s.handleRadius || l.state.handleRadius; e.arc(t.x, t.y, n, 0, 2 * Math.PI) }) }(f)) continue } }, "./drawing/drawJoinedLines.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"); t.default = function (e, t, n, i, r) { var l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel"; Object(o.default)(e, r, function (e) { "pixel" === l && (n = a.default.cornerstone.pixelToCanvas(t, n), i = i.map(function (e) { return a.default.cornerstone.pixelToCanvas(t, e) })), e.moveTo(n.x, n.y), i.forEach(function (t) { var n = t.x, a = t.y; e.lineTo(n, a) }) }) } }, "./drawing/drawLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"); function i(e, t, n, i, r) { var l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel"; Object(o.default)(e, r, function (e) { "pixel" === l && (n = a.default.cornerstone.pixelToCanvas(t, n), i = a.default.cornerstone.pixelToCanvas(t, i)), e.moveTo(n.x, n.y), e.lineTo(i.x, i.y) }) } }, "./drawing/drawLines.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"); t.default = function (e, t, n, i) { var r = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : "pixel"; Object(o.default)(e, i, function (e) { n.forEach(function (n) { var o = n.start, i = n.end; if ("pixel" === r) { var l = a.default.cornerstone; o = l.pixelToCanvas(t, o), i = l.pixelToCanvas(t, i) } e.moveTo(o.x, o.y), e.lineTo(i.x, i.y) }) }) } }, "./drawing/drawLink.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ./drawLine.js */ "./drawing/drawLine.js"); t.default = function (e, t, n, i, r, l) { var s = e.length > 0 ? a.default.cornerstoneMath.point.findClosestPoint(e, t) : t, u = [{ x: n.left + n.width / 2, y: n.top }, { x: n.left, y: n.top + n.height / 2 }, { x: n.left + n.width / 2, y: n.top + n.height }, { x: n.left + n.width, y: n.top + n.height / 2 }], d = a.default.cornerstoneMath.point.findClosestPoint(u, s); Object(o.default)(i, void 0, s, d, { color: r, lineWidth: l, lineDash: [2, 3] }, "canvas") } }, "./drawing/drawLinkedTextBox.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ./drawTextBox.js */ "./drawing/drawTextBox.js"), i = n(/*! ./drawLink.js */ "./drawing/drawLink.js"), r = n(/*! ./../store/index.js */ "./store/index.js"), l = n(/*! ../util/clip.js */ "./util/clip.js"); t.default = function (e, t, n, s, u, d, c, f, g, m) { var h = a.default.cornerstone.pixelToCanvas, v = h(t, n); g && (v.x += g); var p = { centering: { x: !1, y: m } }; if (r.state.preventTextBoxOutsideDisplayedArea && (p.displacer = function (e) { return Object(l.clipBoxToDisplayedArea)(t, e) }), n.boundingBox = Object(o.default)(e, s, v.x, v.y, c, p), n.hasMoved) { var x = d(u).map(function (e) { return h(t, e) }); Object(i.default)(x, v, n.boundingBox, e, c, f) } } }, "./drawing/drawRect.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"), i = n(/*! ../util/pointProjector.js */ "./util/pointProjector.js"); t.default = function (e, t, n, r, l) { var s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel", u = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : 0; if ("pixel" === s) { var d = a.default.cornerstone; n = d.pixelToCanvas(t, n), r = d.pixelToCanvas(t, r) } var c = a.default.cornerstone.getViewport(t), f = t.clientWidth, g = t.clientHeight, m = c.scale, h = c.translation, v = c.rotation - u, p = { x: f / 2 + h.x * m, y: g / 2 + h.y * m }; Math.abs(v) > .05 && (n = Object(i.rotatePoint)(n, p, -v), r = Object(i.rotatePoint)(r, p, -v)); var x = Math.abs(n.x - r.x), $ = Math.abs(n.y - r.y); r = { x: (n = { x: Math.min(n.x, r.x), y: Math.min(n.y, r.y) }).x + x, y: n.y + $ }; var y = { x: n.x + x, y: n.y }, T = { x: n.x, y: n.y + $ }; Math.abs(v) > .05 && (n = Object(i.rotatePoint)(n, p, v), r = Object(i.rotatePoint)(r, p, v), y = Object(i.rotatePoint)(y, p, v), T = Object(i.rotatePoint)(T, p, v)), Object(o.default)(e, l, function (e) { e.moveTo(n.x, n.y), e.lineTo(y.x, y.y), e.lineTo(r.x, r.y), e.lineTo(T.x, T.y), e.lineTo(n.x, n.y) }) } }, "./drawing/drawTextBox.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "textBoxWidth", function () { return l }); var a = n(/*! ../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"), o = n(/*! ./draw.js */ "./drawing/draw.js"), i = n(/*! ./fillTextLines.js */ "./drawing/fillTextLines.js"), r = n(/*! ./fillBox.js */ "./drawing/fillBox.js"); function l(e, t, n) { var o = a.default.getFont(), i = e.font; o && o !== i && (e.font = o); var r = e.measureText(t).width; return o && o !== i && (e.font = i), r + 2 * n } t.default = function (e, t, n, s, u) { var d = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}; "[object Array]" !== Object.prototype.toString.call(t) && (t = [t]); var c = a.default.getFontSize(), f = a.default.getBackgroundColor(), g = 0; t.forEach(function (t) { g = Math.max(g, l(e, t, 5)) }); var m = { width: g, height: 5 + t.length * (c + 5) }; return Object(o.default)(e, function (e) { e.strokeStyle = u, d.centering && (!0 === d.centering.x && (n -= m.width / 2), !0 === d.centering.y && (s -= m.height / 2)), m.left = n, m.top = s, "function" == typeof d.displacer && d.displacer(m), Object(r.default)(e, m, f), Object(i.default)(e, m, t, u, 5) }), m } }, "./drawing/fillBox.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { e.fillStyle = n, e.fillRect(t.left, t.top, t.width, t.height) } }, "./drawing/fillOutsideRect.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = n(/*! ./path.js */ "./drawing/path.js"); t.default = function (e, t, n, i, r) { var l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "pixel"; if ("pixel" === l) { var s = a.default.cornerstone; n = s.pixelToCanvas(t, n), i = s.pixelToCanvas(t, i) } var u = Math.min(n.x, i.x), d = Math.min(n.y, i.y), c = Math.abs(n.x - i.x), f = Math.abs(n.y - i.y); Object(o.default)(e, r, function (e) { e.rect(0, 0, e.canvas.clientWidth, e.canvas.clientHeight), e.rect(u + c, d, -c, f) }) } }, "./drawing/fillTextLines.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"); t.default = function (e, t, n, o, i) { var r = a.default.getFontSize(); e.font = a.default.getFont(), e.textBaseline = "top", e.fillStyle = o, n.forEach(function (n, a) { e.fillText(n, t.left + i, t.top + i + a * (r + i)) }) } }, "./drawing/getNewContext.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e) { var t = e.getContext("2d"); return t.setTransform(1, 0, 0, 1, 0, 0), t } }, "./drawing/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./draw.js */ "./drawing/draw.js"); n.d(t, "draw", function () { return a.default }); var o = n(/*! ./drawArrow.js */ "./drawing/drawArrow.js"); n.d(t, "drawArrow", function () { return o.default }); var i = n(/*! ./drawCircle.js */ "./drawing/drawCircle.js"); n.d(t, "drawCircle", function () { return i.default }); var r = n(/*! ./drawEllipse.js */ "./drawing/drawEllipse.js"); n.d(t, "drawEllipse", function () { return r.default }); var l = n(/*! ./drawHandles.js */ "./drawing/drawHandles.js"); n.d(t, "drawHandles", function () { return l.default }); var s = n(/*! ./drawJoinedLines.js */ "./drawing/drawJoinedLines.js"); n.d(t, "drawJoinedLines", function () { return s.default }); var u = n(/*! ./drawLine.js */ "./drawing/drawLine.js"); n.d(t, "drawLine", function () { return u.default }); var d = n(/*! ./drawLines.js */ "./drawing/drawLines.js"); n.d(t, "drawLines", function () { return d.default }); var c = n(/*! ./drawLink.js */ "./drawing/drawLink.js"); n.d(t, "drawLink", function () { return c.default }); var f = n(/*! ./drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"); n.d(t, "drawLinkedTextBox", function () { return f.default }); var g = n(/*! ./drawRect.js */ "./drawing/drawRect.js"); n.d(t, "drawRect", function () { return g.default }); var m = n(/*! ./drawTextBox.js */ "./drawing/drawTextBox.js"); n.d(t, "drawTextBox", function () { return m.default }); var h = n(/*! ./fillBox.js */ "./drawing/fillBox.js"); n.d(t, "fillBox", function () { return h.default }); var v = n(/*! ./fillOutsideRect.js */ "./drawing/fillOutsideRect.js"); n.d(t, "fillOutsideRect", function () { return v.default }); var p = n(/*! ./fillTextLines.js */ "./drawing/fillTextLines.js"); n.d(t, "fillTextLines", function () { return p.default }); var x = n(/*! ./getNewContext.js */ "./drawing/getNewContext.js"); n.d(t, "getNewContext", function () { return x.default }); var $ = n(/*! ./path.js */ "./drawing/path.js"); n.d(t, "path", function () { return $.default }); var y = n(/*! ./setShadow.js */ "./drawing/setShadow.js"); n.d(t, "setShadow", function () { return y.default }); var T = n(/*! ./transformCanvasContext.js */ "./drawing/transformCanvasContext.js"); n.d(t, "transformCanvasContext", function () { return T.default }); var b = n(/*! ./resetCanvasContextTransform.js */ "./drawing/resetCanvasContextTransform.js"); n.d(t, "resetCanvasContextTransform", function () { return b.default }) }, "./drawing/path.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"); t.default = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 ? arguments[2] : void 0, o = t.color, i = t.lineWidth, r = t.fillStyle, l = t.lineDash, s = t.shouldDrawLines; e.beginPath(), e.strokeStyle = o || e.strokeStyle, e.lineWidth = i || void 0 === i && a.default.getToolWidth() || e.lineWidth, l && e.setLineDash(l), n(e), r && (e.fillStyle = r, e.fill()), (void 0 === s || s) && e.stroke(), l && e.setLineDash([]) } }, "./drawing/resetCanvasContextTransform.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e) { e.setTransform(1, 0, 0, 1, 0, 0) } }, "./drawing/setShadow.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../util/getDefault.js */ "./util/getDefault.js"); t.default = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; t.shadow && (e.shadowColor = Object(a.default)(t.shadowColor, "#000000"), e.shadowBlur = Object(a.default)(t.shadowBlur, 0), e.shadowOffsetX = Object(a.default)(t.shadowOffsetX, 1), e.shadowOffsetY = Object(a.default)(t.shadowOffsetY, 1)) } }, "./drawing/transformCanvasContext.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { if (n.hflip || n.vflip || n.rotation) { var a = { x: t.width / 2 + n.translation.x * n.scale, y: t.height / 2 + n.translation.y * n.scale }; e.translate(a.x, a.y), n.rotation && e.rotate(n.rotation * Math.PI / 180), n.vflip && e.scale(1, -1), n.hflip && e.scale(-1, 1), e.translate(-a.x, -a.y) } } }, "./eventDispatchers/imageRenderedEventDispatcher.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../store/index.js */ "./store/index.js"), o = n(/*! ../stateManagement/toolState */ "./stateManagement/toolState.js"), i = n(/*! ../eventListeners/onImageRenderedBrushEventHandler.js */ "./eventListeners/onImageRenderedBrushEventHandler.js"), r = n(/*! ./../externalModules.js */ "./externalModules.js"), l = Object(a.getModule)("segmentation"), s = function e(t) { var n = t.detail, r = n.element, s = a.state.tools.filter(function (e) { return e.element === r && ("active" === e.mode || "passive" === e.mode || "enabled" === e.mode) }), u = Object(o.getToolState)(r, "stack"), d = l.configuration; u && (d.renderFill || d.renderOutline) && Object(i.default)(t); var c = n.canvasContext.canvas.getContext("2d"); s.forEach(function (e) { e.renderToolData && (c.save(), e.renderToolData(t), c.restore()) }) }, u = function e(t) { t.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED, s) }, d = function e(t) { t.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED, s) }; t.default = { enable: u, disable: d } }, "./eventDispatchers/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./imageRenderedEventDispatcher.js */ "./eventDispatchers/imageRenderedEventDispatcher.js"); n.d(t, "imageRenderedEventDispatcher", function () { return a.default }); var o = n(/*! ./mouseToolEventDispatcher.js */ "./eventDispatchers/mouseToolEventDispatcher.js"); n.d(t, "mouseToolEventDispatcher", function () { return o.default }); var i = n(/*! ./newImageEventDispatcher.js */ "./eventDispatchers/newImageEventDispatcher.js"); n.d(t, "newImageEventDispatcher", function () { return i.default }); var r = n(/*! ./touchToolEventDispatcher.js */ "./eventDispatchers/touchToolEventDispatcher.js"); n.d(t, "touchToolEventDispatcher", function () { return r.default }) }, "./eventDispatchers/mouseEventHandlers/addNewMeasurement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../events.js */ "./events.js"), o = n(/*! ../../externalModules.js */ "./externalModules.js"), i = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), r = n(/*! ../../manipulators/index.js */ "./manipulators/index.js"), l = n(/*! ../../util/logger.js */ "./util/logger.js"), s = n(/*! ../../util/triggerEvent.js */ "./util/triggerEvent.js"), u = Object(l.getLogger)("eventDispatchers:mouseEventHandlers"); t.default = function (e, t) { u.log("addNewMeasurement"), e.preventDefault(), e.stopPropagation(); var n = e.detail, l = n.element, d = t.createNewMeasurement(n); d && (Object(i.addToolState)(l, t.name, d), o.default.cornerstone.updateImage(l), (1 === Object.keys(d.handles).length ? r.moveHandle : r.moveNewHandle)(n, t.name, d, d.handles.end, t.options, "mouse", function (e) { if (!d.cancelled) { if (e) { var n = a.default.MEASUREMENT_COMPLETED, o = { toolName: t.name, toolType: t.name, element: l, measurementData: d }; Object(s.default)(l, n, o) } else Object(i.removeToolState)(l, t.name, d) } })) } }, "./eventDispatchers/mouseEventHandlers/index.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "mouseClick", function () { return s }), n.d(t, "mouseDoubleClick", function () { return u }), n.d(t, "mouseUp", function () { return d }), n.d(t, "mouseWheel", function () { return c }); var a = n(/*! ./../shared/customCallbackHandler.js */ "./eventDispatchers/shared/customCallbackHandler.js"), o = n(/*! ./mouseDown.js */ "./eventDispatchers/mouseEventHandlers/mouseDown.js"); n.d(t, "mouseDown", function () { return o.default }); var i = n(/*! ./mouseDownActivate.js */ "./eventDispatchers/mouseEventHandlers/mouseDownActivate.js"); n.d(t, "mouseDownActivate", function () { return i.default }); var r = n(/*! ./mouseDrag.js */ "./eventDispatchers/mouseEventHandlers/mouseDrag.js"); n.d(t, "mouseDrag", function () { return r.default }); var l = n(/*! ./mouseMove.js */ "./eventDispatchers/mouseEventHandlers/mouseMove.js"); n.d(t, "mouseMove", function () { return l.default }); var s = a.default.bind(null, "Mouse", "mouseClickCallback"), u = a.default.bind(null, "Mouse", "doubleClickCallback"), d = a.default.bind(null, "Mouse", "mouseUpCallback"), c = a.default.bind(null, "MouseWheel", "mouseWheelCallback") }, "./eventDispatchers/mouseEventHandlers/mouseDown.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../store/index.js */ "./store/index.js"), o = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ../../store/getToolsWithMoveableHandles.js */ "./store/getToolsWithMoveableHandles.js"), r = n(/*! ../../util/findAndMoveHelpers.js */ "./util/findAndMoveHelpers.js"), l = n(/*! ./../../store/getInteractiveToolsForElement.js */ "./store/getInteractiveToolsForElement.js"), s = n(/*! ./../../store/getToolsWithDataForElement.js */ "./store/getToolsWithDataForElement.js"), u = n(/*! ./../../store/filterToolsUsableWithMultiPartTools.js */ "./store/filterToolsUsableWithMultiPartTools.js"); t.default = function (e) { if (!a.state.isToolLocked) { var t = e.detail, n = e.detail.element, d = e.detail.currentPoints.canvas, c = Object(l.default)(n, a.getters.mouseTools()), f = c.filter(function (e) { return "active" === e.mode && Array.isArray(e.options.mouseButtonMask) && e.options.mouseButtonMask.includes(t.buttons) && e.options.isMouseActive }); if (a.state.isMultiPartToolActive && (f = Object(u.default)(f)), f.length > 0) { var g = f.find(function (e) { return "function" == typeof e.preMouseDownCallback }); if (g && g.preMouseDownCallback(e)) return } if (!a.state.isMultiPartToolActive) { var m = Object(s.default)(n, c), h = Object(i.default)(n, m, d, "mouse"); if (h.length > 0) { var v = h[0], p = Object(o.getToolState)(n, v.name), x = Object(r.findHandleDataNearImagePoint)(n, p, v.name, d), $ = x.handle, y = x.data; v.handleSelectedCallback(e, y, $, "mouse"); return } var T = c.filter(function (e) { var t = Object(o.getToolState)(n, e.name); return t && t.data && e.pointNearTool && t.data.some(function (t) { return e.pointNearTool(n, t, d, "mouse") }) }); if (T.length > 0) { var b = T[0], _ = Object(o.getToolState)(n, b.name).data.find(function (e) { return b.pointNearTool(n, e, d) }); b.toolSelectedCallback(e, _, "mouse"); return } if (f.length > 0) { var C = f.find(function (e) { return "function" == typeof e.postMouseDownCallback }); if (C && C.postMouseDownCallback(e)) return } } } } }, "./eventDispatchers/mouseEventHandlers/mouseDownActivate.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./addNewMeasurement.js */ "./eventDispatchers/mouseEventHandlers/addNewMeasurement.js"), o = n(/*! ./../../store/index.js */ "./store/index.js"), i = n(/*! ./../../tools/base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), r = n(/*! ../../util/getActiveTool */ "./util/getActiveTool.js"); t.default = function (e) { if (!o.state.isToolLocked) { var t = e.detail, n = t.element, l = t.buttons, s = Object(r.default)(n, l, "mouse"); if (!(!s || "function" == typeof s.preMouseDownActivateCallback && s.preMouseDownActivateCallback(e))) !o.state.isMultiPartToolActive && (s.addNewMeasurement ? s.addNewMeasurement(e, "mouse") : s instanceof i.default && Object(a.default)(e, s)) } } }, "./eventDispatchers/mouseEventHandlers/mouseDrag.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../store/index.js */ "./store/index.js"), o = n(/*! ./../../store/getActiveToolsForElement.js */ "./store/getActiveToolsForElement.js"), i = n(/*! ./../../store/filterToolsUsableWithMultiPartTools.js */ "./store/filterToolsUsableWithMultiPartTools.js"); t.default = function (e) { if (!a.state.isToolLocked) { var t, n = e.detail, r = n.element; t = (t = (t = Object(o.default)(r, a.getters.mouseTools())).filter(function (e) { return Array.isArray(e.options.mouseButtonMask) && e.options.mouseButtonMask.includes(n.buttons) && e.options.isMouseActive })).filter(function (e) { return "function" == typeof e.mouseDragCallback }), a.state.isMultiPartToolActive && (t = Object(i.default)(t)), 0 !== t.length && t[0].mouseDragCallback(e) } } }, "./eventDispatchers/mouseEventHandlers/mouseMove.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../externalModules.js */ "./externalModules.js"), o = n(/*! ./../../store/index.js */ "./store/index.js"), i = n(/*! ./../../store/getInteractiveToolsForElement.js */ "./store/getInteractiveToolsForElement.js"), r = n(/*! ./../../store/getToolsWithDataForElement.js */ "./store/getToolsWithDataForElement.js"); t.default = function (e) { if (!o.state.isToolLocked && !o.state.isMultiPartToolActive) { var t, n = e.detail, l = n.element, s = n.currentPoints; o.state.mousePositionImage = s.image; var u = (t = Object(i.default)(l, o.getters.mouseTools())).filter(function (e) { return "active" === e.mode && e.options.isMouseActive }), d = !1; u.length > 0 && (d = u.some(function (e) { return e.updateOnMouseMove })), t = Object(r.default)(l, t); for (var c = 0; c < t.length; c++) { var f = t[c]; "function" == typeof f.mouseMoveCallback && (d = f.mouseMoveCallback(e) || d) } !0 === d && a.default.cornerstone.updateImage(l) } } }, "./eventDispatchers/mouseToolEventDispatcher.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../events.js */ "./events.js"), o = n(/*! ./mouseEventHandlers/index.js */ "./eventDispatchers/mouseEventHandlers/index.js"), i = function e(t) { t.addEventListener(a.default.MOUSE_CLICK, o.mouseClick), t.addEventListener(a.default.MOUSE_DOWN, o.mouseDown), t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE, o.mouseDownActivate), t.addEventListener(a.default.MOUSE_DOUBLE_CLICK, o.mouseDoubleClick), t.addEventListener(a.default.MOUSE_DRAG, o.mouseDrag), t.addEventListener(a.default.MOUSE_MOVE, o.mouseMove), t.addEventListener(a.default.MOUSE_UP, o.mouseUp), t.addEventListener(a.default.MOUSE_WHEEL, o.mouseWheel) }, r = function e(t) { t.removeEventListener(a.default.MOUSE_CLICK, o.mouseClick), t.removeEventListener(a.default.MOUSE_DOWN, o.mouseDown), t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE, o.mouseDownActivate), t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK, o.mouseDoubleClick), t.removeEventListener(a.default.MOUSE_DRAG, o.mouseDrag), t.removeEventListener(a.default.MOUSE_MOVE, o.mouseMove), t.removeEventListener(a.default.MOUSE_UP, o.mouseUp), t.removeEventListener(a.default.MOUSE_WHEEL, o.mouseWheel) }; t.default = { enable: i, disable: r } }, "./eventDispatchers/newImageEventDispatcher.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../store/index.js */ "./store/index.js"), o = n(/*! ./../externalModules.js */ "./externalModules.js"), i = function e(t) { if (a.state.isToolLocked) return !1; var n = t.detail.element, o = a.state.tools.filter(function (e) { return e.element === n && ("active" === e.mode || "passive" === e.mode || "enabled" === e.mode) }); if (0 === o.length) return !1; o.forEach(function (e) { e.newImageCallback && e.newImageCallback(t) }) }, r = function e(t) { t.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE, i) }, l = function e(t) { t.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE, i) }; t.default = { enable: r, disable: l } }, "./eventDispatchers/shared/customCallbackHandler.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../store/index.js */ "./store/index.js"), o = n(/*! ./../../store/getActiveToolsForElement.js */ "./store/getActiveToolsForElement.js"), i = n(/*! ./../../store/filterToolsUsableWithMultiPartTools.js */ "./store/filterToolsUsableWithMultiPartTools.js"); t.default = function (e, t, n) { if (a.state.isToolLocked) return !1; var r = n.detail.element, l = a.state.tools.filter(function (t) { return t.supportedInteractionTypes.includes(e) }); if (l = (l = Object(o.default)(r, l, e)).filter(function (e) { return "function" == typeof e[t] }), a.state.isMultiPartToolActive && (l = Object(i.default)(l)), 0 === l.length) return !1; l[0][t](n) } }, "./eventDispatchers/touchEventHandlers/addNewMeasurement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../events.js */ "./events.js"), o = n(/*! ../../externalModules.js */ "./externalModules.js"), i = n(/*! ../../store/index.js */ "./store/index.js"), r = n(/*! ./../../manipulators/anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), l = n(/*! ../../manipulators/index.js */ "./manipulators/index.js"), s = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), u = n(/*! ../../util/triggerEvent.js */ "./util/triggerEvent.js"), d = Object(n(/*! ../../util/logger.js */ "./util/logger.js").getLogger)("eventDispatchers:touchEventHandlers"); t.default = function (e, t) { d.log("addNewMeasurement"), e.preventDefault(), e.stopPropagation(); var n = e.detail, c = n.element, f = t.createNewMeasurement(n); if (f) { if (Object(s.addToolState)(c, t.name, f), 1 === Object.keys(f.handles).length && n.type === a.default.TAP) { f.active = !1, f.handles.end.active = !1, f.handles.end.highlight = !1, f.invalidated = !0, (i.state.deleteIfHandleOutsideImage || t.options.deleteIfHandleOutsideImage) && Object(r.default)(n, f.handles) && Object(s.removeToolState)(c, t.name, f), o.default.cornerstone.updateImage(c); return } o.default.cornerstone.updateImage(c), Object(l.moveNewHandle)(n, t.name, f, f.handles.end, t.options, "touch", function () { var e = a.default.MEASUREMENT_COMPLETED, n = { toolName: t.name, toolType: t.name, element: c, measurementData: f }; Object(u.default)(c, e, n) }) } } }, "./eventDispatchers/touchEventHandlers/index.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "doubleTap", function () { return s }), n.d(t, "touchDrag", function () { return u }), n.d(t, "touchEnd", function () { return d }), n.d(t, "touchPinch", function () { return c }), n.d(t, "touchPress", function () { return f }), n.d(t, "touchRotate", function () { return g }); var a = n(/*! ./../shared/customCallbackHandler.js */ "./eventDispatchers/shared/customCallbackHandler.js"), o = n(/*! ./multiTouchDrag.js */ "./eventDispatchers/touchEventHandlers/multiTouchDrag.js"); n.d(t, "multiTouchDrag", function () { return o.default }); var i = n(/*! ./tap.js */ "./eventDispatchers/touchEventHandlers/tap.js"); n.d(t, "tap", function () { return i.default }); var r = n(/*! ./touchStart.js */ "./eventDispatchers/touchEventHandlers/touchStart.js"); n.d(t, "touchStart", function () { return r.default }); var l = n(/*! ./touchStartActive.js */ "./eventDispatchers/touchEventHandlers/touchStartActive.js"); n.d(t, "touchStartActive", function () { return l.default }); var s = a.default.bind(null, "DoubleTap", "doubleTapCallback"), u = a.default.bind(null, "Touch", "touchDragCallback"), d = a.default.bind(null, "Touch", "touchEndCallback"), c = a.default.bind(null, "TouchPinch", "touchPinchCallback"), f = a.default.bind(null, "Touch", "touchPressCallback"), g = a.default.bind(null, "TouchRotate", "touchRotateCallback") }, "./eventDispatchers/touchEventHandlers/multiTouchDrag.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../store/index.js */ "./store/index.js"), o = n(/*! ../../store/getActiveToolsForElement.js */ "./store/getActiveToolsForElement.js"), i = n(/*! ./../../store/filterToolsUsableWithMultiPartTools.js */ "./store/filterToolsUsableWithMultiPartTools.js"); t.default = function (e) { if (a.state.isToolLocked) return !1; var t = e.detail, n = t.element, r = t.numPointers, l = a.state.tools.filter(function (e) { return e.supportedInteractionTypes.includes("MultiTouch") }); if (l = (l = Object(o.default)(n, l, "MultiTouch")).filter(function (e) { return "function" == typeof e.multiTouchDragCallback && r === e.configuration.touchPointers }), a.state.isMultiPartToolActive && (l = Object(i.default)(l)), 0 === l.length) return !1; l[0].multiTouchDragCallback(e) } }, "./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js": function (e, t, n) { "use strict"; function a(e) { Object.keys(e).forEach(function (t) { e[t].active = !1 }) } n.r(t), t.default = function (e) { if (e) for (var t = 0; t < e.data.length; t++) { var n = e.data[t]; n.active = !1, n.handles && a(n.handles) } } }, "./eventDispatchers/touchEventHandlers/tap.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../externalModules.js */ "./externalModules.js"), o = n(/*! ./touchStartActive.js */ "./eventDispatchers/touchEventHandlers/touchStartActive.js"), i = n(/*! ../../store/index.js */ "./store/index.js"), r = n(/*! ../../store/getActiveToolsForElement.js */ "./store/getActiveToolsForElement.js"), l = n(/*! ../../store/getToolsWithDataForElement.js */ "./store/getToolsWithDataForElement.js"), s = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), u = n(/*! ../../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), d = n(/*! ../../manipulators/index.js */ "./manipulators/index.js"), c = n(/*! ./shared/deactivateAllToolInstances.js */ "./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js"); t.default = function (e) { if (!i.state.isToolLocked && !i.state.isMultiPartToolActive) { var t, n = e.detail.element, f = e.detail.currentPoints.canvas; t = Object(r.default)(n, i.getters.touchTools()); var g = (t = Object(l.default)(n, t)).filter(function (e) { for (var t = Object(s.getToolState)(n, e.name), a = 0; a < t.data.length; a++)if (void 0 !== Object(u.default)(n, t.data[a].handles, f, 28)) return !0; return !1 }); if (g.length > 0) { var m = g[0], h = Object(s.getToolState)(n, m.name), v = h.data.find(function (e) { return void 0 !== Object(u.default)(n, e.handles, f, 28) }); h.data.active = !0, v.active = !0, a.default.cornerstone.updateImage(n), Object(d.moveHandle)(e.detail, m.name, h.data, v, m.options, "touch", function () { return Object(c.default)(h) }), e.stopImmediatePropagation(), e.preventDefault(); return } var p = t.filter(function (e) { var t = Object(s.getToolState)(n, e.name); return t && t.data && e.pointNearTool && t.data.some(function (t) { return e.pointNearTool(n, t, f) }) }); if (p.length > 0) { var x = p[0], $ = Object(s.getToolState)(n, x.name), y = $.data.find(function (e) { return x.pointNearTool(n, e, f) }); y.active = !0, a.default.cornerstone.updateImage(n), Object(d.moveAllHandles)(e.detail, x.name, y, null, x.options, "touch", function () { return Object(c.default)($) }), e.stopImmediatePropagation(), e.preventDefault(); return } var T = Object(r.default)(n, i.getters.touchTools()); return T.length > 0 && T[0].touchStartActiveCallback ? T[0].touchStartActiveCallback(e) : Object(o.default)(e), !1 } } }, "./eventDispatchers/touchEventHandlers/touchStart.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../store/index.js */ "./store/index.js"), o = n(/*! ../../util/findAndMoveHelpers.js */ "./util/findAndMoveHelpers.js"), i = n(/*! ../../store/getToolsWithMoveableHandles.js */ "./store/getToolsWithMoveableHandles.js"), r = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), l = n(/*! ./../../store/getInteractiveToolsForElement.js */ "./store/getInteractiveToolsForElement.js"), s = n(/*! ./../../store/getToolsWithDataForElement.js */ "./store/getToolsWithDataForElement.js"), u = n(/*! ./../../store/filterToolsUsableWithMultiPartTools.js */ "./store/filterToolsUsableWithMultiPartTools.js"); t.default = function (e) { if (!a.state.isToolLocked) { var t = e.detail, n = t.element, d = t.startPoints.canvas, c = Object(l.default)(n, a.getters.touchTools()), f = c.filter(function (e) { return "active" === e.mode && e.options.isTouchActive }); if (a.state.isMultiPartToolActive && (f = Object(u.default)(f)), f.length > 0) { var g = f.find(function (e) { return "function" == typeof e.preTouchStartCallback }); if (g && g.preTouchStartCallback(e)) return } if (!a.state.isMultiPartToolActive) { var m = Object(s.default)(n, c), h = Object(i.default)(n, m, d, "touch"); if (h.length > 0) { var v = h[0], p = Object(r.getToolState)(n, v.name), x = Object(o.findHandleDataNearImagePoint)(n, p, v.name, d, "touch"), $ = x.handle, y = x.data; v.handleSelectedCallback(e, y, $, "touch"); return } var T = m.filter(function (e) { var t = Object(r.getToolState)(n, e.name); return t && t.data && e.pointNearTool && t.data.some(function (t) { return e.pointNearTool(n, t, d, "touch") }) }); if (T.length > 0) { var b = T[0], _ = Object(r.getToolState)(n, b.name).data.find(function (e) { return b.pointNearTool(n, e, d) }); b.toolSelectedCallback(e, _, "touch"); return } if (f.length > 0) { var C = f.find(function (e) { return "function" == typeof e.postTouchStartCallback }); if (C && C.postTouchStartCallback(e)) return } } } } }, "./eventDispatchers/touchEventHandlers/touchStartActive.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../store/index.js */ "./store/index.js"), o = n(/*! ./addNewMeasurement.js */ "./eventDispatchers/touchEventHandlers/addNewMeasurement.js"), i = n(/*! ./../../tools/base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), r = n(/*! ../../util/getActiveTool */ "./util/getActiveTool.js"); t.default = function (e) { if (!a.state.isToolLocked && !a.state.isMultiPartToolActive) { var t = e.detail.element, n = Object(r.default)(t, null, "touch"); n && n.addNewMeasurement ? n.addNewMeasurement(e, "touch") : n instanceof i.default && Object(o.default)(e, n) } } }, "./eventDispatchers/touchToolEventDispatcher.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ./touchEventHandlers/index.js */ "./eventDispatchers/touchEventHandlers/index.js"), i = function e(t) { t.addEventListener(a.default.TAP, o.tap), t.addEventListener(a.default.TOUCH_START, o.touchStart, { passive: !1 }), t.addEventListener(a.default.TOUCH_DRAG, o.touchDrag, { passive: !1 }), t.addEventListener(a.default.TOUCH_END, o.touchEnd), t.addEventListener(a.default.TOUCH_START_ACTIVE, o.touchStartActive), t.addEventListener(a.default.TOUCH_PRESS, o.touchPress), t.addEventListener(a.default.DOUBLE_TAP, o.doubleTap), t.addEventListener(a.default.TOUCH_PINCH, o.touchPinch), t.addEventListener(a.default.TOUCH_ROTATE, o.touchRotate), t.addEventListener(a.default.MULTI_TOUCH_DRAG, o.multiTouchDrag) }, r = function e(t) { t.removeEventListener(a.default.TAP, o.tap), t.removeEventListener(a.default.TOUCH_START, o.touchStart), t.removeEventListener(a.default.TOUCH_DRAG, o.touchDrag), t.removeEventListener(a.default.TOUCH_END, o.touchEnd), t.removeEventListener(a.default.TOUCH_START_ACTIVE, o.touchStartActive), t.removeEventListener(a.default.TOUCH_PRESS, o.touchPress), t.removeEventListener(a.default.DOUBLE_TAP, o.doubleTap), t.removeEventListener(a.default.TOUCH_PINCH, o.touchPinch), t.removeEventListener(a.default.TOUCH_ROTATE, o.touchRotate), t.removeEventListener(a.default.MULTI_TOUCH_DRAG, o.multiTouchDrag) }; t.default = { enable: i, disable: r } }, "./eventListeners/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./mouseEventListeners.js */ "./eventListeners/mouseEventListeners.js"); n.d(t, "mouseEventListeners", function () { return a.default }); var o = n(/*! ./wheelEventListener.js */ "./eventListeners/wheelEventListener.js"); n.d(t, "wheelEventListener", function () { return o.default }); var i = n(/*! ./touchEventListeners.js */ "./eventListeners/touchEventListeners.js"); n.d(t, "touchEventListeners", function () { return i.default }) }, "./eventListeners/internals/normalizeWheel.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e) { var t = 0, n = 0, a = 0, o = 0; return "detail" in e && (n = e.detail), "wheelDelta" in e && (n = -e.wheelDelta / 120), "wheelDeltaY" in e && (n = -e.wheelDeltaY / 120), "wheelDeltaX" in e && (t = -e.wheelDeltaX / 120), a = 10 * t, o = 10 * n, "deltaY" in e && (o = e.deltaY), "deltaX" in e && (a = e.deltaX), (a || o) && e.deltaMode && (1 === e.deltaMode ? (a *= 40, o *= 40) : (a *= 800, o *= 800)), a && !t && (t = a < 1 ? -1 : 1), o && !n && (n = o < 1 ? -1 : 1), { spinX: t, spinY: n, pixelX: a, pixelY: o } } }, "./eventListeners/internals/renderSegmentation.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ../../store/index.js */ "./store/index.js"), o = n(/*! ./renderSegmentationFill */ "./eventListeners/internals/renderSegmentationFill.js"), i = n(/*! ./renderSegmentationOutline */ "./eventListeners/internals/renderSegmentationOutline.js"), r = Object(a.getModule)("segmentation"); function l(e, t, n, a, l) { var s, u, d, c; s = l, u = r.configuration, u.renderFill && (s && 0 !== u.fillAlpha || !s && 0 !== u.fillAlphaInactive) && Object(o.default)(e, t, a, n, l), d = l, c = r.configuration, c.renderOutline && (d && 0 !== c.outlineAlpha || !d && 0 !== c.outlineAlphaInactive) && Object(i.default)(e, t, a, n, l) } }, "./eventListeners/internals/renderSegmentationFill.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }), n.d(t, "getLabelmapCanvas", function () { return s }), n.d(t, "renderFill", function () { return u }); var a = n(/*! ../../store/index.js */ "./store/index.js"), o = n(/*! ../../drawing/index.js */ "./drawing/index.js"), i = n(/*! ../../externalModules */ "./externalModules.js"), r = Object(a.getModule)("segmentation"); function l(e, t, n, a, o) { var i = s(e, t, n); u(e, i, o) } function s(e, t, n) { var a = r.state, i = e.detail.image, l = i.width, s = i.height, u = t.segmentsHidden, d = n.pixelData, c = a.colorLutTables[t.colorLUTIndex], f = document.createElement("canvas"); f.width = l, f.height = s; for (var g = Object(o.getNewContext)(f), m = new ImageData(l, s), h = m.data, v = 0; v < d.length; v++) { var p = d[v]; if (0 !== p && !u[p]) { var x = c[d[v]]; h[4 * v] = x[0], h[4 * v + 1] = x[1], h[4 * v + 2] = x[2], h[4 * v + 3] = x[3] } } return g.putImageData(m, 0, 0), f } function u(e, t, n) { var a, l, s, u, d, c = r.configuration, f = e.detail, g = Object(o.getNewContext)(f.canvasContext.canvas), m = i.default.cornerstone.pixelToCanvas(f.element, { x: 0, y: 0 }), h = i.default.cornerstone.pixelToCanvas(f.element, { x: f.image.width, y: 0 }), v = i.default.cornerstone.pixelToCanvas(f.element, { x: f.image.width, y: f.image.height }), p = i.default.cornerstoneMath.point.distance(m, h), x = i.default.cornerstoneMath.point.distance(h, v), $ = f.canvasContext.canvas, y = f.viewport, T = g.imageSmoothingEnabled, b = g.globalAlpha; g.imageSmoothingEnabled = !1, g.globalAlpha = n ? c.fillAlpha : c.fillAlphaInactive, Object(o.transformCanvasContext)(g, $, y); var _ = (a = f, l = a.viewport, s = a.image, u = l.scale, d = l.scale, s.rowPixelSpacing < s.columnPixelSpacing ? u *= s.columnPixelSpacing / s.rowPixelSpacing : s.columnPixelSpacing < s.rowPixelSpacing && (d *= s.rowPixelSpacing / s.columnPixelSpacing), { x: l.translation.x * u, y: l.translation.y * d }); g.drawImage(t, $.width / 2 - p / 2 + _.x, $.height / 2 - x / 2 + _.y, p, x), g.globalAlpha = b, g.imageSmoothingEnabled = T, Object(o.resetCanvasContextTransform)(g) } }, "./eventListeners/internals/renderSegmentationOutline.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }), n.d(t, "renderOutline", function () { return s }), n.d(t, "getOutline", function () { return u }), n.d(t, "_addTopRightCorner", function () { return f }); var a = n(/*! ../../store/index.js */ "./store/index.js"), o = n(/*! ../../externalModules.js */ "./externalModules.js"), i = n(/*! ../../drawing/index.js */ "./drawing/index.js"); n(/*! ../../index.js */ "./index.js"); var r = Object(a.getModule)("segmentation"); function l(e, t, n, a, o) { var i = u(e, t, n, r.configuration.outlineWidth); s(e, i, t.colorLUTIndex, o) } function s(e, t, n) { var a = !(arguments.length > 3) || void 0 === arguments[3] || arguments[3], o = r.configuration, l = r.state, s = e.detail, u = s.element, d = s.canvasContext, c = o.outlineWidth || 1, f = Object(i.getNewContext)(d.canvas), g = l.colorLutTables[n], m = f.globalAlpha; f.globalAlpha = a ? o.outlineAlpha : o.outlineAlphaInactive, Object(i.draw)(f, function (e) { for (var n = 1; n < t.length; n++)if (t[n]) { var a = g[n]; Object(i.drawLines)(e, u, t[n], { color: "rgba(".concat(a[0], ", ").concat(a[1], ", ").concat(a[2], ", 1.0 )"), lineWidth: c }, "canvas") } }), f.globalAlpha = m } function u(e, t, n, a) { var o = e.detail, i = o.element, r = o.image, l = o.viewport, s = r.width, u = r.height; a = a || 1; var $, y, T, b, _, C, j, S, w, M, E = t.segmentsHidden, I = n.pixelData, P = t.activeSegmentIndex, k = []; n.segmentsOnLabelmap.forEach(function (e) { E[e] || (k[e] = []) }), k[P] || (k[P] = []); for (var D = ($ = l, y = a, T = y / 2, b = $.rotation, _ = Math.cos(b *= Math.PI / 180), C = Math.sin(b), j = [_, C], S = [-C, _], w = { x: T * j[0], y: T * j[1] }, M = { x: T * S[0], y: T * S[1] }, $.hflip && (w.x *= -1, w.y *= -1), $.vflip && (M.x *= -1, M.y *= -1), { i: w, j: M }), L = 0; L < I.length; L++) { var O = I[L]; if (0 !== O) { if (!E[O]) { var A, H = { x: (A = L) % s, y: Math.floor(A / s) }, R = d(H, u, s); (void 0 === R.top || I[R.top] !== O) && h(k[O], i, H, D), (void 0 === R.bottom || I[R.bottom] !== O) && v(k[O], i, H, D), (void 0 === R.left || I[R.left] !== O) && p(k[O], i, H, D), (void 0 === R.right || I[R.right] !== O) && x(k[O], i, H, D), void 0 !== R.topLeft && I[R.topLeft] !== O && I[R.top] === O && I[R.left] === O && c(k[O], i, H, D), void 0 !== R.topRight && I[R.topRight] !== O && I[R.top] === O && I[R.right] === O && f(k[O], i, H, D), void 0 !== R.bottomLeft && I[R.bottomLeft] !== O && I[R.bottom] === O && I[R.left] === O && g(k[O], i, H, D), void 0 !== R.bottomRight && I[R.bottomRight] !== O && I[R.bottom] === O && I[R.right] === O && m(k[O], i, H, D) } } } return k } function d(e, t, n) { var a = e.y * n + e.x, o = {}, i = e.y - 1 >= 0, r = e.y + 1 < t, l = e.x - 1 >= 0, s = e.x + 1 < n; return i && (o.top = a - n, s && (o.topRight = o.top + 1), l && (o.topLeft = o.top - 1)), r && (o.bottom = a + n, s && (o.bottomRight = o.bottom + 1), l && (o.bottomLeft = o.bottom - 1)), l && (o.left = a - 1), s && (o.right = a + 1), o } function c(e, t, n, a) { var i = (0, o.default.cornerstone.pixelToCanvas)(t, n); i.x += a.j.x, i.y += a.j.y; var r = { x: i.x, y: i.y }; r.x += 2 * a.i.x, r.y += 2 * a.i.y, e.push({ start: i, end: r }) } function f(e, t, n, a) { var i = (0, o.default.cornerstone.pixelToCanvas)(t, { x: n.x + 1, y: n.y }); i.x += a.j.x, i.y += a.j.y; var r = { x: i.x, y: i.y }; r.x -= 2 * a.i.x, r.y -= 2 * a.i.y, e.push({ start: i, end: r }) } function g(e, t, n, a) { var i = (0, o.default.cornerstone.pixelToCanvas)(t, { x: n.x, y: n.y + 1 }); i.x -= a.j.x, i.y -= a.j.y; var r = { x: i.x, y: i.y }; r.x += 2 * a.i.x, r.y += 2 * a.i.y, e.push({ start: i, end: r }) } function m(e, t, n, a) { var i = (0, o.default.cornerstone.pixelToCanvas)(t, { x: n.x + 1, y: n.y + 1 }); i.x -= a.j.x, i.y -= a.j.y; var r = { x: i.x, y: i.y }; r.x -= 2 * a.i.x, r.y -= 2 * a.i.y, e.push({ start: i, end: r }) } function h(e, t, n, a) { var i = o.default.cornerstone.pixelToCanvas, r = i(t, n), l = i(t, { x: n.x + 1, y: n.y }); r.x += a.j.x, r.y += a.j.y, l.x += a.j.x, l.y += a.j.y, e.push({ start: r, end: l }) } function v(e, t, n, a) { var i = o.default.cornerstone.pixelToCanvas, r = i(t, { x: n.x, y: n.y + 1 }), l = i(t, { x: n.x + 1, y: n.y + 1 }); r.x -= a.j.x, r.y -= a.j.y, l.x -= a.j.x, l.y -= a.j.y, e.push({ start: r, end: l }) } function p(e, t, n, a) { var i = o.default.cornerstone.pixelToCanvas, r = i(t, n), l = i(t, { x: n.x, y: n.y + 1 }); r.x += a.i.x, r.y += a.i.y, l.x += a.i.x, l.y += a.i.y, e.push({ start: r, end: l }) } function x(e, t, n, a) { var i = o.default.cornerstone.pixelToCanvas, r = i(t, { x: n.x + 1, y: n.y }), l = i(t, { x: n.x + 1, y: n.y + 1 }); r.x -= a.i.x, r.y -= a.i.y, l.x -= a.i.x, l.y -= a.i.y, e.push({ start: r, end: l }) } }, "./eventListeners/mouseEventListeners.js": function (e, t, n) { "use strict"; n.r(t); var a, o = n(/*! ../events.js */ "./events.js"), i = n(/*! ../externalModules.js */ "./externalModules.js"), r = n(/*! ../util/copyPoints.js */ "./util/copyPoints.js"), l = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), s = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("eventListeners:mouseEventListeners"), u = !0, d = new Map; function c(e) { if ("number" == typeof e.buttons) return e.buttons; switch (e.which) { case 0: break; case 1: return 1; case 2: return 4; case 3: return 2 }return 0 } function f() { u = !1 } function g(e) { var t = e.currentTarget, n = i.default.cornerstone.getEnabledElement(t); if (n.image) { var a = o.default.MOUSE_DOUBLE_CLICK, u = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; u.canvas = i.default.cornerstone.pixelToCanvas(t, u.image); var d = Object(r.default)(u); s.log("double-click: %o", c(e)); var f = { event: e, buttons: c(e), viewport: i.default.cornerstone.getViewport(t), image: n.image, element: t, startPoints: u, lastPoints: d, currentPoints: u, deltaPoints: { x: 0, y: 0 }, type: a }; Object(l.default)(t, a, f) } } function m(e) { var t = e.currentTarget, n = i.default.cornerstone.getEnabledElement(t); if (n.image) { a = setTimeout(f, 200), t.removeEventListener("mousemove", h); var g = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; g.canvas = i.default.cornerstone.pixelToCanvas(t, g.image); var m = Object(r.default)(g), v = { event: e, buttons: c(e), viewport: i.default.cornerstone.getViewport(t), image: n.image, element: t, startPoints: g, lastPoints: m, currentPoints: g, deltaPoints: { x: 0, y: 0 }, type: o.default.MOUSE_DOWN }; Object(l.default)(v.element, o.default.MOUSE_DOWN, v) && (v.type = o.default.MOUSE_DOWN_ACTIVATE, Object(l.default)(v.element, o.default.MOUSE_DOWN_ACTIVATE, v)), document.addEventListener("mousemove", p), document.addEventListener("mouseup", x), d.set(p, "mousemove"), d.set(x, "mouseup") } function p(e) { var a = o.default.MOUSE_DRAG, u = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; u.canvas = i.default.cornerstone.pixelToCanvas(t, u.image); var d = { page: i.default.cornerstoneMath.point.subtract(u.page, m.page), image: i.default.cornerstoneMath.point.subtract(u.image, m.image), client: i.default.cornerstoneMath.point.subtract(u.client, m.client), canvas: i.default.cornerstoneMath.point.subtract(u.canvas, m.canvas) }; s.log("mousemove: %o", c(e)); var f = { buttons: c(e), viewport: i.default.cornerstone.getViewport(t), image: n.image, element: t, startPoints: g, lastPoints: m, currentPoints: u, deltaPoints: d, type: a, ctrlKey: e.ctrlKey, metaKey: e.metaKey, shiftKey: e.shiftKey }; Object(l.default)(f.element, a, f), m = Object(r.default)(u) } function x(e) { clearTimeout(a); var r = o.default.MOUSE_UP; u && (r = o.default.MOUSE_CLICK); var f = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; f.canvas = i.default.cornerstone.pixelToCanvas(t, f.image); var v = { page: i.default.cornerstoneMath.point.subtract(f.page, m.page), image: i.default.cornerstoneMath.point.subtract(f.image, m.image), client: i.default.cornerstoneMath.point.subtract(f.client, m.client), canvas: i.default.cornerstoneMath.point.subtract(f.canvas, m.canvas) }; s.log("mouseup: %o", c(e)); var $ = { event: e, buttons: c(e), viewport: i.default.cornerstone.getViewport(t), image: n.image, element: t, startPoints: g, lastPoints: m, currentPoints: f, deltaPoints: v, type: r }; Object(l.default)($.element, r, $), document.removeEventListener("mousemove", p), document.removeEventListener("mouseup", x), d.delete(p), d.delete(x), t.addEventListener("mousemove", h), u = !0 } } function h(e) { var t = e.currentTarget, n = i.default.cornerstone.getEnabledElement(t); if (n.image) { var a = o.default.MOUSE_MOVE, s = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; s.canvas = i.default.cornerstone.pixelToCanvas(t, s.image); var u = Object(r.default)(s), d = { page: i.default.cornerstoneMath.point.pageToPoint(e), image: i.default.cornerstone.pageToPixel(t, e.pageX, e.pageY), client: { x: e.clientX, y: e.clientY } }; d.canvas = i.default.cornerstone.pixelToCanvas(t, d.image); var c = { page: i.default.cornerstoneMath.point.subtract(d.page, u.page), image: i.default.cornerstoneMath.point.subtract(d.image, u.image), client: i.default.cornerstoneMath.point.subtract(d.client, u.client), canvas: i.default.cornerstoneMath.point.subtract(d.canvas, u.canvas) }, f = { viewport: i.default.cornerstone.getViewport(t), image: n.image, element: t, startPoints: s, lastPoints: u, currentPoints: d, deltaPoints: c, type: a }; Object(l.default)(t, a, f), u = Object(r.default)(d) } } function v(e) { e.removeEventListener("mousedown", m), e.removeEventListener("mousemove", h), e.removeEventListener("dblclick", g), d.forEach(function (e, t) { document.removeEventListener(e, t) }), d.clear() } t.default = { enable: function e(t) { v(t), t.addEventListener("mousedown", m), t.addEventListener("mousemove", h), t.addEventListener("dblclick", g) }, disable: v } }, "./eventListeners/onImageRenderedBrushEventHandler.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../store/index.js */ "./store/index.js"), o = n(/*! ./internals/renderSegmentation.js */ "./eventListeners/internals/renderSegmentation.js"), i = Object(a.getModule)("segmentation"); t.default = function (e) { var t = e.detail.element, n = i.configuration, a = i.getters.labelmaps3D(t), r = a.activeLabelmapIndex, l = a.labelmaps3D, s = a.currentImageIdIndex; l && (n.shouldRenderInactiveLabelmaps && function e(t, n, a, i) { for (var r = 0; r < n.length; r++) { var l = n[r]; if (r !== a && l) { var s = l.labelmaps2D[i]; s && Object(o.default)(t, l, r, s, !1) } } }(e, l, r, s), function e(t, n, a, i) { var r = n[a]; if (r) { var l = r.labelmaps2D[i]; l && Object(o.default)(t, r, a, l, !0) } }(e, l, r, s)) } }, "./eventListeners/preventGhostClick.js": function (e, t, n) { "use strict"; n.r(t); var a, o, i = { mouse: 0, touch: 1 }; function r(e, t) { var n = Date.now(); if (e !== a) { if (n - o <= 2e3) return t.preventDefault(), t.stopPropagation(), t.stopImmediatePropagation(), !1; a = e } o = n } var l = r.bind(null, i.mouse), s = r.bind(null, i.touch); function u(e, t, n) { var a = n ? l : s; t.forEach(function (t) { e.addEventListener(t, a, { passive: !1 }) }) } function d(e, t, n) { var a = n ? l : s; t.forEach(function (t) { e.removeEventListener(t, a) }) } var c = ["mousedown", "mouseup"], f = ["touchstart", "touchend"]; function g(e) { d(e, c, i.mouse), d(e, f, i.touch) } t.default = { enable: function e(t) { g(t), u(t, c, i.mouse), u(t, f, i.touch) }, disable: g } }, "./eventListeners/touchEventListeners.js": function (e, t, n) { "use strict"; n.r(t); var a, o, i, r, l, s, u, d, c, f = n(/*! ../events.js */ "./events.js"), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = n(/*! ../util/copyPoints.js */ "./util/copyPoints.js"), h = n(/*! ./preventGhostClick.js */ "./eventListeners/preventGhostClick.js"), v = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), p = n(/*! ../toolOptions.js */ "./toolOptions.js"), x = 1, $ = 0, y = !1, T = !1, b = "touchInput"; function _(e) { var t, n, h, p, b, _ = e.currentTarget || e.srcEvent.currentTarget, C = g.default.cornerstone.getEnabledElement(_); if (C.image) { switch (e.preventDefault(), (e.pointers && e.pointers.length > 1 || e.touches && e.touches.length > 1) && (T = !1, clearTimeout(u)), e.type) { case "tap": T = !1, clearTimeout(u), (o = { page: g.default.cornerstoneMath.point.pageToPoint(e.pointers[0]), image: g.default.cornerstone.pageToPixel(_, e.pointers[0].pageX, e.pointers[0].pageY), client: { x: e.pointers[0].clientX, y: e.pointers[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, o.image), t = f.default.TAP, l = { event: e, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, currentPoints: o, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l); break; case "doubletap": T = !1, clearTimeout(u), (o = { page: g.default.cornerstoneMath.point.pageToPoint(e.pointers[0]), image: g.default.cornerstone.pageToPixel(_, e.pointers[0].pageX, e.pointers[0].pageY), client: { x: e.pointers[0].clientX, y: e.pointers[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, o.image), t = f.default.DOUBLE_TAP, l = { event: e, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, currentPoints: o, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l); break; case "pinchstart": T = !1, clearTimeout(u), x = 1; break; case "pinchmove": if (T = !1, clearTimeout(u), !0 === y) { x = e.scale, y = !1; break } n = (e.scale - x) / x, (a = { page: e.center, image: g.default.cornerstone.pageToPixel(_, e.center.x, e.center.y) }).canvas = g.default.cornerstone.pixelToCanvas(_, a.image), t = f.default.TOUCH_PINCH, l = { event: e, startPoints: a, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, direction: e.scale < 1 ? 1 : -1, scaleChange: n, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l), x = e.scale; break; case "touchstart": x = 1, clearTimeout(u), clearTimeout(s), s = setTimeout(function () { (a = { page: g.default.cornerstoneMath.point.pageToPoint(e.touches[0]), image: g.default.cornerstone.pageToPixel(_, e.touches[0].pageX, e.touches[0].pageY), client: { x: e.touches[0].clientX, y: e.touches[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, a.image), t = f.default.TOUCH_START, e.touches.length > 1 && (t = f.default.MULTI_TOUCH_START), l = { event: e, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, startPoints: a, currentPoints: a, type: t, isTouchEvent: !0 }, !0 === Object(v.default)(_, t, l) && (t = f.default.TOUCH_START_ACTIVE, e.touches.length > 1 && (t = f.default.MULTI_TOUCH_START_ACTIVE), l.type = t, Object(v.default)(_, t, l)), i = Object(m.default)(a) }, 50), T = !0, d = 0, u = setTimeout(function () { T && ((o = { page: g.default.cornerstoneMath.point.pageToPoint(e.touches[0]), image: g.default.cornerstone.pageToPixel(_, e.touches[0].pageX, e.touches[0].pageY), client: { x: e.touches[0].clientX, y: e.touches[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, a.image), t = f.default.TOUCH_PRESS, l = { event: e, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, currentPoints: o, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l)) }, 700); break; case "touchend": x = 1, T = !1, clearTimeout(u), setTimeout(function () { (a = { page: g.default.cornerstoneMath.point.pageToPoint(e.changedTouches[0]), image: g.default.cornerstone.pageToPixel(_, e.changedTouches[0].pageX, e.changedTouches[0].pageY), client: { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, a.image), t = f.default.TOUCH_END, l = { event: e, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, startPoints: a, currentPoints: a, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l) }, 50); break; case "panmove": h = { x: e.deltaX - c.x, y: e.deltaY - c.y }, c = { x: e.deltaX, y: e.deltaY }, (o = { page: { x: i.page.x + h.x, y: i.page.y + h.y }, image: g.default.cornerstone.pageToPixel(_, i.page.x + h.x, i.page.y + h.y), client: { x: i.client.x + h.x, y: i.client.y + h.y } }).canvas = g.default.cornerstone.pixelToCanvas(_, o.image), (d += Math.sqrt((r = { page: g.default.cornerstoneMath.point.subtract(o.page, i.page), image: g.default.cornerstoneMath.point.subtract(o.image, i.image), client: g.default.cornerstoneMath.point.subtract(o.client, i.client), canvas: g.default.cornerstoneMath.point.subtract(o.canvas, i.canvas) }).page.x * r.page.x + r.page.y * r.page.y)) > 5 && (T = !1, clearTimeout(u)), t = f.default.TOUCH_DRAG, e.pointers.length > 1 && (t = f.default.MULTI_TOUCH_DRAG), l = { viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, startPoints: a, lastPoints: i, currentPoints: o, deltaPoints: r, numPointers: e.pointers.length, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l), i = Object(m.default)(o); break; case "panstart": c = { x: e.deltaX, y: e.deltaY }, (o = { page: g.default.cornerstoneMath.point.pageToPoint(e.pointers[0]), image: g.default.cornerstone.pageToPixel(_, e.pointers[0].pageX, e.pointers[0].pageY), client: { x: e.pointers[0].clientX, y: e.pointers[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, o.image), i = Object(m.default)(o); break; case "panend": if (T = !1, clearTimeout(u), !i) break; (o = { page: g.default.cornerstoneMath.point.pageToPoint(e.pointers[0]), image: g.default.cornerstone.pageToPixel(_, e.pointers[0].pageX, e.pointers[0].pageY), client: { x: e.pointers[0].clientX, y: e.pointers[0].clientY } }).canvas = g.default.cornerstone.pixelToCanvas(_, o.image), r = { page: g.default.cornerstoneMath.point.subtract(o.page, i.page), image: g.default.cornerstoneMath.point.subtract(o.image, i.image), client: g.default.cornerstoneMath.point.subtract(o.client, i.client), canvas: g.default.cornerstoneMath.point.subtract(o.canvas, i.canvas) }, t = f.default.TOUCH_DRAG_END, l = { event: e.srcEvent, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, startPoints: a, lastPoints: i, currentPoints: o, deltaPoints: r, type: t, isTouchEvent: !0 }, Object(v.default)(_, t, l), 2 == (p = e.pointers.length - e.changedPointers.length) && (y = !0); break; case "rotatemove": T = !1, clearTimeout(u), b = e.rotation - $, $ = e.rotation, t = f.default.TOUCH_ROTATE, l = { event: e.srcEvent, viewport: g.default.cornerstone.getViewport(_), image: C.image, element: _, rotation: b, type: t }, Object(v.default)(_, t, l) }return !1 } } function C(e) { h.default.disable(e), ["touchstart", "touchend"].forEach(function (t) { e.removeEventListener(t, _) }); var t = Object(p.getToolOptions)(b, e), n = t.hammer; n && (n.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove", _), n.input.destroy()), t.hammer = null, Object(p.clearToolOptions)(b, e) } t.default = { enable: function e(t) { C(t); var n = g.default.Hammer, a = { inputClass: n.SUPPORT_POINTER_EVENTS ? n.PointerEventInput : n.TouchInput }, o = new n.Manager(t, a), i = { pointers: 0, direction: n.DIRECTION_ALL, threshold: 0 }, r = new n.Pan(i), l = new n.Pinch({ threshold: 0 }), s = new n.Rotate({ threshold: 0 }); l.recognizeWith(r), l.recognizeWith(s), s.recognizeWith(r); var u = new n.Tap({ event: "doubletap", taps: 2, interval: 1500, threshold: 50, posThreshold: 50 }); u.recognizeWith(r), o.add([u, r, s, l]), o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove", _), h.default.enable(t), ["touchstart", "touchend"].forEach(function (e) { t.addEventListener(e, _, { passive: !1 }) }); var d = Object(p.getToolOptions)(b, t); d.hammer = o, Object(p.setToolOptions)(b, t, d) }, disable: C } }, "./eventListeners/wheelEventListener.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), r = n(/*! ./internals/normalizeWheel.js */ "./eventListeners/internals/normalizeWheel.js"); function l(e) { var t = e.currentTarget, n = o.default.cornerstone.getEnabledElement(t); if (n.image && (!(e.deltaY > -1) || !(e.deltaY < 1))) { e.preventDefault(); var l = e.pageX, s = e.pageY, u = o.default.cornerstone.pageToPixel(t, l, s), d = Object(r.default)(e), c = d.spinX, f = d.spinY, g = d.pixelX, m = d.pixelY, h = { element: t, viewport: o.default.cornerstone.getViewport(t), detail: e, image: n.image, direction: f < 0 ? -1 : 1, spinX: c, spinY: f, pixelX: g, pixelY: m, pageX: l, pageY: s, imageX: u.x, imageY: u.y }; Object(i.default)(t, a.default.MOUSE_WHEEL, h) } } function s(e) { e.removeEventListener("wheel", l, { passive: !1 }) } t.default = { enable: function e(t) { s(t), t.addEventListener("wheel", l, { passive: !1 }) }, disable: s } }, "./eventListeners/windowResizeHandler.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "forceEnabledElementResize", function () { return u }); var a, o = n(/*! ./../store/index.js */ "./store/index.js"), i = n(/*! ./../externalModules.js */ "./externalModules.js"), r = function e() { l(), window.addEventListener("resize", s, !1) }, l = function e() { window.removeEventListener("resize", s, !1) }; function s() { a || (a = setTimeout(function () { a = null, u() }, 66)) } var u = function e() { o.state.enabledElements.forEach(function (e) { i.default.cornerstone.resize(e) }) }; t.default = { enable: r, disable: l } }, "./events.js": function (e, t, n) { "use strict"; n.r(t), t.default = { MOUSE_DOWN: "cornerstonetoolsmousedown", MOUSE_UP: "cornerstonetoolsmouseup", MOUSE_DOWN_ACTIVATE: "cornerstonetoolsmousedownactivate", MOUSE_DRAG: "cornerstonetoolsmousedrag", MOUSE_MOVE: "cornerstonetoolsmousemove", MOUSE_CLICK: "cornerstonetoolsmouseclick", MOUSE_DOUBLE_CLICK: "cornerstonetoolsmousedoubleclick", MOUSE_WHEEL: "cornerstonetoolsmousewheel", TOUCH_START: "cornerstonetoolstouchstart", TOUCH_START_ACTIVE: "cornerstonetoolstouchstartactive", TOUCH_END: "cornerstonetoolstouchend", TOUCH_DRAG: "cornerstonetoolstouchdrag", TOUCH_DRAG_END: "cornerstonetoolstouchdragend", TOUCH_PINCH: "cornerstonetoolstouchpinch", TOUCH_ROTATE: "cornerstonetoolstouchrotate", TOUCH_PRESS: "cornerstonetoolstouchpress", TAP: "cornerstonetoolstap", DOUBLE_TAP: "cornerstonetoolsdoubletap", MULTI_TOUCH_START: "cornerstonetoolsmultitouchstart", MULTI_TOUCH_START_ACTIVE: "cornerstonetoolsmultitouchstartactive", MULTI_TOUCH_DRAG: "cornerstonetoolsmultitouchdrag", KEY_DOWN: "cornerstonetoolskeydown", KEY_UP: "cornerstonetoolskeyup", KEY_PRESS: "cornerstonetoolskeypress", MEASUREMENT_ADDED: "cornerstonetoolsmeasurementadded", MEASUREMENT_MODIFIED: "cornerstonetoolsmeasurementmodified", MEASUREMENT_COMPLETED: "cornerstonetoolsmeasurementcompleted", MEASUREMENT_REMOVED: "cornerstonetoolsmeasurementremoved", TOOL_DEACTIVATED: "cornerstonetoolstooldeactivated", CLIP_STOPPED: "cornerstonetoolsclipstopped", STACK_SCROLL: "cornerstonetoolsstackscroll", STACK_PREFETCH_IMAGE_LOADED: "cornerstonetoolsstackprefetchimageloaded", STACK_PREFETCH_DONE: "cornerstonetoolsstackprefetchdone", LABELMAP_MODIFIED: "cornersontetoolslabelmapmodified" } }, "./externalModules.js": function (e, t, n) { "use strict"; n.r(t); var a = window.cornerstone, o = window.cornerstoneMath, i = window.Hammer; t.default = { set cornerstone(cs) { a = cs }, get cornerstone() { return a }, set cornerstoneMath(cm) { o = cm }, get cornerstoneMath() { return o }, set Hammer(module) { i = module }, get Hammer() { return i } } }, "./importInternal.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./lib.js */ "./lib.js"); t.default = function (e) { return a.lib[e] } }, "./index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./tools/annotation/index.js */ "./tools/annotation/index.js"); n.d(t, "AngleTool", function () { return a.AngleTool }), n.d(t, "ArrowAnnotateTool", function () { return a.ArrowAnnotateTool }), n.d(t, "BidirectionalTool", function () { return a.BidirectionalTool }), n.d(t, "CircleRoiTool", function () { return a.CircleRoiTool }), n.d(t, "CobbAngleTool", function () { return a.CobbAngleTool }), n.d(t, "EllipticalRoiTool", function () { return a.EllipticalRoiTool }), n.d(t, "FreehandRoiTool", function () { return a.FreehandRoiTool }), n.d(t, "LengthTool", function () { return a.LengthTool }), n.d(t, "ProbeTool", function () { return a.ProbeTool }), n.d(t, "RectangleRoiTool", function () { return a.RectangleRoiTool }), n.d(t, "TextMarkerTool", function () { return a.TextMarkerTool }); var o = n(/*! ./tools/segmentation/index.js */ "./tools/segmentation/index.js"); n.d(t, "BrushTool", function () { return o.BrushTool }), n.d(t, "SphericalBrushTool", function () { return o.SphericalBrushTool }), n.d(t, "RectangleScissorsTool", function () { return o.RectangleScissorsTool }), n.d(t, "FreehandScissorsTool", function () { return o.FreehandScissorsTool }), n.d(t, "CircleScissorsTool", function () { return o.CircleScissorsTool }), n.d(t, "CorrectionScissorsTool", function () { return o.CorrectionScissorsTool }); var i = n(/*! ./tools/index.js */ "./tools/index.js"); n.d(t, "CrosshairsTool", function () { return i.CrosshairsTool }), n.d(t, "DoubleTapFitToWindowTool", function () { return i.DoubleTapFitToWindowTool }), n.d(t, "DragProbeTool", function () { return i.DragProbeTool }), n.d(t, "EraserTool", function () { return i.EraserTool }), n.d(t, "FreehandRoiSculptorTool", function () { return i.FreehandRoiSculptorTool }), n.d(t, "MagnifyTool", function () { return i.MagnifyTool }), n.d(t, "OverlayTool", function () { return i.OverlayTool }), n.d(t, "OrientationMarkersTool", function () { return i.OrientationMarkersTool }), n.d(t, "PanMultiTouchTool", function () { return i.PanMultiTouchTool }), n.d(t, "PanTool", function () { return i.PanTool }), n.d(t, "ReferenceLinesTool", function () { return i.ReferenceLinesTool }), n.d(t, "RotateTool", function () { return i.RotateTool }), n.d(t, "RotateTouchTool", function () { return i.RotateTouchTool }), n.d(t, "ScaleOverlayTool", function () { return i.ScaleOverlayTool }), n.d(t, "StackScrollMouseWheelTool", function () { return i.StackScrollMouseWheelTool }), n.d(t, "StackScrollMultiTouchTool", function () { return i.StackScrollMultiTouchTool }), n.d(t, "StackScrollTool", function () { return i.StackScrollTool }), n.d(t, "WwwcRegionTool", function () { return i.WwwcRegionTool }), n.d(t, "WwwcTool", function () { return i.WwwcTool }), n.d(t, "ZoomMouseWheelTool", function () { return i.ZoomMouseWheelTool }), n.d(t, "ZoomTool", function () { return i.ZoomTool }), n.d(t, "ZoomTouchPinchTool", function () { return i.ZoomTouchPinchTool }); var r = n(/*! ./init.js */ "./init.js"); n.d(t, "init", function () { return r.default }); var l = n(/*! ./stackTools/stackPrefetch.js */ "./stackTools/stackPrefetch.js"); n.d(t, "stackPrefetch", function () { return l.default }); var s = n(/*! ./stackTools/stackRenderers.js */ "./stackTools/stackRenderers.js"); n.d(t, "stackRenderers", function () { return s.default }); var u = n(/*! ./stackTools/playClip.js */ "./stackTools/playClip.js"); n.d(t, "playClip", function () { return u.playClip }), n.d(t, "stopClip", function () { return u.stopClip }); var d = n(/*! ./store/index.js */ "./store/index.js"); n.d(t, "store", function () { return d.default }), n.d(t, "getModule", function () { return d.getModule }); var c = n(/*! ./store/getToolForElement.js */ "./store/getToolForElement.js"); n.d(t, "getToolForElement", function () { return c.default }); var f = n(/*! ./store/addTool.js */ "./store/addTool.js"); n.d(t, "addTool", function () { return f.addTool }), n.d(t, "addToolForElement", function () { return f.addToolForElement }); var g = n(/*! ./store/removeTool.js */ "./store/removeTool.js"); n.d(t, "removeTool", function () { return g.removeTool }), n.d(t, "removeToolForElement", function () { return g.removeToolForElement }); var m = n(/*! ./store/setToolOptions.js */ "./store/setToolOptions.js"); n.d(t, "setToolOptions", function () { return m.setToolOptions }), n.d(t, "setToolOptionsForElement", function () { return m.setToolOptionsForElement }); var h = n(/*! ./store/setToolMode.js */ "./store/setToolMode.js"); n.d(t, "setToolActive", function () { return h.setToolActive }), n.d(t, "setToolActiveForElement", function () { return h.setToolActiveForElement }), n.d(t, "setToolEnabled", function () { return h.setToolEnabled }), n.d(t, "setToolEnabledForElement", function () { return h.setToolEnabledForElement }), n.d(t, "setToolDisabled", function () { return h.setToolDisabled }), n.d(t, "setToolDisabledForElement", function () { return h.setToolDisabledForElement }), n.d(t, "setToolPassive", function () { return h.setToolPassive }), n.d(t, "setToolPassiveForElement", function () { return h.setToolPassiveForElement }); var v = n(/*! ./store/isToolActiveForElement */ "./store/isToolActiveForElement.js"); n.d(t, "isToolActiveForElement", function () { return v.default }); var p = n(/*! ./stateManagement/toolState.js */ "./stateManagement/toolState.js"); n.d(t, "addToolState", function () { return p.addToolState }), n.d(t, "getToolState", function () { return p.getToolState }), n.d(t, "removeToolState", function () { return p.removeToolState }), n.d(t, "clearToolState", function () { return p.clearToolState }), n.d(t, "setElementToolStateManager", function () { return p.setElementToolStateManager }), n.d(t, "getElementToolStateManager", function () { return p.getElementToolStateManager }); var x = n(/*! ./stateManagement/textStyle.js */ "./stateManagement/textStyle.js"); n.d(t, "textStyle", function () { return x.default }); var $ = n(/*! ./stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"); n.d(t, "toolStyle", function () { return $.default }); var y = n(/*! ./stateManagement/toolColors.js */ "./stateManagement/toolColors.js"); n.d(t, "toolColors", function () { return y.default }); var T = n(/*! ./stateManagement/toolCoordinates.js */ "./stateManagement/toolCoordinates.js"); n.d(t, "toolCoordinates", function () { return T.default }); var b = n(/*! ./stateManagement/stackSpecificStateManager.js */ "./stateManagement/stackSpecificStateManager.js"); n.d(t, "stackSpecificStateManager", function () { return b.stackSpecificStateManager }), n.d(t, "newStackSpecificToolStateManager", function () { return b.newStackSpecificToolStateManager }), n.d(t, "addStackStateManager", function () { return b.addStackStateManager }); var _ = n(/*! ./stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"); n.d(t, "loadHandlerManager", function () { return _.default }); var C = n(/*! ./stateManagement/imageIdSpecificStateManager.js */ "./stateManagement/imageIdSpecificStateManager.js"); n.d(t, "newImageIdSpecificToolStateManager", function () { return C.newImageIdSpecificToolStateManager }), n.d(t, "globalImageIdSpecificToolStateManager", function () { return C.globalImageIdSpecificToolStateManager }); var j = n(/*! ./stateManagement/frameOfReferenceStateManager.js */ "./stateManagement/frameOfReferenceStateManager.js"); n.d(t, "newFrameOfReferenceSpecificToolStateManager", function () { return j.newFrameOfReferenceSpecificToolStateManager }), n.d(t, "globalFrameOfReferenceSpecificToolStateManager", function () { return j.globalFrameOfReferenceSpecificToolStateManager }); var S = n(/*! ./eventListeners/windowResizeHandler.js */ "./eventListeners/windowResizeHandler.js"); n.d(t, "forceEnabledElementResize", function () { return S.forceEnabledElementResize }); var w = n(/*! ./orientation/index.js */ "./orientation/index.js"); n.d(t, "orientation", function () { return w.default }); var M = n(/*! ./util/SaveAs.js */ "./util/SaveAs.js"); n.d(t, "SaveAs", function () { return M.default }); var E = n(/*! ./util/logger.js */ "./util/logger.js"); n.d(t, "enableLogger", function () { return E.enable }), n.d(t, "disableLogger", function () { return E.disable }); var I = n(/*! ./thirdParty/register.js */ "./thirdParty/register.js"); n.d(t, "register", function () { return I.default }); var P = n(/*! ./thirdParty/registerSome.js */ "./thirdParty/registerSome.js"); n.d(t, "registerSome", function () { return P.default }); var k = n(/*! ./synchronization/wwwcSynchronizer.js */ "./synchronization/wwwcSynchronizer.js"); n.d(t, "wwwcSynchronizer", function () { return k.default }); var D = n(/*! ./synchronization/updateImageSynchronizer.js */ "./synchronization/updateImageSynchronizer.js"); n.d(t, "updateImageSynchronizer", function () { return D.default }); var L = n(/*! ./synchronization/Synchronizer.js */ "./synchronization/Synchronizer.js"); n.d(t, "Synchronizer", function () { return L.default }); var O = n(/*! ./synchronization/stackScrollSynchronizer.js */ "./synchronization/stackScrollSynchronizer.js"); n.d(t, "stackScrollSynchronizer", function () { return O.default }); var A = n(/*! ./synchronization/stackImagePositionSynchronizer.js */ "./synchronization/stackImagePositionSynchronizer.js"); n.d(t, "stackImagePositionSynchronizer", function () { return A.default }); var H = n(/*! ./synchronization/stackImagePositionOffsetSynchronizer.js */ "./synchronization/stackImagePositionOffsetSynchronizer.js"); n.d(t, "stackImagePositionOffsetSynchronizer", function () { return H.default }); var R = n(/*! ./synchronization/stackImageIndexSynchronizer.js */ "./synchronization/stackImageIndexSynchronizer.js"); n.d(t, "stackImageIndexSynchronizer", function () { return R.default }); var B = n(/*! ./synchronization/panZoomSynchronizer.js */ "./synchronization/panZoomSynchronizer.js"); n.d(t, "panZoomSynchronizer", function () { return B.default }); var F = n(/*! ./externalModules.js */ "./externalModules.js"); n.d(t, "external", function () { return F.default }); var U = n(/*! ./events.js */ "./events.js"); n.d(t, "EVENTS", function () { return U.default }); var N = n(/*! ./version.js */ "./version.js"); n.d(t, "version", function () { return N.default }); var V = n(/*! ./importInternal.js */ "./importInternal.js"); n.d(t, "importInternal", function () { return V.default }), n.d(t, "import", function () { return V.default }); var z = { AngleTool: a.AngleTool, ArrowAnnotateTool: a.ArrowAnnotateTool, BidirectionalTool: a.BidirectionalTool, CircleRoiTool: a.CircleRoiTool, CobbAngleTool: a.CobbAngleTool, EllipticalRoiTool: a.EllipticalRoiTool, FreehandRoiTool: a.FreehandRoiTool, LengthTool: a.LengthTool, ProbeTool: a.ProbeTool, RectangleRoiTool: a.RectangleRoiTool, TextMarkerTool: a.TextMarkerTool, BrushTool: o.BrushTool, SphericalBrushTool: o.SphericalBrushTool, RectangleScissorsTool: o.RectangleScissorsTool, FreehandScissorsTool: o.FreehandScissorsTool, CircleScissorsTool: o.CircleScissorsTool, CorrectionScissorsTool: o.CorrectionScissorsTool, CrosshairsTool: i.CrosshairsTool, DoubleTapFitToWindowTool: i.DoubleTapFitToWindowTool, DragProbeTool: i.DragProbeTool, EraserTool: i.EraserTool, FreehandRoiSculptorTool: i.FreehandRoiSculptorTool, MagnifyTool: i.MagnifyTool, OverlayTool: i.OverlayTool, OrientationMarkersTool: i.OrientationMarkersTool, PanMultiTouchTool: i.PanMultiTouchTool, PanTool: i.PanTool, ReferenceLinesTool: i.ReferenceLinesTool, RotateTool: i.RotateTool, RotateTouchTool: i.RotateTouchTool, ScaleOverlayTool: i.ScaleOverlayTool, StackScrollMouseWheelTool: i.StackScrollMouseWheelTool, StackScrollMultiTouchTool: i.StackScrollMultiTouchTool, StackScrollTool: i.StackScrollTool, WwwcRegionTool: i.WwwcRegionTool, WwwcTool: i.WwwcTool, ZoomMouseWheelTool: i.ZoomMouseWheelTool, ZoomTool: i.ZoomTool, ZoomTouchPinchTool: i.ZoomTouchPinchTool, init: r.default, stackPrefetch: l.default, stackRenderers: s.default, playClip: u.playClip, stopClip: u.stopClip, store: d.default, getModule: d.getModule, getToolForElement: c.default, addTool: f.addTool, addToolForElement: f.addToolForElement, removeTool: g.removeTool, removeToolForElement: g.removeToolForElement, setToolOptions: m.setToolOptions, setToolOptionsForElement: m.setToolOptionsForElement, isToolActiveForElement: v.default, setToolActive: h.setToolActive, setToolActiveForElement: h.setToolActiveForElement, setToolEnabled: h.setToolEnabled, setToolEnabledForElement: h.setToolEnabledForElement, setToolDisabled: h.setToolDisabled, setToolDisabledForElement: h.setToolDisabledForElement, setToolPassive: h.setToolPassive, setToolPassiveForElement: h.setToolPassiveForElement, addToolState: p.addToolState, getToolState: p.getToolState, removeToolState: p.removeToolState, clearToolState: p.clearToolState, setElementToolStateManager: p.setElementToolStateManager, getElementToolStateManager: p.getElementToolStateManager, textStyle: x.default, toolStyle: $.default, toolColors: y.default, toolCoordinates: T.default, stackSpecificStateManager: b.stackSpecificStateManager, newStackSpecificToolStateManager: b.newStackSpecificToolStateManager, addStackStateManager: b.addStackStateManager, loadHandlerManager: _.default, newImageIdSpecificToolStateManager: C.newImageIdSpecificToolStateManager, globalImageIdSpecificToolStateManager: C.globalImageIdSpecificToolStateManager, newFrameOfReferenceSpecificToolStateManager: j.newFrameOfReferenceSpecificToolStateManager, globalFrameOfReferenceSpecificToolStateManager: j.globalFrameOfReferenceSpecificToolStateManager, forceEnabledElementResize: S.forceEnabledElementResize, orientation: w.default, SaveAs: M.default, enableLogger: E.enable, disableLogger: E.disable, importInternal: V.default, import: V.default, register: I.default, registerSome: P.default, wwwcSynchronizer: k.default, updateImageSynchronizer: D.default, Synchronizer: L.default, stackScrollSynchronizer: O.default, stackImagePositionSynchronizer: A.default, stackImagePositionOffsetSynchronizer: H.default, stackImageIndexSynchronizer: R.default, panZoomSynchronizer: B.default, external: F.default, EVENTS: U.default, version: N.default }; t.default = z }, "./init.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./externalModules.js */ "./externalModules.js"), o = n(/*! ./store/index.js */ "./store/index.js"), i = n(/*! ./store/internals/addEnabledElement.js */ "./store/internals/addEnabledElement.js"), r = n(/*! ./store/internals/removeEnabledElement.js */ "./store/internals/removeEnabledElement.js"), l = n(/*! ./eventListeners/windowResizeHandler.js */ "./eventListeners/windowResizeHandler.js"); t.default = function () { var e, t, n, s, u, d, c, f = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; t = (e = a.default.cornerstone).EVENTS.ELEMENT_ENABLED, n = e.EVENTS.ELEMENT_DISABLED, e.events.removeEventListener(t, i.default), e.events.removeEventListener(n, r.default), u = (s = a.default.cornerstone).EVENTS.ELEMENT_ENABLED, d = s.EVENTS.ELEMENT_DISABLED, s.events.addEventListener(u, i.default), s.events.addEventListener(d, r.default), Object.keys(c = o.default.modules).forEach(function (e) { "function" == typeof c[e].onRegisterCallback && c[e].onRegisterCallback() }); var g = Object(o.getModule)("globalConfiguration"); Array.isArray(f) ? f.forEach(function (e) { var t = e.moduleName, n = e.configuration, a = Object(o.getModule)(t); a && (a.configuration = Object.assign({}, a.configuration, n)) }) : g.configuration = Object.assign({}, g.configuration, f), g.configuration.autoResizeViewports && l.default.enable() } }, "./lib.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "lib", function () { return ee }); var a = n(/*! ./tools/base/BaseTool.js */ "./tools/base/BaseTool.js"), o = n(/*! ./tools/base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), i = n(/*! ./tools/base/BaseBrushTool.js */ "./tools/base/BaseBrushTool.js"), r = n(/*! ./manipulators/index.js */ "./manipulators/index.js"), l = n(/*! ./util/findAndMoveHelpers.js */ "./util/findAndMoveHelpers.js"), s = n(/*! ./mixins/index.js */ "./mixins/index.js"), u = n(/*! ./tools/cursors/index.js */ "./tools/cursors/index.js"), d = n(/*! ./drawing/index.js */ "./drawing/index.js"), c = n(/*! ./util/clip.js */ "./util/clip.js"), f = n(/*! ./util/debounce */ "./util/debounce.js"), g = n(/*! ./util/deepmerge */ "./util/deepmerge.js"), m = n(/*! ./util/getDefault */ "./util/getDefault.js"), h = n(/*! ./util/getPixelSpacing */ "./util/getPixelSpacing.js"), v = n(/*! ./util/isEmptyObject */ "./util/isEmptyObject.js"), p = n(/*! ./util/isObject */ "./util/isObject.js"), x = n(/*! ./util/isPointInImage */ "./util/isPointInImage.js"), $ = n(/*! ./util/isPointInPolygon */ "./util/isPointInPolygon.js"), y = n(/*! ./util/throttle */ "./util/throttle.js"), T = n(/*! ./util/wait */ "./util/wait.js"), b = n(/*! ./util/getKeyPressData */ "./util/getKeyPressData.js"), _ = n(/*! ./util/getProximityThreshold.js */ "./util/getProximityThreshold.js"), C = n(/*! ./drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), j = n(/*! ./drawing/drawArrow.js */ "./drawing/drawArrow.js"), S = n(/*! ./drawing/drawLink.js */ "./drawing/drawLink.js"), w = n(/*! ./drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), M = n(/*! ./drawing/drawHandles.js */ "./drawing/drawHandles.js"), E = n(/*! ./util/getActiveTool */ "./util/getActiveTool.js"), I = n(/*! ./util/getLuminance.js */ "./util/getLuminance.js"), P = n(/*! ./util/getROITextBoxCoords */ "./util/getROITextBoxCoords.js"), k = n(/*! ./util/copyPoints.js */ "./util/copyPoints.js"), D = n(/*! ./util/calculateSUV.js */ "./util/calculateSUV.js"), L = n(/*! ./util/setContextToDisplayFontSize.js */ "./util/setContextToDisplayFontSize.js"), O = n(/*! ./util/scrollToIndex.js */ "./util/scrollToIndex.js"), A = n(/*! ./util/scroll.js */ "./util/scroll.js"), H = n(/*! ./util/roundToDecimal.js */ "./util/roundToDecimal.js"), R = n(/*! ./util/pointProjector.js */ "./util/pointProjector.js"), B = n(/*! ./util/lineSegDistance.js */ "./util/lineSegDistance.js"), F = n(/*! ./util/logger */ "./util/logger.js"), U = n(/*! ./util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), N = n(/*! ./util/makeUnselectable.js */ "./util/makeUnselectable.js"), V = n(/*! ./util/getRGBPixels.js */ "./util/getRGBPixels.js"), z = n(/*! ./util/getMaxSimultaneousRequests.js */ "./util/getMaxSimultaneousRequests.js"), W = n(/*! ./util/angleBetweenPoints.js */ "./util/angleBetweenPoints.js"), q = n(/*! ./util/numbersWithCommas.js */ "./util/numbersWithCommas.js"), G = n(/*! ./tools/cursors/MouseCursor.js */ "./tools/cursors/MouseCursor.js"), Y = n(/*! ./util/ellipse/index.js */ "./util/ellipse/index.js"), Z = n(/*! ./util/freehand/index.js */ "./util/freehand/index.js"), X = n(/*! ./util/segmentation */ "./util/segmentation/index.js"), K = n(/*! ./util/zoom/index.js */ "./util/zoom/index.js"), J = n(/*! ./util/triggerEvent.js */ "./util/triggerEvent.js"), Q = n(/*! ./util/convertToVector3.js */ "./util/convertToVector3.js"), ee = { "base/BaseTool": a.default, "base/BaseAnnotationTool": o.default, "base/BaseBrushTool": i.default, "tools/cursors/MouseCursor": G.default, "tools/cursors": u, "manipulators/anyHandlesOutsideImage": r.anyHandlesOutsideImage, "manipulators/getHandleNearImagePoint": r.getHandleNearImagePoint, "manipulators/getHandlePixelPosition": r.getHandlePixelPosition, "manipulators/handleActivator": r.handleActivator, "manipulators/moveAllHandles": r.moveAllHandles, "manipulators/moveHandle": r.moveHandle, "manipulators/moveNewHandle": r.moveNewHandle, "manipulators/moveHandleNearImagePoint": l.moveHandleNearImagePoint, "manipulators/findHandleDataNearImagePoint": l.findHandleDataNearImagePoint, "manipulators/moveAnnotation": l.moveAnnotation, "mixins/activeOrDisabledBinaryTool": s.default.activeOrDisabledBinaryTool, "mixins/enabledOrDisabledBinaryTool": s.default.enabledOrDisabledBinaryTool, "drawing/getNewContext": d.getNewContext, "drawing/draw": d.draw, "drawing/path": d.path, "drawing/setShadow": d.setShadow, "drawing/drawLine": d.drawLine, "drawing/drawLines": d.drawLines, "drawing/drawJoinedLines": d.drawJoinedLines, "drawing/drawCircle": d.drawCircle, "drawing/drawEllipse": d.drawEllipse, "drawing/drawRect": d.drawRect, "drawing/fillOutsideRect": d.fillOutsideRect, "drawing/drawTextBox": C.default, "drawing/drawArrow": j.default, "drawing/fillBox": d.fillBox, "drawing/fillTextLines": d.fillTextLines, "drawing/drawLink": S.default, "drawing/drawLinkedTextBox": w.default, "drawing/drawHandles": M.default, "drawing/textBoxWidth": C.textBoxWidth, "util/getActiveTool": E.default, "util/getLuminance": I.default, "util/getROITextBoxCoords": P.default, "util/copyPoints": k.default, "util/calculateSUV": D.default, "util/setContextToDisplayFontSize": L.default, "util/scrollToIndex": O.default, "util/scroll": A.default, "util/roundToDecimal": H.default, "util/projectPatientPointToImagePlane": R.projectPatientPointToImagePlane, "util/imagePointToPatientPoint": R.imagePointToPatientPoint, "util/planePlaneIntersection": R.planePlaneIntersection, "util/pointInsideBoundingBox": U.default, "util/makeUnselectable": N.default, "util/getRGBPixels": V.default, "util/getBrowserInfo": z.getBrowserInfo, "util/isMobileDevice": z.isMobileDevice, "util/angleBetweenPoints": W.default, "util/numbersWithCommas": q.default, "util/lineSegDistance": B.default, "util/triggerEvent": J.default, "util/convertToVector3": Q.default, "util/clip": c.clip, "util/clipToBox": c.clipToBox, "util/clipBoxToDisplayedArea": c.clipBoxToDisplayedArea, "util/debounce": f.default, "util/deepmerge": g.default, "util/getDefault": m.default, "util/getProximityThreshold": _.default, "util/getPixelSpacing": h.default, "util/isEmptyObject": v.default, "util/isObject": p.default, "util/isPointInImage": x.default, "util/isPointInPolygon": $.default, "util/getLogger": F.getLogger, "util/throttle": y.default, "util/wait": T.wait, "util/waitForEnabledElementImageToLoad": T.waitForEnabledElementImageToLoad, "util/getKeyPressData": b.default, "util/ellipseUtils": Y.default, "util/freehandUtils": Z.default, "util/segmentationUtils": X, "util/zoomUtils": K.default } }, "./manipulators/anyHandlesOutsideImage.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t) { var n = e.image, o = { left: 0, top: 0, width: n.width, height: n.height }, i = !1; return Object.keys(t).forEach(function (e) { var n = t[e]; !0 !== n.allowedOutsideImage && !1 === a.default.cornerstoneMath.point.insideRect(n, o) && (i = !0) }), i } }, "./manipulators/getHandleNearImagePoint.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = n(/*! ../externalModules.js */ "./externalModules.js"), r = n(/*! ../util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), l = function e(t, n, a, i) { var r; if (n) { if (Array.isArray(n)) for (var l = Object.keys(n), u = 0; u < l.length; u++) { var d = n[l[u]]; if (d.hasOwnProperty("x") && d.hasOwnProperty("y") && s(d, t, a, i)) { r = d; break } } else if ("object" === o()(n)) for (var c = Object.keys(n), f = 0; f < c.length; f++) { var g = c[f]; if (Array.isArray(n[g])) { if (r = e(t, n[g], a, i)) break } else { var m = n[g]; if (s(m, t, a, i)) { r = m; break } } } return r } }, s = function e(t, n, a, o) { if (t.hasOwnProperty("pointNearHandle")) { if (t.pointNearHandle(n, t, a)) return !0 } else if (!0 === t.hasBoundingBox) { if (Object(r.default)(t, a)) return !0 } else { var l = i.default.cornerstone.pixelToCanvas(n, t); if (i.default.cornerstoneMath.point.distance(l, a) <= o) return !0 } return !1 }; t.default = l }, "./manipulators/getHandlePixelPosition.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ./../store/index.js */ "./store/index.js"); t.default = function (e, t) { var n = e.currentPoints, i = e.element, r = n.page, l = o.state.handleTouchOffset, s = 0, u = 0; return "touch" === t && (s = l.x, u = l.y), a.default.cornerstone.pageToPixel(i, r.x + s, r.y + u) } }, "./manipulators/handleActivator.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"); t.default = function (e, t, n, o) { o || (o = 6); var i, r, l = (i = t, Object.keys(i).forEach(function (e) { var t = i[e]; if (!0 === t.active) { r = t; return } }), r), s = Object(a.default)(e, t, n, o); return l !== s && (void 0 !== s && (s.active = !0), void 0 !== l && (l.active = !1), !0) } }, "./manipulators/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"); n.d(t, "anyHandlesOutsideImage", function () { return a.default }); var o = n(/*! ./getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"); n.d(t, "getHandleNearImagePoint", function () { return o.default }); var i = n(/*! ./getHandlePixelPosition.js */ "./manipulators/getHandlePixelPosition.js"); n.d(t, "getHandlePixelPosition", function () { return i.default }); var r = n(/*! ./handleActivator.js */ "./manipulators/handleActivator.js"); n.d(t, "handleActivator", function () { return r.default }); var l = n(/*! ./moveAllHandles.js */ "./manipulators/moveAllHandles.js"); n.d(t, "moveAllHandles", function () { return l.default }); var s = n(/*! ./moveHandle.js */ "./manipulators/moveHandle.js"); n.d(t, "moveHandle", function () { return s.default }); var u = n(/*! ./moveNewHandle.js */ "./manipulators/moveNewHandle.js"); n.d(t, "moveNewHandle", function () { return u.default }) }, "./manipulators/moveAllHandles.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ./anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), r = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), l = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), s = n(/*! ../util/clip.js */ "./util/clip.js"), u = n(/*! ./../store/index.js */ "./store/index.js"), d = n(/*! ../util/getActiveTool */ "./util/getActiveTool.js"), c = n(/*! ../tools/base/BaseAnnotationTool */ "./tools/base/BaseAnnotationTool.js"), f = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("manipulators:moveAllHandles"), g = Object(u.getModule)("manipulatorState"), m = { mouse: [a.default.MOUSE_DRAG], touch: [a.default.TOUCH_DRAG] }, h = { mouse: [a.default.MOUSE_UP, a.default.MOUSE_CLICK], touch: [a.default.TOUCH_END, a.default.TOUCH_DRAG_END, a.default.TOUCH_PINCH, a.default.TOUCH_PRESS, a.default.TAP] }; function v(e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, i = arguments.length > 3 ? arguments[3] : void 0, r = arguments.length > 4 ? arguments[4] : void 0, u = r.detail, f = u.element, g = u.image, m = u.buttons, h = r.detail.deltaPoints.image, v = h.x, p = h.y; t.active = !0, t.invalidated = !0; for (var x = Object.keys(t.handles), $ = 0; $ < x.length; $++) { var y = x[$], T = t.handles[y]; !0 !== T.movesIndependently && T.hasOwnProperty("x") && T.hasOwnProperty("y") && (T.x += v, T.y += p, n.preventHandleOutsideImage && Object(s.clipToBox)(T, g)) } o.default.cornerstone.updateImage(f); var b = Object(d.default)(f, m, i); b instanceof c.default && b.updateCachedStats(g, f, t); var _ = a.default.MEASUREMENT_MODIFIED; Object(l.default)(f, _, { toolName: e, toolType: e, element: f, measurementData: t }), r.preventDefault(), r.stopPropagation() } function p(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 ? arguments[2] : void 0, a = arguments.length > 3 ? arguments[3] : void 0, o = a.dragHandler, i = a.upOrEndHandler, r = arguments.length > 4 ? arguments[4] : void 0, l = arguments.length > 5 ? arguments[5] : void 0; x(e, t, n, { dragHandler: o, upOrEndHandler: i }, r, l, !1) } function x(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 ? arguments[2] : void 0, a = arguments.length > 3 ? arguments[3] : void 0, i = a.dragHandler, r = a.upOrEndHandler, l = arguments.length > 4 ? arguments[4] : void 0, s = arguments.length > 5 ? arguments[5] : void 0, d = !(arguments.length > 6) || void 0 === arguments[6] || arguments[6]; e.active = !1, e.invalidated = !0, u.state.isToolLocked = !1, m[n].forEach(function (e) { l.removeEventListener(e, i) }), h[n].forEach(function (e) { l.removeEventListener(e, r) }), "function" == typeof t.doneMovingCallback && (f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."), t.doneMovingCallback(d)), "function" == typeof s && s(d), o.default.cornerstone.updateImage(l) } t.default = function (e, t, n, a) { var o = e.element, l = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "mouse", d = arguments.length > 6 ? arguments[6] : void 0; l = Object.assign({ deleteIfHandleOutsideImage: u.state.deleteIfHandleOutsideImage, preventHandleOutsideImage: u.state.preventHandleOutsideImage }, l); var c = v.bind(this, t, n, l, s), f = function e(a) { !function e(t, n) { var a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, o = arguments.length > 3 ? arguments[3] : void 0, l = arguments.length > 4 ? arguments[4] : void 0, s = l.dragHandler, u = l.upOrEndHandler, d = arguments.length > 5 ? arguments[5] : void 0, c = arguments.length > 6 ? arguments[6] : void 0, f = d.detail, m = f.element; g.setters.removeActiveManipulatorForElement(m), a.deleteIfHandleOutsideImage && Object(i.default)(f, n.handles) && Object(r.removeToolState)(m, t, n), x(n, a, o, { dragHandler: s, upOrEndHandler: u }, m, c, !0) }(t, n, l, s, { dragHandler: c, upOrEndHandler: e }, a, d) }; g.setters.addActiveManipulatorForElement(o, p.bind(null, n, l, s, { dragHandler: c, upOrEndHandler: f }, o, d)), n.active = !0, u.state.isToolLocked = !0, m[s].forEach(function (e) { o.addEventListener(e, c) }), h[s].forEach(function (e) { o.addEventListener(e, f) }) } }, "./manipulators/moveHandle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ./anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), r = n(/*! ./getHandlePixelPosition.js */ "./manipulators/getHandlePixelPosition.js"), l = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), s = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), u = n(/*! ../util/clip.js */ "./util/clip.js"), d = n(/*! ./../store/index.js */ "./store/index.js"), c = n(/*! ../util/getActiveTool */ "./util/getActiveTool.js"), f = n(/*! ../tools/base/BaseAnnotationTool */ "./tools/base/BaseAnnotationTool.js"), g = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("manipulators:moveHandle"), m = Object(d.getModule)("manipulatorState"), h = { value: !1 }, v = { mouse: [a.default.MOUSE_DRAG], touch: [a.default.TOUCH_DRAG] }, p = { mouse: [a.default.MOUSE_UP, a.default.MOUSE_CLICK], touch: [a.default.TOUCH_END, a.default.TOUCH_DRAG_END, a.default.TOUCH_PINCH, a.default.TOUCH_PRESS, a.default.TAP] }; function x(e, t, n, i, l, d) { var g = d.detail, m = g.image, v = g.element, p = g.buttons, x = Object(r.default)(d.detail, l); h.value = !1, n.active = !0, n.hasMoved = !0, n.x = x.x, n.y = x.y, t.invalidated = !0, i.preventHandleOutsideImage && Object(u.clipToBox)(n, m), o.default.cornerstone.updateImage(v); var $ = Object(c.default)(v, p, l); $ instanceof f.default && $.updateCachedStats(m, v, t); var y = a.default.MEASUREMENT_MODIFIED; Object(s.default)(v, y, { toolName: e, toolType: e, element: v, measurementData: t }) } function $(e, t, n, a) { var o = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, i = arguments.length > 5 ? arguments[5] : void 0, r = arguments.length > 6 ? arguments[6] : void 0, l = r.dragHandler, s = r.upOrEndHandler, u = arguments.length > 7 ? arguments[7] : void 0; y(e, t, n, a, o, i, { dragHandler: l, upOrEndHandler: s }, u, !1) } function y(e, t, n, a) { var r = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, s = arguments.length > 5 ? arguments[5] : void 0, u = arguments.length > 6 ? arguments[6] : void 0, c = u.dragHandler, f = u.upOrEndHandler, m = arguments.length > 7 ? arguments[7] : void 0, x = !(arguments.length > 8) || void 0 === arguments[8] || arguments[8], $ = t.element; a.active = !1, a.moving = !1, n.active = !1, n.invalidated = !0, h.value = !1, d.state.isToolLocked = !1, v[s].forEach(function (e) { $.removeEventListener(e, c) }), p[s].forEach(function (e) { $.removeEventListener(e, f) }), r.deleteIfHandleOutsideImage && Object(i.default)(t, n.handles) && Object(l.removeToolState)($, e, n), "function" == typeof r.doneMovingCallback && (g.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."), r.doneMovingCallback(x)), "function" == typeof m && m(x), o.default.cornerstone.updateImage($) } t.default = function (e, t, n, a) { var i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "mouse", s = arguments.length > 6 ? arguments[6] : void 0; i = Object.assign({ deleteIfHandleOutsideImage: d.state.deleteIfHandleOutsideImage, preventHandleOutsideImage: d.state.preventHandleOutsideImage }, i); var u = e.element, c = x.bind(this, t, n, a, i, l), f = function o() { !function e(t, n, a, o) { var i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, r = arguments.length > 5 ? arguments[5] : void 0, l = arguments.length > 6 ? arguments[6] : void 0, s = l.dragHandler, u = l.upOrEndHandler, d = arguments.length > 7 ? arguments[7] : void 0, c = n.element; m.setters.removeActiveManipulatorForElement(c), y(t, n, a, o, i, r, { dragHandler: s, upOrEndHandler: u }, d, !0) }(t, e, n, a, i, l, { dragHandler: c, upOrEndHandler: o }, s) }; if (m.setters.addActiveManipulatorForElement(u, $.bind(null, t, e, n, a, i, l, { dragHandler: c, upOrEndHandler: f }, s)), a.active = !0, a.moving = !0, n.active = !0, d.state.isToolLocked = !0, v[l].forEach(function (e) { u.addEventListener(e, c) }), p[l].forEach(function (e) { u.addEventListener(e, f) }), "touch" === l) { h.value = !0; var g = o.default.cornerstone.getEnabledElement(u), T = Object(r.default)(e, l); !function e(t, n, a, i) { if (n.value) { var r = Math.abs(t.y - i.y), l = r / 10; if (r < 1) { t.y = i.y, n.value = !1; return } t.y > i.y ? t.y -= l : t.y < i.y && (t.y += l), o.default.cornerstone.updateImage(a.element), o.default.cornerstone.requestAnimationFrame(function () { e(t, n, a, i) }) } }(a, h, g, T) } } }, "./manipulators/moveNewHandle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ./anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), r = n(/*! ./getHandlePixelPosition.js */ "./manipulators/getHandlePixelPosition.js"), l = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), s = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), u = n(/*! ../util/clip.js */ "./util/clip.js"), d = n(/*! ./../store/index.js */ "./store/index.js"), c = n(/*! ../util/getActiveTool */ "./util/getActiveTool.js"), f = n(/*! ../tools/base/BaseAnnotationTool */ "./tools/base/BaseAnnotationTool.js"), g = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("manipulators:moveNewHandle"), m = Object(d.getModule)("manipulatorState"), h = { mouse: [a.default.MOUSE_MOVE, a.default.MOUSE_DRAG], touch: [a.default.TOUCH_DRAG] }, v = { mouse: [a.default.MOUSE_UP, a.default.MOUSE_CLICK], touch: [a.default.TOUCH_END, a.default.TOUCH_PINCH, a.default.TAP] }; function p(e, t, n, i, r) { var l = i.moveHandler, s = i.moveEndHandler, u = !(arguments.length > 5) || void 0 === arguments[5] || arguments[5]; h[e].forEach(function (e) { n.removeEventListener(e, l) }), v[e].forEach(function (e) { n.removeEventListener(e, s) }), n.removeEventListener(a.default.TOUCH_START, $), d.state.isToolLocked = !1, "function" == typeof r && r(u), "function" == typeof t.doneMovingCallback && (g.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."), t.doneMovingCallback(u)), o.default.cornerstone.updateImage(n) } function x(e, t, n, a, o, i, r) { var l = o.moveHandler, s = o.moveEndHandler; e.active = !1, e.invalidated = !0, t.active = !1, p(a, n, i, { moveHandler: l, moveEndHandler: s }, r, !1) } function $(e) { return e.stopImmediatePropagation(), !1 } t.default = function (e, t, n, g, y) { var T = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "mouse", b = arguments.length > 6 ? arguments[6] : void 0; (y = Object.assign({ deleteIfHandleOutsideImage: d.state.deleteIfHandleOutsideImage, preventHandleOutsideImage: d.state.preventHandleOutsideImage }, y)).hasMoved = !1; var _ = e.element; function C(e) { var i, l, d, m, h, v, p, x, $, b, _, C, j; i = t, l = n, d = g, m = y, h = T, v = e, p = v.detail, x = p.image, $ = p.element, b = p.buttons, _ = Object(r.default)(v.detail, h), m.hasMoved = !0, l.invalidated = !0, d.active = !0, d.x = _.x, d.y = _.y, m && m.preventHandleOutsideImage && Object(u.clipToBox)(d, x), o.default.cornerstone.updateImage($), C = Object(c.default)($, b, h), C instanceof f.default && C.updateCachedStats(x, $, l), j = a.default.MEASUREMENT_MODIFIED, Object(s.default)($, j, { toolName: i, toolType: i, element: $, measurementData: l }) } function j(e) { !function e(t, n, a, o, s, d, c, f) { var g = d.moveHandler, h = d.moveEndHandler, v = c.detail, x = v.element, $ = !0; if (!1 !== o.hasMoved) { var y = Object(r.default)(v, s); n.active = !1, n.invalidated = !0, a.active = !1, a.moving = !1, a.x = y.x, a.y = y.y, m.setters.removeActiveManipulatorForElement(x), o.preventHandleOutsideImage && Object(u.clipToBox)(a, c.detail.image), o.deleteIfHandleOutsideImage && Object(i.default)(c.detail, n.handles) && (n.cancelled = !0, $ = !1, Object(l.removeToolState)(x, t, n)), p(s, o, x, { moveHandler: g, moveEndHandler: h }, f, $) } }(t, n, g, y, T, { moveHandler: C, moveEndHandler: j }, e, b) } n.active = !0, g.moving = !0, g.active = !0, d.state.isToolLocked = !0, h[T].forEach(function (e) { _.addEventListener(e, C) }), _.addEventListener(a.default.TOUCH_START, $), v[T].forEach(function (e) { _.addEventListener(e, j) }), m.setters.addActiveManipulatorForElement(_, x.bind(null, n, g, y, T, { moveHandler: C, moveEndHandler: j }, _, b)) } }, "./mixins/activeOrDisabledBinaryTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../store/setToolMode.js */ "./store/setToolMode.js"); t.default = { passiveCallback: function e(t) { Object(a.setToolDisabledForElement)(t, this.name) }, enabledCallback: function e(t) { Object(a.setToolActiveForElement)(t, this.name) } } }, "./mixins/enabledOrDisabledBinaryTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../store/setToolMode.js */ "./store/setToolMode.js"); t.default = { passiveCallback: function e(t) { Object(a.setToolDisabledForElement)(t, this.name) }, activeCallback: function e(t) { Object(a.setToolEnabledForElement)(t, this.name) } } }, "./mixins/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./activeOrDisabledBinaryTool.js */ "./mixins/activeOrDisabledBinaryTool.js"), o = n(/*! ./enabledOrDisabledBinaryTool.js */ "./mixins/enabledOrDisabledBinaryTool.js"), i = n(/*! ./segmentation/circleSegmentationMixin.js */ "./mixins/segmentation/circleSegmentationMixin.js"), r = n(/*! ./segmentation/polylineSegmentationMixin.js */ "./mixins/segmentation/polylineSegmentationMixin.js"), l = n(/*! ./segmentation/freehandSegmentationMixin.js */ "./mixins/segmentation/freehandSegmentationMixin.js"), s = n(/*! ./segmentation/rectangleSegmentationMixin.js */ "./mixins/segmentation/rectangleSegmentationMixin.js"), u = n(/*! ./segmentation/renderBrushMixin.js */ "./mixins/segmentation/renderBrushMixin.js"); t.default = { activeOrDisabledBinaryTool: a.default, enabledOrDisabledBinaryTool: o.default, circleSegmentationMixin: i.default, polylineSegmentationMixin: r.default, freehandSegmentationMixin: l.default, rectangleSegmentationMixin: s.default, renderBrushMixin: u.default } }, "./mixins/segmentation/circleSegmentationMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../drawing */ "./drawing/index.js"), o = n(/*! ../../externalModules */ "./externalModules.js"), i = n(/*! ../../util/isEmptyObject */ "./util/isEmptyObject.js"), r = n(/*! ../../store */ "./store/index.js"), l = n(/*! ../../util/segmentation */ "./util/segmentation/index.js"), s = Object(r.getModule)("segmentation"), u = s.getters, d = s.setters; function c() { this.handles = { start: {}, end: {} } } function f(e) { var t = e.detail.element, n = e.detail.currentPoints.image; return Object(i.default)(this.handles.start) ? this.handles.start = n : (this.handles.end = n, this._applyStrategy(e)), o.default.cornerstone.updateImage(t), !0 } function g(e) { var t = e.detail, n = t.element, a = t.currentPoints.image; this.handles.end = a, o.default.cornerstone.updateImage(n) } function m(e) { e.detail.handles = this.handles; var t = e.detail.element, n = u.labelmap2D(t), a = n.labelmap2D, i = n.labelmap3D, r = n.currentImageIdIndex, s = a.pixelData, c = s.slice(), f = { points: { start: { x: this.handles.start.x, y: this.handles.start.y }, end: { x: this.handles.end.x, y: this.handles.end.y } }, pixelData: s, segmentIndex: i.activeSegmentIndex, segmentationMixinType: "circleSegmentationMixin" }; this.applyActiveStrategy(e, f); var g = { imageIdIndex: r, diff: Object(l.getDiffBetweenPixelData)(c, s) }; d.pushState(this.element, [g]), d.updateSegmentsOnLabelmap2D(a), o.default.cornerstone.updateImage(t), this._resetHandles() } t.default = { postTouchStartCallback: f, postMouseDownCallback: f, mouseClickCallback: f, touchDragCallback: g, mouseDragCallback: g, mouseMoveCallback: g, touchEndCallback: m, mouseUpCallback: m, initializeMixin: c, renderToolData: function e(t) { var n = this, i = t.detail, r = i.element, l = u.brushColor(r, !0), s = Object(a.getNewContext)(i.canvasContext.canvas), d = o.default.cornerstoneMath.point.distance; Object(a.draw)(s, function (e) { if (!n.handles) return null; var t = o.default.cornerstone.pixelToCanvas(r, n.handles.start), i = o.default.cornerstone.pixelToCanvas(r, n.handles.end), s = d(t, i); Object(a.drawCircle)(e, r, n.handles.start, s, { color: l }) }) }, _resetHandles: c, _applyStrategy: m } }, "./mixins/segmentation/freehandSegmentationMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ../../externalModules.js */ "./externalModules.js"), r = n(/*! ../../store */ "./store/index.js"), l = n(/*! ../../util/logger.js */ "./util/logger.js"), s = n(/*! ../../drawing */ "./drawing/index.js"), u = n(/*! ../../util/segmentation */ "./util/segmentation/index.js"), d = Object(l.getLogger)("tools:ScissorsTool"), c = Object(r.getModule)("segmentation"), f = c.getters, g = c.setters; function m(e) { var t = e.detail.element, n = e.detail.currentPoints.image, a = this.handles.points; if (!a.length) return d.warn("Something went wrong, empty handles detected."), null; a.push({ x: n.x, y: n.y, lines: [] }), this.currentHandle += 1, i.default.cornerstone.updateImage(t) } function h(e) { var t = e.detail, n = e.detail.element; this._addPoint(t), i.default.cornerstone.updateImage(n) } function v(e) { var t = this.handles.points, n = e.detail.element, a = f.labelmap2D(n), o = a.labelmap2D, r = a.labelmap3D, l = a.currentImageIdIndex, s = o.pixelData, d = s.slice(), c = { points: t, pixelData: s, segmentIndex: r.activeSegmentIndex, segmentationMixinType: "freehandSegmentationMixin" }; this.applyActiveStrategy(e, c); var m = { imageIdIndex: l, diff: Object(u.getDiffBetweenPixelData)(d, s) }; g.pushState(this.element, [m]), g.updateSegmentsOnLabelmap2D(o), i.default.cornerstone.updateImage(n), this._resetHandles() } function p() { this.handles = { points: [] }, this.currentHandle = 0 } t.default = { postTouchStartCallback: m, postMouseDownCallback: m, mouseClickCallback: m, touchDragCallback: h, mouseDragCallback: h, mouseMoveCallback: h, touchEndCallback: v, mouseUpCallback: v, initializeMixin: p, renderToolData: function e(t) { var n = t.detail, a = n.element, i = f.brushColor(a, !0), r = Object(s.getNewContext)(n.canvasContext.canvas), l = this.handles.points; !(l.length < 2) && Object(s.draw)(r, function (e) { for (var t = 0; t < l.length; t++) { var n = o()(l[t].lines); t === l.length - 1 && n.push(l[0]), Object(s.drawJoinedLines)(e, a, l[t], n, { color: i }) } }) }, _resetHandles: p, _addPoint: function e(t) { var n = this.handles.points; n.length && n[this.currentHandle - 1].lines.push({ x: t.currentPoints.image.x, y: t.currentPoints.image.y, lines: [] }), n.push({ x: t.currentPoints.image.x, y: t.currentPoints.image.y, lines: [] }), this.currentHandle += 1, i.default.cornerstone.updateImage(t.element) }, _applyStrategy: v } }, "./mixins/segmentation/polylineSegmentationMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ../../drawing */ "./drawing/index.js"), r = n(/*! ../../store */ "./store/index.js"), l = n(/*! ./freehandSegmentationMixin */ "./mixins/segmentation/freehandSegmentationMixin.js"), s = Object(r.getModule)("segmentation").getters, u = Object.assign({}, l.default, { renderToolData: function e(t) { var n = this, a = t.detail, r = a.element, l = s.brushColor(r, !0), u = Object(i.getNewContext)(a.canvasContext.canvas), d = this.handles; Object(i.draw)(u, function (e) { if (d.points.length > 1) for (var t = 0; t < d.points.length; t++) { var a = o()(d.points[t].lines); Object(i.drawJoinedLines)(e, r, n.handles.points[t], a, { color: l }) } }) } }); t.default = u }, "./mixins/segmentation/rectangleSegmentationMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../drawing */ "./drawing/index.js"), o = n(/*! ../../externalModules */ "./externalModules.js"), i = n(/*! ../../util/isEmptyObject */ "./util/isEmptyObject.js"), r = n(/*! ../../store */ "./store/index.js"), l = n(/*! ../../util/segmentation */ "./util/segmentation/index.js"), s = Object(r.getModule)("segmentation"), u = s.getters, d = s.setters; function c(e) { var t = e.detail.element, n = e.detail.currentPoints.image; return Object(i.default)(this.handles.start) ? this.handles.start = n : (this.handles.end = n, this._applyStrategy(e)), o.default.cornerstone.updateImage(t), !0 } function f(e) { var t = e.detail, n = t.element, a = t.currentPoints.image; this.handles.end = a, o.default.cornerstone.updateImage(n) } function g(e) { e.detail.handles = this.handles; var t = e.detail.element, n = u.labelmap2D(t), a = n.labelmap2D, i = n.labelmap3D, r = n.currentImageIdIndex, s = a.pixelData, c = s.slice(), f = { points: [{ x: this.handles.start.x, y: this.handles.start.y }, { x: this.handles.end.x, y: this.handles.end.y }], pixelData: s, segmentIndex: i.activeSegmentIndex, segmentationMixinType: "rectangleSegmentationMixin" }; this.applyActiveStrategy(e, f); var g = { imageIdIndex: r, diff: Object(l.getDiffBetweenPixelData)(c, s) }; d.pushState(this.element, [g]), d.updateSegmentsOnLabelmap2D(a), o.default.cornerstone.updateImage(t), this._resetHandles() } function m() { this.handles = { start: {}, end: {} } } t.default = { postTouchStartCallback: c, postMouseDownCallback: c, mouseClickCallback: c, touchDragCallback: f, mouseDragCallback: f, mouseMoveCallback: f, touchEndCallback: g, mouseUpCallback: g, initializeMixin: m, renderToolData: function e(t) { var n = this, o = t.detail, i = o.element, r = u.brushColor(i, !0), l = Object(a.getNewContext)(o.canvasContext.canvas); Object(a.draw)(l, function (e) { Object(a.drawRect)(e, i, n.handles.start, n.handles.end, { color: r }, "canvas") }) }, _resetHandles: m, _applyStrategy: g } }, "./mixins/segmentation/renderBrushMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../externalModules.js */ "./externalModules.js"), o = n(/*! ./../../store/index.js */ "./store/index.js"); t.default = { renderBrush: function e(t) { var n, i = a.default.cornerstone, r = Object(o.getModule)("segmentation"), l = r.getters, s = r.configuration, u = t.detail, d = u.viewport; if (this._drawing ? n = this._lastImageCoords : this._mouseUpRender ? (n = this._lastImageCoords, this._mouseUpRender = !1) : n = o.default.state.mousePositionImage, n) { var c = u.image, f = c.rows, g = c.columns, m = n, h = m.x, v = m.y; if (!(h < 0) && !(h > g) && !(v < 0) && !(v > f)) { var p = s.radius, x = u.canvasContext, $ = u.element, y = l.brushColor($, this._drawing); x.setTransform(1, 0, 0, 1, 0, 0); var T = p * d.scale, b = i.pixelToCanvas($, n); x.beginPath(), x.strokeStyle = y, x.ellipse(b.x, b.y, T, T, 0, 0, 2 * Math.PI), x.stroke() } } } } }, "./orientation/getOrientationString.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"); t.default = function (e) { for (var t = Object(o.default)(e), n = "", i = t.x < 0 ? "R" : "L", r = t.y < 0 ? "A" : "P", l = t.z < 0 ? "F" : "H", s = new a.default.cornerstoneMath.Vector3(Math.abs(t.x), Math.abs(t.y), Math.abs(t.z)), u = 0; u < 3; u++)if (s.x > 1e-4 && s.x > s.y && s.x > s.z) n += i, s.x = 0; else if (s.y > 1e-4 && s.y > s.x && s.y > s.z) n += r, s.y = 0; else if (s.z > 1e-4 && s.z > s.x && s.z > s.y) n += l, s.z = 0; else if (s.x > 1e-4 && s.y > 1e-4 && s.x === s.y) n += i + r, s.x = 0, s.y = 0; else if (s.x > 1e-4 && s.z > 1e-4 && s.x === s.z) n += i + l, s.x = 0, s.z = 0; else if (s.y > 1e-4 && s.z > 1e-4 && s.y === s.z) n += r + l, s.y = 0, s.z = 0; else break; return n } }, "./orientation/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./getOrientationString.js */ "./orientation/getOrientationString.js"), o = n(/*! ./invertOrientationString.js */ "./orientation/invertOrientationString.js"), i = { getOrientationString: a.default, invertOrientationString: o.default }; t.default = i }, "./orientation/invertOrientationString.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e) { var t = e.replace("H", "f"); return (t = (t = (t = (t = (t = t.replace("F", "h")).replace("R", "l")).replace("L", "r")).replace("A", "p")).replace("P", "a")).toUpperCase() } }, "./stackTools/fusionRenderer.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return u }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! ../externalModules.js */ "./externalModules.js"), s = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), u = function () { function e() { o()(this, e), this.currentImageIdIndex = 0, this.layerIds = [], this.findImageFn = void 0 } return r()(e, [{ key: "render", value: function e(t, n) { var a = this; if (!Number.isInteger(this.currentImageIdIndex)) throw Error("FusionRenderer: render - Image ID Index is not an integer"); if (!this.findImageFn) throw Error("No findImage function has been defined"); !n && (n = Object(s.getToolState)(t, "stack").data); var o = l.default.cornerstone, i = n[0], r = i.imageIds[this.currentImageIdIndex], u = n.slice(1, n.length); o.loadAndCacheImage(r).then(function (e) { var n = a.layerIds[0]; n ? o.setLayerImage(t, e, n) : (n = o.addLayer(t, e, i.options), a.layerIds.push(n)), o.displayImage(t, e), u.forEach(function (e, i) { var l = a.findImageFn(e.imageIds, r), s = a.layerIds[i + 1]; s || (s = o.addLayer(t, void 0, e.options), a.layerIds.push(s)), l ? o.loadAndCacheImage(l).then(function (e) { o.setLayerImage(t, e, s), o.updateImage(t) }) : (o.setLayerImage(t, void 0, s), o.setActiveLayer(t, n), o.updateImage(t)) }) }) } }]), e }() }, "./stackTools/playClip.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "playClip", function () { return d }), n.d(t, "stopClip", function () { return c }); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), l = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), s = "playClip"; function u(e) { var t = e.intervalId; void 0 !== t && (e.intervalId = void 0, e.usingFrameTimeVector ? clearTimeout(t) : clearInterval(t)) } function d(e, t) { if (void 0 === e) throw Error("playClip: element must not be undefined"); var n, d, c, f = Object(r.getToolState)(e, "stack"); if (f && f.data && f.data.length) { var g = o.default.cornerstone; if (f.data.length > 1) { var m = Object(r.getToolState)(e, "stackRenderer"); m && m.data && m.data.length && (c = m.data[0]) } var h = f.data[0], v = Object(r.getToolState)(e, s); v && v.data && v.data.length ? u(n = v.data[0]) : (n = { intervalId: void 0, framesPerSecond: 30, lastFrameTimeStamp: void 0, frameRate: 0, frameTimeVector: void 0, ignoreFrameTimeVector: !1, usingFrameTimeVector: !1, speed: 1, reverse: !1, loop: !0 }, Object(r.addToolState)(e, s, n)), (t < 0 || t > 0) && (n.framesPerSecond = Number(t), n.reverse = n.framesPerSecond < 0, n.ignoreFrameTimeVector = !0), !0 !== n.ignoreFrameTimeVector && n.frameTimeVector && n.frameTimeVector.length === h.imageIds.length && (d = function e(t, n) { var a, o, i, r = 0, l = t.length, s = []; for (s.isTimeVarying = !1, ("number" != typeof n || n <= 0) && (n = 1), a = 1; a < l; a++)i = Number(t[a]) / n | 0, s.push(i), 1 === a ? o = i : i !== o && (s.isTimeVarying = !0), r += i; return s.length > 0 && (i = s.isTimeVarying ? r / s.length | 0 : s[0], s.push(i)), s }(n.frameTimeVector, n.speed)); var p = function t() { var o, r, s, d, m, v = h.currentImageIdIndex, p = h.imageIds.length; if (n.reverse ? v-- : v++, !n.loop && (v < 0 || v >= p)) { u(n), o = e, Object(l.default)(o, a.default.CLIP_STOPPED, { element: o }); return } v >= p && (v = 0), v < 0 && (v = p - 1), v !== h.currentImageIdIndex && (s = i.default.getStartLoadHandler(e), d = i.default.getEndLoadHandler(e), m = i.default.getErrorLoadingHandler(e), s && s(e), (r = !0 === h.preventCache ? g.loadImage(h.imageIds[v]) : g.loadAndCacheImage(h.imageIds[v])).then(function (t) { try { h.currentImageIdIndex = v, c ? (c.currentImageIdIndex = v, c.render(e, f.data)) : g.displayImage(e, t), d && d(e, t) } catch (n) { return } }, function (t) { var n = h.imageIds[v]; m && m(e, n, t) })) }; d && d.length > 0 && d.isTimeVarying ? (n.usingFrameTimeVector = !0, n.intervalId = setTimeout(function e() { n.intervalId = setTimeout(e, d[h.currentImageIdIndex]), p() }, 0)) : (n.usingFrameTimeVector = !1, n.intervalId = setInterval(p, 1e3 / Math.abs(n.framesPerSecond))) } } function c(e) { var t = Object(r.getToolState)(e, s); t && t.data && t.data.length && u(t.data[0]) } }, "./stackTools/stackPrefetch.js": function (e, t, n) { "use strict"; n.r(t); var a, o = n(/*! ./../externalModules.js */ "./externalModules.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), l = n(/*! ../util/logger.js */ "./util/logger.js"), s = n(/*! ../util/triggerEvent */ "./util/triggerEvent.js"), u = n(/*! ../events.js */ "./events.js"), d = Object(l.getLogger)("stackTools:stackPrefetch"), c = "stackPrefetch", f = "prefetch", g = { maxImagesToPrefetch: 1 / 0, preserveExistingPool: !1 }; function m(e) { var t, n, a, l, m, h, v, p = Object(r.getToolState)(e, "stack"); if (p && p.data && p.data.length) { var x = p.data[0], $ = Object(r.getToolState)(e, c); if ($) { var y = $.data[0] || {}; if (y.indicesToRequest && y.indicesToRequest.length || (y.enabled = !1), !1 !== y.enabled) { if ($.data[0].indicesToRequest.sort(function (e, t) { return e - t }), y.indicesToRequest.slice().forEach(function (e) { var t = x.imageIds[e]; t && o.default.cornerstone.imageCache.getImageLoadObject(t) && k(e) }), y.indicesToRequest.length) { g.preserveExistingPool || o.default.cornerstone.imageLoadPoolManager.clearRequestStack(f); for (var T = (t = y.indicesToRequest, n = x.currentImageIdIndex, a = 0, l = t.length - 1, t.forEach(function (e, t) { e < n ? a = Math.max(t, a) : e > n && (l = Math.min(t, l)) }), { low: a, high: l }), b = i.default.getErrorLoadingHandler(e), _ = T.low, C = T.high, j = []; _ >= 0 || C < y.indicesToRequest.length;) { var S = x.currentImageIdIndex, w = S - y.indicesToRequest[_] > g.maxImagesToPrefetch, M = y.indicesToRequest[C] - S > g.maxImagesToPrefetch, E = !w && _ >= 0, I = !M && C < y.indicesToRequest.length; if (!I && !E) break; E && (h = y.indicesToRequest[_--], m = x.imageIds[h], j.push(m)), I && (h = y.indicesToRequest[C++], m = x.imageIds[h], j.push(m)) } var P = { addToBeginning: !0, priority: 0, requestType: f }; v = function e(t) { return o.default.cornerstone.loadAndCacheImage(t, P) }, j.reverse().forEach(function (e) { o.default.cornerstone.imageLoadPoolManager.addRequest(v.bind(null, e), f, { imageId: e }, 0, !0) }) } } } } function k(e) { var t = y.indicesToRequest.indexOf(e); t > -1 && y.indicesToRequest.splice(t, 1) } function D(t) { d.log("prefetch done: %s", t.imageId); var n = x.imageIds.indexOf(t.imageId); k(n), Object(s.default)(e, u.default.STACK_PREFETCH_IMAGE_LOADED, { element: e, imageId: t.imageId, imageIndex: n, stackPrefetch: y, stack: x }), y.indicesToRequest && y.indicesToRequest.length > 0 || Object(s.default)(e, u.default.STACK_PREFETCH_DONE, { element: e, stackPrefetch: y, stack: x }) } function L(t) { d.log("prefetch errored: %o", t), b && b(e, m, t, "stackPrefetch") } } function h(e) { return function (t) { var n, a = t.detail; try { n = Object(r.getToolState)(e, "stack") } catch (o) { return } if (n && n.data && n.data.length) { var i = n.data[0].imageIds.indexOf(a.imageId); if (!(i < 0)) { var l = Object(r.getToolState)(e, c); l && l.data && l.data.length && l.data[0].indicesToRequest.push(i) } } } } function v(e) { clearTimeout(a), a = setTimeout(function () { var t = e.target; try { m(t) } catch (n) { return } }, 10) } function p() { return g } function x(e) { g = e } t.default = { enable: function e(t) { Object(r.getToolState)(t, c).data = []; var n = Object(r.getToolState)(t, "stack"); if (n && n.data && n.data.length) { var a = n.data[0]; if (!0 === a.preventCache) { d.warn("A stack that should not be cached was given the stackPrefetch"); return } var i = { indicesToRequest: function e(t, n) { t = Math.round(t) || 0; var a = [], o = (n = Math.round(n) || 0) - t + 1; if (o <= 0) return a; for (; o--;)a[o] = n--; return a }(0, a.imageIds.length - 1), enabled: !0, direction: 1 }, l = i.indicesToRequest.indexOf(a.currentImageIdIndex); i.indicesToRequest.splice(l, 1), Object(r.addToolState)(t, c, i), m(t), t.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE, v), t.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE, v); var s = h(t); o.default.cornerstone.events.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED, s), o.default.cornerstone.events.addEventListener(o.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED, s) } }, disable: function e(t) { clearTimeout(a), t.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE, v); var n = h(t); o.default.cornerstone.events.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED, n); var i = Object(r.getToolState)(t, c); i && i.data.length && (i.data[0].enabled = !1, o.default.cornerstone.imageLoadPoolManager.clearRequestStack(f)) }, getConfiguration: p, setConfiguration: x } }, "./stackTools/stackRenderers.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./fusionRenderer.js */ "./stackTools/fusionRenderer.js"), o = {}; o.FusionRenderer = a.default, t.default = o }, "./stateManagement/frameOfReferenceStateManager.js": function (e, t, n) { "use strict"; function a() { var e = {}; return { get: function t(n, a) { if (!1 !== e.hasOwnProperty(n)) { var o = e[n]; if (!1 !== o.hasOwnProperty(a)) return o[a] } }, add: function t(n, a, o) { !1 === e.hasOwnProperty(n) && (e[n] = {}); var i = e[n]; !1 === i.hasOwnProperty(a) && (i[a] = { data: [] }), i[a].data.push(o) }, remove: function t(n, a, o) { if (!1 !== e.hasOwnProperty(n)) { var i = e[n]; if (!1 !== i.hasOwnProperty(a)) { for (var r = i[a], l = -1, s = 0; s < r.data.length; s++)r.data[s] === o && (l = s); -1 !== l && r.data.splice(l, 1) } } } } } n.r(t), n.d(t, "newFrameOfReferenceSpecificToolStateManager", function () { return a }), n.d(t, "globalFrameOfReferenceSpecificToolStateManager", function () { return o }); var o = a() }, "./stateManagement/imageIdSpecificStateManager.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "newImageIdSpecificToolStateManager", function () { return o }), n.d(t, "globalImageIdSpecificToolStateManager", function () { return i }); var a = n(/*! ../externalModules.js */ "./externalModules.js"); function o() { var e = {}; function t(t) { return e[t] } function n(t, n) { e[t] = n } function o() { return e } function i(t) { e = t } function r(t, n, a) { !1 === e.hasOwnProperty(t) && (e[t] = {}); var o = e[t]; !1 === o.hasOwnProperty(n) && (o[n] = { data: [] }), o[n].data.push(a) } function l(t, n) { if (!1 !== e.hasOwnProperty(t)) { var a = e[t]; if (!1 !== a.hasOwnProperty(n)) return a[n] } } function s(t, n, a) { e[t][n] = a } function u(t) { !1 !== e.hasOwnProperty(t) && delete e[t] } return { get: function e(t, n) { var o = a.default.cornerstone.getEnabledElement(t); if (o.image) return l(o.image.imageId, n) }, add: function e(t, n, o) { var i = a.default.cornerstone.getEnabledElement(t); i.image && r(i.image.imageId, n, o) }, set: function e(t, n, o) { var i = a.default.cornerstone.getEnabledElement(t); i.image && s(i.image.imageId, n, o) }, clear: function e(t) { var n = a.default.cornerstone.getEnabledElement(t); n.image && u(n.image.imageId) }, getImageIdToolState: l, addImageIdToolState: r, setImageIdToolState: s, clearImageIdToolState: u, saveImageIdToolState: t, restoreImageIdToolState: n, saveToolState: o, restoreToolState: i, toolState: e } } var i = o() }, "./stateManagement/loadHandlerManager.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = "DEFAULT", i = {}, r = {}, l = {}; function s(e) { if (!e) return o; var t = a.default.cornerstone.getEnabledElement(e).uuid; if (!t) throw Error("Something went wrong when getting uuid from element"); return t } t.default = { setStartLoadHandler: function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0; if (!t) throw Error("The Handler function must be defined"); i[s(n)] = t }, getStartLoadHandler: function e(t) { return i[s(t)] || i[o] }, setEndLoadHandler: function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0; if (!t) throw Error("The Handler function must be defined"); r[s(n)] = t }, getEndLoadHandler: function e(t) { return r[s(t)] || r[o] }, setErrorLoadingHandler: function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : void 0; if (!t) throw Error("The Handler function must be defined"); l[s(n)] = t }, getErrorLoadingHandler: function e(t) { return l[s(t)] || l[o] }, removeHandlers: function e(t) { var n = s(t); delete i[n], delete r[n], delete l[n] } } }, "./stateManagement/stackSpecificStateManager.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "stackSpecificStateManager", function () { return s }), n.d(t, "newStackSpecificToolStateManager", function () { return i }), n.d(t, "addStackStateManager", function () { return l }); var a = n(/*! ./imageIdSpecificStateManager.js */ "./stateManagement/imageIdSpecificStateManager.js"), o = n(/*! ./toolState.js */ "./stateManagement/toolState.js"); function i(e, t) { var n = {}; function a() { return n } function o(e) { n = e } return { get: function a(o, i) { return e.indexOf(i) >= 0 ? (!1 === n.hasOwnProperty(i) && (n[i] = { data: [] }), n[i]) : t.get(o, i) }, add: function a(o, i, r) { if (!(e.indexOf(i) >= 0)) return t.add(o, i, r); !1 === n.hasOwnProperty(i) && (n[i] = { data: [] }), n[i].data.push(r) }, saveToolState: a, restoreToolState: o, toolState: n } } var r = []; function l(e, t) { var n = Object(o.getElementToolStateManager)(e); n || (n = a.globalImageIdSpecificToolStateManager); var l = ["stack", "stackPrefetch", "playClip", "volume", "slab", "referenceLines", "crosshairs", "stackRenderer"]; t && (l = l.concat(t)); var s = i(l, n); r.push(s), Object(o.setElementToolStateManager)(e, s) } var s = { newStackSpecificToolStateManager: i, addStackStateManager: l } }, "./stateManagement/textStyle.js": function (e, t, n) { "use strict"; n.r(t); var a = { fontSize: 15, fontFamily: "Arial", backgroundColor: "transparent" }; function o(e) { if ("string" != typeof e) throw Error("Font family must be a valid string"); a.fontFamily = e } function i(e) { if ("number" != typeof e || isNaN(e) || !isFinite(e)) throw Error("Font size must be a valid number"); a.fontSize = parseFloat(e) } t.default = { setFont: function e(t) { var n = t.split("px "); 2 === n.length && (i(parseFloat(n[0])), o(n[1])) }, getFont: function e() { return "".concat(a.fontSize, "px ").concat(a.fontFamily) }, setFontSize: i, getFontSize: function e() { return a.fontSize }, setFontFamily: o, getFontFamily: function e() { return a.fontFamily }, setBackgroundColor: function e(t) { a.backgroundColor = t }, getBackgroundColor: function e() { return a.backgroundColor } } }, "./stateManagement/toolColors.js": function (e, t, n) { "use strict"; n.r(t); var a = "white", o = "greenyellow", i = "transparent"; function r(e) { i = e } function l() { return i } function s(e) { a = e } function u() { return a } function d(e) { o = e } function c() { return o } t.default = { setFillColor: r, getFillColor: l, setToolColor: s, getToolColor: u, setActiveColor: d, getActiveColor: c, getColorIfActive: function e(t) { return t.color ? t.color : t.active ? o : a } } }, "./stateManagement/toolCoordinates.js": function (e, t, n) { "use strict"; var a; function o() { return a } n.r(t), t.default = { setCoords: function e(t) { a = t.currentPoints.canvas }, getCoords: o } }, "./stateManagement/toolState.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "addToolState", function () { return u }), n.d(t, "getToolState", function () { return d }), n.d(t, "removeToolState", function () { return c }), n.d(t, "clearToolState", function () { return f }), n.d(t, "setElementToolStateManager", function () { return g }), n.d(t, "getElementToolStateManager", function () { return s }); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ./imageIdSpecificStateManager.js */ "./stateManagement/imageIdSpecificStateManager.js"), r = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"), l = n(/*! ../util/uuidv4.js */ "./util/uuidv4.js"); function s(e) { var t = o.default.cornerstone.getEnabledElement(e); return void 0 === t.toolStateManager && (t.toolStateManager = i.globalImageIdSpecificToolStateManager), t.toolStateManager } function u(e, t, n) { var o = s(e); n.uuid = n.uuid || Object(l.default)(), o.add(e, t, n); var i = a.default.MEASUREMENT_ADDED; Object(r.default)(e, i, { toolName: t, toolType: t, element: e, measurementData: n }) } function d(e, t) { return s(e).get(e, t) } function c(e, t, n) { var o = s(e).get(e, t); if (o && o.data && o.data.length) { for (var i = -1, l = 0; l < o.data.length; l++)o.data[l] === n && (i = l); if (-1 !== i) { o.data.splice(i, 1); var u = a.default.MEASUREMENT_REMOVED; Object(r.default)(e, u, { toolName: t, toolType: t, element: e, measurementData: n }) } } } function f(e, t) { var n = s(e).get(e, t); void 0 !== n && (n.data = []) } function g(e, t) { o.default.cornerstone.getEnabledElement(e).toolStateManager = t } }, "./stateManagement/toolStyle.js": function (e, t, n) { "use strict"; n.r(t); var a = 1, o = 2; function i(e) { a = e } function r() { return a } function l(e) { o = e } function s() { return o } t.default = { setToolWidth: i, getToolWidth: r, setActiveWidth: l, getActiveWidth: s } }, "./store/addTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "addTool", function () { return l }), n.d(t, "addToolForElement", function () { return r }); var a = n(/*! ./index.js */ "./store/index.js"), o = n(/*! ./getToolForElement.js */ "./store/getToolForElement.js"), i = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("addTool"), r = function e(t, n, r) { var l = new n(r); if (Object(o.default)(t, l.name)) { i.warn("%s has already been added to the target element", l.name); return } l.element = t, a.default.state.tools.push(l) }, l = function e(t, n) { s(t, n), a.default.state.enabledElements.forEach(function (e) { r(e, t, n) }) }, s = function e(t, n) { if (Object(a.getModule)("globalConfiguration").configuration.globalToolSyncEnabled) { var o = new t(n); if (void 0 !== a.default.state.globalTools[o.name]) { i.warn("%s has already been added globally", o.name); return } a.default.state.globalTools[o.name] = { tool: t, props: n, activeBindings: [] } } } }, "./store/filterToolsUsableWithMultiPartTools.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../tools/base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), o = n(/*! ../tools/base/BaseBrushTool.js */ "./tools/base/BaseBrushTool.js"); t.default = function (e) { return e.filter(function (e) { return !e.isMultiPartTool && !(e instanceof a.default) && !(e instanceof o.default) }) } }, "./store/getActiveToolsForElement.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { return t.filter(function (t) { return t.element === e && "active" === t.mode && (void 0 === n || t.options["is".concat(n, "Active")]) }) } }, "./store/getInteractiveToolsForElement.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { return t.filter(function (t) { return t.element === e && ("active" === t.mode || "passive" === t.mode) }) } }, "./store/getToolForElement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./index.js */ "./store/index.js"); t.default = function (e, t) { return a.state.tools.find(function (n) { return n.element === e && n.name === t }) } }, "./store/getToolsWithDataForElement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../stateManagement/toolState.js */ "./stateManagement/toolState.js"); t.default = function (e, t) { return t.filter(function (t) { var n = Object(a.getToolState)(e, t.name); return n && n.data.length > 0 }) } }, "./store/getToolsWithMoveableHandles.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), o = n(/*! ../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), i = n(/*! ../util/getProximityThreshold.js */ "./util/getProximityThreshold.js"); t.default = function (e, t, n) { var r = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse"; return t.filter(function (t) { for (var l = Object(i.default)(r, t.name), s = Object(a.getToolState)(e, t.name), u = 0; u < s.data.length; u++)if (void 0 !== Object(o.default)(e, s.data[u].handles, n, l)) return !0; return !1 }) } }, "./store/index.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "state", function () { return s }), n.d(t, "getters", function () { return u }), n.d(t, "modules", function () { return d }), n.d(t, "getModule", function () { return c }); var a = n(/*! ./modules/segmentationModule */ "./store/modules/segmentationModule/index.js"), o = n(/*! ./modules/manipulatorStateModule */ "./store/modules/manipulatorStateModule.js"), i = n(/*! ./modules/cursorModule.js */ "./store/modules/cursorModule.js"), r = n(/*! ./modules/globalConfigurationModule.js */ "./store/modules/globalConfigurationModule.js"), l = n(/*! ../externalModules.js */ "./externalModules.js"); Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("store:modules:storeLogger"); var s = { globalTools: {}, globalToolChangeHistory: [], enabledElements: [], tools: [], isToolLocked: !1, activeMultiPartTool: null, mousePositionImage: {}, clickProximity: 6, touchProximity: 10, handleRadius: 6, deleteIfHandleOutsideImage: !0, preventHandleOutsideImage: !1, preventTextBoxOutsideDisplayedArea: !1, handleTouchOffset: { x: 0, y: -57 }, svgCursorUrl: null }, u = { mouseTools: function e() { return s.tools.filter(function (e) { return e.supportedInteractionTypes.includes("Mouse") }) }, touchTools: function e() { return s.tools.filter(function (e) { return e.supportedInteractionTypes.includes("Touch") }) }, enabledElementByUID: function e(t) { return s.enabledElements.find(function (e) { return l.default.cornerstone.getEnabledElement(e).uuid === t }) } }, d = { segmentation: a.default, cursor: i.default, globalConfiguration: r.default, manipulatorState: o.default }; function c(e) { return d[e] } t.default = { modules: d, state: s, getters: u } }, "./store/internals/addEnabledElement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../eventListeners/index.js */ "./eventListeners/index.js"), o = n(/*! ../../eventDispatchers/index.js */ "./eventDispatchers/index.js"), i = n(/*! ./../addTool.js */ "./store/addTool.js"), r = n(/*! ./../setToolMode.js */ "./store/setToolMode.js"), l = n(/*! ../index.js */ "./store/index.js"), s = Object(n(/*! ../../util/logger.js */ "./util/logger.js").getLogger)("internals:addEnabledElement"); t.default = function (e) { s.log("EVENT:ELEMENT_ENABLED"); var t = e.detail.element; o.imageRenderedEventDispatcher.enable(t), o.newImageEventDispatcher.enable(t); var n = Object(l.getModule)("globalConfiguration").configuration; n.mouseEnabled && (a.mouseEventListeners.enable(t), a.wheelEventListener.enable(t), o.mouseToolEventDispatcher.enable(t)), n.touchEnabled && (a.touchEventListeners.enable(t), o.touchToolEventDispatcher.enable(t)), u(t) }; var u = function e(t) { var n, a, o; l.default.state.enabledElements.push(t), l.default.modules && (n = t, a = l.default.modules, Object.keys(a).forEach(function (e) { "function" == typeof a[e].enabledElementCallback && a[e].enabledElementCallback(n) })), o = t, Object(l.getModule)("globalConfiguration").configuration.globalToolSyncEnabled && Object.keys(l.default.state.globalTools).forEach(function (e) { var t = l.default.state.globalTools[e], n = t.tool, a = t.props; Object(i.addToolForElement)(o, n, a) }), function e(t) { if (Object(l.getModule)("globalConfiguration").configuration.globalToolSyncEnabled) { var n = { active: r.setToolActiveForElement, passive: r.setToolPassiveForElement, enabled: r.setToolEnabledForElement, disabled: r.setToolDisabledForElement }; l.default.state.globalToolChangeHistory.forEach(function (e) { var a = e.args.slice(0); a.unshift(t), n[e.mode].apply(null, a) }) } }(t) } }, "./store/internals/removeEnabledElement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../eventListeners/index.js */ "./eventListeners/index.js"), o = n(/*! ../../eventDispatchers/index.js */ "./eventDispatchers/index.js"), i = n(/*! ../index.js */ "./store/index.js"), r = n(/*! ../../util/logger.js */ "./util/logger.js"), l = n(/*! ../../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), s = n(/*! ../setToolMode */ "./store/setToolMode.js"), u = Object(r.getLogger)("internals:removeEnabledElement"); t.default = function (e) { u.log("EVENT:ELEMENT_DISABLED"); var t = e.detail.element, n = Object(i.getModule)("globalConfiguration").configuration; o.imageRenderedEventDispatcher.disable(t), o.newImageEventDispatcher.disable(t), n.mouseEnabled && (a.mouseEventListeners.disable(t), a.wheelEventListener.disable(t), o.mouseToolEventDispatcher.disable(t)), n.touchEnabled && (a.touchEventListeners.disable(t), o.touchToolEventDispatcher.disable(t)), d(t), c(t), f(t) }; var d = function e(t) { i.default.state.tools.forEach(function (e) { e.element === t && Object(s.setToolDisabledForElement)(e.element, e.name) }), i.default.state.tools = i.default.state.tools.filter(function (e) { return e.element !== t }) }, c = function e(t) { i.default.modules && (n = t, a = i.default.modules, Object.keys(a).forEach(function (e) { "function" == typeof a[e].removeEnabledElementCallback && a[e].removeEnabledElementCallback(n) })); var n, a, o = i.default.state.enabledElements.findIndex(function (e) { return e === t }); o > -1 ? i.default.state.enabledElements.splice(o, 1) : u.warn("unable to remove element") }, f = function e(t) { l.default.removeHandlers(t) } }, "./store/isToolActiveForElement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./getToolForElement.js */ "./store/getToolForElement.js"); t.default = function (e, t) { return "active" === Object(a.default)(e, t).mode } }, "./store/modules/cursorModule.js": function (e, t, n) { "use strict"; n.r(t), n(/*! ../../externalModules */ "./externalModules.js"); var a = { iconSize: 16, viewBox: { x: 16, y: 16 }, mousePoint: { x: 8, y: 8 }, mousePointerGroupString: '\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  ' }; t.default = { configuration: a, getters: { defaultOptions: function e() { return a } }, setters: { defaultOptions: function e(t) { Object.assign(a, t) } } } }, "./store/modules/globalConfigurationModule.js": function (e, t, n) { "use strict"; n.r(t), t.default = { configuration: { mouseEnabled: !0, touchEnabled: !0, globalToolSyncEnabled: !1, showSVGCursors: !1, autoResizeViewports: !0, lineDash: [4, 4] } } }, "./store/modules/manipulatorStateModule.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../externalModules */ "./externalModules.js"), o = { activeManipulators: {} }; function i(e) { var t = a.default.cornerstone.getEnabledElement(e).uuid; delete o.activeManipulators[t] } function r(e) { var t = o.activeManipulators, n = t[e]; "function" == typeof n && n(), delete t[e] } function l(e) { i(e.detail.element) } t.default = { setters: { addActiveManipulatorForElement: function e(t, n) { var i = a.default.cornerstone.getEnabledElement(t).uuid; o.activeManipulators[i] = n }, removeActiveManipulatorForElement: i, cancelActiveManipulatorsForElement: function e(t) { r(a.default.cornerstone.getEnabledElement(t).uuid) }, cancelActiveManipulators: function e() { Object.keys(o.activeManipulators).forEach(function (e) { return r(e) }) } }, state: o, enabledElementCallback: function e(t) { var n = a.default.cornerstone.EVENTS.NEW_IMAGE; t.removeEventListener(n, l), t.addEventListener(n, l) }, removeEnabledElementCallback: function e(t) { var n = a.default.cornerstone.EVENTS.NEW_IMAGE; t.removeEventListener(n, l), i(t) } } }, "./store/modules/segmentationModule/activeLabelmapIndex.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getActiveLabelmapIndex", function () { return s }), n.d(t, "setActiveLabelmapIndex", function () { return u }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./addLabelmap3D */ "./store/modules/segmentationModule/addLabelmap3D.js"), r = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), l = n(/*! ../../../externalModules */ "./externalModules.js"); function s(e) { var t = Object(a.default)(e); if (t) { var n = Object(o.getToolState)(t, "stack").data[0].imageIds[0], i = r.default.series[n]; if (i) return i.activeLabelmapIndex } } function u(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, n = Object(a.default)(e); if (n) { var s, u = l.default.cornerstone, d = Object(o.getToolState)(n, "stack").data[0], c = u.getEnabledElement(n).image, f = c.rows, g = f * c.columns * d.imageIds.length, m = d.imageIds[0], h = r.default.series[m]; h ? (h.activeLabelmapIndex = t, h.labelmaps3D[t] || Object(i.default)(h, t, g)) : (r.default.series[m] = { activeLabelmapIndex: t, labelmaps3D: [] }, h = r.default.series[m], Object(i.default)(h, t, g)), u.updateImage(n) } } }, "./store/modules/segmentationModule/activeSegmentIndex.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getActiveSegmentIndex", function () { return l }), n.d(t, "setActiveSegmentIndex", function () { return s }), n.d(t, "incrementActiveSegmentIndex", function () { return u }), n.d(t, "decrementActiveSegmentIndex", function () { return d }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = n(/*! ../../index.js */ "./store/index.js"); function l(e, t) { var n = Object(a.default)(e); if (n) { var r = Object(o.getToolState)(n, "stack").data[0].imageIds[0], l = i.default.series[r]; if (l) { t = void 0 === t ? l.activeLabelmapIndex : t; var s = l.labelmaps3D[t]; if (s) return s.activeSegmentIndex } return 1 } } function s(e, t) { var n = Object(a.default)(e); if (n) { var l = Object(o.getToolState)(n, "stack").data[0].imageIds[0], s = i.default.series[l]; if (s) { var u = s.activeLabelmapIndex, d = s.labelmaps3D[u], c = Object(r.getModule)("segmentation").configuration; t <= 0 ? t = 1 : t > c.segmentsPerLabelmap && (t = c.segmentsPerLabelmap), d.activeSegmentIndex = t } } } function u(e) { var t = Object(a.default)(e); t && c(t, "increase") } function d(e) { var t = Object(a.default)(e); t && c(t, "decrease") } function c(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "increase", n = Object(r.getModule)("segmentation").configuration, a = Object(o.getToolState)(e, "stack").data[0].imageIds[0], l = i.default.series[a]; if (l) { var s = l.activeLabelmapIndex, u = l.labelmaps3D[s]; switch (t) { case "increase": u.activeSegmentIndex++, u.activeSegmentIndex > n.segmentsPerLabelmap && (u.activeSegmentIndex = 1); break; case "decrease": u.activeSegmentIndex--, u.activeSegmentIndex <= 0 && (u.activeSegmentIndex = n.segmentsPerLabelmap) } } } }, "./store/modules/segmentationModule/addLabelmap2D.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js"), o = n(/*! ../../index.js */ "./store/index.js"), i = a.default.UINT_16_ARRAY, r = a.default.FLOAT_32_ARRAY; function l(e, t, n, a, l) { var s, u = Object(o.getModule)("segmentation").configuration, d = a * l, c = d * n; switch (u.arrayType) { case i: s = new Uint16Array(e.labelmaps3D[t].buffer, 2 * c, d); break; case r: s = new Float32Array(e.labelmaps3D[t].buffer, 4 * c, d); break; default: throw Error("Unsupported Array Type ".concat(u.arrayType)) }e.labelmaps3D[t].labelmaps2D[n] = { pixelData: s, segmentsOnLabelmap: [] } } }, "./store/modules/segmentationModule/addLabelmap3D.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js"), o = n(/*! ../../index.js */ "./store/index.js"), i = a.default.UINT_16_ARRAY, r = a.default.FLOAT_32_ARRAY; function l(e, t, n) { var a, l = Object(o.getModule)("segmentation").configuration; switch (l.arrayType) { case i: a = 2; break; case r: a = 4; break; default: throw Error("Unsupported Array Type ".concat(l.arrayType)) }e.labelmaps3D[t] = { buffer: new ArrayBuffer(n * a), labelmaps2D: [], metadata: [], activeSegmentIndex: 1, colorLUTIndex: 0, segmentsHidden: [], undo: [], redo: [] } } }, "./store/modules/segmentationModule/arrayTypes.js": function (e, t, n) { "use strict"; n.r(t), t.default = { UINT_16_ARRAY: 0, FLOAT_32_ARRAY: 1 } }, "./store/modules/segmentationModule/colorLUT.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return u }), n.d(t, "setColorLUTIndexForLabelmap3D", function () { return d }), n.d(t, "getColorForSegmentIndexColorLUT", function () { return c }), n.d(t, "setColorForSegmentIndexOfColorLUT", function () { return f }), n.d(t, "getColorLUT", function () { return g }); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ../../../util/logger */ "./util/logger.js"), r = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), l = n(/*! ../../index.js */ "./store/index.js"), s = Object(i.getLogger)("store:modules:segmentationModule:setColorLUT"); function u(e) { var t, n, a = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : [], i = Object(l.getModule)("segmentation").configuration.segmentsPerLabelmap; a ? (t = a, n = i, t.length < n ? s.warn("The provided colorLUT only provides ".concat(t.length, " labels, whereas segmentsPerLabelmap is set to ").concat(n, ". Autogenerating the rest.")) : t.length > n && s.warn("segmentsPerLabelmap is set to ".concat(n, ", and the provided colorLUT provides ").concat(t.length, ". Using the first ").concat(n, " colors from the LUT.")), a.length < i && (a = [].concat(o()(a), o()(m(i - a.length))))) : a = a || m(i), a.unshift([0, 0, 0, 0]), r.default.colorLutTables[e] = a } function d(e, t) { e.colorLUTIndex = t } function c(e, t) { return g(e)[t] } function f(e, t, n) { g(e)[t] = n } function g(e) { return "number" == typeof e ? r.default.colorLutTables[e] : r.default.colorLutTables[e.colorLUTIndex] } function m() { for (var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 255, t = [], n = 0; n < e; n++)t.push($(v(), x())); return t } var h = 222.5; function v() { return (h += 137.5) >= 360 && (h -= 360), h } var p = .6; function x() { return (p += .07) > .82 && (p = .3 + (p - .82)), p } function $(e) { var t, n, a, o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : .6, r = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 255, l = (1 - Math.abs(2 * i - 1)) * o, s = l * (1 - Math.abs(e / 60 % 2 - 1)), u = i - l / 2; return e < 60 ? (t = l, n = s, a = 0) : e < 120 ? (t = s, n = l, a = 0) : e < 180 ? (t = 0, n = l, a = s) : e < 240 ? (t = 0, n = s, a = l) : e < 300 ? (t = s, n = 0, a = l) : e < 360 && (t = l, n = 0, a = s), [(t + u) * 255, (n + u) * 255, (a + u) * 255, r] } }, "./store/modules/segmentationModule/defaultConfiguration.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js").default.UINT_16_ARRAY; t.default = { renderOutline: !0, renderFill: !0, shouldRenderInactiveLabelmaps: !0, radius: 10, minRadius: 1, maxRadius: 50, fillAlpha: .2, fillAlphaInactive: .1, outlineAlpha: .7, outlineAlphaInactive: .35, outlineWidth: 3, storeHistory: !0, segmentsPerLabelmap: 65535, arrayType: a } }, "./store/modules/segmentationModule/deleteSegment.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = n(/*! ../../../externalModules */ "./externalModules.js"); function l(e, t, n) { if (t) { var l = Object(a.default)(e); if (l) { var s = Object(o.getToolState)(l, "stack").data[0].imageIds[0], u = i.default.series[s]; if (u) { n = void 0 === n ? u.activeLabelmapIndex : n; var d = u.labelmaps3D[n]; if (d) { delete d.metadata[t]; for (var c = d.labelmaps2D, f = 0; f < c.length; f++) { var g = c[f]; if (g && g.segmentsOnLabelmap.includes(t)) { var m = g.pixelData, h = g.segmentsOnLabelmap.indexOf(t); g.segmentsOnLabelmap.splice(h, 1); for (var v = 0; v < m.length; v++)m[v] === t && (m[v] = 0) } } r.default.cornerstone.updateImage(l) } } } } } }, "./store/modules/segmentationModule/getBrushColor.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), o = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), i = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), r = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("store:modules:segmentationModule:getBrushColor"); function l(e) { var t, n = arguments.length > 1 && void 0 !== arguments[1] && arguments[1], l = Object(i.default)(e); if (l) { var s = Object(a.getToolState)(l, "stack"); if (!s) { r.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools."); return } var u = s.data[0].imageIds[0], d = o.default.series[u]; if (d) { var c = d.activeLabelmapIndex, f = d.labelmaps3D[c], g = f.activeSegmentIndex; t = o.default.colorLutTables[f.colorLUTIndex][g] } else t = o.default.colorLutTables[0][1]; return n ? "rgba(".concat(t[0], ", ").concat(t[1], ", ").concat(t[2], ", 1.0 )") : "rgba(".concat(t[0], ", ").concat(t[1], ", ").concat(t[2], ", 0.8 )") } } }, "./store/modules/segmentationModule/getElement.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../../index.js */ "./store/index.js"); function o(e) { return e instanceof HTMLElement ? e : a.getters.enabledElementByUID(e) } }, "./store/modules/segmentationModule/getLabelmap2D.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return v }), n.d(t, "getLabelmap2DByImageIdIndex", function () { return p }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./getSegmentsOnPixeldata */ "./store/modules/segmentationModule/getSegmentsOnPixeldata.js"), r = n(/*! ./addLabelmap3D */ "./store/modules/segmentationModule/addLabelmap3D.js"), l = n(/*! ./addLabelmap2D */ "./store/modules/segmentationModule/addLabelmap2D.js"), s = n(/*! ../../../externalModules */ "./externalModules.js"), u = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), d = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js"), c = n(/*! ../../index.js */ "./store/index.js"), f = n(/*! ../../../util/logger */ "./util/logger.js"), g = d.default.UINT_16_ARRAY, m = d.default.FLOAT_32_ARRAY, h = Object(f.getLogger)("store:modules:segmentationModule:getLabelmap2D"); function v(e) { var t, n = Object(a.default)(e); if (n) { var i = s.default.cornerstone, d = Object(o.getToolState)(n, "stack"); if (!d) { h.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools."); return } var c = d.data[0], f = i.getEnabledElement(n), g = c.currentImageIdIndex, m = f.image, v = m.rows, p = m.columns, x = c.imageIds.length, $ = c.imageIds[0], y = u.default.series[$]; y ? (t = y.activeLabelmapIndex, y.labelmaps3D[t] || Object(r.default)(y, t, v * p * x), y.labelmaps3D[t].labelmaps2D[g] || Object(l.default)(y, t, g, v, p)) : (t = 0, u.default.series[$] = { activeLabelmapIndex: t, labelmaps3D: [] }, y = u.default.series[$], Object(r.default)(y, t, v * p * x), Object(l.default)(y, t, g, v, p)); var T = y.labelmaps3D[t]; return { labelmap2D: T.labelmaps2D[g], labelmap3D: T, currentImageIdIndex: g, activeLabelmapIndex: t } } } function p(e, t, n, a) { if (!e.labelmaps2D[t]) { var o, r = Object(c.getModule)("segmentation").configuration, l = n * a, s = l * t; switch (r.arrayType) { case g: o = new Uint16Array(e.buffer, 2 * s, l); break; case m: o = new Float32Array(e.buffer, 4 * s, l); break; default: throw Error("Unsupported Array Type ".concat(r.arrayType)) }e.labelmaps2D[t] = { pixelData: o, segmentsOnLabelmap: Object(i.default)(o) } } return e.labelmaps2D[t] } }, "./store/modules/segmentationModule/getLabelmapBuffers.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getLabelmapBuffers", function () { return c }), n.d(t, "getActiveLabelmapBuffer", function () { return f }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./getLabelmaps3D */ "./store/modules/segmentationModule/getLabelmaps3D.js"), r = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), l = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js"), s = n(/*! ../../index.js */ "./store/index.js"), u = l.default.UINT_16_ARRAY, d = l.default.FLOAT_32_ARRAY; function c(e, t) { var n, o, l = Object(a.default)(e); if (l) { var c = Object(i.default)(l).labelmaps3D; if (!c) return []; var f = Object(s.getModule)("segmentation").configuration; switch (f.arrayType) { case u: n = "Uint16Array", o = "2"; break; case d: n = "Float32Array", o = "4"; break; default: throw Error("Unsupported Array Type ".concat(f.arrayType)) }var g = r.default.colorLutTables; if (void 0 !== t) { var m = c[t]; return m ? { labelmapIndex: t, bytesPerVoxel: o, type: n, buffer: m.buffer, colorLUT: g[m.colorLUTIndex] } : void 0 } for (var h = [], v = 0; v < c.length; v++) { var p = c[v]; p && h.push({ labelmapIndex: v, bytesPerVoxel: 2, buffer: p.buffer, colorLUT: g[p.colorLUTIndex] }) } return h } } function f(e) { var t = Object(a.default)(e); if (t) { var n = Object(o.getToolState)(t, "stack").data[0].imageIds[0], i = r.default.series[n]; if (i) return c(t, i.activeLabelmapIndex) } } }, "./store/modules/segmentationModule/getLabelmapStats.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return s }), n.d(t, "_calculateLabelmapStats", function () { return u }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = n(/*! ../../../externalModules */ "./externalModules.js"), l = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("store:modules:segmentationModule:getLabelmapStats"); function s(e, t, n) { var s = r.default.cornerstone, d = Object(a.default)(e); if (!d) return null; var c = Object(o.getToolState)(d, "stack").data[0].imageIds, f = c[0]; return new Promise(function (e) { var a = i.default.series[f]; a || e(null); var o = function e(t) { for (var n = [], a = r.default.cornerstone.metaData, o = !0, i = 0; i < t.length; i++) { var l = a.get("imagePlaneModule", t[i]); if (!l) { o = !1; break } n.push(l) } return { sufficientMetadata: o, imagePlanes: n } }(c), d = o.sufficientMetadata, g = o.imagePlanes; d || (l.warn("Insufficient imagePlaneModule information to calculate volume statistics."), e(null)), n = void 0 === n ? a.activeLabelmapIndex : n; for (var m = a.labelmaps3D[n], h = [], v = 0; v < c.length; v++)h.push(s.loadAndCacheImage(c[v])); Promise.all(h).then(function (n) { e(u(m, n, g, t)) }) }) } function u(e, t, n, a) { for (var o = function e(t, n, a, o) { for (var i = n[0], r = i.rowPixelSpacing, l = i.columnPixelSpacing, s = t.labelmaps2D, u = [], c = 0; c < s.length; c++) { var f = s[c]; if (f && f.segmentsOnLabelmap.includes(o)) { for (var g = d(n, a, c) * r * l, m = f.pixelData, h = n[c].getPixelData(), v = [], p = 0; p < m.length; p++)m[p] === o && v.push(h[p]); u.push({ voxelInMM3: g, values: v }) } } return u }(e, t, n, a), i = 0, r = o[0].values[0], l = r, s = 0, u = 0; u < o.length; u++) { var c = o[u], f = c.values, g = c.voxelInMM3; s += g * f.length; var m = 0; f.forEach(function (e) { e > r ? r = e : e < l && (l = e), m += e }), i += m * g } i /= s; for (var h = 0, v = 0; v < o.length; v++) { var p = o[v], f = p.values, g = p.voxelInMM3, x = 0; f.forEach(function (e) { x += Math.pow(e - i, 2) }), h += x * g } return h /= s, { volume: s, mean: i, stdDev: h = Math.sqrt(h), max: r, min: l } } function d(e, t, n) { var a = e.length, o = t[n].imagePositionPatient; if (0 === n) return c(o, t[n + 1].imagePositionPatient); if (n === a - 1) return c(o, t[n - 1].imagePositionPatient); var i = t[n - 1].imagePositionPatient, r = t[n + 1].imagePositionPatient; return (c(o, i) + c(o, r)) / 2 } function c(e, t) { return Math.sqrt(Math.pow(e[0] - t[0], 2) + Math.pow(e[1] - t[1], 2) + Math.pow(e[2] - t[2], 2)) } }, "./store/modules/segmentationModule/getLabelmaps3D.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }), n.d(t, "getLabelmap3D", function () { return s }); var a = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), o = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("store:modules:segmentationModule:getLabelmaps3D"); function l(e) { var t, n, l = Object(o.default)(e); if (l) { var s = Object(a.getToolState)(l, "stack"); if (!s) { r.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools."); return } var u = s.data[0], d = u.imageIds[0], c = i.default.series[d]; return c && (t = c.labelmaps3D, n = c.activeLabelmapIndex), { labelmaps3D: t, activeLabelmapIndex: n, currentImageIdIndex: u.currentImageIdIndex } } } function s(e, t) { var n = l(e), a = n.labelmaps3D, o = n.activeLabelmapIndex; return a[t = void 0 !== t ? t : o] } }, "./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), o = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), i = n(/*! ../../../util/isPointInImage */ "./util/isPointInImage.js"), r = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent"); function l(e) { var t = e.detail, n = t.element, l = t.image, s = t.currentPoints; if (!s) { r.warn("Not a cornerstone input event."); return } var u = l.width, d = l.height; if (n) { var c = Object(a.getToolState)(n, "stack").data[0], f = c.currentImageIdIndex, g = c.imageIds[0], m = o.default.series[g], h = m.activeLabelmapIndex, v = m.labelmaps3D[h]; if (v) { var p = v.labelmaps2D[f]; if (p) { var x = p.pixelData, $ = s.image, y = $.x, T = $.y; if (y = Math.floor(y), T = Math.floor(T), Object(i.default)({ x: y, y: T }, d, u)) { var b = x[T * u + y]; if (0 === b) return; return { segmentIndex: b, metadata: v.metadata[b] } } } } } } }, "./store/modules/segmentationModule/getSegmentsOnPixeldata.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a); function i(e) { return o()(new Set(e)) } }, "./store/modules/segmentationModule/history.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "pushState", function () { return l }), n.d(t, "undo", function () { return s }), n.d(t, "redo", function () { return u }); var a = n(/*! ./getLabelmaps3D */ "./store/modules/segmentationModule/getLabelmaps3D.js"), o = n(/*! ../../../util/logger */ "./util/logger.js"), i = n(/*! ../../../externalModules */ "./externalModules.js"), r = Object(o.getLogger)("util:segmentation:labelmap3DHistory"); function l(e, t, n) { var o = Object(a.getLabelmap3D)(e, n); o.undo.push(t), o.redo = [] } function s(e, t) { var n = Object(a.getLabelmap3D)(e, t), o = n.undo, l = n.redo; if (!o.length) { r.warn("No undos left."); return } var s = o.pop(); d(n, s, 1), l.push(s), i.default.cornerstone.updateImage(e) } function u(e, t) { var n = Object(a.getLabelmap3D)(e, t), o = n.undo, l = n.redo; if (!l.length) { r.warn("No redos left."); return } var s = l.pop(); d(n, s, 2), o.push(s), i.default.cornerstone.updateImage(e) } function d(e, t, n) { var a = e.labelmaps2D; t.forEach(function (e) { for (var t = e.imageIdIndex, o = e.diff, i = a[t].pixelData, r = 0; r < o.length; r++) { var l = o[r]; i[l[0]] = l[n] } }) } }, "./store/modules/segmentationModule/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./metadata */ "./store/modules/segmentationModule/metadata.js"), o = n(/*! ./activeLabelmapIndex */ "./store/modules/segmentationModule/activeLabelmapIndex.js"), i = n(/*! ./activeSegmentIndex */ "./store/modules/segmentationModule/activeSegmentIndex.js"), r = n(/*! ./segmentVisibility.js */ "./store/modules/segmentationModule/segmentVisibility.js"), l = n(/*! ./getLabelmapBuffers */ "./store/modules/segmentationModule/getLabelmapBuffers.js"), s = n(/*! ./setLabelmap3D.js */ "./store/modules/segmentationModule/setLabelmap3D.js"), u = n(/*! ./getLabelmapStats */ "./store/modules/segmentationModule/getLabelmapStats.js"), d = n(/*! ./getLabelmaps3D */ "./store/modules/segmentationModule/getLabelmaps3D.js"), c = n(/*! ./getLabelmap2D */ "./store/modules/segmentationModule/getLabelmap2D.js"), f = n(/*! ./getSegmentOfActiveLabelmapAtEvent */ "./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js"), g = n(/*! ./colorLUT */ "./store/modules/segmentationModule/colorLUT.js"), m = n(/*! ./getBrushColor */ "./store/modules/segmentationModule/getBrushColor.js"), h = n(/*! ./getSegmentsOnPixeldata */ "./store/modules/segmentationModule/getSegmentsOnPixeldata.js"), v = n(/*! ./deleteSegment */ "./store/modules/segmentationModule/deleteSegment.js"), p = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), x = n(/*! ./defaultConfiguration */ "./store/modules/segmentationModule/defaultConfiguration.js"), $ = n(/*! ./history */ "./store/modules/segmentationModule/history.js"), y = n(/*! ./setRadius */ "./store/modules/segmentationModule/setRadius.js"); t.default = { state: p.default, configuration: x.default, onRegisterCallback: function e() { Object(g.default)(0) }, getters: { metadata: a.getMetadata, labelmap3D: d.getLabelmap3D, labelmaps3D: d.default, activeLabelmapIndex: o.getActiveLabelmapIndex, activeSegmentIndex: i.getActiveSegmentIndex, isSegmentVisible: r.isSegmentVisible, labelmap2D: c.default, labelmap2DByImageIdIndex: c.getLabelmap2DByImageIdIndex, labelmapStats: u.default, segmentOfActiveLabelmapAtEvent: f.default, brushColor: m.default, labelmapBuffers: l.getLabelmapBuffers, activeLabelmapBuffer: l.getActiveLabelmapBuffer, colorLUT: g.getColorLUT, colorForSegmentIndexColorLUT: g.getColorForSegmentIndexColorLUT }, setters: { metadata: a.setMetadata, labelmap3DForElement: s.setLabelmap3DForElement, labelmap3DByFirstImageId: s.setLabelmap3DByFirstImageId, incrementActiveSegmentIndex: i.incrementActiveSegmentIndex, decrementActiveSegmentIndex: i.decrementActiveSegmentIndex, activeSegmentIndex: i.setActiveSegmentIndex, toggleSegmentVisibility: r.toggleSegmentVisibility, updateSegmentsOnLabelmap2D: function e(t) { t.segmentsOnLabelmap = Object(h.default)(t.pixelData) }, deleteSegment: v.default, colorLUT: g.default, colorLUTIndexForLabelmap3D: g.setColorLUTIndexForLabelmap3D, colorForSegmentIndexOfColorLUT: g.setColorForSegmentIndexOfColorLUT, activeLabelmapIndex: o.setActiveLabelmapIndex, radius: y.default, pushState: $.pushState, undo: $.undo, redo: $.redo } } }, "./store/modules/segmentationModule/metadata.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getMetadata", function () { return d }), n.d(t, "setMetadata", function () { return c }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ./addLabelmap3D */ "./store/modules/segmentationModule/addLabelmap3D.js"), i = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), r = n(/*! ../../../externalModules */ "./externalModules.js"), l = n(/*! ../../../util/logger */ "./util/logger.js"), s = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), u = Object(l.getLogger)("store:modules:segmentationModule:metadata"); function d(e, t, n) { var o = Object(a.default)(e); if (o) { var r = Object(i.getToolState)(o, "stack").data[0].imageIds[0], l = s.default.series[r]; if (!l) { u.warn("brushStackState is undefined"); return } if (t = void 0 === t ? l.activeLabelmapIndex : t, !l.labelmaps3D[t]) { u.warn("No labelmap3D of labelmap index ".concat(t, " on stack.")); return } var d = l.labelmaps3D[t]; return void 0 === n ? d.metadata : d.metadata[n] } } function c(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, n = arguments.length > 2 ? arguments[2] : void 0, l = arguments.length > 3 ? arguments[3] : void 0, u = Object(a.default)(e); if (u) { var d = r.default.cornerstone, c = Object(i.getToolState)(u, "stack").data[0], f = c.imageIds[0], g = s.default.series[f]; if (g || (s.default.series[f] = { labelmapIndex: t, labelmaps3D: [] }, g = s.default.series[f]), !g.labelmaps3D[t]) { var m = d.getEnabledElement(u).image, h = m.rows, v = m.columns, p = c.imageIds.length; Object(o.default)(g, t, h * v * p) } g.labelmaps3D[t].metadata[n] = l } } }, "./store/modules/segmentationModule/segmentVisibility.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "isSegmentVisible", function () { return l }), n.d(t, "toggleSegmentVisibility", function () { return s }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("store:modules:segmentationModule:segmentVisibility"); function l(e, t, n) { if (t) { var l = Object(a.default)(e); if (l) { var s = Object(o.getToolState)(l, "stack").data[0].imageIds[0], u = i.default.series[s]; if (!u) { r.warn("brushStackState is undefined"); return } if (n = void 0 === n ? u.activeLabelmapIndex : n, !u.labelmaps3D[n]) { r.warn("No labelmap3D of labelmap index ".concat(n, " on stack.")); return } return !u.labelmaps3D[n].segmentsHidden[t] } } } function s(e, t, n) { if (t) { var l = Object(a.default)(e); if (l) { var s = Object(o.getToolState)(l, "stack").data[0].imageIds[0], u = i.default.series[s]; if (!u) { r.warn("brushStackState is undefined"); return } if (n = void 0 === n ? u.activeLabelmapIndex : n, !u.labelmaps3D[n]) { r.warn("No labelmap3D of labelmap index ".concat(n, " on stack.")); return } var d = u.labelmaps3D[n].segmentsHidden; return d[t] = !d[t], !d[t] } } } }, "./store/modules/segmentationModule/setLabelmap3D.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "setLabelmap3DByFirstImageId", function () { return g }), n.d(t, "setLabelmap3DForElement", function () { return f }); var a = n(/*! ./getElement */ "./store/modules/segmentationModule/getElement.js"), o = n(/*! ../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./state */ "./store/modules/segmentationModule/state.js"), r = n(/*! ./getSegmentsOnPixeldata */ "./store/modules/segmentationModule/getSegmentsOnPixeldata.js"), l = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), s = n(/*! ./arrayTypes */ "./store/modules/segmentationModule/arrayTypes.js"), u = n(/*! ../../index.js */ "./store/index.js"), d = s.default.UINT_16_ARRAY, c = s.default.FLOAT_32_ARRAY; function f(e, t, n) { var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : [], r = arguments.length > 4 ? arguments[4] : void 0, s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0, u = Object(a.default)(e); if (u) { var d = Object(o.getToolState)(u, "stack"), c = d.data[0].imageIds.length; g(d.data[0].imageIds[0], t, n, i, c, r, s), Object(l.triggerLabelmapModifiedEvent)(u, n) } } function g(e, t, n) { var a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : [], o = arguments.length > 4 ? arguments[4] : void 0, l = arguments.length > 5 ? arguments[5] : void 0, s = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : 0, f = Object(u.getModule)("segmentation").configuration, g = i.default.series[e]; g || (i.default.series[e] = { activeLabelmapIndex: n, labelmaps3D: [] }, g = i.default.series[e]), g.labelmaps3D[n] = { buffer: t, labelmaps2D: [], metadata: a, activeSegmentIndex: 1, colorLUTIndex: s, segmentsHidden: [], undo: [], redo: [] }; for (var m = g.labelmaps3D[n].labelmaps2D, h = t.byteLength / o, v = 0; v < o; v++) { var p = void 0; switch (f.arrayType) { case d: p = new Uint16Array(t, h * v, h / 2); break; case c: p = new Float32Array(t, h * v, h / 4); break; default: throw Error("Unsupported Array Type ".concat(f.arrayType)) }var x = l ? l[v] : Object(r.default)(p); x && x.some(function (e) { return e }) && (m[v] = { pixelData: p, segmentsOnLabelmap: x }) } } }, "./store/modules/segmentationModule/setRadius.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../../index */ "./store/index.js"); function o(e) { var t = Object(a.getModule)("segmentation").configuration; t.radius = Math.min(Math.max(e, t.minRadius), t.maxRadius) } }, "./store/modules/segmentationModule/state.js": function (e, t, n) { "use strict"; n.r(t), t.default = { series: {}, colorLutTables: [] } }, "./store/removeTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "removeTool", function () { return i }), n.d(t, "removeToolForElement", function () { return o }); var a = n(/*! ./index.js */ "./store/index.js"), o = function e(t, n) { var o = a.default.state.tools.findIndex(function (e) { return e.element === t && e.name === n }); o >= 0 && a.default.state.tools.splice(o, 1) }, i = function e(t) { r(t), a.default.state.enabledElements.forEach(function (e) { o(e, t) }) }, r = function e(t) { Object(a.getModule)("globalConfiguration").configuration.globalToolSyncEnabled && a.default.state.globalTools[t] && delete a.default.state.globalTools[t] } }, "./store/setToolCursor.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "setToolCursor", function () { return i }), n.d(t, "resetToolCursor", function () { return r }), n.d(t, "hideToolCursor", function () { return l }); var a = n(/*! ./index.js */ "./store/index.js"), o = a.modules.globalConfiguration; function i(e, t) { if (o.configuration.showSVGCursors) { var n = t.getIconWithPointerSVG(), i = t.mousePoint, r = window.URL.createObjectURL(n); e.style.cursor = "url('".concat(r, "') ").concat(i, ", auto"), a.state.svgCursorUrl = r } } function r(e) { s(e, "initial") } function l(e) { o.configuration.showSVGCursors && s(e, "none") } function s(e, t) { a.state.svgCursorUrl && window.URL.revokeObjectURL(a.state.svgCursorUrl), a.state.svgCursorUrl = null, e.style.cursor = t } }, "./store/setToolMode.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "setToolActive", function () { return f }), n.d(t, "setToolActiveForElement", function () { return c }), n.d(t, "setToolDisabled", function () { return m }), n.d(t, "setToolDisabledForElement", function () { return g }), n.d(t, "setToolEnabled", function () { return v }), n.d(t, "setToolEnabledForElement", function () { return h }), n.d(t, "setToolPassive", function () { return x }), n.d(t, "setToolPassiveForElement", function () { return p }), n.d(t, "setToolMode", function () { return y }), n.d(t, "setToolModeForElement", function () { return $ }), n.d(t, "_getNormalizedOptions", function () { return C }), n.d(t, "_mergeMouseButtonMask", function () { return j }); var a = n(/*! ./../events.js */ "./events.js"), o = n(/*! ./../util/triggerEvent.js */ "./util/triggerEvent.js"), i = n(/*! ./getToolForElement.js */ "./store/getToolForElement.js"), r = n(/*! ./setToolCursor.js */ "./store/setToolCursor.js"), l = n(/*! ../util/logger.js */ "./util/logger.js"), s = n(/*! ./index.js */ "./store/index.js"), u = Object(s.getModule)("globalConfiguration"), d = Object(l.getLogger)("store:setToolMode"), c = function e(t, n, a, o) { void 0 === o && Array.isArray(a) && (o = a, a = null); var l, c, f, g, m, h, v, x, y = Object(i.default)(t, n); y && (l = t, c = y, f = a, g = o, c.supportedInteractionTypes.forEach(function (e) { if (void 0 === g || g.includes(e)) { var t = _[e]; t ? t(c, l, f) : d.warn("Unable to resolve input conflicts for type %s", e) } }), s.default.state.tools.filter(function (e) { return e.element === l && "active" === e.mode && e.supportedInteractionTypes.length > 0 }).forEach(function (e) { var t = !1; e.supportedInteractionTypes.forEach(function (n) { e.options["is".concat(n, "Active")] && (t = !0) }), t || (d.log("Setting tool %s's to PASSIVE", e.name), p(l, e.name)) }), y.supportedInteractionTypes.forEach(function (e) { void 0 === o || o.includes(e) ? a["is".concat(e, "Active")] = !0 : a["is".concat(e, "Active")] = !1 }), u.configuration.showSVGCursors && y.supportedInteractionTypes.includes("Mouse") && (m = t, h = a, v = y, (x = "number" == typeof h ? [h] : h.mouseButtonMask).includes(1) && (v.svgCursor ? Object(r.setToolCursor)(v.element, v.svgCursor) : v.hideDefaultCursor ? Object(r.hideToolCursor)(m) : Object(r.resetToolCursor)(m)))), $("active", null, t, n, a) }, f = function e(t, n, a) { b("active", t, n, a), s.default.state.enabledElements.forEach(function (e) { c(e, t, n, a) }) }, g = $.bind(null, "disabled", null), m = y.bind(null, "disabled", null), h = $.bind(null, "enabled", null), v = y.bind(null, "enabled", null), p = $.bind(null, "passive", a.default.TOOL_DEACTIVATED), x = y.bind(null, "passive", a.default.TOOL_DEACTIVATED); function $(e, t, n, a, r) { var l = Object(i.default)(n, a); if (!l) { d.warn('Unable to find tool "%s" for enabledElement', a); return } if (Array.isArray((r = C(r)).mouseButtonMask) && 0 !== r.mouseButtonMask.length && Array.isArray(l.options.mouseButtonMask) && (r.mouseButtonMask = j(r.mouseButtonMask, l.options.mouseButtonMask)), l.mode = e, l.mergeOptions(r), l["".concat(e, "Callback")] && l["".concat(e, "Callback")](n, r), t) { var s = { options: r, toolName: a, toolType: a, type: t }; Object(o.default)(n, t, s) } } function y(e, t, n, a) { b(e, n, a), s.default.state.enabledElements.forEach(function (o) { $(e, t, o, n, a) }) } function T(e, t, n) { var a = "is".concat(e, "Active"), o = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options[a] }); o && (d.log("Setting tool %s's %s to false", o.name, a), o.options[a] = !1) } function b(e, t, n, a) { if (u.configuration.globalToolSyncEnabled) { var o = { mode: e, args: [t, n] }; a && o.push(a), s.default.state.globalToolChangeHistory.push(o), s.default.state.globalToolChangeHistory.length > 50 && s.default.state.globalToolChangeHistory.shift(); var i = s.default.state.globalTools[t]; if (!i) { d.warn("setToolMode call for tool not available globally: ".concat(t)); return } if ("active" === e) { var r = function e(t, n, a) { void 0 === a && Array.isArray(n) && (a = n, n = null); var o = [], i = s.default.state.globalTools[t]; if (i) { var r = new i.tool(i.props); r.supportedInteractionTypes.forEach(function (e) { if (void 0 === a || a.includes(e)) { if ("Mouse" === e) { var t = C(n).mouseButtonMask; Array.isArray(t) && t.length > 0 ? t.forEach(function (t) { return o.push("".concat(e, "-").concat(t)) }) : Array.isArray(t) && 0 === t.length && o.push("".concat(e, "-DELETE")) } else "MultiTouch" === e ? o.push("".concat(e, "-").concat(r.configuration.touchPointers)) : o.push(e) } }) } return o }(t, n, a); Object.keys(s.default.state.globalTools).forEach(function (e) { var t = s.default.state.globalTools[e]; t.activeBindings = t.activeBindings.filter(function (e) { return !r.includes(e) }) }), r.some(function (e) { return e.includes("Mouse-DELETE") }) && (i.activeBindings = i.activeBindings.filter(function (e) { return !e.includes("Mouse") }), r = r.filter(function (e) { return !e.includes("Mouse") })), i.activeBindings = i.activeBindings.concat(r) } else i.activeBindings = [] } } var _ = { Mouse: function e(t, n, a) { var o = C(a).mouseButtonMask; if (Array.isArray(o) && o.length > 0) { var i = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options.isMouseActive && Array.isArray(e.options.mouseButtonMask) && e.options.mouseButtonMask.some(function (e) { return o.includes(e) }) }); i && (i.options.mouseButtonMask = i.options.mouseButtonMask.filter(function (e) { return !o.includes(e) }), 0 === i.options.mouseButtonMask.length && (i.options.isMouseActive = !1)) } }, MouseWheel: T.bind(void 0, "MouseWheel"), Touch: function e(t, n) { var a = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options.isTouchActive }), o = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options.isMultiTouchActive && 1 === e.configuration.touchPointers }); a && (d.log("Setting tool %s's isTouchActive to false", a.name), a.options.isTouchActive = !1), o && (d.log("Setting tool %s's isTouchActive to false", o.name), o.options.isMultiTouchActive = !1) }, TouchPinch: T.bind(void 0, "TouchPinch"), TouchRotate: T.bind(void 0, "TouchRotate"), DoubleTap: T.bind(void 0, "DoubleTap"), MultiTouch: function e(t, n) { var a, o = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options.isMultiTouchActive && e.configuration.touchPointers === t.configuration.touchPointers }); 1 === t.configuration.touchPointers && (a = s.default.state.tools.find(function (e) { return e.element === n && "active" === e.mode && !0 === e.options.isTouchActive })), o && (d.log("Setting tool %s's isMultiTouchActive to false", o.name), o.options.isMultiTouchActive = !1), a && (d.log("Setting tool %s's isTouchActive to false", a.name), a.options.isTouchActive = !1) } }; function C(e) { return Array.isArray(e) ? e = { mouseButtonMask: e } : e !== Object(e) && (e = { mouseButtonMask: [e] }), e.hasOwnProperty("mouseButtonMask") || (e.mouseButtonMask = []), Array.isArray(e.mouseButtonMask) || (e.mouseButtonMask = [e.mouseButtonMask]), e.mouseButtonMask = e.mouseButtonMask.filter(function (e) { return "number" == typeof e && 0 !== e }), e } function j(e, t) { return e.concat(t).reduce(function (e, t) { return -1 === e.indexOf(t) && e.push(t), e }, []) } }, "./store/setToolOptions.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "setToolOptions", function () { return r }), n.d(t, "setToolOptionsForElement", function () { return i }); var a = n(/*! ./getToolForElement.js */ "./store/getToolForElement.js"), o = n(/*! ./index.js */ "./store/index.js"), i = function e(t, n, o) { var i = Object(a.default)(t, n); i && i.mergeOptions(o) }, r = function e(t, n) { o.state.enabledElements.forEach(function (e) { i(e, t, n) }) } }, "./synchronization/Synchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"), i = n(/*! ../toolOptions.js */ "./toolOptions.js"); function r(e) { return e.filter(function (e, t, n) { return n.indexOf(e) === t }) } t.default = function e(t, n) { a.default.cornerstone; var l = this, s = [], u = [], d = !1, c = {}, f = n; function g(e) { var t = e.detail.element; l.remove(t), Object(i.clearToolOptionsByElement)(t) } this.enabled = !0, this.setHandler = function (e) { f = e }, this.getHandler = function () { return f }, this.getDistances = function () { if (s.length && u.length) { var e = a.default.cornerstone; c.distances = {}, c.imageIds = { sourceElements: [], targetElements: [] }, s.forEach(function (t) { var n = e.getEnabledElement(t); if (n && n.image) { var a = n.image.imageId, i = e.metaData.get("imagePlaneModule", a); if (i && i.imagePositionPatient) { var r = Object(o.default)(i.imagePositionPatient); !c.hasOwnProperty(n) && (c.distances[a] = {}, c.imageIds.sourceElements.push(a), u.forEach(function (n) { var i = e.getEnabledElement(n); if (i && i.image) { var l = i.image.imageId; if (c.imageIds.targetElements.push(l), !(t === n || a === l || c.distances[a].hasOwnProperty(l))) { var s = e.metaData.get("imagePlaneModule", l); if (s && s.imagePositionPatient) { var u = Object(o.default)(s.imagePositionPatient); c.distances[a][l] = u.clone().sub(r) } } } }), Object.keys(c.distances[a]).length || delete c.distances[a]) } } }) } }, this.fireEvent = function (e, t) { var n = !l.enabled, a = !s.length || !u.length; !n && !a && (d = !0, u.forEach(function (n) { var a, o = u.indexOf(n); if (-1 !== o) { var i = c.imageIds.targetElements[o], r = s.indexOf(e); if (-1 !== r) { var d = c.imageIds.sourceElements[r]; d === i ? a = 0 : void 0 !== c.distances[d] && (a = c.distances[d][i]), f(l, e, n, t, a) } } }), d = !1) }, this.onEvent = function (e) { var t = e.detail; !0 !== d && l.fireEvent(e.currentTarget, t) }, this.addSource = function (e) { -1 === s.indexOf(e) && (s.push(e), t.split(" ").forEach(function (t) { e.addEventListener(t, l.onEvent) }), l.getDistances(), l.updateDisableHandlers()) }, this.addTarget = function (e) { -1 === u.indexOf(e) && (u.push(e), l.getDistances(), f(l, e, e, 0), l.updateDisableHandlers()) }, this.add = function (e) { l.addSource(e), l.addTarget(e) }, this.removeSource = function (e) { var n = s.indexOf(e); -1 !== n && (s.splice(n, 1), t.split(" ").forEach(function (t) { e.removeEventListener(t, l.onEvent) }), l.getDistances(), l.fireEvent(e), l.updateDisableHandlers()) }, this.removeTarget = function (e) { var t = u.indexOf(e); -1 !== t && (u.splice(t, 1), l.getDistances(), f(l, e, e, 0), l.updateDisableHandlers()) }, this.remove = function (e) { l.removeTarget(e), l.removeSource(e) }, this.getSourceElements = function () { return s }, this.getTargetElements = function () { return u }, this.displayImage = function (e, t, n) { d = !0, a.default.cornerstone.displayImage(e, t, n), d = !1 }, this.setViewport = function (e, t) { d = !0, a.default.cornerstone.setViewport(e, t), d = !1 }, this.updateDisableHandlers = function () { r(s.concat(u)).forEach(function (e) { e.removeEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED, g), e.addEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED, g) }) }, this.destroy = function () { r(s.concat(u)).forEach(function (e) { l.remove(e) }) } } }, "./synchronization/panZoomSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n) { if (n !== t) { var o = a.default.cornerstone, i = o.getViewport(t), r = o.getViewport(n); (r.scale !== i.scale || r.translation.x !== i.translation.x || r.translation.y !== i.translation.y) && (r.scale = i.scale, r.translation.x = i.translation.x, r.translation.y = i.translation.y, e.setViewport(n, r)) } } }, "./synchronization/stackImageIndexSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../util/clip.js */ "./util/clip.js"); t.default = function (e, t, n) { if (n !== t) { var l, s = a.default.cornerstone, u = Object(o.getToolState)(t, "stack").data[0], d = Object(o.getToolState)(n, "stack").data[0], c = u.currentImageIdIndex; if ((c = Object(r.default)(c, 0, d.imageIds.length - 1)) !== d.currentImageIdIndex) { var f = i.default.getStartLoadHandler(n), g = i.default.getEndLoadHandler(n), m = i.default.getErrorLoadingHandler(n); f && f(n), (l = !0 === d.preventCache ? s.loadImage(d.imageIds[c]) : s.loadAndCacheImage(d.imageIds[c])).then(function (t) { var a = s.getViewport(n); d.currentImageIdIndex = c, e.displayImage(n, t, a), g && g(n, t) }, function (e) { var t = d.imageIds[c]; m && m(n, t, e) }) } } } }, "./synchronization/stackImagePositionOffsetSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"); t.default = function (e, t, n, l, s) { if (n !== t) { var u, d = a.default.cornerstone, c = Object(o.getToolState)(t, "stack").data[0], f = c.imageIds[c.currentImageIdIndex], g = d.metaData.get("imagePlaneModule", f); if (void 0 !== g && void 0 !== g.imagePositionPatient) { var m = Object(r.default)(g.imagePositionPatient), h = Object(o.getToolState)(n, "stack").data[0], v = Number.MAX_VALUE, p = -1; if (s) { var x = m.clone().add(s); if (h.imageIds.forEach(function (e, t) { var n = d.metaData.get("imagePlaneModule", e); if (void 0 !== n && void 0 !== n.imagePositionPatient) { var a = Object(r.default)(n.imagePositionPatient), o = x.distanceToSquared(a); o < v && (v = o, p = t) } }), p !== h.currentImageIdIndex && -1 !== p) { var $ = i.default.getStartLoadHandler(n), y = i.default.getEndLoadHandler(n), T = i.default.getErrorLoadingHandler(n); h.currentImageIdIndex = p; var b = h.imageIds[p]; $ && $(n), (u = !0 === h.preventCache ? d.loadImage(b) : d.loadAndCacheImage(b)).then(function (t) { var a = d.getViewport(n); h.currentImageIdIndex === p && (e.displayImage(n, t, a), y && y(n, t)) }, function (e) { var t = h.imageIds[p]; T && T(n, t, e) }) } } } } } }, "./synchronization/stackImagePositionSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"); t.default = function (e, t, n) { if (n !== t) { var l, s = a.default.cornerstone, u = Object(o.getToolState)(t, "stack").data[0], d = u.imageIds[u.currentImageIdIndex], c = s.metaData.get("imagePlaneModule", d); if (void 0 !== c && void 0 !== c.imagePositionPatient) { var f = Object(r.default)(c.imagePositionPatient), g = Object(o.getToolState)(n, "stack").data[0], m = Number.MAX_VALUE, h = -1; if (g.imageIds.forEach(function (e, t) { var n = s.metaData.get("imagePlaneModule", e); if (void 0 !== n && void 0 !== n.imagePositionPatient) { var a = Object(r.default)(n.imagePositionPatient).distanceToSquared(f); a < m && (m = a, h = t) } }), h !== g.currentImageIdIndex) { var v = i.default.getStartLoadHandler(n), p = i.default.getEndLoadHandler(n), x = i.default.getErrorLoadingHandler(n); g.currentImageIdIndex = h; var $ = g.imageIds[h]; v && v(n), -1 !== h && (l = !0 === g.preventCache ? s.loadImage($) : s.loadAndCacheImage($)).then(function (t) { var a = s.getViewport(n); g.currentImageIdIndex === h && (e.displayImage(n, t, a), p && p(n, t)) }, function (e) { var t = g.imageIds[h]; x && x(n, t, e) }) } } } } }, "./synchronization/stackScrollSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), r = n(/*! ../util/clip.js */ "./util/clip.js"); t.default = function (e, t, n, l) { if (t !== n && l && l.direction) { var s, u = a.default.cornerstone, d = Object(o.getToolState)(n, "stack").data[0], c = d.currentImageIdIndex + l.direction; if (c = Object(r.default)(c, 0, d.imageIds.length - 1), d.currentImageIdIndex !== c) { var f = i.default.getStartLoadHandler(n), g = i.default.getEndLoadHandler(n), m = i.default.getErrorLoadingHandler(n); d.currentImageIdIndex = c; var h = d.imageIds[c]; f && f(n), (s = !0 === d.preventCache ? u.loadImage(h) : u.loadAndCacheImage(h)).then(function (t) { var a = u.getViewport(n); d.currentImageIdIndex === c && (e.displayImage(n, t, a), g && g(n, t)) }, function (e) { var t = d.imageIds[c]; m && m(n, t, e) }) } } } }, "./synchronization/updateImageSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n) { n !== t && a.default.cornerstone.updateImage(n) } }, "./synchronization/wwwcSynchronizer.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n) { if (n !== t) { var o = a.default.cornerstone, i = o.getViewport(t), r = o.getViewport(n); (r.voi.windowWidth !== i.voi.windowWidth || r.voi.windowCenter !== i.voi.windowCenter || r.invert !== i.invert) && (r.voi.windowWidth = i.voi.windowWidth, r.voi.windowCenter = i.voi.windowCenter, r.invert = i.invert, e.setViewport(n, r)) } } }, "./thirdParty/register.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = n(/*! ./registerModule.js */ "./thirdParty/registerModule.js"), r = n(/*! ./registerMixin.js */ "./thirdParty/registerMixin.js"), l = n(/*! ./registerItem.js */ "./thirdParty/registerItem.js"), s = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("thirdParty:register"); t.default = function (e, t, n) { var a, u, d, c = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]; if (a = e, u = t, d = n, a ? u ? "object" === o()(d) || "function" == typeof d || (s.warn("The %s is a %s, it should be an Object or a function.", d, o()(d)), !1) : (s.warn("The %s must have a name in order to register.", a), !1) : (s.warn("The type must be given in order to register."), !1)) switch (e) { case "module": Object(i.default)(t, n, c); break; case "mixin": Object(r.default)(t, n, c); break; default: Object(l.default)(e, t, n, c) } } }, "./thirdParty/registerItem.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../lib.js */ "./lib.js"), o = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("thirdParty:registerType"); t.default = function (e, t, n) { var i, r = arguments.length > 3 && void 0 !== arguments[3] && arguments[3], l = "".concat(e, "/").concat(t), s = (i = l, void 0 !== a.lib[i]); if (s && !r) { o.warn("%s is already registered", l); return } s && o.warn("Overwriting %s", l), a.lib[l] = n } }, "./thirdParty/registerMixin.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../lib.js */ "./lib.js"), o = n(/*! ../mixins/index.js */ "./mixins/index.js"), i = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("thirdParty:registerMixin"); t.default = function (e, t) { var n, r = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], l = (n = e, void 0 !== o.default[n]); if (l && !r) { i.warn("mixins/%s is already registered", e); return } l && i.warn("Overwriting mixins/%s", e), o.default[e] = t, a.lib["mixins/".concat(e)] = o.default[e] } }, "./thirdParty/registerModule.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../store/index.js */ "./store/index.js"), o = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("thirdParty:registerModule"); t.default = function (e, t) { var n, i = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], r = (n = e, void 0 !== a.modules[n]); if (r && !i) { o.warn("A module with the name %s is already registered", e); return } r && o.warn("Overwriting module %s", e), a.modules[e] = t, "function" == typeof a.modules[e].onRegisterCallback && a.modules[e].onRegisterCallback() } }, "./thirdParty/registerSome.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./register.js */ "./thirdParty/register.js"); t.default = function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; e.forEach(function (e) { var n = e.type, o = e.name, i = e.item; Object(a.default)(n, o, i, t) }) } }, "./toolOptions.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getToolOptions", function () { return o }), n.d(t, "setToolOptions", function () { return i }), n.d(t, "clearToolOptions", function () { return r }), n.d(t, "clearToolOptionsByToolType", function () { return l }), n.d(t, "clearToolOptionsByToolName", function () { return s }), n.d(t, "clearToolOptionsByElement", function () { return u }); var a = {}; function o(e, t) { if (!a[e]) return {}; var n = a[e].find(function (e) { return e.element === t }); return n ? n.options : {} } function i(e, t, n) { if (!a[e]) { a[e] = [{ element: t, options: n }]; return } var o = a[e].findIndex(function (e) { return e.element === t }); if (-1 === o) a[e].push({ element: t, options: n }); else { var i = a[e][o].options || {}; a[e][o].options = Object.assign(i, n) } } function r(e, t) { var n = a[e]; n && (a[e] = n.filter(function (e) { return e.element !== t })) } function l(e) { return s(e) } function s(e) { delete a[e] } function u(e) { for (var t in a) a[t] = a[t].filter(function (t) { return t.element !== e }) } }, "./tools/CrosshairsTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return _ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), v = n(/*! ./../externalModules.js */ "./externalModules.js"), p = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), x = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), $ = n(/*! ../util/pointProjector.js */ "./util/pointProjector.js"), y = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"), T = n(/*! ../toolOptions.js */ "./toolOptions.js"), b = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), _ = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Crosshairs", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: b.crosshairsCursor }; return (e = s()(this, d()(t).call(this, n, a))).preMouseDownCallback = e._chooseLocation.bind(f()(e)), e.mouseDragCallback = e._chooseLocation.bind(f()(e)), e.touchDragCallback = e._chooseLocation.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_chooseLocation", value: function e(t) { var n = t.detail, a = n.element; t.stopImmediatePropagation(); var o = Object(x.getToolState)(a, this.name); if (o) { var i = a, r = v.default.cornerstone.getEnabledElement(i).image.imageId, l = v.default.cornerstone.metaData.get("imagePlaneModule", r); if (l) { var s = n.currentPoints.image, u = Object($.imagePointToPatientPoint)(s, l); o.data[0].synchronizationContext.getSourceElements().forEach(function (e) { if (e !== i) { var t = Number.MAX_VALUE, n = -1, a = Object(x.getToolState)(e, "stack"); if (void 0 !== a) { var o = a.data[0]; if (o.imageIds.forEach(function (e, a) { var o = v.default.cornerstone.metaData.get("imagePlaneModule", e); if (o && o.imagePositionPatient && o.rowCosines && o.columnCosines) { var i = Object(y.default)(o.imagePositionPatient), r = Object(y.default)(o.rowCosines), l = Object(y.default)(o.columnCosines).clone().cross(r.clone()), s = Math.abs(l.clone().dot(i) - l.clone().dot(u)); s < t && (t = s, n = a) } }), n !== o.currentImageIdIndex && -1 !== n && void 0 !== o.imageIds[n]) { var r, l = p.default.getStartLoadHandler(e), s = p.default.getEndLoadHandler(e), d = p.default.getErrorLoadingHandler(e); l && l(e), (r = !0 === o.preventCache ? v.default.cornerstone.loadImage(o.imageIds[n]) : v.default.cornerstone.loadAndCacheImage(o.imageIds[n])).then(function (t) { var a = v.default.cornerstone.getViewport(e); o.currentImageIdIndex = n, v.default.cornerstone.displayImage(e, t, a), s && s(e, t) }, function (t) { var a = o.imageIds[n]; d && d(e, a, t) }) } } } }) } } } }, { key: "activeCallback", value: function e(t, n) { var a = n.mouseButtonMask, o = n.synchronizationContext; Object(T.setToolOptions)(this.name, t, { mouseButtonMask: a }), Object(x.clearToolState)(t, this.name), Object(x.addToolState)(t, this.name, { synchronizationContext: o }) } }]), t }(h.default) }, "./tools/DoubleTapFitToWindowTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return m }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "DoubleTapFitToWindow", supportedInteractionTypes: ["DoubleTap"] })) } return f()(t, e), r()(t, [{ key: "doubleTapCallback", value: function e(t) { var n = t.detail; g.default.cornerstone.fitToWindow(n.element) } }]), t }(n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js").default) }, "./tools/DragProbeTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return C }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../externalModules.js */ "./externalModules.js"), v = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), p = n(/*! ../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"), x = n(/*! ../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), $ = n(/*! ../util/getRGBPixels.js */ "./util/getRGBPixels.js"), y = n(/*! ../util/calculateSUV.js */ "./util/calculateSUV.js"), T = n(/*! ../drawing/index.js */ "./drawing/index.js"), b = n(/*! ../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), _ = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), C = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "DragProbe", strategies: { default: j, minimal: S }, defaultStrategy: "default", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: _.probeCursor }; return (e = s()(this, d()(t).call(this, n, a))).touchDragCallback = e._movingEventCallback.bind(f()(e)), e.touchEndCallback = e._endMovingEventCallback.bind(f()(e)), e.mouseDragCallback = e._movingEventCallback.bind(f()(e)), e.mouseUpCallback = e._endMovingEventCallback.bind(f()(e)), e.dragEventData = {}, e } return m()(t, e), r()(t, [{ key: "_movingEventCallback", value: function e(t) { var n = t.detail, a = n.element; this.dragEventData = n, h.default.cornerstone.updateImage(a) } }, { key: "_endMovingEventCallback", value: function e(t) { var n = t.detail.element; this.dragEventData = {}, h.default.cornerstone.updateImage(n) } }, { key: "renderToolData", value: function e(t) { this.dragEventData.currentPoints && t && t.detail && Boolean(Object.keys(this.dragEventData.currentPoints).length) && (t.detail.currentPoints = this.dragEventData.currentPoints, this.applyActiveStrategy(t)) } }]), t }(v.default); function j(e) { var t = this.configuration, n = h.default.cornerstone, a = e.detail, o = a.element, i = a.image, r = a.currentPoints, l = a.canvasContext, s = Object(T.getNewContext)(l.canvas), u = x.default.getActiveColor(), d = p.default.getFontSize(), c = Math.round(r.image.x), f = Math.round(r.image.y); !(c < 0) && !(f < 0) && !(c >= i.columns) && !(f >= i.rows) && Object(T.draw)(s, function (e) { Object(T.setShadow)(e, t); var a, l, s = "".concat(c, ", ").concat(f); if (i.color) a = Object($.default)(o, c, f, 1, 1), l = "R: ".concat(a[0], " G: ").concat(a[1], " B: ").concat(a[2], " A: ").concat(a[3]); else { var g = (a = n.getStoredPixels(o, c, f, 1, 1))[0], m = g * i.slope + i.intercept, h = Object(y.default)(i, g); l = "SP: ".concat(g, " MO: ").concat(parseFloat(m.toFixed(3))), h && (l += " SUV: ".concat(parseFloat(h.toFixed(3)))) } var v = { x: r.canvas.x + 5, y: r.canvas.y - 5 }; Object(b.default)(e, l, v.x, v.y + d + 5, u), Object(b.default)(e, s, v.x, v.y, u) }) } function S(e) { var t = this.configuration, n = h.default.cornerstone, a = e.detail, o = a.element, i = a.image, r = a.currentPoints, l = a.canvasContext, s = a.isTouchEvent, u = Object(T.getNewContext)(l.canvas), d = x.default.getActiveColor(), c = r.page.y - p.default.getFontSize() / 2; s && (c = r.page.y - 4 * p.default.getFontSize()); var f = n.pageToPixel(o, r.page.x, c); !(f.x < 0) && !(f.y < 0) && !(f.x >= i.columns) && !(f.y >= i.rows) && Object(T.draw)(u, function (e) { Object(T.setShadow)(e, t); var a, r = n.metaData.get("generalSeriesModule", i.imageId), l = r && r.modality, u = ""; if (i.color) a = Object($.default)(o, f.x, f.y, 1, 1), u = "R: ".concat(a[0], " G: ").concat(a[1], " B: ").concat(a[2]); else { var c = (a = n.getStoredPixels(o, f.x, f.y, 1, 1))[0], g = parseFloat((c * i.slope + i.intercept).toFixed(2)); if ("CT" === l) u += "HU: ".concat(g); else if ("PT" === l) { u += g; var m = Object(y.default)(i, c); m && (u += " SUV: ".concat(parseFloat(m.toFixed(2)))) } else u += g } var h = n.pixelToCanvas(o, f), v = { x: 12, y: -(p.default.getFontSize() + 10) / 2 }, x = Object(b.textBoxWidth)(e, u, 5); s && (v = { x: -x / 2, y: -p.default.getFontSize() - 10 - 12 }), Object(T.drawCircle)(e, o, h, 6, { color: d }, "canvas"), Object(b.default)(e, u, h.x + v.x, h.y + v.y, d) }) } }, "./tools/EraserTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return y }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../externalModules.js */ "./externalModules.js"), v = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), p = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), x = n(/*! ../store/index.js */ "./store/index.js"), $ = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), y = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Eraser", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: $.eraserCursor }; return (e = s()(this, d()(t).call(this, n, a))).preMouseDownCallback = e._deleteAllNearbyTools.bind(f()(e)), e.preTouchStartCallback = e._deleteAllNearbyTools.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_deleteAllNearbyTools", value: function e(t) { var n = t.detail.currentPoints.canvas, a = t.detail.element; return x.state.tools.forEach(function (e) { var t = Object(p.getToolState)(a, e.name); t && t.data.forEach(function (t) { "function" == typeof e.pointNearTool && e.pointNearTool(a, t, n) && (Object(p.removeToolState)(a, e.name, t), h.default.cornerstone.updateImage(a)) }) }), !0 } }]), t }(v.default) }, "./tools/FreehandRoiSculptorTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return M }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../events.js */ "./events.js"), v = n(/*! ../externalModules.js */ "./externalModules.js"), p = n(/*! ../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ../drawing/drawHandles.js */ "./drawing/drawHandles.js"), $ = n(/*! ../store/index.js */ "./store/index.js"), y = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), T = n(/*! ../util/clip.js */ "./util/clip.js"), b = n(/*! ../store/getToolForElement.js */ "./store/getToolForElement.js"), _ = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), C = n(/*! ../store/setToolCursor.js */ "./store/setToolCursor.js"), j = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), S = n(/*! ../util/freehand/index.js */ "./util/freehand/index.js"), w = S.default.FreehandHandleData, M = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "FreehandRoiSculptor", referencedToolName: "FreehandRoi", supportedInteractionTypes: ["Mouse", "Touch", "DoubleTap"], mixins: ["activeOrDisabledBinaryTool"], configuration: { mouseLocation: { handles: { start: { highlight: !0, active: !0 } } }, minSpacing: 1, currentTool: null, dragColor: p.default.getActiveColor(), hoverColor: p.default.getToolColor(), showCursorOnHover: !0, limitRadiusOutsideRegion: !0, hoverCursorFadeAlpha: .5, hoverCursorFadeDistance: 1.2 }, svgCursor: j.freehandRoiSculptorCursor }; return (e = s()(this, d()(t).call(this, n, a))).updateOnMouseMove = !0, e.isMultiPartTool = !0, e.referencedToolName = e.initialConfiguration.referencedToolName, e._active = !1, e.activeMouseUpCallback = e.activeMouseUpCallback.bind(f()(e)), e.activeTouchEndCallback = e.activeTouchEndCallback.bind(f()(e)), e.activeMouseDragCallback = e.activeMouseDragCallback.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "renderToolData", value: function e(t) { var n = t.detail; if (null === this.configuration.currentTool) return !1; var a = n.element, o = this.configuration; if (!Object(y.getToolState)(a, this.referencedToolName).data[o.currentTool]) return !1; if (this._active) { var i = n.canvasContext.canvas.getContext("2d"), r = { color: this.configuration.dragColor, fill: null, handleRadius: this._toolSizeCanvas }; Object(x.default)(i, n, this.configuration.mouseLocation.handles, r) } else this.configuration.showCursorOnHover && !this._recentTouchEnd && this._renderHoverCursor(t) } }, { key: "doubleClickCallback", value: function e(t) { var n = t.detail; this._selectFreehandTool(n), v.default.cornerstone.updateImage(n.element) } }, { key: "doubleTapCallback", value: function e(t) { var n = t.detail; this._selectFreehandTool(n), v.default.cornerstone.updateImage(n.element) } }, { key: "preTouchStartCallback", value: function e(t) { return this._initialiseSculpting(t), !0 } }, { key: "preMouseDownCallback", value: function e(t) { if (this.options.mouseButtonMask.includes(t.detail.buttons)) return this._initialiseSculpting(t), !0 } }, { key: "activeMouseDragCallback", value: function e(t) { var n = this.configuration; if (this._active) { var a = t.detail, o = Object(y.getToolState)(a.element, this.referencedToolName); if (o) { var i = o.data[n.currentTool].handles.points; this._getMouseLocation(a), this._sculpt(a, i), v.default.cornerstone.updateImage(a.element) } } } }, { key: "activeMouseUpCallback", value: function e(t) { this._activeEnd(t) } }, { key: "activeTouchEndCallback", value: function e(t) { this._activeEnd(t), this._deselectAllTools(t), this._recentTouchEnd = !0 } }, { key: "_activeEnd", value: function e(t) { var n, a = t.detail, o = a.element, i = this.configuration; this._active = !1, $.state.isMultiPartToolActive = !1, this._getMouseLocation(a), this._invalidateToolData(a), i.mouseUpRender = !0, this._deactivateSculpt(o), v.default.cornerstone.updateImage(a.element), (n = t).stopImmediatePropagation(), n.stopPropagation(), n.preventDefault() } }, { key: "_renderHoverCursor", value: function e(t) { var n, a = t.detail, o = a.element, i = a.canvasContext.canvas.getContext("2d"), r = Object(y.getToolState)(o, this.referencedToolName).data[this.configuration.currentTool]; this._recentTouchEnd = !1, this.configuration.mouseUpRender ? (n = this.configuration.mouseLocation.handles.start, this.configuration.mouseUpRender = !1) : n = $.state.mousePositionImage; var l = Object(b.default)(o, this.referencedToolName).distanceFromPointCanvas(o, r, n); if (this.configuration.mouseLocation.handles.start.x = n.x, this.configuration.mouseLocation.handles.start.y = n.y, this.configuration.limitRadiusOutsideRegion) { var s = l; l = this._limitCursorRadiusCanvas(a, l), s > this.configuration.hoverCursorFadeDistance * l && (i.globalAlpha = this.configuration.hoverCursorFadeAlpha) } var u = { fill: null, color: this.configuration.hoverColor, handleRadius: l }; Object(x.default)(i, a, this.configuration.mouseLocation.handles, u), this.configuration.limitRadiusOutsideRegion && (i.globalAlpha = 1) } }, { key: "newImageCallback", value: function e(t) { this._deselectAllTools(t) } }, { key: "enabledCallback", value: function e(t) { this._deselectAllTools(t) } }, { key: "passiveCallback", value: function e(t) { this._deselectAllTools(t) } }, { key: "disabledCallback", value: function e(t) { this._deselectAllTools(t) } }, { key: "_selectFreehandTool", value: function e(t) { var n = this.configuration, a = t.element, o = this._getClosestFreehandToolOnElement(a, t); void 0 !== o && (n.currentTool = o, Object(C.hideToolCursor)(a)) } }, { key: "_activateFreehandTool", value: function e(t, n) { var a = Object(y.getToolState)(t, this.referencedToolName).data; this.configuration.currentTool = n; for (var o = 0; o < a.length; o++)o === n ? a[o].active = !0 : a[o].active = !1 } }, { key: "_initialiseSculpting", value: function e(t) { var n = t.detail, a = this.configuration, o = n.element; (null !== a.currentTool || (this._selectFreehandTool(n), null !== a.currentTool)) && (this._active = !0, $.state.isMultiPartToolActive = !0, this._configureToolSize(n), this._getMouseLocation(n), this._activateFreehandTool(o, a.currentTool), this._activateSculpt(o), v.default.cornerstone.updateImage(n.element)) } }, { key: "_sculpt", value: function e(t, n) { var a = this.configuration; this._sculptData = { element: t.element, image: t.image, mousePoint: t.currentPoints.image, points: n, toolSize: this._toolSizeImage, minSpacing: a.minSpacing, maxSpacing: Math.max(this._toolSizeImage, 2 * a.minSpacing) }; var o = this._pushHandles(); void 0 !== o.first && (this._insertNewHandles(o), this._consolidateHandles()) } }, { key: "_pushHandles", value: function e() { for (var t = this._sculptData, n = t.points, a = t.mousePoint, o = t.toolSize, i = {}, r = 0; r < n.length; r++) { var l = v.default.cornerstoneMath.point.distance(n[r], a); !(l > o) && (this._pushOneHandle(r, l), void 0 === i.first && (i.first = r), i.last = r) } return i } }, { key: "_pushOneHandle", value: function e(t, n) { var a = this._sculptData, o = a.points, i = a.mousePoint, r = a.toolSize, l = a.image, s = o[t], u = { x: (s.x - i.x) / n, y: (s.y - i.y) / n }, d = { x: i.x + r * u.x, y: i.y + r * u.y }; Object(T.clipToBox)(d, l), s.x = d.x, s.y = d.y; var c = this.constructor._getPreviousHandleIndex(t, o.length); o[c].lines.pop(), o[c].lines.push(s) } }, { key: "_insertNewHandles", value: function e(t) { for (var n = this._findNewHandleIndicies(t), a = 0, o = 0; o < n.length; o++) { var i = n[o] + 1 + a; this._insertHandleRadially(i), a++ } } }, { key: "_findNewHandleIndicies", value: function e(t) { for (var n = this._sculptData, a = n.points, o = n.maxSpacing, i = [], r = t.first; r <= t.last; r++)this._checkSpacing(r, a, i, o); var l = this.constructor._getNextHandleIndex(t.last, a.length); if (l !== t.first) { this._checkSpacing(l, a, i, o); var s = this.constructor._getPreviousHandleIndex(t.first, a.length); s !== l && this._checkSpacing(s, a, i, o) } return i } }, { key: "_checkSpacing", value: function e(t, n, a, o) { var i = this.constructor._getNextHandleIndex(t, n.length); v.default.cornerstoneMath.point.distance(n[t], n[i]) > o && a.push(t) } }, { key: "_insertHandleRadially", value: function e(t) { var n = this._sculptData.points, a = t - 1, o = this.constructor._getNextHandleIndexBeforeInsert(t, n.length), i = this._getInsertPosition(t, a, o), r = new w(i); n.splice(t, 0, r), n[a].lines.pop(), n[a].lines.push(n[t]), S.default.addLine(n, t) } }, { key: "_consolidateHandles", value: function e() { if (!(this._sculptData.points.length <= 3)) { var t = this._findCloseHandlePairs(); this._mergeCloseHandles(t) } } }, { key: "_findCloseHandlePairs", value: function e() { for (var t = this._sculptData, n = t.points, a = t.minSpacing, o = [], i = n.length, r = 0; r < i; r++) { var l = this.constructor._getNextHandleIndex(r, n.length); if (v.default.cornerstoneMath.point.distance(n[r], n[l]) < a) { var s = [r, l]; o.push(s), 0 === r && (i -= 1), r++ } } return o } }, { key: "_mergeCloseHandles", value: function e(t) { for (var n = 0, a = 0; a < t.length; a++) { var o = this.constructor._getCorrectedPair(t[a], n); this._combineHandles(o), n++ } var i = this._findCloseHandlePairs(); i.length && this._mergeCloseHandles(i) } }, { key: "_combineHandles", value: function e(t) { var n = this._sculptData, a = n.points, o = n.image, i = { x: (a[t[0]].x + a[t[1]].x) / 2, y: (a[t[0]].y + a[t[1]].y) / 2 }; Object(T.clipToBox)(i, o), a[t[0]].x = i.x, a[t[0]].y = i.y; var r = this.constructor._getNextHandleIndex(t[1], a.length); a[t[0]].lines.pop(), a[t[0]].lines.push(a[r]), a.splice(t[1], 1) } }, { key: "_configureToolSize", value: function e(t) { var n = t.element, a = this.configuration, o = a.currentTool, i = t.currentPoints.image, r = Object(y.getToolState)(n, this.referencedToolName).data[o], l = Object(b.default)(n, this.referencedToolName), s = l.distanceFromPoint(n, r, i), u = l.distanceFromPointCanvas(n, r, i); a.limitRadiusOutsideRegion && (s = this._limitCursorRadiusImage(t, s), u = this._limitCursorRadiusCanvas(t, u)), this._toolSizeImage = s, this._toolSizeCanvas = u } }, { key: "_getMouseLocation", value: function e(t) { var n = this.configuration; n.mouseLocation.handles.start.x = t.currentPoints.image.x, n.mouseLocation.handles.start.y = t.currentPoints.image.y, Object(T.clipToBox)(n.mouseLocation.handles.start, t.image) } }, { key: "_activateSculpt", value: function e(t) { this._deactivateSculpt(t), t.addEventListener(h.default.MOUSE_UP, this.activeMouseUpCallback), t.addEventListener(h.default.MOUSE_CLICK, this.activeMouseUpCallback), t.addEventListener(h.default.MOUSE_DRAG, this.activeMouseDragCallback), t.addEventListener(h.default.TOUCH_END, this.activeTouchEndCallback), t.addEventListener(h.default.TOUCH_TAP, this.activeTouchEndCallback), t.addEventListener(h.default.TOUCH_DRAG, this.activeMouseDragCallback), v.default.cornerstone.updateImage(t) } }, { key: "_deactivateSculpt", value: function e(t) { t.removeEventListener(h.default.MOUSE_UP, this.activeMouseUpCallback), t.removeEventListener(h.default.MOUSE_CLICK, this.activeMouseUpCallback), t.removeEventListener(h.default.MOUSE_DRAG, this.activeMouseDragCallback), t.removeEventListener(h.default.TOUCH_END, this.activeTouchEndCallback), t.removeEventListener(h.default.TOUCH_TAP, this.activeTouchEndCallback), t.removeEventListener(h.default.TOUCH_DRAG, this.activeMouseDragCallback), v.default.cornerstone.updateImage(t) } }, { key: "_invalidateToolData", value: function e(t) { var n = this.configuration, a = t.element; Object(y.getToolState)(a, this.referencedToolName).data[n.currentTool].invalidated = !0 } }, { key: "_deselectAllTools", value: function e(t) { var n = this.configuration, a = Object(y.getToolState)(this.element, this.referencedToolName); if (n.currentTool = null, a) for (var o = 0; o < a.data.length; o++)a.data[o].active = !1; Object(C.setToolCursor)(this.element, this.svgCursor), v.default.cornerstone.updateImage(this.element) } }, { key: "_limitCursorRadiusCanvas", value: function e(t, n) { return this._limitCursorRadius(t, n, !0) } }, { key: "_limitCursorRadiusImage", value: function e(t, n) { return this._limitCursorRadius(t, n, !1) } }, { key: "_limitCursorRadius", value: function e(t, n) { var a, o = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], i = t.element, r = t.image, l = this.configuration, s = Object(y.getToolState)(i, this.referencedToolName).data[l.currentTool], u = 1; if (o) { var d = v.default.cornerstone.pixelToCanvas(i, { x: 0, y: 0 }), c = v.default.cornerstone.pixelToCanvas(i, { x: r.width, y: r.height }); u = (c.x - d.x) * (c.y - d.y) / (r.width * r.height) } return Math.min(n, Math.pow(s.area * u / Math.PI, .5)) } }, { key: "_getClosestFreehandToolOnElement", value: function e(t, n) { var a = Object(b.default)(t, this.referencedToolName), o = Object(y.getToolState)(t, this.referencedToolName); if (o) { for (var i = o.data, r = n.currentPoints.image, l = { distance: 1 / 0, toolIndex: null }, s = 0; s < i.length; s++) { var u = a.distanceFromPoint(t, i[s], r); -1 !== u && u < l.distance && (l.distance = u, l.toolIndex = s) } return l.toolIndex } } }, { key: "_getInsertPosition", value: function e(t, n, a) { var o, i = this._sculptData, r = i.points, l = i.toolSize, s = i.mousePoint, u = i.image, d = { x: (r[n].x + r[a].x) / 2, y: (r[n].y + r[a].y) / 2 }, c = v.default.cornerstoneMath.point.distance(s, d); if (c < l) { var f = { x: (d.x - s.x) / c, y: (d.y - s.y) / c }; o = { x: s.x + l * f.x, y: s.y + l * f.y } } else o = d; return Object(T.clipToBox)(o, u), o } }, { key: "minSpacing", get: function e() { return this.configuration.minSpacing }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehandSculpter minSpacing to a value other than a number."); this.configuration.minSpacing = t } }, { key: "maxSpacing", get: function e() { return this.configuration.maxSpacing }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehandSculpter maxSpacing to a value other than a number."); this.configuration.maxSpacing = t } }, { key: "showCursorOnHover", get: function e() { return this.configuration.showCursorOnHover }, set: function e(t) { if ("boolean" != typeof t) throw Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean."); this.configuration.showCursorOnHover = t, v.default.cornerstone.updateImage(this.element) } }, { key: "limitRadiusOutsideRegion", get: function e() { return this.configuration.limitRadiusOutsideRegion }, set: function e(t) { if ("boolean" != typeof t) throw Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean."); this.configuration.limitRadiusOutsideRegion = t, v.default.cornerstone.updateImage(this.element) } }, { key: "hoverCursorFadeAlpha", get: function e() { return this.configuration.hoverCursorFadeAlpha }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number."); t = Math.max(Math.min(t, 1), 0), this.configuration.hoverCursorFadeAlpha = t, v.default.cornerstone.updateImage(this.element) } }, { key: "hoverCursorFadeDistance", get: function e() { return this.configuration.hoverCursorFadeDistance }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number."); t = Math.max(t, 1), this.configuration.hoverCursorFadeDistance = t, v.default.cornerstone.updateImage(this.element) } }], [{ key: "_getCorrectedPair", value: function e(t, n) { var a = [t[0] - n, t[1] - n]; return a[1] < 0 && (a[1] = 0), a } }, { key: "_getNextHandleIndex", value: function e(t, n) { return t === n - 1 ? 0 : t + 1 } }, { key: "_getPreviousHandleIndex", value: function e(t, n) { return 0 === t ? n - 1 : t - 1 } }, { key: "_getNextHandleIndexBeforeInsert", value: function e(t, n) { return t === n ? 0 : t } }]), t }(_.default) }, "./tools/MagnifyTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return y }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../externalModules.js */ "./externalModules.js"), v = n(/*! ../drawing/index.js */ "./drawing/index.js"), p = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), x = n(/*! ../store/setToolCursor.js */ "./store/setToolCursor.js"), $ = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), y = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Magnify", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { magnifySize: 300, magnificationLevel: 2 }, svgCursor: $.magnifyCursor }; return (e = s()(this, d()(t).call(this, n, a))).zoomCanvas = void 0, e.zoomElement = void 0, e.activeCallback = e._createMagnificationCanvas.bind(f()(e)), e.enabledCallback = e._createMagnificationCanvas.bind(f()(e)), e.disabledCallback = e._destroyMagnificationCanvas.bind(f()(e)), e.postTouchStartCallback = e._addMagnifyingGlass.bind(f()(e)), e.touchDragCallback = e._updateMagnifyingGlass.bind(f()(e)), e.touchEndCallback = e._removeMagnifyingGlass.bind(f()(e)), e.touchDragEndCallback = e._removeMagnifyingGlass.bind(f()(e)), e.postMouseDownCallback = e._addMagnifyingGlass.bind(f()(e)), e.mouseDragCallback = e._updateMagnifyingGlass.bind(f()(e)), e.mouseUpCallback = e._removeMagnifyingGlass.bind(f()(e)), e.mouseClickCallback = e._removeMagnifyingGlass.bind(f()(e)), e.newImageCallback = e._drawMagnificationTool.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_addMagnifyingGlass", value: function e(t) { var n = this; this._removeZoomElement(), this._drawZoomedElement(t), window.requestAnimationFrame(function () { return n._drawMagnificationTool(t) }), Object(x.hideToolCursor)(t.detail.element), t.preventDefault(), t.stopPropagation() } }, { key: "_updateMagnifyingGlass", value: function e(t) { this._drawMagnificationTool(t), t.preventDefault(), t.stopPropagation() } }, { key: "_removeMagnifyingGlass", value: function e(t) { var n = t.detail.element; Object(x.setToolCursor)(this.element, this.svgCursor), n.querySelector(".magnifyTool").style.display = "none", this._removeZoomElement() } }, { key: "_drawMagnificationTool", value: function e(t) { var n = t.detail.element, a = n.querySelector(".magnifyTool"); if (a || this._createMagnificationCanvas(n), void 0 !== this.zoomCanvas) { var o = n.querySelector("canvas:not(.magnifyTool)"), i = Object(v.getNewContext)(a), r = h.default.cornerstone.pixelToCanvas(t.detail.element, t.detail.currentPoints.image), l = Math.min(this.configuration.magnifySize, o.width, o.height), s = this.configuration.magnificationLevel; a.width = l, a.height = l, r.x = Math.max(r.x, .5 * l / s), r.x = Math.min(r.x, o.width - .5 * l / s), r.y = Math.max(r.y, .5 * l / s), r.y = Math.min(r.y, o.height - .5 * l / s); var u = { x: r.x * s - .5 * l, y: r.y * s - .5 * l }; u.x = Math.max(u.x, 0), u.y = Math.max(u.y, 0), i.drawImage(this.zoomCanvas, u.x, u.y, l, l, 0, 0, l, l); var d = t.detail.isTouchEvent ? 120 : 0, c = { top: Math.max(r.y - .5 * l - d, 0), left: Math.max(r.x - .5 * l, 0) }, f = a.getBoundingClientRect(); c.top = Math.min(c.top, o.height - f.height), c.left = Math.min(c.left, o.width - f.width), a.style.top = "".concat(c.top, "px"), a.style.left = "".concat(c.left, "px"), a.style.display = "block" } } }, { key: "_drawZoomedElement", value: function e(t) { var n = t.detail.element, a = t.detail.enabledElement; void 0 === a && (a = h.default.cornerstone.getEnabledElement(n)); var o = this.configuration.magnificationLevel, i = a.canvas, r = a.image; this.zoomElement || (this.zoomElement = document.createElement("div"), this.zoomElement.width = i.width * o, this.zoomElement.height = i.height * o, h.default.cornerstone.enable(this.zoomElement, a.options)); var l = h.default.cornerstone.getEnabledElement(this.zoomElement), s = h.default.cornerstone.getViewport(a.element); this.zoomCanvas = l.canvas, this.zoomCanvas.width = i.width * o, this.zoomCanvas.height = i.height * o, l.viewport = Object.assign({}, s), s.scale *= o, h.default.cornerstone.displayImage(this.zoomElement, r), h.default.cornerstone.setViewport(this.zoomElement, s) } }, { key: "_removeZoomElement", value: function e() { void 0 !== this.zoomElement && (h.default.cornerstone.disable(this.zoomElement), this.zoomElement = void 0, this.zoomCanvas = void 0) } }, { key: "_createMagnificationCanvas", value: function e(t) { if (null === t.querySelector(".magnifyTool")) { var n = document.createElement("canvas"); n.classList.add("magnifyTool"), n.width = this.configuration.magnifySize, n.height = this.configuration.magnifySize, n.style.position = "absolute", n.style.display = "none", t.appendChild(n) } } }, { key: "_destroyMagnificationCanvas", value: function e(t) { var n = t.querySelector(".magnifyTool"); n && t.removeChild(n) } }]), t }(p.default) }, "./tools/OrientationMarkersTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return $ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../orientation/index.js */ "./orientation/index.js"), v = n(/*! ../drawing/index.js */ "./drawing/index.js"), p = n(/*! ../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), $ = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "OrientationMarkers", configuration: { drawAllMarkers: !0 }, mixins: ["enabledOrDisabledBinaryTool"] })) } return f()(t, e), r()(t, [{ key: "enabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "disabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "forceImageUpdate", value: function e(t) { var n = g.default.cornerstone; n.getEnabledElement(t).image && n.updateImage(t) } }, { key: "renderToolData", value: function e(t) { var n = t.detail, a = Object(v.getNewContext)(n.canvasContext.canvas), o = n.element, i = b(o); if (i) { var r = _(o, i), l = p.default.getToolColor(), s = { top: Object(x.textBoxWidth)(a, i.top, 0), left: Object(x.textBoxWidth)(a, i.left, 0), right: Object(x.textBoxWidth)(a, i.right, 0), bottom: Object(x.textBoxWidth)(a, i.bottom, 0), height: Object(x.textBoxWidth)(a, "M", 0) }; y(a, i, r, s, l), this.configuration.drawAllMarkers && T(a, i, r, s, l) } } }]), t }(m.default), y = function e(t, n, a, o, i) { Object(x.default)(t, n.top, a.top.x - o.top / 2, a.top.y, i), Object(x.default)(t, n.left, a.left.x - o.left / 2, a.left.y, i) }, T = function e(t, n, a, o, i) { Object(x.default)(t, n.right, a.right.x - o.right, a.right.y, i), Object(x.default)(t, n.bottom, a.bottom.x - o.bottom / 2, a.bottom.y - o.height, i) }, b = function e(t) { var n = g.default.cornerstone, a = n.getEnabledElement(t), o = n.metaData.get("imagePlaneModule", a.image.imageId); if (o && o.rowCosines && o.columnCosines) { var i = h.default.getOrientationString(o.rowCosines), r = h.default.getOrientationString(o.columnCosines), l = h.default.invertOrientationString(i); return { top: h.default.invertOrientationString(r), bottom: r, left: l, right: i } } }, _ = function e(t) { var n = g.default.cornerstone.getEnabledElement(t), a = g.default.cornerstone.pixelToCanvas(t, { x: n.image.width / 2, y: 5 }), o = g.default.cornerstone.pixelToCanvas(t, { x: n.image.width / 2, y: n.image.height - 15 }), i = g.default.cornerstone.pixelToCanvas(t, { x: 5, y: n.image.height / 2 }), r = g.default.cornerstone.pixelToCanvas(t, { x: n.image.width - 10, y: n.image.height / 2 }); return { top: a, bottom: o, left: i, right: r } } }, "./tools/OverlayTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return p }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../store/index */ "./store/index.js"), m = n(/*! ../externalModules.js */ "./externalModules.js"), h = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), v = g.modules.globalConfiguration, p = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = Object.assign({ name: "Overlay", configuration: {}, mixins: ["enabledOrDisabledBinaryTool"] }, n); return (e = s()(this, d()(t).call(this, a))).initialConfiguration = a, e } return f()(t, e), r()(t, [{ key: "enabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "disabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "forceImageUpdate", value: function e(t) { m.default.cornerstone.getEnabledElement(t).image && m.default.cornerstone.updateImage(t) } }, { key: "setupRender", value: function e(t) { if (t) { var n = m.default.cornerstone.metaData.get("overlayPlaneModule", t.imageId); if (n && n.overlays && n.overlays.length) return n } } }, { key: "setupViewport", value: function e(t) { if (void 0 === t.overlayColor && (t.overlayColor = v.configuration.overlayColor || "white"), !1 !== t.overlayColor) return !0 } }, { key: "renderToolData", value: function e(t) { var n = t.detail, a = n.enabledElement, o = n.image, i = n.viewport, r = n.canvasContext, l = this.setupRender(o); if (n && a && l && this.setupViewport(i)) { var s = o.columns, u = o.rows; l.overlays.forEach(function (e) { if (!1 !== e.visible) { var t = document.createElement("canvas"); t.width = s, t.height = u; var n = t.getContext("2d"); n.fillStyle = e.fillStyle || i.overlayColor, "R" === e.type && (n.fillRect(0, 0, t.width, t.height), n.globalCompositeOperation = "xor"); for (var a = 0, o = 0; o < e.rows; o++)for (var l = 0; l < e.columns; l++)e.pixelData[a++] > 0 && n.fillRect(l, o, 1, 1); var d = !isNaN(parseFloat(e.x)) && isFinite(e.x) ? e.x : 0, c = !isNaN(parseFloat(e.y)) && isFinite(e.y) ? e.y : 0; r.drawImage(t, d, c) } }) } } }]), t }(h.default) }, "./tools/PanMultiTouchTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return v }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../externalModules.js */ "./externalModules.js"), v = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), (e = s()(this, d()(t).call(this, n, { name: "PanMultiTouch", supportedInteractionTypes: ["MultiTouch"], configuration: { touchPointers: 2 } }))).multiTouchDragCallback = e._dragCallback.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_dragCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.viewport; if (n.numPointers === this.configuration.touchPointers) { var i = this._getTranslation(n); this._applyTranslation(o, i), h.default.cornerstone.setViewport(a, o) } } }, { key: "_getTranslation", value: function e(t) { var n = t.viewport, a = t.image, o = t.deltaPoints, i = n.scale, r = n.scale; return a.rowPixelSpacing < a.columnPixelSpacing ? i *= a.columnPixelSpacing / a.rowPixelSpacing : a.columnPixelSpacing < a.rowPixelSpacing && (r *= a.rowPixelSpacing / a.columnPixelSpacing), { x: o.page.x / i, y: o.page.y / r } } }, { key: "_applyTranslation", value: function e(t, n) { t.translation.x += n.x, t.translation.y += n.y } }]), t }(n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js").default) }, "./tools/PanTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return x }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./../externalModules.js */ "./externalModules.js"), v = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), p = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), x = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Pan", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: p.panCursor }; return (e = s()(this, d()(t).call(this, n, a))).touchDragCallback = e._dragCallback.bind(f()(e)), e.mouseDragCallback = e._dragCallback.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_dragCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.viewport, i = this._getTranslation(n); this._applyTranslation(o, i), h.default.cornerstone.setViewport(a, o) } }, { key: "_getTranslation", value: function e(t) { var n = t.viewport, a = t.image, o = t.deltaPoints, i = n.scale, r = n.scale; return a.rowPixelSpacing < a.columnPixelSpacing ? i *= a.columnPixelSpacing / a.rowPixelSpacing : a.columnPixelSpacing < a.rowPixelSpacing && (r *= a.rowPixelSpacing / a.columnPixelSpacing), { x: o.page.x / i, y: o.page.y / r } } }, { key: "_applyTranslation", value: function e(t, n) { t.translation.x += n.x, t.translation.y += n.y } }]), t }(v.default) }, "./tools/ReferenceLinesTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return _ }); var a = n(/*! @babel/runtime/regenerator */ "../node_modules/@babel/runtime/regenerator/index.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/asyncToGenerator */ "../node_modules/@babel/runtime/helpers/asyncToGenerator.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), m = n.n(g), h = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), v = n.n(h), p = n(/*! ./../externalModules.js */ "./externalModules.js"), x = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), $ = n(/*! ../drawing/index.js */ "./drawing/index.js"), y = n(/*! ./referenceLines/renderActiveReferenceLine.js */ "./tools/referenceLines/renderActiveReferenceLine.js"), T = n(/*! ../util/wait.js */ "./util/wait.js"), b = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("tools:ReferenceLinesTool"), _ = function (e) { var t; function n() { var e, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; s()(this, n); var a = { name: "ReferenceLines", mixins: ["enabledOrDisabledBinaryTool"], configuration: { renderer: y.default } }; return (e = f()(this, m()(n).call(this, t, a))).renderer = null, e.synchronizationContext = null, e } return v()(n, e), d()(n, [{ key: "enabledCallback", value: (t = r()(o.a.mark(function e(t) { var n, a, i, r, l = arguments; return o.a.wrap(function e(o) { for (; ;)switch (o.prev = o.next) { case 0: return a = (n = l.length > 1 && void 0 !== l[1] ? l[1] : {}).synchronizationContext, i = this.configuration.renderer, o.next = 4, Object(T.waitForEnabledElementImageToLoad)(t); case 4: if (!(!(r = o.sent) || !i || !a)) { o.next = 8; break } return b.warn("Unable to enable ".concat(this.name, ". Exiting enable callback. Tool will be enabled, but will not render.")), o.abrupt("return"); case 8: this.renderer = i, this.synchronizationContext = a, this.forceImageUpdate(t); case 11: case "end": return o.stop() } }, e, this) })), function e(n) { return t.apply(this, arguments) }) }, { key: "disabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "forceImageUpdate", value: function e(t) { p.default.cornerstone.getEnabledElement(t).image && p.default.cornerstone.updateImage(t) } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail; if (this.renderer && this.synchronizationContext) { var o = this.synchronizationContext.getSourceElements(), i = Object($.getNewContext)(a.canvasContext.canvas); p.default.cornerstone.setToPixelCoordinateSystem(a.enabledElement, i), o.forEach(function (e) { e !== t.currentTarget && n.renderer(i, a, t.currentTarget, e) }) } } }]), n }(x.default) }, "./tools/RotateTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return p }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../util/angleBetweenPoints.js */ "./util/angleBetweenPoints.js"), v = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), p = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "Rotate", strategies: { default: x, horizontal: $, vertical: y }, defaultStrategy: "default", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { roundAngles: !1, flipHorizontal: !1, flipVertical: !1, rotateScale: 1 }, svgCursor: v.rotateCursor }; return s()(this, d()(t).call(this, e, n)) } return f()(t, e), r()(t, [{ key: "touchDragCallback", value: function e(t) { this.dragCallback(t) } }, { key: "mouseDragCallback", value: function e(t) { this.dragCallback(t) } }, { key: "postMouseDownCallback", value: function e(t) { this.initialRotation = t.detail.viewport.rotation } }, { key: "dragCallback", value: function e(t) { t.detail.viewport.initialRotation = this.initialRotation, this.applyActiveStrategy(t), g.default.cornerstone.setViewport(t.detail.element, t.detail.viewport) } }]), t }(m.default); function x(e) { var t = this.configuration, n = t.roundAngles, a = t.rotateScale, o = e.detail, i = o.element, r = o.viewport, l = o.startPoints, s = o.currentPoints, u = r.initialRotation ? r.initialRotation : r.rotation, d = i.getBoundingClientRect(i), c = i.clientWidth, f = i.clientHeight, g = r.scale, m = r.translation, v = { x: d.left + c / 2 + m.x * g, y: d.top + f / 2 + m.y * g }, p = Object(h.default)(v, l.client, s.client); p.angle *= a, n && (p.angle = Math.ceil(p.angle)), p.direction < 0 && (p.angle = -p.angle), r.rotation = u + p.angle } function $(e) { var t = this.configuration, n = t.roundAngles, a = t.flipHorizontal, o = t.rotateScale, i = e.detail, r = i.viewport, l = i.startPoints, s = i.currentPoints, u = r.initialRotation, d = l.client.x, c = (s.client.x - d) * o; n && (c = Math.round(Math.abs(c)) * (c > 0 ? 1 : -1)), a && (c = -c), r.rotation = u + c } function y(e) { var t = this.configuration, n = t.roundAngles, a = t.flipVertical, o = t.rotateScale, i = e.detail, r = i.viewport, l = i.startPoints, s = i.currentPoints, u = r.initialRotation, d = l.client.y, c = (s.client.y - d) * o; n && (c = Math.round(Math.abs(c)) * (c > 0 ? 1 : -1)), a && (c = -c), r.rotation = u + c } }, "./tools/RotateTouchTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return m }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../externalModules.js */ "./externalModules.js"), m = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "RotateTouch", supportedInteractionTypes: ["TouchRotate"] })) } return f()(t, e), r()(t, [{ key: "touchRotateCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.viewport, i = n.rotation; o.rotation += i, g.default.cornerstone.setViewport(a, o) } }]), t }(n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js").default) }, "./tools/ScaleOverlayTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return $ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../drawing/index.js */ "./drawing/index.js"), v = n(/*! ../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = Object(n(/*! ../util/logger.js */ "./util/logger.js").getLogger)("tools:ScaleOverlayTool"), $ = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "ScaleOverlay", configuration: { minorTickLength: 12.5, majorTickLength: 25 }, mixins: ["enabledOrDisabledBinaryTool"] })) } return f()(t, e), r()(t, [{ key: "enabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "disabledCallback", value: function e(t) { this.forceImageUpdate(t) } }, { key: "forceImageUpdate", value: function e(t) { g.default.cornerstone.getEnabledElement(t).image && g.default.cornerstone.updateImage(t) } }, { key: "renderToolData", value: function e(t) { var n = t.detail, a = Object(h.getNewContext)(n.canvasContext.canvas), o = n.image, i = n.viewport, r = n.element, l = o.rowPixelSpacing, s = o.columnPixelSpacing, u = g.default.cornerstone.metaData.get("imagePlaneModule", o.imageId); if (u && (l = u.rowPixelSpacing || u.rowImagePixelSpacing, s = u.columnPixelSpacing || u.colImagePixelSpacing), !l || !s) { x.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name, "'s renderToolData")); return } var d = { width: a.canvas.width, height: a.canvas.height }, c = 10 / l * i.scale, f = 10 / s * i.scale, m = y(d, .25, .05), $ = y(d, .05, .15); if (d.width && d.height && m && $) { var _ = p.default.getToolColor(), C = v.default.getToolWidth(), j = Object.assign({}, { hscaleBounds: m, vscaleBounds: $, verticalMinorTick: c, horizontalMinorTick: f, verticalLine: { start: { x: $.bottomRight.x, y: $.topLeft.y }, end: { x: $.bottomRight.x, y: $.bottomRight.y } }, horizontalLine: { start: { x: m.topLeft.x, y: m.bottomRight.y }, end: { x: m.bottomRight.x, y: m.bottomRight.y } }, color: _, lineWidth: C }, this.configuration); Object(h.draw)(a, function (e) { Object(h.setShadow)(e, j), Object(h.drawLine)(e, r, j.verticalLine.start, j.verticalLine.end, { color: j.color, lineWidth: j.lineWidth }, "canvas"), T(e, r, j), Object(h.drawLine)(e, r, j.horizontalLine.start, j.horizontalLine.end, { color: j.color, lineWidth: j.lineWidth }, "canvas"), b(e, r, j) }) } } }]), t }(m.default), y = function e(t, n, a) { var o = n * Math.min(1e3, t.width), i = a * Math.min(1e3, t.height), r = { left: o, top: i, width: t.width - 2 * o, height: t.height - 2 * i }; return { topLeft: { x: r.left, y: r.top }, bottomRight: { x: r.left + r.width, y: r.top + r.height } } }, T = function e(t, n, a) { for (var o = 0; a.verticalLine.start.y + o * a.verticalMinorTick <= a.vscaleBounds.bottomRight.y;) { var i = a.color, r = a.lineWidth, l = { x: a.verticalLine.start.x, y: a.verticalLine.start.y + o * a.verticalMinorTick }, s = { x: 0, y: a.verticalLine.start.y + o * a.verticalMinorTick }; o % 5 == 0 ? s.x = a.verticalLine.start.x - a.majorTickLength : s.x = a.verticalLine.start.x - a.minorTickLength, Object(h.drawLine)(t, n, l, s, { color: i, lineWidth: r }, "canvas"), o++ } }, b = function e(t, n, a) { for (var o = 0; a.horizontalLine.start.x + o * a.horizontalMinorTick <= a.hscaleBounds.bottomRight.x;) { var i = a.color, r = a.lineWidth, l = { x: a.horizontalLine.start.x + o * a.horizontalMinorTick, y: a.horizontalLine.start.y }, s = { x: a.horizontalLine.start.x + o * a.horizontalMinorTick, y: 0 }; o % 5 == 0 ? s.y = a.horizontalLine.start.y - a.majorTickLength : s.y = a.horizontalLine.start.y - a.minorTickLength, Object(h.drawLine)(t, n, l, s, { color: i, lineWidth: r }, "canvas"), o++ } } }, "./tools/StackScrollMouseWheelTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return h }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), m = n(/*! ../util/scroll.js */ "./util/scroll.js"), h = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "StackScrollMouseWheel", supportedInteractionTypes: ["MouseWheel"], configuration: { loop: !1, allowSkipping: !0, invert: !1 } })) } return f()(t, e), r()(t, [{ key: "mouseWheelCallback", value: function e(t) { var n = t.detail, a = n.direction, o = n.element, i = this.configuration, r = i.loop, l = i.allowSkipping, s = i.invert; Object(m.default)(o, s ? -a : a, r, l) } }]), t }(g.default) }, "./tools/StackScrollMultiTouchTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return $ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), v = n(/*! ../util/scroll.js */ "./util/scroll.js"), p = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), x = n(/*! ../toolOptions.js */ "./toolOptions.js"), $ = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), (e = s()(this, d()(t).call(this, n, { name: "StackScrollMultiTouch", supportedInteractionTypes: ["MultiTouch"], configuration: { loop: !1, allowSkipping: !0, touchPointers: 3 } }))).multiTouchDragCallback = e._dragCallback.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_dragCallback", value: function e(t) { var n = t.detail; if (n.numPointers === this.configuration.touchPointers) { var a = n.element, o = n.deltaPoints, i = this.configuration, r = i.loop, l = i.allowSkipping, s = Object(x.getToolOptions)(this.name, a), u = this._getPixelPerImage(a), d = this._getDeltaY(a, o.page.y); if (!u) return; Math.abs(d) >= u ? (Object(v.default)(a, Math.round(d / u), r, l), s.deltaY = d % u) : s.deltaY = d, Object(x.setToolOptions)(this.name, a, s) } } }, { key: "_getDeltaY", value: function e(t, n) { return (Object(x.getToolOptions)(this.name, t).deltaY || 0) + n } }, { key: "_getPixelPerImage", value: function e(t) { var n = Object(p.getToolState)(t, "stack"); if (n && n.data && n.data.length) { var a = n.data[0]; return this.configuration.stackScrollSpeed || Math.max(2, t.offsetHeight / Math.max(a.imageIds.length, 8)) } } }]), t }(h.default) }, "./tools/StackScrollTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return y }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), v = n(/*! ../util/scroll.js */ "./util/scroll.js"), p = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), x = n(/*! ../toolOptions.js */ "./toolOptions.js"), $ = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), y = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "StackScroll", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { loop: !1, allowSkipping: !0 }, svgCursor: $.stackScrollCursor }; return (e = s()(this, d()(t).call(this, n, a))).mouseDragCallback = e._dragCallback.bind(f()(e)), e.touchDragCallback = e._dragCallback.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_dragCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.deltaPoints, i = this.configuration, r = i.loop, l = i.allowSkipping, s = Object(x.getToolOptions)(this.name, a), u = this._getPixelPerImage(a), d = this._getDeltaY(a, o.page.y); u && (Math.abs(d) >= u ? (Object(v.default)(a, Math.round(d / u), r, l), s.deltaY = d % u) : s.deltaY = d, Object(x.setToolOptions)(this.name, a, s)) } }, { key: "_getDeltaY", value: function e(t, n) { return (Object(x.getToolOptions)(this.name, t).deltaY || 0) + n } }, { key: "_getPixelPerImage", value: function e(t) { var n = Object(p.getToolState)(t, "stack"); if (n && n.data && n.data.length) { var a = n.data[0]; return this.configuration.stackScrollSpeed || Math.max(2, t.offsetHeight / Math.max(a.imageIds.length, 8)) } } }]), t }(h.default) }, "./tools/WwwcRegionTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return b }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../externalModules.js */ "./externalModules.js"), v = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), p = n(/*! ../drawing/index.js */ "./drawing/index.js"), x = n(/*! ../util/clip.js */ "./util/clip.js"), $ = n(/*! ../util/getLuminance.js */ "./util/getLuminance.js"), y = n(/*! ../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), T = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), b = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "WwwcRegion", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { minWindowWidth: 10 }, svgCursor: T.wwwcRegionCursor }; return (e = s()(this, d()(t).call(this, n, a)))._resetHandles(), e.postTouchStartCallback = e._startOutliningRegion.bind(f()(e)), e.touchDragCallback = e._setHandlesAndUpdate.bind(f()(e)), e.touchEndCallback = e._applyStrategy.bind(f()(e)), e.postMouseDownCallback = e._startOutliningRegion.bind(f()(e)), e.mouseClickCallback = e._startOutliningRegion.bind(f()(e)), e.mouseDragCallback = e._setHandlesAndUpdate.bind(f()(e)), e.mouseMoveCallback = e._setHandlesAndUpdate.bind(f()(e)), e.mouseUpCallback = e._applyStrategy.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = a.element, i = y.default.getColorIfActive({ active: !0 }), r = Object(p.getNewContext)(a.canvasContext.canvas); Object(p.draw)(r, function (e) { Object(p.drawRect)(e, o, n.handles.start, n.handles.end, { color: i }) }) } }, { key: "_startOutliningRegion", value: function e(t) { var n = t.detail.element, a = t.detail.currentPoints.image; return _(this.handles.start) ? this.handles.start = a : (this.handles.end = a, this._applyStrategy(t)), h.default.cornerstone.updateImage(n), !0 } }, { key: "_setHandlesAndUpdate", value: function e(t) { var n = t.detail.element, a = t.detail.currentPoints.image; this.handles.end = a, h.default.cornerstone.updateImage(n) } }, { key: "_applyStrategy", value: function e(t) { !(_(this.handles.start) || _(this.handles.end)) && (t.detail.handles = this.handles, C(t, this.configuration), this._resetHandles()) } }, { key: "_resetHandles", value: function e() { this.handles = { start: {}, end: {} } } }]), t }(v.default), _ = function e(t) { return 0 === Object.keys(t).length && t.constructor === Object }, C = function e(t, n) { var a = t.detail, o = a.image, i = a.element, r = t.detail.handles, l = r.start, s = r.end, u = Math.min(l.x, s.x), d = Math.min(l.y, s.y), c = Math.abs(l.x - s.x), f = Math.abs(l.y - s.y); u = Object(x.default)(u, 0, o.width), d = Object(x.default)(d, 0, o.height), c = Math.floor(Math.min(c, Math.abs(o.width - u))), f = Math.floor(Math.min(f, Math.abs(o.height - d))); var g = Object($.default)(i, u, d, c, f), m = j(g, o.minPixelValue, o.maxPixelValue), v = a.viewport; void 0 === n.minWindowWidth && (n.minWindowWidth = 10), v.voi.windowWidth = Math.max(Math.abs(m.max - m.min), n.minWindowWidth), v.voi.windowCenter = m.mean, v.voiLUT = void 0, h.default.cornerstone.setViewport(i, v), h.default.cornerstone.updateImage(i) }, j = function e(t, n, a) { var o = t.length, i = a, r = n, l = 0; if (o < 2) return { min: i, max: r, mean: (n + a) / 2 }; for (var s = 0; s < o; s++) { var u = t[s]; i = Math.min(i, u), r = Math.max(r, u), l += u } return { min: i, max: r, mean: l / o } } }, "./tools/WwwcTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return v }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), v = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "Wwwc", strategies: { basicLevelingStrategy: p }, supportedInteractionTypes: ["Mouse", "Touch"], configuration: { orientation: 0 }, svgCursor: h.wwwcCursor }; return s()(this, d()(t).call(this, e, n)) } return f()(t, e), r()(t, [{ key: "mouseDragCallback", value: function e(t) { this.applyActiveStrategy(t), g.default.cornerstone.setViewport(t.detail.element, t.detail.viewport) } }, { key: "touchDragCallback", value: function e(t) { t.stopImmediatePropagation(), this.applyActiveStrategy(t), g.default.cornerstone.setViewport(t.detail.element, t.detail.viewport) } }]), t }(m.default); function p(e) { var t, n = this.configuration.orientation, a = e.detail, o = a.image.maxPixelValue * a.image.slope + a.image.intercept, i = (o - (a.image.minPixelValue * a.image.slope + a.image.intercept)) / 1024, r = a.deltaPoints.page.x * i, l = a.deltaPoints.page.y * i; 0 === n ? (a.viewport.voi.windowWidth += r, a.viewport.voi.windowCenter += l) : (a.viewport.voi.windowWidth += l, a.viewport.voi.windowCenter += r), a.viewport.voiLUT = void 0 } }, "./tools/ZoomMouseWheelTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return v }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../util/zoom/index.js */ "./util/zoom/index.js"), v = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "ZoomMouseWheel", supportedInteractionTypes: ["MouseWheel"], configuration: { minScale: .25, maxScale: 20, invert: !1 } })) } return f()(t, e), r()(t, [{ key: "mouseWheelCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.viewport, i = n.spinY, r = this.configuration, l = r.invert, s = r.maxScale, u = r.minScale, d = Object(h.changeViewportScale)(o, l ? i / 4 : -i / 4, { maxScale: s, minScale: u }); g.default.cornerstone.setViewport(a, d) } }]), t }(m.default) }, "./tools/ZoomTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return y }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../util/clip.js */ "./util/clip.js"), v = n(/*! ../util/zoom/index.js */ "./util/zoom/index.js"), p = n(/*! ./cursors/index.js */ "./tools/cursors/index.js"), x = v.default.correctShift, $ = v.default.changeViewportScale, y = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "Zoom", strategies: { default: b, translate: _, zoomToCenter: C }, defaultStrategy: "default", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { invert: !0, preventZoomOutsideImage: !1, minScale: .25, maxScale: 20 }, svgCursor: p.zoomCursor }; return s()(this, d()(t).call(this, e, n)) } return f()(t, e), r()(t, [{ key: "touchDragCallback", value: function e(t) { T.call(this, t) } }, { key: "mouseDragCallback", value: function e(t) { T.call(this, t) } }]), t }(m.default), T = function e(t) { if (!t.detail.deltaPoints.page.y) return !1; this.applyActiveStrategy(t, this.configuration), g.default.cornerstone.setViewport(t.detail.element, t.detail.viewport) }; function b(e) { var t = this.configuration, n = t.invert, a = t.maxScale, o = t.minScale, i = e.detail.deltaPoints.page.y, r = e.detail, l = r.element, s = r.viewport, u = [e.detail.startPoints.page.x, e.detail.startPoints.page.y, e.detail.startPoints.image.x, e.detail.startPoints.image.y], d = u[0], c = u[1], f = u[2], m = u[3], h = $(s, n ? -i / 100 : i / 100, { maxScale: a, minScale: o }); g.default.cornerstone.setViewport(l, h); var v = g.default.cornerstone.pageToPixel(l, d, c), p = { x: f - v.x, y: m - v.y }; p = x(p, h), s.translation.x -= p.x, s.translation.y -= p.y } function _(e) { var t = this.configuration, n = t.invert, a = t.preventZoomOutsideImage, o = t.maxScale, i = t.minScale, r = e.detail.deltaPoints.page.y, l = n ? -r / 100 : r / 100, s = e.detail.image, u = e.detail.viewport, d = [e.detail.startPoints.image.x, e.detail.startPoints.image.y], c = d[0], f = d[1], g = $(u, l, { maxScale: o, minScale: i }), m = { x: 0, y: 0 }; if (l < 0) g.scale < 3 && (.01 > Math.abs(g.translation.x) ? g.translation.x = 0 : m.x = g.translation.x / 8, .01 > Math.abs(g.translation.y) ? g.translation.y = 0 : m.y = g.translation.y / 8); else { a && Object(h.clipToBox)(e.detail.startPoints.image, s); var v = { x: s.width / 2 - c, y: s.height / 2 - f }; v = x(v, g); var p = { x: g.translation.x - v.x, y: g.translation.y - v.y }; .01 > Math.abs(p.x) ? g.translation.x = v.x : m.x = p.x / 8, .01 > Math.abs(p.y) ? g.translation.y = v.y : m.y = p.y / 8 } g.translation.x -= m.x, g.translation.y -= m.y } function C(e) { var t = this.configuration, n = t.invert, a = t.maxScale, o = t.minScale, i = e.detail.deltaPoints.page.y; $(e.detail.viewport, n ? -i / 100 : i / 100, { maxScale: a, minScale: o }) } }, "./tools/ZoomTouchPinchTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return v }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../externalModules.js */ "./externalModules.js"), m = n(/*! ./base/BaseTool.js */ "./tools/base/BaseTool.js"), h = n(/*! ../util/zoom/index.js */ "./util/zoom/index.js").default.correctShift, v = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), s()(this, d()(t).call(this, e, { name: "ZoomTouchPinch", supportedInteractionTypes: ["TouchPinch"], configuration: { minScale: .25, maxScale: 20 } })) } return f()(t, e), r()(t, [{ key: "touchPinchCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.viewport, i = n.scaleChange, r = [t.detail.startPoints.page.x, t.detail.startPoints.page.y, t.detail.startPoints.image.x, t.detail.startPoints.image.y], l = r[0], s = r[1], u = r[2], d = r[3], c = this.configuration, f = c.maxScale, m = c.minScale; o.scale += i * o.scale, f && o.scale > f ? o.scale = f : m && o.scale < m && (o.scale = m), g.default.cornerstone.setViewport(a, o); var v = g.default.cornerstone.pageToPixel(a, l, s), p = { x: u - v.x, y: d - v.y }; p = h(p, o), o.translation.x -= p.x, o.translation.y -= p.y, g.default.cornerstone.setViewport(a, o) } }]), t }(m.default) }, "./tools/annotation/AngleTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return P }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), v = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ./../../manipulators/index.js */ "./manipulators/index.js"), $ = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), y = n(/*! ./../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), T = n(/*! ./../../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), b = n(/*! ./../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), _ = n(/*! ./../../util/lineSegDistance.js */ "./util/lineSegDistance.js"), C = n(/*! ./../../util/roundToDecimal.js */ "./util/roundToDecimal.js"), j = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), S = n(/*! ../../util/triggerEvent.js */ "./util/triggerEvent.js"), w = n(/*! ../../events.js */ "./events.js"), M = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), E = n(/*! ../../util/throttle */ "./util/throttle.js"), I = n(/*! ../../store/index */ "./store/index.js"), P = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Angle", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: j.angleCursor, configuration: { drawHandles: !0, drawHandlesOnHover: !1, hideHandlesIfMoving: !1, renderDashed: !1 } }; return (e = s()(this, d()(t).call(this, n, a))).preventNewMeasurement = !1, e.throttledUpdateCachedStats = Object(E.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { start: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, middle: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 }, end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a) { return !1 !== n.visible && (25 > Object(_.default)(t, n.handles.start, n.handles.middle, a) || 25 > Object(_.default)(t, n.handles.middle, n.handles.end, a)) } }, { key: "updateCachedStats", value: function e(t, n, a) { var o = D(t, a.handles.middle, a.handles.start), i = D(t, a.handles.end, a.handles.middle), r = D(t, a.handles.end, a.handles.start), l = k(o), s = k(i), u = Math.acos((Math.pow(l, 2) + Math.pow(s, 2) - Math.pow(k(r), 2)) / (2 * l * s)); u *= 180 / Math.PI, a.rAngle = Object(C.default)(u, 2), a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = a.enabledElement, i = this.configuration, r = i.handleRadius, l = i.drawHandlesOnHover, s = i.hideHandlesIfMoving, u = i.renderDashed, d = Object(h.getToolState)(t.currentTarget, this.name), c = Object(I.getModule)("globalConfiguration").configuration.lineDash; if (d) { for (var f = Object($.getNewContext)(a.canvasContext.canvas), m = a.image, x = a.element, _ = Object(M.default)(m), C = _.rowPixelSpacing, j = _.colPixelSpacing, S = v.default.getToolWidth(), w = 0; w < d.data.length; w++)if ("continue" === function e(t) { var i = d.data[t]; if (!1 === i.visible) return "continue"; Object($.draw)(f, function (e) { Object($.setShadow)(e, n.configuration); var t = p.default.getColorIfActive(i), d = g.default.cornerstone.pixelToCanvas(a.element, i.handles.start), f = g.default.cornerstone.pixelToCanvas(a.element, i.handles.middle), h = { color: t }; if (u && (h.lineDash = c), Object($.drawJoinedLines)(e, a.element, i.handles.start, [i.handles.middle, i.handles.end], h), n.configuration.drawHandles && Object(b.default)(e, a, i.handles, { color: t, handleRadius: r, drawHandlesIfActive: l, hideHandlesIfMoving: s }), !0 === i.invalidated && (i.rAngle ? n.throttledUpdateCachedStats(m, x, i) : n.updateCachedStats(m, x, i)), i.rAngle) { var v, _, w, M, I = (v = i, _ = C, w = j, v.rAngle.toString() + String.fromCharCode(parseInt("00B0", 16)) + (_ && w ? "" : " (isotropic)")); if (!i.handles.textBox.hasMoved) { M = { x: f.x, y: f.y }; var P = Object(T.textBoxWidth)(e, I, 5); f.x < d.x ? M.x -= 15 + P + 10 : M.x += 15; var k = g.default.cornerstone.internal.getTransform(o); k.invert(); var D = k.transformPoint(M.x, M.y); i.handles.textBox.x = D.x, i.handles.textBox.y = D.y } Object(y.default)(e, a.element, i.handles.textBox, I, i.handles, E, t, S, 0, !0) } }) }(w)) continue } function E(e) { return [e.start, e.middle, e.end] } } }, { key: "addNewMeasurement", value: function e(t, n) { var a = this; if (!this.preventNewMeasurement) { this.preventNewMeasurement = !0, t.preventDefault(), t.stopPropagation(); var o = t.detail, i = this.createNewMeasurement(o), r = t.detail.element; Object(h.addToolState)(r, this.name, i), g.default.cornerstone.updateImage(r), Object(x.moveNewHandle)(o, this.name, i, i.handles.middle, this.options, n, function (e) { if (i.active = !1, !e) { Object(h.removeToolState)(r, a.name, i), a.preventNewMeasurement = !1; return } i.handles.end.active = !0, g.default.cornerstone.updateImage(r), Object(x.moveNewHandle)(o, a.name, i, i.handles.end, a.options, n, function (e) { e ? (i.active = !1, g.default.cornerstone.updateImage(r)) : Object(h.removeToolState)(r, a.name, i), a.preventNewMeasurement = !1, g.default.cornerstone.updateImage(r); var t = { toolName: a.name, toolType: a.name, element: r, measurementData: i }; Object(S.default)(r, w.default.MEASUREMENT_COMPLETED, t) }) }) } } }]), t }(m.default); function k(e) { return Math.sqrt(Math.pow(e.x, 2) + Math.pow(e.y, 2)) } function D(e, t, n) { var a = Object(M.default)(e), o = a.rowPixelSpacing, i = a.colPixelSpacing; return { x: (t.x - n.x) * (i || 1), y: (t.y - n.y) * (o || 1) } } }, "./tools/annotation/ArrowAnnotateTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return P }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../events.js */ "./events.js"), v = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ./../../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"), x = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), $ = n(/*! ./../../manipulators/index.js */ "./manipulators/index.js"), y = n(/*! ./../../util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), T = n(/*! ./../../util/lineSegDistance.js */ "./util/lineSegDistance.js"), b = n(/*! ./../../util/triggerEvent.js */ "./util/triggerEvent.js"), _ = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), C = n(/*! ./../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), j = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), S = n(/*! ./../../drawing/drawArrow.js */ "./drawing/drawArrow.js"), w = n(/*! ./../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), M = n(/*! ./../../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), E = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), I = n(/*! ../../store/index */ "./store/index.js"), P = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "ArrowAnnotate", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { getTextCallback: k, changeTextCallback: D, drawHandles: !0, drawHandlesOnHover: !1, hideHandlesIfMoving: !1, arrowFirst: !0, renderDashed: !1, allowEmptyLabel: !1 }, svgCursor: E.arrowAnnotateCursor }; return (e = s()(this, d()(t).call(this, n, a))).preventNewMeasurement = !1, e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { return { visible: !0, active: !0, color: void 0, handles: { start: { x: t.detail.currentPoints.image.x, y: t.detail.currentPoints.image.y, highlight: !0, active: !1 }, end: { x: t.detail.currentPoints.image.x, y: t.detail.currentPoints.image.y, highlight: !0, active: !1 }, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a) { return !1 !== n.visible && 25 > Object(T.default)(t, n.handles.start, n.handles.end, a) } }, { key: "updateCachedStats", value: function e() { } }, { key: "renderToolData", value: function e(t) { var n, a = this, o = t.detail, i = o.element, r = o.enabledElement, l = this.configuration, s = l.handleRadius, u = l.drawHandlesOnHover, d = l.hideHandlesIfMoving, c = l.renderDashed, f = Object(_.getToolState)(i, this.name); if (f) { var m = t.detail.canvasContext.canvas, h = Object(j.getNewContext)(m), $ = v.default.getToolWidth(); c && (n = Object(I.getModule)("globalConfiguration").configuration.lineDash); for (var y = 0; y < f.data.length; y++)if ("continue" === function e(o) { var l = f.data[o]; if (!1 === l.visible) return "continue"; Object(j.draw)(h, function (e) { Object(j.setShadow)(e, a.configuration); var o, c = x.default.getColorIfActive(l), f = g.default.cornerstone.pixelToCanvas(i, l.handles.start), m = g.default.cornerstone.pixelToCanvas(i, l.handles.end); a.configuration.arrowFirst ? Object(S.default)(e, m, f, c, $, n) : Object(S.default)(e, f, m, c, $, n), a.configuration.drawHandles && Object(w.default)(e, t.detail, l.handles, { color: c, handleRadius: s, drawHandlesIfActive: u, hideHandlesIfMoving: d }); var h = (o = l, o.text); if (h && "" !== h) { var v = Object(M.textBoxWidth)(e, h, 5), y = p.default.getFontSize() + 10, b = Math.max(v, y) / 2 + 5; if (m.x < f.x && (b = -b), !l.handles.textBox.hasMoved) { _ = a.configuration.arrowFirst ? { x: m.x - v / 2 + b, y: m.y - y / 2 } : { x: f.x - v / 2 - b, y: f.y - y / 2 }; var _, E = g.default.cornerstone.internal.getTransform(r); E.invert(); var I = E.transformPoint(_.x, _.y); l.handles.textBox.x = I.x, l.handles.textBox.y = I.y } Object(C.default)(e, i, l.handles.textBox, h, l.handles, T, c, $, 0, !1) } }) }(y)) continue } function T(e) { var t = { x: (e.start.x + e.end.x) / 2, y: (e.start.y + e.end.y) / 2 }; return [e.start, t, e.end] } } }, { key: "addNewMeasurement", value: function e(t, n) { var a = this, o = t.detail.element, i = this.createNewMeasurement(t), r = this.configuration.allowEmptyLabel; Object(_.addToolState)(o, this.name, i), g.default.cornerstone.updateImage(o), Object($.moveNewHandle)(t.detail, this.name, i, i.handles.end, this.options, n, function (e) { e ? void 0 === i.text && a.configuration.getTextCallback(function (e) { if (e || r) { i.text = e, i.active = !1; var t = { toolName: a.name, toolType: a.name, element: o, measurementData: i }; g.default.cornerstone.updateImage(o), Object(b.default)(o, h.default.MEASUREMENT_COMPLETED, t) } else Object(_.removeToolState)(o, a.name, i) }, t.detail) : Object(_.removeToolState)(o, a.name, i), g.default.cornerstone.updateImage(o) }) } }, { key: "doubleClickCallback", value: function e(t) { return this._updateTextForNearbyAnnotation(t) } }, { key: "touchPressCallback", value: function e(t) { return this._updateTextForNearbyAnnotation(t) } }, { key: "_updateTextForNearbyAnnotation", value: function e(t) { var n = t.detail.element, a = t.detail.currentPoints.canvas, o = Object(_.getToolState)(n, this.name); if (!o) return !1; for (var i = 0; i < o.data.length; i++) { var r = o.data[i]; if (this.pointNearTool(n, r, a) || Object(y.default)(r.handles.textBox, a)) return r.active = !0, g.default.cornerstone.updateImage(n), this.configuration.changeTextCallback(r, t.detail, this._doneChangingTextCallback.bind(this, n, r)), t.stopImmediatePropagation(), t.preventDefault(), t.stopPropagation(), !0 } } }, { key: "_doneChangingTextCallback", value: function e(t, n, a, o) { !0 === o ? Object(_.removeToolState)(t, this.name, n) : n.text = a, n.active = !1, g.default.cornerstone.updateImage(t), Object(b.default)(t, h.default.MEASUREMENT_MODIFIED, { toolName: this.name, toolType: this.name, element: t, measurementData: n }) } }]), t }(m.default); function k(e) { e(prompt("Enter your annotation:")) } function D(e, t, n) { n(prompt("Change your annotation:")) } }, "./tools/annotation/BidirectionalTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return E }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), v = n(/*! ./bidirectionalTool/createNewMeasurement.js */ "./tools/annotation/bidirectionalTool/createNewMeasurement.js"), p = n(/*! ./bidirectionalTool/pointNearTool.js */ "./tools/annotation/bidirectionalTool/pointNearTool.js"), x = n(/*! ./bidirectionalTool/renderToolData.js */ "./tools/annotation/bidirectionalTool/renderToolData.js"), $ = n(/*! ./bidirectionalTool/addNewMeasurement.js */ "./tools/annotation/bidirectionalTool/addNewMeasurement.js"), y = n(/*! ./bidirectionalTool/mouseMoveCallback.js */ "./tools/annotation/bidirectionalTool/mouseMoveCallback.js"), T = n(/*! ./bidirectionalTool/handleSelectedCallback.js */ "./tools/annotation/bidirectionalTool/handleSelectedCallback.js"), b = n(/*! ./bidirectionalTool/handleSelectedMouseCallback.js */ "./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js"), _ = n(/*! ./bidirectionalTool/handleSelectedTouchCallback.js */ "./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js"), C = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), j = n(/*! ../../util/throttle */ "./util/throttle.js"), S = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), w = n(/*! ./bidirectionalTool/utils/calculateLongestAndShortestDiameters */ "./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js"), M = function e(t, n, a) { return a() }, E = function (e) { function t(e) { o()(this, t); var n, a = { name: "Bidirectional", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { changeMeasurementLocationCallback: M, getMeasurementLocationCallback: M, textBox: "", shadow: "", drawHandles: !0, drawHandlesOnHover: !0, hideHandlesIfMoving: !1, renderDashed: !1, additionalData: [] }, svgCursor: C.bidirectionalCursor }; return (n = s()(this, d()(t).call(this, e, a))).throttledUpdateCachedStats = Object(j.default)(n.updateCachedStats, 110), n.createNewMeasurement = v.default.bind(f()(n)), n.pointNearTool = p.default.bind(f()(n)), n.renderToolData = x.default.bind(f()(n)), n.addNewMeasurement = $.default.bind(f()(n)), n._moveCallback = y.default.bind(f()(n)), n.handleSelectedCallback = T.default.bind(f()(n)), n.handleSelectedMouseCallback = b.default.bind(f()(n)), n.handleSelectedTouchCallback = _.default.bind(f()(n)), n } return m()(t, e), r()(t, [{ key: "updateCachedStats", value: function e(t, n, a) { if (a.toolName === this.name) { var o = Object(S.default)(t), i = Object(w.default)(a, o), r = i.longestDiameter, l = i.shortestDiameter; a.longestDiameter = r, a.shortestDiameter = l, a.invalidated = !1 } } }]), t }(h.default) }, "./tools/annotation/CircleRoiTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return I }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), v = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ../../store/index */ "./store/index.js"), $ = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), y = n(/*! ./../../util/calculateSUV.js */ "./util/calculateSUV.js"), T = n(/*! ./../../util/ellipse/index.js */ "./util/ellipse/index.js"), b = n(/*! ../../util/getROITextBoxCoords.js */ "./util/getROITextBoxCoords.js"), _ = n(/*! ./../../util/numbersWithCommas.js */ "./util/numbersWithCommas.js"), C = n(/*! ./../../util/throttle.js */ "./util/throttle.js"), j = n(/*! ../../util/logger.js */ "./util/logger.js"), S = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), w = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), M = n(/*! ../../util/getCircleCoords */ "./util/getCircleCoords.js"), E = Object(j.getLogger)("tools:annotation:CircleRoiTool"), I = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "CircleRoi", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: w.circleRoiCursor, configuration: { renderDashed: !1, hideHandlesIfMoving: !1 } }; return (e = s()(this, d()(t).call(this, n, a))).throttledUpdateCachedStats = Object(C.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { E.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { start: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 }, initialRotation: t.viewport.rotation, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a, o) { var i = n && n.handles && n.handles.start && n.handles.end, r = g.default.cornerstoneMath.point.distance; if (i || E.warn("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")), !i || !1 === n.visible) return !1; var l = "mouse" === o ? 15 : 25, s = g.default.cornerstone.pixelToCanvas(t, n.handles.start), u = g.default.cornerstone.pixelToCanvas(t, n.handles.end), d = r(s, a), c = r(s, u); return d > c - l / 2 && d < c + l / 2 } }, { key: "updateCachedStats", value: function e(t, n, a) { var o, i, r, l, s, u, d, c, f, m = (g.default.cornerstone.metaData.get("generalSeriesModule", t.imageId) || {}).modality, h = Object(S.default)(t), v = (o = t, i = n, r = a.handles, l = m, s = h, d = Object(M.default)(r.start, r.end), c = g.default.cornerstone.getPixels(i, d.left, d.top, d.width, d.height), f = Object(T.calculateEllipseStatistics)(c, d), "PT" === l && (u = { mean: Object(y.default)(o, f.mean, !0) || 0, stdDev: Object(y.default)(o, f.stdDev, !0) || 0 }), { area: Math.PI * (d.width * (s.colPixelSpacing || 1) / 2) * (d.height * (s.rowPixelSpacing || 1) / 2) || 0, count: f.count || 0, mean: f.mean || 0, variance: f.variance || 0, stdDev: f.stdDev || 0, min: f.min || 0, max: f.max || 0, meanStdDevSUV: u }); a.cachedStats = v, a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = Object(h.getToolState)(t.currentTarget, this.name); if (a) { var o = g.default.cornerstoneMath.point.distance, i = t.detail, r = i.image, l = i.element, s = i.canvasContext, u = v.default.getToolWidth(), d = this.configuration, c = d.handleRadius, f = d.drawHandlesOnHover, m = d.hideHandlesIfMoving, y = d.renderDashed, T = Object($.getNewContext)(s.canvas), _ = Object(S.default)(r), C = _.rowPixelSpacing, j = _.colPixelSpacing, w = Object(x.getModule)("globalConfiguration").configuration.lineDash, M = (g.default.cornerstone.metaData.get("generalSeriesModule", r.imageId) || {}).modality, E = C && j; Object($.draw)(T, function (e) { for (var t = 0; t < a.data.length; t++) { var s = a.data[t]; if (!1 !== s.visible) { var d = p.default.getColorIfActive(s), h = { color: d, handleRadius: c, drawHandlesIfActive: f, hideHandlesIfMoving: m }; Object($.setShadow)(e, n.configuration); var v = g.default.cornerstone.pixelToCanvas(l, s.handles.start), x = g.default.cornerstone.pixelToCanvas(l, s.handles.end), T = o(v, x), _ = { color: d }; if (y && (_.lineDash = w), Object($.drawCircle)(e, l, s.handles.start, T, _, "canvas"), Object($.drawHandles)(e, i, s.handles, h), !0 === s.invalidated && (s.cachedStats ? n.throttledUpdateCachedStats(r, l, s) : n.updateCachedStats(r, l, s)), !s.handles.textBox.hasMoved) { var C = Object(b.default)(i.viewport, s.handles); Object.assign(s.handles.textBox, C) } var j = function e(t) { return P(t.start, t.end) }, S = D(e, r.color, s.cachedStats, M, E, n.configuration); s.unit = k(M, n.configuration.showHounsfieldUnits), Object($.drawLinkedTextBox)(e, l, s.handles.textBox, S, s.handles, j, d, u, 10, !0) } } }) } } }]), t }(m.default); function P(e, t) { var n = Object(M.default)(e, t), a = n.left, o = n.top, i = n.width, r = n.height; return [{ x: a + i / 2, y: o }, { x: a, y: o + r / 2 }, { x: a + i / 2, y: o + r }, { x: a + i, y: o + r / 2 }] } function k(e, t) { return "CT" === e && !1 !== t ? "HU" : "" } function D(e, t) { var n, a, o, i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, r = i.area, l = i.mean, s = i.stdDev, u = i.min, d = i.max, c = i.meanStdDevSUV, f = arguments.length > 3 ? arguments[3] : void 0, g = arguments.length > 4 ? arguments[4] : void 0, m = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}, h = m.showMinMax || !1, v = [], p = []; if (!t) { var x = c && 0 !== c.mean, $ = k(f, m.showHounsfieldUnits), y = "Mean: ".concat(Object(_.default)(l.toFixed(2)), " ").concat($), T = "Std Dev: ".concat(Object(_.default)(s.toFixed(2)), " ").concat($); if (x) { for (var b = " SUV: ", C = "".concat(b).concat(Object(_.default)(c.mean.toFixed(2))), j = "".concat(b).concat(Object(_.default)(c.stdDev.toFixed(2))), S = Math.floor(e.measureText("".concat(T, "     ")).width); e.measureText(y).width < S;)y += " "; p.push("".concat(y).concat(C)), p.push("".concat(T, "     ").concat(j)) } else p.push("".concat(y, "     ").concat(T)); if (h) { for (var w = "Min: ".concat(u, " ").concat($), M = "Max: ".concat(d, " ").concat($), E = x ? Math.floor(e.measureText("".concat(T, "     ")).width) : Math.floor(e.measureText("".concat(y, "     ")).width); e.measureText(w).width < E;)w += " "; p.push("".concat(w).concat(M)) } } return v.push((n = r, a = g, o = a ? " mm".concat("\xb2") : " px".concat("\xb2"), "Area: ".concat(Object(_.default)(n.toFixed(2))).concat(o))), p.forEach(function (e) { return v.push(e) }), v } }, "./tools/annotation/CobbAngleTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return P }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"), v = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), p = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), x = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), $ = n(/*! ./../../manipulators/index.js */ "./manipulators/index.js"), y = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), T = n(/*! ./../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), b = n(/*! ./../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), _ = n(/*! ./../../util/lineSegDistance.js */ "./util/lineSegDistance.js"), C = n(/*! ./../../util/roundToDecimal.js */ "./util/roundToDecimal.js"), j = n(/*! ./../../events.js */ "./events.js"), S = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), w = n(/*! ../../util/triggerEvent.js */ "./util/triggerEvent.js"), M = n(/*! ../../util/throttle */ "./util/throttle.js"), E = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), I = n(/*! ../../store/index */ "./store/index.js"), P = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "CobbAngle", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: S.cobbAngleCursor, configuration: { drawHandles: !0, drawHandlesOnHover: !1, hideHandlesIfMoving: !1, renderDashed: !1 } }; return (e = s()(this, d()(t).call(this, n, a))).hasIncomplete = !1, e.throttledUpdateCachedStats = Object(M.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { return this.hasIncomplete = !0, { visible: !0, active: !0, color: void 0, invalidated: !0, complete: !1, value: "", handles: { start: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 }, start2: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1, drawnIndependently: !0 }, end2: { x: t.currentPoints.image.x + 1, y: t.currentPoints.image.y, highlight: !0, active: !1, drawnIndependently: !0 }, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a) { if (!1 === n.visible || this.hasIncomplete) return !1; var o = 25 > Object(_.default)(t, n.handles.start, n.handles.end, a), i = 25 > Object(_.default)(t, n.handles.start2, n.handles.end2, a); return o || i } }, { key: "updateCachedStats", value: function e(t, n, a) { var o = Object(E.default)(t), i = o.rowPixelSpacing, r = o.colPixelSpacing, l = (Math.ceil(a.handles.start.x) - Math.ceil(a.handles.end.x)) * (r || 1), s = (Math.ceil(a.handles.start.y) - Math.ceil(a.handles.end.y)) * (i || 1), u = (Math.ceil(a.handles.start2.x) - Math.ceil(a.handles.end2.x)) * (r || 1), d = (Math.ceil(a.handles.start2.y) - Math.ceil(a.handles.end2.y)) * (i || 1), c = Math.acos(Math.abs((l * u + s * d) / (Math.sqrt(l * l + s * s) * Math.sqrt(u * u + d * d)))); c *= 180 / Math.PI, a.rAngle = Object(C.default)(c, 2), a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = this.configuration, i = o.handleRadius, r = o.drawHandlesOnHover, l = o.hideHandlesIfMoving, s = o.renderDashed, u = Object(v.getToolState)(t.currentTarget, this.name); if (u) { for (var d = Object(y.getNewContext)(a.canvasContext.canvas), c = p.default.getToolWidth(), f = Object(I.getModule)("globalConfiguration").configuration.lineDash, m = h.default.getFont(), $ = t.detail.element, _ = g.default.cornerstone.getEnabledElement($).image, C = Object(E.default)(_), j = C.rowPixelSpacing, S = C.colPixelSpacing, w = 0; w < u.data.length; w++)if ("continue" === function e(t) { var o = u.data[t]; if (!1 === o.visible) return "continue"; o.value || (o.value = n.textBoxText(o, j, S)), Object(y.draw)(d, function (e) { Object(y.setShadow)(e, n.configuration); var t = x.default.getColorIfActive(o), u = { color: t }; s && (u.lineDash = f), Object(y.drawLine)(e, a.element, o.handles.start, o.handles.end, u), o.complete && Object(y.drawLine)(e, a.element, o.handles.start2, o.handles.end2, u), n.configuration.drawHandles && Object(T.default)(e, a, o.handles, { color: t, handleRadius: i, drawHandlesIfActive: r, hideHandlesIfMoving: l }), e.fillStyle = t; var d = o.value; if (!o.handles.textBox.hasMoved) { var g = { x: (o.handles.start.x + o.handles.end.x) / 2, y: (o.handles.start.y + o.handles.end.y) / 2 - 10 }; e.font = m, o.handles.textBox.x = g.x, o.handles.textBox.y = g.y } Object(b.default)(e, a.element, o.handles.textBox, d, o.handles, M, t, c, 0, !0) }) }(w)) continue } function M(e) { return [e.start, e.start2, e.end, e.end2] } } }, { key: "getIncomplete", value: function e(t) { var n = Object(v.getToolState)(t, this.name); if (n && Array.isArray(n.data)) return n.data.find(function (e) { return !1 === e.complete }) } }, { key: "addNewMeasurement", value: function e(t, n) { var a, o, i = this; t.preventDefault(), t.stopPropagation(); var r = t.detail, l = function e(t) { if (!t) { Object(v.removeToolState)(s, i.name, a); return } var n = j.default.MEASUREMENT_COMPLETED, o = { toolName: i.name, toolType: i.name, element: s, measurementData: a }; Object(w.default)(s, n, o) }, s = t.detail.element, u = this.getIncomplete(s); u ? ((a = u).complete = !0, a.handles.start2 = { x: r.currentPoints.image.x, y: r.currentPoints.image.y, drawnIndependently: !1, highlight: !0, active: !1 }, a.handles.end2 = { x: r.currentPoints.image.x, y: r.currentPoints.image.y, drawnIndependently: !1, highlight: !0, active: !0 }, o = a.handles.end2, this.hasIncomplete = !1, l = function e(t) { if (!t) { Object(v.removeToolState)(s, i.name, a); return } var n = j.default.MEASUREMENT_COMPLETED, o = { toolName: i.name, toolType: i.name, element: s, measurementData: a }; Object(w.default)(s, n, o) }) : (a = this.createNewMeasurement(r), Object(v.addToolState)(s, this.name, a), o = a.handles.end), g.default.cornerstone.updateImage(s), Object($.moveNewHandle)(r, this.name, a, o, this.options, n, l) } }, { key: "onMeasureModified", value: function e(t) { var n = t.detail.element, a = g.default.cornerstone.getEnabledElement(n).image, o = Object(E.default)(a), i = o.rowPixelSpacing, r = o.colPixelSpacing; if (t.detail.toolName === this.name) { var l = t.detail.measurementData; !0 === l.invalidated && (l.rAngle ? this.throttledUpdateCachedStats(a, n, l) : this.updateCachedStats(a, n, l)), l.value = this.textBoxText(l, i, r) } } }, { key: "textBoxText", value: function e(t, n, a) { var o = t.rAngle; return void 0 === o || Number.isNaN(o) ? "" : "".concat(o, "\xb0").concat(n && a ? "" : " (isotropic)") } }, { key: "activeCallback", value: function e(t) { this.onMeasureModified = this.onMeasureModified.bind(this), t.addEventListener(j.default.MEASUREMENT_MODIFIED, this.onMeasureModified) } }, { key: "passiveCallback", value: function e(t) { this.onMeasureModified = this.onMeasureModified.bind(this), t.addEventListener(j.default.MEASUREMENT_MODIFIED, this.onMeasureModified) } }, { key: "enabledCallback", value: function e(t) { t.removeEventListener(j.default.MEASUREMENT_MODIFIED, this.onMeasureModified) } }, { key: "disabledCallback", value: function e(t) { t.removeEventListener(j.default.MEASUREMENT_MODIFIED, this.onMeasureModified) } }]), t }(m.default) }, "./tools/annotation/EllipticalRoiTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return I }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), v = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ../../manipulators/getHandleNearImagePoint */ "./manipulators/getHandleNearImagePoint.js"), $ = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), y = n(/*! ./../../util/calculateSUV.js */ "./util/calculateSUV.js"), T = n(/*! ./../../util/ellipse/index.js */ "./util/ellipse/index.js"), b = n(/*! ../../util/getROITextBoxCoords.js */ "./util/getROITextBoxCoords.js"), _ = n(/*! ./../../util/numbersWithCommas.js */ "./util/numbersWithCommas.js"), C = n(/*! ./../../util/throttle.js */ "./util/throttle.js"), j = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), S = n(/*! ../../util/logger.js */ "./util/logger.js"), w = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), M = n(/*! ../../store/index */ "./store/index.js"), E = Object(S.getLogger)("tools:annotation:EllipticalRoiTool"), I = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "EllipticalRoi", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { drawHandlesOnHover: !1, hideHandlesIfMoving: !1, renderDashed: !1 }, svgCursor: j.ellipticalRoiCursor }; return (e = s()(this, d()(t).call(this, n, a))).throttledUpdateCachedStats = Object(C.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { E.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { start: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 }, initialRotation: t.viewport.rotation, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a, o) { var i = n && n.handles && n.handles.start && n.handles.end; if (i || E.warn("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")), !i || !1 === n.visible) return !1; if (Object(x.default)(t, n.handles, a, 6)) return !0; var r = "mouse" === o ? 15 : 25, l = g.default.cornerstone.pixelToCanvas(t, n.handles.start), s = g.default.cornerstone.pixelToCanvas(t, n.handles.end), u = { left: Math.min(l.x, s.x) + r / 2, top: Math.min(l.y, s.y) + r / 2, width: Math.abs(l.x - s.x) - r, height: Math.abs(l.y - s.y) - r }, d = { left: Math.min(l.x, s.x) - r / 2, top: Math.min(l.y, s.y) - r / 2, width: Math.abs(l.x - s.x) + r, height: Math.abs(l.y - s.y) + r }, c = Object(T.pointInEllipse)(u, a); return !!Object(T.pointInEllipse)(d, a) && !c } }, { key: "updateCachedStats", value: function e(t, n, a) { var o, i, r, l, s, u, d, c, f, m = (g.default.cornerstone.metaData.get("generalSeriesModule", t.imageId) || {}).modality, h = Object(w.default)(t), v = (o = t, i = n, r = a.handles, l = m, s = h, d = L(r.start, r.end), c = g.default.cornerstone.getPixels(i, d.left, d.top, d.width, d.height), f = Object(T.calculateEllipseStatistics)(c, d), "PT" === l && (u = { mean: Object(y.default)(o, f.mean, !0) || 0, stdDev: Object(y.default)(o, f.stdDev, !0) || 0 }), { area: Math.PI * (d.width * (s.colPixelSpacing || 1) / 2) * (d.height * (s.rowPixelSpacing || 1) / 2) || 0, count: f.count || 0, mean: f.mean || 0, variance: f.variance || 0, stdDev: f.stdDev || 0, min: f.min || 0, max: f.max || 0, meanStdDevSUV: u }); a.cachedStats = v, a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = Object(h.getToolState)(t.currentTarget, this.name); if (a) { var o = t.detail, i = o.image, r = o.element, l = v.default.getToolWidth(), s = Object(M.getModule)("globalConfiguration").configuration.lineDash, u = this.configuration, d = u.handleRadius, c = u.drawHandlesOnHover, f = u.hideHandlesIfMoving, m = u.renderDashed, x = Object($.getNewContext)(o.canvasContext.canvas), y = Object(w.default)(i), T = y.rowPixelSpacing, _ = y.colPixelSpacing, C = (g.default.cornerstone.metaData.get("generalSeriesModule", i.imageId) || {}).modality, j = T && _; Object($.draw)(x, function (e) { for (var t = 0; t < a.data.length; t++) { var u = a.data[t]; if (!1 !== u.visible) { var g = p.default.getColorIfActive(u), h = { color: g, handleRadius: d, drawHandlesIfActive: c, hideHandlesIfMoving: f }; Object($.setShadow)(e, n.configuration); var v = { color: g }; if (m && (v.lineDash = s), Object($.drawEllipse)(e, r, u.handles.start, u.handles.end, v, "pixel", u.handles.initialRotation), Object($.drawHandles)(e, o, u.handles, h), !0 === u.invalidated && (u.cachedStats ? n.throttledUpdateCachedStats(i, r, u) : n.updateCachedStats(i, r, u)), !u.handles.textBox.hasMoved) { var x = Object(b.default)(o.viewport, u.handles); Object.assign(u.handles.textBox, x) } var y = function e(t) { return P(t.start, t.end) }, T = D(e, i.color, u.cachedStats, C, j, n.configuration); u.unit = k(C, n.configuration.showHounsfieldUnits), Object($.drawLinkedTextBox)(e, r, u.handles.textBox, T, u.handles, y, g, l, 10, !0) } } }) } } }]), t }(m.default); function P(e, t) { var n = L(e, t), a = n.left, o = n.top, i = n.width, r = n.height; return [{ x: a + i / 2, y: o }, { x: a, y: o + r / 2 }, { x: a + i / 2, y: o + r }, { x: a + i, y: o + r / 2 }] } function k(e, t) { return "CT" === e && !1 !== t ? "HU" : "" } function D(e, t) { var n, a, o, i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, r = i.area, l = i.mean, s = i.stdDev, u = i.min, d = i.max, c = i.meanStdDevSUV, f = arguments.length > 3 ? arguments[3] : void 0, g = arguments.length > 4 ? arguments[4] : void 0, m = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}, h = m.showMinMax || !1, v = [], p = []; if (!t) { var x = c && 0 !== c.mean, $ = k(f, m.showHounsfieldUnits), y = "Mean: ".concat(Object(_.default)(l.toFixed(2)), " ").concat($), T = "Std Dev: ".concat(Object(_.default)(s.toFixed(2)), " ").concat($); if (x) { for (var b = " SUV: ", C = "".concat(b).concat(Object(_.default)(c.mean.toFixed(2))), j = "".concat(b).concat(Object(_.default)(c.stdDev.toFixed(2))), S = Math.floor(e.measureText("".concat(T, "     ")).width); e.measureText(y).width < S;)y += " "; p.push("".concat(y).concat(C)), p.push("".concat(T, "     ").concat(j)) } else p.push("".concat(y)), p.push("".concat(T)); if (h) { for (var w = "Min: ".concat(u, " ").concat($), M = "Max: ".concat(d, " ").concat($), E = x ? Math.floor(e.measureText("".concat(T, "     ")).width) : Math.floor(e.measureText("".concat(y, "     ")).width); e.measureText(w).width < E;)w += " "; p.push("".concat(w).concat(M)) } } return v.push((n = r, a = g, o = a ? " mm".concat("\xb2") : " px".concat("\xb2"), "Area: ".concat(Object(_.default)(n.toFixed(2))).concat(o))), p.forEach(function (e) { return v.push(e) }), v } function L(e, t) { return { left: Math.round(Math.min(e.x, t.x)), top: Math.round(Math.min(e.y, t.y)), width: Math.round(Math.abs(e.x - t.x)), height: Math.round(Math.abs(e.y - t.y)) } } }, "./tools/annotation/FreehandRoiTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return V }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./../../events.js */ "./events.js"), v = n(/*! ./../../externalModules.js */ "./externalModules.js"), p = n(/*! ./../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), x = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), $ = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), y = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), T = n(/*! ../../store/index.js */ "./store/index.js"), b = n(/*! ../../util/triggerEvent.js */ "./util/triggerEvent.js"), _ = n(/*! ../../util/findAndMoveHelpers.js */ "./util/findAndMoveHelpers.js"), C = n(/*! ../../util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), j = n(/*! ../../util/calculateSUV.js */ "./util/calculateSUV.js"), S = n(/*! ../../util/numbersWithCommas.js */ "./util/numbersWithCommas.js"), w = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), M = n(/*! ../../drawing/index.js */ "./drawing/index.js"), E = n(/*! ../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), I = n(/*! ../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), P = n(/*! ../../util/clip.js */ "./util/clip.js"), k = n(/*! ../../store/setToolCursor.js */ "./store/setToolCursor.js"), D = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), L = n(/*! ../../util/freehand/index.js */ "./util/freehand/index.js"), O = n(/*! ../../util/logger.js */ "./util/logger.js"), A = n(/*! ../../util/throttle */ "./util/throttle.js"), H = Object(O.getLogger)("tools:annotation:FreehandRoiTool"), R = L.default.insertOrDelete, B = L.default.freehandArea, F = L.default.calculateFreehandStatistics, U = L.default.freehandIntersect, N = L.default.FreehandHandleData, V = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "FreehandRoi", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { mouseLocation: { handles: { start: { highlight: !0, active: !0 } } }, spacing: 1, activeHandleRadius: 3, completeHandleRadius: 6, completeHandleRadiusTouch: 28, alwaysShowHandles: !1, invalidColor: "crimson", currentHandle: 0, currentTool: -1, drawHandles: !0, renderDashed: !1 }, svgCursor: D.freehandRoiCursor }; return (e = s()(this, d()(t).call(this, n, a))).isMultiPartTool = !0, e._drawing = !1, e._dragging = !1, e._modifying = !1, e._drawingMouseDownCallback = e._drawingMouseDownCallback.bind(f()(e)), e._drawingMouseMoveCallback = e._drawingMouseMoveCallback.bind(f()(e)), e._drawingMouseDragCallback = e._drawingMouseDragCallback.bind(f()(e)), e._drawingMouseUpCallback = e._drawingMouseUpCallback.bind(f()(e)), e._drawingMouseDoubleClickCallback = e._drawingMouseDoubleClickCallback.bind(f()(e)), e._editMouseUpCallback = e._editMouseUpCallback.bind(f()(e)), e._editMouseDragCallback = e._editMouseDragCallback.bind(f()(e)), e._drawingTouchStartCallback = e._drawingTouchStartCallback.bind(f()(e)), e._drawingTouchDragCallback = e._drawingTouchDragCallback.bind(f()(e)), e._drawingDoubleTapClickCallback = e._drawingDoubleTapClickCallback.bind(f()(e)), e._editTouchDragCallback = e._editTouchDragCallback.bind(f()(e)), e.throttledUpdateCachedStats = Object(A.default)(e.updateCachedStats, 110), e } return m()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { H.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } var n = { visible: !0, active: !0, invalidated: !0, color: void 0, handles: { points: [] } }; return n.handles.textBox = { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 }, n } }, { key: "pointNearTool", value: function e(t, n, a) { var o = n && n.handles && n.handles.points; if (!o) throw Error("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")); return !!o && !1 !== n.visible && void 0 !== this._pointNearHandle(t, n, a) } }, { key: "distanceFromPoint", value: function e(t, n, a) { for (var o = 1 / 0, i = 0; i < n.handles.points.length; i++)o = Math.min(o, v.default.cornerstoneMath.point.distance(n.handles.points[i], a)); return o === 1 / 0 ? -1 : o } }, { key: "distanceFromPointCanvas", value: function e(t, n, a) { var o = 1 / 0; if (!n) return -1; for (var i = v.default.cornerstone.pixelToCanvas(t, a), r = n.handles.points, l = 0; l < r.length; l++) { var s = v.default.cornerstone.pixelToCanvas(t, r[l]); o = Math.min(o, v.default.cornerstoneMath.point.distance(s, i)) } return o === 1 / 0 ? -1 : o } }, { key: "updateCachedStats", value: function e(t, n, a) { for (var o, i, r = v.default.cornerstone.metaData.get("generalSeriesModule", t.imageId), l = r ? r.modality : null, s = a.handles.points, u = { left: s[0].x, right: s[0].x, bottom: s[0].y, top: s[0].x }, d = 0; d < s.length; d++)u.left = Math.min(u.left, s[d].x), u.right = Math.max(u.right, s[d].x), u.bottom = Math.min(u.bottom, s[d].y), u.top = Math.max(u.top, s[d].y); var c = { left: u.left, top: u.bottom, width: Math.abs(u.right - u.left), height: Math.abs(u.top - u.bottom) }; if (a.polyBoundingBox = c, !t.color) { var f = v.default.cornerstone.getPixels(n, c.left, c.top, c.width, c.height); o = F.call(this, f, c, a.handles.points), "PT" === l && (i = { mean: Object(j.default)(t, (o.mean - t.intercept) / t.slope), stdDev: Object(j.default)(t, (o.stdDev - t.intercept) / t.slope) }), o && !isNaN(o.mean) && (a.meanStdDev = o, a.meanStdDevSUV = i) } var g = Object(w.default)(t), m = g.colPixelSpacing, h = g.rowPixelSpacing, p = B(a.handles.points, (m || 1) * (h || 1)); isNaN(p) || (a.area = p), a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = Object(x.getToolState)(t.currentTarget, this.name); if (o) { for (var i = a.image, r = a.element, l = this.configuration, s = v.default.cornerstone.metaData.get("generalSeriesModule", i.imageId), u = s ? s.modality : null, d = Object(M.getNewContext)(a.canvasContext.canvas), c = $.default.getToolWidth(), f = l.renderDashed, g = Object(T.getModule)("globalConfiguration").configuration.lineDash, m = 0; m < o.data.length; m++)if ("continue" === function e(t) { var s = o.data[t]; if (!1 === s.visible) return "continue"; Object(M.draw)(d, function (e) { var t, o = y.default.getColorIfActive(s); s.active ? s.handles.invalidHandlePlacement ? (o = l.invalidColor, t = l.invalidColor) : (o = y.default.getColorIfActive(s), t = y.default.getFillColor()) : t = y.default.getToolColor(); var u = { color: o }; if (f && (u.lineDash = g), s.handles.points.length) { var d = s.handles.points; Object(M.drawJoinedLines)(e, r, d[0], d, u), s.polyBoundingBox ? Object(M.drawJoinedLines)(e, r, d[d.length - 1], [d[0]], u) : Object(M.drawJoinedLines)(e, r, d[d.length - 1], [l.mouseLocation.handles.start], u) } if (u = { color: o, fill: t }, (l.alwaysShowHandles || s.active && s.polyBoundingBox) && (u.handleRadius = l.activeHandleRadius, n.configuration.drawHandles && Object(I.default)(e, a, s.handles.points, u)), s.canComplete) { u.handleRadius = l.completeHandleRadius; var m = s.handles.points[0]; n.configuration.drawHandles && Object(I.default)(e, a, [m], u) } if (s.active && !s.polyBoundingBox) { u.handleRadius = l.activeHandleRadius, n.configuration.drawHandles && Object(I.default)(e, a, l.mouseLocation.handles, u); var v = s.handles.points[0]; n.configuration.drawHandles && Object(I.default)(e, a, [v], u) } if (!0 !== s.invalidated || s.active || (s.meanStdDev && s.meanStdDevSUV && s.area ? n.throttledUpdateCachedStats(i, r, s) : n.updateCachedStats(i, r, s)), s.polyBoundingBox && !s.handles.textBox.freehand) { s.handles.textBox.hasMoved || (s.handles.textBox.x = s.polyBoundingBox.left + s.polyBoundingBox.width, s.handles.textBox.y = s.polyBoundingBox.top + s.polyBoundingBox.height / 2); var x = h.call(n, s); Object(E.default)(e, r, s.handles.textBox, x, s.handles.points, p, o, c, 0, !0) } }) }(m)) continue } function h(e) { var t = e.meanStdDev, n = e.meanStdDevSUV, a = e.area, o = []; if (t && void 0 !== t.mean) { var r = ""; "CT" === u && (r = "HU"), e.unit = r; var l = "Mean: ".concat(Object(S.default)(t.mean.toFixed(2)), " ").concat(r), s = "StdDev: ".concat(Object(S.default)(t.stdDev.toFixed(2)), " ").concat(r); if (n && void 0 !== n.mean) { var d = " SUV: "; l += d + Object(S.default)(n.mean.toFixed(2)), s += d + Object(S.default)(n.stdDev.toFixed(2)) } o.push(l), o.push(s) } if (a) { var c = " mm".concat("\xb2"), f = Object(w.default)(i), g = f.rowPixelSpacing, m = f.colPixelSpacing; g && m || (c = " pixels".concat("\xb2")); var h = "Area: ".concat(Object(S.default)(a.toFixed(2))).concat(c); o.push(h) } return o } function p(e) { return e } } }, { key: "addNewMeasurement", value: function e(t) { var n = t.detail; this._startDrawing(t), this._addPoint(n), z(t) } }, { key: "preMouseDownCallback", value: function e(t) { var n = t.detail, a = this._pointNearHandleAllTools(n); return !!n.event.ctrlKey && (void 0 !== a && a.handleNearby.hasBoundingBox || R.call(this, t, a), z(t), !0) } }, { key: "handleSelectedCallback", value: function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse", i = t.detail.element, r = Object(x.getToolState)(i, this.name); if (a.hasBoundingBox) { Object(_.moveHandleNearImagePoint)(t, this, n, a, o); return } var l = this.configuration; l.dragOrigin = { x: a.x, y: a.y }; for (var s = 0; s < r.data.length; s++)for (var u = r.data[s].handles.points, d = 0; d < u.length; d++)u[d] === a && (l.currentHandle = d, l.currentTool = s); this._modifying = !0, this._activateModify(i), z(t) } }, { key: "_drawingMouseMoveCallback", value: function e(t) { var n = t.detail, a = n.currentPoints, o = n.element, i = Object(x.getToolState)(o, this.name), r = this.configuration, l = r.currentTool, s = i.data[l], u = a.canvas; this._getMouseLocation(n), this._checkInvalidHandleLocation(s, n); var d = this._pointNearHandle(o, s, u), c = s.handles.points; void 0 !== d && !d.hasBoundingBox && d < c.length - 1 && (r.mouseLocation.handles.start.x = c[d].x, r.mouseLocation.handles.start.y = c[d].y), v.default.cornerstone.updateImage(o) } }, { key: "_drawingMouseDragCallback", value: function e(t) { this.options.mouseButtonMask.includes(t.detail.buttons) && this._drawingDrag(t) } }, { key: "_drawingTouchDragCallback", value: function e(t) { this._drawingDrag(t) } }, { key: "_drawingDrag", value: function e(t) { var n = t.detail, a = n.element, o = Object(x.getToolState)(a, this.name), i = this.configuration.currentTool, r = o.data[i]; this._getMouseLocation(n), this._checkInvalidHandleLocation(r, n), this._addPointPencilMode(n, r.handles.points), this._dragging = !0, v.default.cornerstone.updateImage(a) } }, { key: "_drawingMouseUpCallback", value: function e(t) { var n = t.detail.element; if (this._dragging) { this._dragging = !1; var a = this.configuration, o = a.currentTool, i = Object(x.getToolState)(n, this.name).data[o]; if (!U.end(i.handles.points) && i.canComplete) { var r = a.currentHandle; this._endDrawing(n, r) } z(t) } } }, { key: "_drawingMouseDownCallback", value: function e(t) { var n = t.detail, a = n.buttons, o = n.currentPoints, i = n.element; if (this.options.mouseButtonMask.includes(a)) { var r = o.canvas, l = this.configuration, s = l.currentTool, u = Object(x.getToolState)(i, this.name).data[s], d = this._pointNearHandle(i, u, r); if (!U.end(u.handles.points) && u.canComplete) { var c = l.currentHandle; this._endDrawing(i, c) } else void 0 === d && this._addPoint(n); z(t) } } }, { key: "_drawingTouchStartCallback", value: function e(t) { var n = t.detail, a = n.currentPoints, o = n.element, i = a.canvas, r = this.configuration, l = r.currentTool, s = Object(x.getToolState)(o, this.name).data[l], u = this._pointNearHandle(o, s, i); if (!U.end(s.handles.points) && s.canComplete) { var d = r.currentHandle; this._endDrawing(o, d) } else void 0 === u && this._addPoint(n); z(t) } }, { key: "completeDrawing", value: function e(t) { if (this._drawing) { var n = Object(x.getToolState)(t, this.name), a = this.configuration, o = n.data[a.currentTool]; if (!U.end(o.handles.points) && o.handles.points.length >= 2) { var i = a.currentHandle; o.polyBoundingBox = {}, this._endDrawing(t, i) } } } }, { key: "_drawingMouseDoubleClickCallback", value: function e(t) { var n = t.detail.element; this.completeDrawing(n), z(t) } }, { key: "_drawingDoubleTapClickCallback", value: function e(t) { var n = t.detail.element; this.completeDrawing(n), z(t) } }, { key: "_editMouseDragCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.buttons; if (this.options.mouseButtonMask.includes(o)) { var i = Object(x.getToolState)(a, this.name), r = this.configuration, l = i.data[r.currentTool], s = r.currentHandle, u = l.handles.points, d = -1; if (this._getMouseLocation(n), l.handles.invalidHandlePlacement = U.modify(u, s), l.active = !0, l.highlight = !0, u[s].x = r.mouseLocation.handles.start.x, u[s].y = r.mouseLocation.handles.start.y, d = this._getPrevHandleIndex(s, u), s >= 0) { var c = u[d].lines.length - 1, f = u[d].lines[c]; f.x = r.mouseLocation.handles.start.x, f.y = r.mouseLocation.handles.start.y } v.default.cornerstone.updateImage(a) } } }, { key: "_editTouchDragCallback", value: function e(t) { var n = t.detail, a = n.element, o = Object(x.getToolState)(a, this.name), i = this.configuration, r = o.data[i.currentTool], l = i.currentHandle, s = r.handles.points, u = -1; if (this._getMouseLocation(n), r.handles.invalidHandlePlacement = U.modify(s, l), r.active = !0, r.highlight = !0, s[l].x = i.mouseLocation.handles.start.x, s[l].y = i.mouseLocation.handles.start.y, u = this._getPrevHandleIndex(l, s), l >= 0) { var d = s[u].lines.length - 1, c = s[u].lines[d]; c.x = i.mouseLocation.handles.start.x, c.y = i.mouseLocation.handles.start.y } v.default.cornerstone.updateImage(a) } }, { key: "_getPrevHandleIndex", value: function e(t, n) { return 0 === t ? n.length - 1 : t - 1 } }, { key: "_editMouseUpCallback", value: function e(t) { var n = t.detail, a = n.element, o = Object(x.getToolState)(a, this.name); this._deactivateModify(a), this._dropHandle(n, o), this._endDrawing(a), v.default.cornerstone.updateImage(a) } }, { key: "_dropHandle", value: function e(t, n) { var a = this.configuration, o = a.currentTool, i = n.data[o].handles, r = i.points; if (i.invalidHandlePlacement) { var l, s = a.currentHandle, u = r[s]; l = 0 === s ? r[r.length - 1] : r[s - 1], u.x = a.dragOrigin.x, u.y = a.dragOrigin.y, l.lines[0] = u, i.invalidHandlePlacement = !1 } } }, { key: "_startDrawing", value: function e(t) { var n, a = t.detail, o = this.createNewMeasurement(a), i = a.element, r = this.configuration; t.type === h.default.MOUSE_DOWN_ACTIVATE ? n = "Mouse" : t.type === h.default.TOUCH_START_ACTIVE && (n = "Touch"), this._activateDraw(i, n), this._getMouseLocation(a), Object(x.addToolState)(i, this.name, o); var l = Object(x.getToolState)(i, this.name); r.currentTool = l.data.length - 1, this._activeDrawingToolReference = l.data[r.currentTool] } }, { key: "_addPoint", value: function e(t) { var n = t.currentPoints, a = t.element, o = Object(x.getToolState)(a, this.name), i = this.configuration, r = o.data[i.currentTool]; if (!r.handles.invalidHandlePlacement) { var l = new N(n.image); r.handles.points.length && r.handles.points[i.currentHandle - 1].lines.push(n.image), r.handles.points.push(l), i.currentHandle += 1, v.default.cornerstone.updateImage(a), this.fireModifiedEvent(a, r) } } }, { key: "_addPointPencilMode", value: function e(t, n) { var a = this, o = this.configuration, i = t.element, r = o.mouseLocation.handles.start, l = function e(t) { return a._isDistanceLargerThanSpacing(i, t, r) }; n.every(l) && this._addPoint(t) } }, { key: "_endDrawing", value: function e(t, n) { var a = Object(x.getToolState)(t, this.name), o = this.configuration, i = a.data[o.currentTool]; if (i.active = !1, i.highlight = !1, i.handles.invalidHandlePlacement = !1, void 0 !== n) { var r = i.handles.points; r[o.currentHandle - 1].lines.push(r[0]) } this._modifying && (this._modifying = !1, i.invalidated = !0), o.currentHandle = 0, o.currentTool = -1, i.canComplete = !1, this._drawing && this._deactivateDraw(t), v.default.cornerstone.updateImage(t), this.fireModifiedEvent(t, i), this.fireCompletedEvent(t, i) } }, { key: "_pointNearHandle", value: function e(t, n, a) { if (void 0 !== n.handles && void 0 !== n.handles.points && !1 !== n.visible) { for (var o = 0; o < n.handles.points.length; o++) { var i = v.default.cornerstone.pixelToCanvas(t, n.handles.points[o]); if (6 > v.default.cornerstoneMath.point.distance(i, a)) return o } if (n.handles.textBox && Object(C.default)(n.handles.textBox, a)) return n.handles.textBox } } }, { key: "_pointNearHandleAllTools", value: function e(t) { var n, a = t.currentPoints, o = t.element, i = a.canvas, r = Object(x.getToolState)(o, this.name); if (r) { for (var l = 0; l < r.data.length; l++)if (void 0 !== (n = this._pointNearHandle(o, r.data[l], i))) return { handleNearby: n, toolIndex: l } } } }, { key: "_getMouseLocation", value: function e(t) { var n = t.currentPoints, a = t.image, o = this.configuration; o.mouseLocation.handles.start.x = n.image.x, o.mouseLocation.handles.start.y = n.image.y, Object(P.clipToBox)(o.mouseLocation.handles.start, a) } }, { key: "_checkInvalidHandleLocation", value: function e(t, n) { var a; if (t.handles.points.length < 2) return !0; a = this._dragging ? this._checkHandlesPencilMode(t, n) : this._checkHandlesPolygonMode(t, n), t.handles.invalidHandlePlacement = a } }, { key: "_checkHandlesPolygonMode", value: function e(t, n) { var a = this.configuration, o = n.element, i = a.mouseLocation.handles.start, r = t.handles.points, l = !1; return t.canComplete = !1, this._isDistanceSmallerThanCompleteSpacingCanvas(o, r[0], i) && !U.end(r) && r.length > 2 ? (t.canComplete = !0, l = !1) : l = U.newHandle(i, r), l } }, { key: "_checkHandlesPencilMode", value: function e(t, n) { var a = this.configuration.mouseLocation.handles.start, o = t.handles.points, i = U.newHandle(a, o); return !1 === i && (i = this._invalidHandlePencilMode(t, n)), i } }, { key: "_invalidHandlePencilMode", value: function e(t, n) { var a = this.configuration, o = n.element, i = a.mouseLocation.handles.start, r = t.handles.points; if (this._isDistanceSmallerThanCompleteSpacingCanvas(o, r[0], i)) return t.canComplete = !0, !1; t.canComplete = !1; for (var l = 1; l < r.length - 1; l++)if (this._isDistanceSmallerThanSpacing(o, r[l], i)) return !0; return !1 } }, { key: "_isDistanceSmallerThanCompleteSpacingCanvas", value: function e(t, n, a) { var o, i = v.default.cornerstone.pixelToCanvas(t, n), r = v.default.cornerstone.pixelToCanvas(t, a); return "Mouse" === this._drawingInteractionType ? o = this.configuration.completeHandleRadius : "Touch" === this._drawingInteractionType && (o = this.configuration.completeHandleRadiusTouch), this._compareDistanceToSpacing(t, i, r, "<", o) } }, { key: "_isDistanceSmallerThanSpacing", value: function e(t, n, a) { return this._compareDistanceToSpacing(t, n, a, "<") } }, { key: "_isDistanceLargerThanSpacing", value: function e(t, n, a) { return this._compareDistanceToSpacing(t, n, a, ">") } }, { key: "_compareDistanceToSpacing", value: function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ">", i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : this.configuration.spacing; return ">" === o ? v.default.cornerstoneMath.point.distance(n, a) > i : v.default.cornerstoneMath.point.distance(n, a) < i } }, { key: "_activateDraw", value: function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "Mouse"; this._drawing = !0, this._drawingInteractionType = n, T.state.isMultiPartToolActive = !0, Object(k.hideToolCursor)(this.element), t.addEventListener(h.default.MOUSE_DOWN, this._drawingMouseDownCallback), t.addEventListener(h.default.MOUSE_MOVE, this._drawingMouseMoveCallback), t.addEventListener(h.default.MOUSE_DOUBLE_CLICK, this._drawingMouseDoubleClickCallback), t.addEventListener(h.default.MOUSE_DRAG, this._drawingMouseDragCallback), t.addEventListener(h.default.MOUSE_UP, this._drawingMouseUpCallback), t.addEventListener(h.default.TOUCH_START, this._drawingMouseMoveCallback), t.addEventListener(h.default.TOUCH_START, this._drawingTouchStartCallback), t.addEventListener(h.default.TOUCH_DRAG, this._drawingTouchDragCallback), t.addEventListener(h.default.TOUCH_END, this._drawingMouseUpCallback), t.addEventListener(h.default.DOUBLE_TAP, this._drawingDoubleTapClickCallback), v.default.cornerstone.updateImage(t) } }, { key: "_deactivateDraw", value: function e(t) { this._drawing = !1, T.state.isMultiPartToolActive = !1, this._activeDrawingToolReference = null, this._drawingInteractionType = null, Object(k.setToolCursor)(this.element, this.svgCursor), t.removeEventListener(h.default.MOUSE_DOWN, this._drawingMouseDownCallback), t.removeEventListener(h.default.MOUSE_MOVE, this._drawingMouseMoveCallback), t.removeEventListener(h.default.MOUSE_DOUBLE_CLICK, this._drawingMouseDoubleClickCallback), t.removeEventListener(h.default.MOUSE_DRAG, this._drawingMouseDragCallback), t.removeEventListener(h.default.MOUSE_UP, this._drawingMouseUpCallback), t.removeEventListener(h.default.TOUCH_START, this._drawingTouchStartCallback), t.removeEventListener(h.default.TOUCH_DRAG, this._drawingTouchDragCallback), t.removeEventListener(h.default.TOUCH_START, this._drawingMouseMoveCallback), t.removeEventListener(h.default.TOUCH_END, this._drawingMouseUpCallback), v.default.cornerstone.updateImage(t) } }, { key: "_activateModify", value: function e(t) { T.state.isToolLocked = !0, t.addEventListener(h.default.MOUSE_UP, this._editMouseUpCallback), t.addEventListener(h.default.MOUSE_DRAG, this._editMouseDragCallback), t.addEventListener(h.default.MOUSE_CLICK, this._editMouseUpCallback), t.addEventListener(h.default.TOUCH_END, this._editMouseUpCallback), t.addEventListener(h.default.TOUCH_DRAG, this._editTouchDragCallback), v.default.cornerstone.updateImage(t) } }, { key: "_deactivateModify", value: function e(t) { T.state.isToolLocked = !1, t.removeEventListener(h.default.MOUSE_UP, this._editMouseUpCallback), t.removeEventListener(h.default.MOUSE_DRAG, this._editMouseDragCallback), t.removeEventListener(h.default.MOUSE_CLICK, this._editMouseUpCallback), t.removeEventListener(h.default.TOUCH_END, this._editMouseUpCallback), t.removeEventListener(h.default.TOUCH_DRAG, this._editTouchDragCallback), v.default.cornerstone.updateImage(t) } }, { key: "passiveCallback", value: function e(t) { this._closeToolIfDrawing(t) } }, { key: "enabledCallback", value: function e(t) { this._closeToolIfDrawing(t) } }, { key: "disabledCallback", value: function e(t) { this._closeToolIfDrawing(t) } }, { key: "_closeToolIfDrawing", value: function e(t) { if (this._drawing) { var n = this.configuration.currentHandle; this._endDrawing(t, n), v.default.cornerstone.updateImage(t) } } }, { key: "fireModifiedEvent", value: function e(t, n) { var a = h.default.MEASUREMENT_MODIFIED, o = { toolName: this.name, toolType: this.name, element: t, measurementData: n }; Object(b.default)(t, a, o) } }, { key: "fireCompletedEvent", value: function e(t, n) { var a = h.default.MEASUREMENT_COMPLETED, o = { toolName: this.name, toolType: this.name, element: t, measurementData: n }; Object(b.default)(t, a, o) } }, { key: "cancelDrawing", value: function e(t) { if (this._drawing) { var n = Object(x.getToolState)(t, this.name), a = this.configuration, o = n.data[a.currentTool]; o.active = !1, o.highlight = !1, o.handles.invalidHandlePlacement = !1, a.currentHandle = 0, a.currentTool = -1, o.canComplete = !1, Object(x.removeToolState)(t, this.name, o), this._deactivateDraw(t), v.default.cornerstone.updateImage(t) } } }, { key: "newImageCallback", value: function e(t) { var n = this.configuration; if (this._drawing && this._activeDrawingToolReference) { var a = t.detail.element, o = this._activeDrawingToolReference; o.active = !1, o.highlight = !1, o.handles.invalidHandlePlacement = !1; var i = o.handles.points; i[n.currentHandle - 1].lines.push(i[0]), n.currentHandle = 0, n.currentTool = -1, o.canComplete = !1, this._deactivateDraw(a), v.default.cornerstone.updateImage(a) } } }, { key: "spacing", get: function e() { return this.configuration.spacing }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehand spacing to a value other than a number."); this.configuration.spacing = t, v.default.cornerstone.updateImage(this.element) } }, { key: "activeHandleRadius", get: function e() { return this.configuration.activeHandleRadius }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehand activeHandleRadius to a value other than a number."); this.configuration.activeHandleRadius = t, v.default.cornerstone.updateImage(this.element) } }, { key: "completeHandleRadius", get: function e() { return this.configuration.completeHandleRadius }, set: function e(t) { if ("number" != typeof t) throw Error("Attempting to set freehand completeHandleRadius to a value other than a number."); this.configuration.completeHandleRadius = t, v.default.cornerstone.updateImage(this.element) } }, { key: "alwaysShowHandles", get: function e() { return this.configuration.alwaysShowHandles }, set: function e(t) { if ("boolean" != typeof t) throw Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean."); this.configuration.alwaysShowHandles = t, v.default.cornerstone.updateImage(this.element) } }, { key: "invalidColor", get: function e() { return this.configuration.invalidColor }, set: function e(t) { this.configuration.invalidColor = t, v.default.cornerstone.updateImage(this.element) } }]), t }(p.default); function z(e) { e.stopImmediatePropagation(), e.stopPropagation(), e.preventDefault() } }, "./tools/annotation/LengthTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return w }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), m = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), h = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), v = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), p = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), x = n(/*! ./../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), $ = n(/*! ./../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), y = n(/*! ./../../util/lineSegDistance.js */ "./util/lineSegDistance.js"), T = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), b = n(/*! ../../util/logger.js */ "./util/logger.js"), _ = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), C = n(/*! ../../util/throttle */ "./util/throttle.js"), j = n(/*! ../../store/index */ "./store/index.js"), S = Object(b.getLogger)("tools:annotation:LengthTool"), w = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Length", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: T.lengthCursor, configuration: { drawHandles: !0, drawHandlesOnHover: !1, hideHandlesIfMoving: !1, renderDashed: !1, digits: 2 } }; return (e = s()(this, d()(t).call(this, n, a))).throttledUpdateCachedStats = Object(C.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { S.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } var n = t.currentPoints.image, a = n.x, o = n.y; return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { start: { x: a, y: o, highlight: !0, active: !1 }, end: { x: a, y: o, highlight: !0, active: !0 }, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a) { var o; return n && n.handles && n.handles.start && n.handles.end ? !1 !== n.visible && 25 > Object(y.default)(t, n.handles.start, n.handles.end, a) : (S.warn("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")), !1) } }, { key: "updateCachedStats", value: function e(t, n, a) { var o = Object(_.default)(t), i = o.rowPixelSpacing, r = o.colPixelSpacing, l = (a.handles.end.x - a.handles.start.x) * (r || 1), s = (a.handles.end.y - a.handles.start.y) * (i || 1); a.length = Math.sqrt(l * l + s * s), a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = this.configuration, i = o.handleRadius, r = o.drawHandlesOnHover, l = o.hideHandlesIfMoving, s = o.renderDashed, u = o.digits, d = Object(m.getToolState)(t.currentTarget, this.name); if (d) { for (var c = Object(p.getNewContext)(a.canvasContext.canvas), f = a.image, g = a.element, y = Object(_.default)(f), T = y.rowPixelSpacing, b = y.colPixelSpacing, C = h.default.getToolWidth(), S = Object(j.getModule)("globalConfiguration").configuration.lineDash, w = 0; w < d.data.length; w++)if ("continue" === function e(t) { var o = d.data[t]; if (!1 === o.visible) return "continue"; Object(p.draw)(c, function (e) { Object(p.setShadow)(e, n.configuration); var t = v.default.getColorIfActive(o), d = { color: t }; if (s && (d.lineDash = S), Object(p.drawLine)(e, g, o.handles.start, o.handles.end, d), n.configuration.drawHandles && Object($.default)(e, a, o.handles, { color: t, handleRadius: i, drawHandlesIfActive: r, hideHandlesIfMoving: l }), !o.handles.textBox.hasMoved) { var c = { x: Math.max(o.handles.start.x, o.handles.end.x) }; c.x === o.handles.start.x ? c.y = o.handles.start.y : c.y = o.handles.end.y, o.handles.textBox.x = c.x, o.handles.textBox.y = c.y } !0 === o.invalidated && (o.length ? n.throttledUpdateCachedStats(f, g, o) : n.updateCachedStats(f, g, o)); var m = function e(t, n, a) { var o = function e(t) { var n = Number(t); return isNaN(n) ? void 0 : n }(t.length); if (!o) return ""; var i = "mm"; return n && a || (i = "pixels"), t.unit = i, "".concat(o.toFixed(u), " ").concat(i) }(o, T, b); Object(x.default)(e, g, o.handles.textBox, m, o.handles, M, t, C, 10, !0) }) }(w)) continue } function M(e) { var t = { x: (e.start.x + e.end.x) / 2, y: (e.start.y + e.end.y) / 2 }; return [e.start, t, e.end] } } }]), t }(g.default) }, "./tools/annotation/ProbeTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return M }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), v = n(/*! ../../stateManagement/textStyle.js */ "./stateManagement/textStyle.js"), p = n(/*! ../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ../../drawing/index.js */ "./drawing/index.js"), $ = n(/*! ../../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), y = n(/*! ../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), T = n(/*! ../../util/getRGBPixels.js */ "./util/getRGBPixels.js"), b = n(/*! ../../util/calculateSUV.js */ "./util/calculateSUV.js"), _ = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), C = n(/*! ../../util/logger.js */ "./util/logger.js"), j = n(/*! ../../util/throttle */ "./util/throttle.js"), S = n(/*! ../../store/index */ "./store/index.js"), w = Object(C.getLogger)("tools:annotation:ProbeTool"), M = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "Probe", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: _.probeCursor, configuration: { drawHandles: !0, renderDashed: !1 } }; return (e = s()(this, d()(t).call(this, n, a))).throttledUpdateCachedStats = Object(j.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { w.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a) { var o = n && n.handles && n.handles.end; if (o || w.warn("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")), !o || !1 === n.visible) return !1; var i = g.default.cornerstone.pixelToCanvas(t, n.handles.end); return 5 > g.default.cornerstoneMath.point.distance(i, a) } }, { key: "updateCachedStats", value: function e(t, n, a) { var o = Math.round(a.handles.end.x), i = Math.round(a.handles.end.y), r = {}; o >= 0 && i >= 0 && o < t.columns && i < t.rows && (r.x = o, r.y = i, t.color ? r.storedPixels = Object(T.default)(n, o, i, 1, 1) : (r.storedPixels = g.default.cornerstone.getStoredPixels(n, o, i, 1, 1), r.sp = r.storedPixels[0], r.mo = r.sp * t.slope + t.intercept, r.suv = Object(b.default)(t, r.sp))), a.cachedStats = r, a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = t.detail, o = this.configuration, i = o.handleRadius, r = o.renderDashed, l = Object(h.getToolState)(t.currentTarget, this.name); if (l) { for (var s = Object(x.getNewContext)(a.canvasContext.canvas), u = a.image, d = a.element, c = v.default.getFontSize(), f = Object(S.getModule)("globalConfiguration").configuration.lineDash, m = 0; m < l.data.length; m++)if ("continue" === function e(t) { var o = l.data[t]; if (!1 === o.visible) return "continue"; Object(x.draw)(s, function (e) { var t, l, s = p.default.getColorIfActive(o); if (n.configuration.drawHandles) { var m = { handleRadius: i, color: s }; r && (m.lineDash = f), Object(y.default)(e, a, o.handles, m) } !0 === o.invalidated && (o.cachedStats ? n.throttledUpdateCachedStats(u, d, o) : n.updateCachedStats(u, d, o)); var h = o.cachedStats, v = h.x, x = h.y, T = h.storedPixels, b = h.sp, _ = h.mo, C = h.suv; if (v >= 0 && x >= 0 && v < u.columns && x < u.rows) { t = "".concat(v, ", ").concat(x), u.color ? l = "R: ".concat(T[0], " G: ").concat(T[1], " B: ").concat(T[2]) : (l = "SP: ".concat(b, " MO: ").concat(parseFloat(_.toFixed(3))), C && (l += " SUV: ".concat(parseFloat(C.toFixed(3))))); var j = { x: o.handles.end.x + 3, y: o.handles.end.y - 3 }, S = g.default.cornerstone.pixelToCanvas(a.element, j); Object($.default)(e, l, S.x, S.y + c + 5, s), Object($.default)(e, t, S.x, S.y, s) } }) }(m)) continue } } }]), t }(m.default) }, "./tools/annotation/RectangleRoiTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return M }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./../../externalModules.js */ "./externalModules.js"), m = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), h = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), v = n(/*! ./../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), p = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), x = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), $ = n(/*! ./../../util/calculateSUV.js */ "./util/calculateSUV.js"), y = n(/*! ../../util/getROITextBoxCoords.js */ "./util/getROITextBoxCoords.js"), T = n(/*! ./../../util/numbersWithCommas.js */ "./util/numbersWithCommas.js"), b = n(/*! ./../../util/throttle.js */ "./util/throttle.js"), _ = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), C = n(/*! ../../util/logger.js */ "./util/logger.js"), j = n(/*! ../../util/getPixelSpacing */ "./util/getPixelSpacing.js"), S = n(/*! ../../store/index */ "./store/index.js"), w = Object(C.getLogger)("tools:annotation:RectangleRoiTool"), M = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "RectangleRoi", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { drawHandles: !0, drawHandlesOnHover: !1, hideHandlesIfMoving: !1, renderDashed: !1 }, svgCursor: _.rectangleRoiCursor }; return (e = s()(this, d()(t).call(this, n, a))).throttledUpdateCachedStats = Object(b.default)(e.updateCachedStats, 110), e } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { if (!(t && t.currentPoints && t.currentPoints.image)) { w.error("required eventData not supplied to tool ".concat(this.name, "'s createNewMeasurement")); return } return { visible: !0, active: !0, color: void 0, invalidated: !0, handles: { start: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !1 }, end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0 }, initialRotation: t.viewport.rotation, textBox: { active: !1, hasMoved: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 } } } } }, { key: "pointNearTool", value: function e(t, n, a, o) { var i = n && n.handles && n.handles.start && n.handles.end; if (i || w.warn("invalid parameters supplied to tool ".concat(this.name, "'s pointNearTool")), !i || !1 === n.visible) return !1; var r = g.default.cornerstone.pixelToCanvas(t, n.handles.start), l = g.default.cornerstone.pixelToCanvas(t, n.handles.end), s = { left: Math.min(r.x, l.x), top: Math.min(r.y, l.y), width: Math.abs(r.x - l.x), height: Math.abs(r.y - l.y) }; return g.default.cornerstoneMath.rect.distanceToPoint(s, a) < ("mouse" === o ? 15 : 25) } }, { key: "updateCachedStats", value: function e(t, n, a) { var o, i, r, l, s, u, d, c, f, m, h = (g.default.cornerstone.metaData.get("generalSeriesModule", t.imageId) || {}).modality, v = Object(j.default)(t), p = (o = t, i = n, r = a.handles, l = h, s = v, d = E(r.start, r.end), f = function e(t, n) { for (var a = 0, o = 0, i = 0, r = 0, l = t ? t[0] : null, s = t ? t[0] : null, u = n.top; u < n.top + n.height; u++)for (var d = n.left; d < n.left + n.width; d++)a += t[r], o += t[r] * t[r], l = Math.min(l, t[r]), s = Math.max(s, t[r]), i++, r++; if (0 === i) return { count: i, mean: 0, variance: 0, stdDev: 0, min: 0, max: 0 }; var c = a / i, f = o / i - c * c; return { count: i, mean: c, variance: f, stdDev: Math.sqrt(f), min: l, max: s } }(g.default.cornerstone.getPixels(i, d.left, d.top, d.width, d.height), d), "PT" === l && (u = { mean: Object($.default)(o, f.mean, !0) || 0, stdDev: Object($.default)(o, f.stdDev, !0) || 0 }), { area: d.width * (s.colPixelSpacing || 1) * (d.height * (s.rowPixelSpacing || 1)) || 0, perimeter: 2 * d.width * (s.colPixelSpacing || 1) + 2 * d.height * (s.rowPixelSpacing || 1), count: f.count || 0, mean: f.mean || 0, variance: f.variance || 0, stdDev: f.stdDev || 0, min: f.min || 0, max: f.max || 0, meanStdDevSUV: u }); a.cachedStats = p, a.invalidated = !1 } }, { key: "renderToolData", value: function e(t) { var n = this, a = Object(h.getToolState)(t.currentTarget, this.name); if (a) { var o = t.detail, i = o.image, r = o.element, l = v.default.getToolWidth(), s = Object(S.getModule)("globalConfiguration").configuration.lineDash, u = this.configuration, d = u.handleRadius, c = u.drawHandlesOnHover, f = u.hideHandlesIfMoving, m = u.renderDashed, $ = Object(x.getNewContext)(o.canvasContext.canvas), T = Object(j.default)(i), b = T.rowPixelSpacing, _ = T.colPixelSpacing, C = (g.default.cornerstone.metaData.get("generalSeriesModule", i.imageId) || {}).modality, w = b && _; Object(x.draw)($, function (e) { for (var t = 0; t < a.data.length; t++) { var u = a.data[t]; if (!1 !== u.visible) { var g = p.default.getColorIfActive(u), h = { color: g, handleRadius: d, drawHandlesIfActive: c, hideHandlesIfMoving: f }; Object(x.setShadow)(e, n.configuration); var v = { color: g }; if (m && (v.lineDash = s), Object(x.drawRect)(e, r, u.handles.start, u.handles.end, v, "pixel", u.handles.initialRotation), n.configuration.drawHandles && Object(x.drawHandles)(e, o, u.handles, h), !0 === u.invalidated && (u.cachedStats ? n.throttledUpdateCachedStats(i, r, u) : n.updateCachedStats(i, r, u)), !u.handles.textBox.hasMoved) { var $ = Object(y.default)(o.viewport, u.handles); Object.assign(u.handles.textBox, $) } var T = function e(t) { return I(t.start, t.end) }, b = k(e, i.color, u.cachedStats, C, w, n.configuration); u.unit = P(C, n.configuration.showHounsfieldUnits), Object(x.drawLinkedTextBox)(e, r, u.handles.textBox, b, u.handles, T, g, l, 10, !0) } } }) } } }]), t }(m.default); function E(e, t) { return { left: Math.min(e.x, t.x), top: Math.min(e.y, t.y), width: Math.abs(e.x - t.x), height: Math.abs(e.y - t.y) } } function I(e, t) { var n = E(e, t), a = n.left, o = n.top, i = n.width, r = n.height; return [{ x: a + i / 2, y: o }, { x: a, y: o + r / 2 }, { x: a + i / 2, y: o + r }, { x: a + i, y: o + r / 2 }] } function P(e, t) { return "CT" === e && !1 !== t ? "HU" : "" } function k(e, t, n, a, o) { var i, r, l, s = n.area, u = n.mean, d = n.stdDev, c = n.min, f = n.max, g = n.meanStdDevSUV, m = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}, h = m.showMinMax || !1, v = [], p = []; if (!t) { var x = g && 0 !== g.mean, $ = P(a, m.showHounsfieldUnits), y = "Mean: ".concat(Object(T.default)(u.toFixed(2)), " ").concat($), b = "Std Dev: ".concat(Object(T.default)(d.toFixed(2)), " ").concat($); if (x) { for (var _ = " SUV: ", C = "".concat(_).concat(Object(T.default)(g.mean.toFixed(2))), j = "".concat(_).concat(Object(T.default)(g.stdDev.toFixed(2))), S = Math.floor(e.measureText("".concat(b, "     ")).width); e.measureText(y).width < S;)y += " "; p.push("".concat(y).concat(C)), p.push("".concat(b, "     ").concat(j)) } else p.push("".concat(y)), p.push("".concat(b)); if (h) { for (var w = "Min: ".concat(c, " ").concat($), M = "Max: ".concat(f, " ").concat($), E = x ? Math.floor(e.measureText("".concat(b, "     ")).width) : Math.floor(e.measureText("".concat(y, "     ")).width); e.measureText(w).width < E;)w += " "; p.push("".concat(w).concat(M)) } } return v.push((i = s, l = (r = o) ? " mm".concat("\xb2") : " px".concat("\xb2"), "Area: ".concat(Object(T.default)(i.toFixed(2))).concat(l))), p.forEach(function (e) { return v.push(e) }), v } }, "./tools/annotation/TextMarkerTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return _ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ../base/BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), v = n(/*! ./../../externalModules.js */ "./externalModules.js"), p = n(/*! ./../../util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), x = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), $ = n(/*! ./../../drawing/index.js */ "./drawing/index.js"), y = n(/*! ./../../drawing/drawTextBox.js */ "./drawing/drawTextBox.js"), T = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), b = n(/*! ../cursors/index.js */ "./tools/cursors/index.js"), _ = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var a = { name: "TextMarker", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { markers: [], current: "", ascending: !0, loop: !1, changeTextCallback: C }, svgCursor: b.textMarkerCursor }; return (e = s()(this, d()(t).call(this, n, a))).touchPressCallback = e._changeText.bind(f()(e)), e.doubleClickCallback = e._changeText.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { var n = this.configuration; if (n.current) { var a = { visible: !0, active: !0, text: prompt("Please Enter Your Annotation :"), color: void 0, handles: { end: { x: t.currentPoints.image.x, y: t.currentPoints.image.y, highlight: !0, active: !0, hasBoundingBox: !0 } } }, o = { left: 0, top: 0, width: t.image.width, height: t.image.height }; if (v.default.cornerstoneMath.point.insideRect(a.handles.end, o)) { var i = n.markers.indexOf(n.current); return (i += n.ascending ? 1 : -1) >= n.markers.length ? i = n.loop ? 0 : -1 : i < 0 && (i = n.loop ? n.markers.length : -1), n.current = n.markers[i], a } } } }, { key: "pointNearTool", value: function e(t, n, a) { if (!1 === n.visible) return !1; if (n.handles.end.boundingBox) { var o = v.default.cornerstoneMath.rect.distanceToPoint(n.handles.end.boundingBox, a), i = Object(p.default)(n.handles.end, a); return o < 10 || i } } }, { key: "updateCachedStats", value: function e() { } }, { key: "renderToolData", value: function e(t) { var n = t.detail, a = this.configuration, o = Object(T.getToolState)(n.element, this.name); if (o) { for (var i = Object($.getNewContext)(n.canvasContext.canvas), r = 0; r < o.data.length; r++)if ("continue" === function e(t) { var r = o.data[t]; if (!1 === r.visible) return "continue"; var l = x.default.getColorIfActive(r); Object($.draw)(i, function (e) { Object($.setShadow)(e, a); var t = v.default.cornerstone.pixelToCanvas(n.element, r.handles.end); r.handles.end.boundingBox = Object(y.default)(e, r.text, t.x, t.y - 10, l, { centering: { x: !0, y: !0 } }) }) }(r)) continue } } }, { key: "_changeText", value: function e(t) { var n, a = t.detail, o = a.element, i = a.currentPoints; function r(e, t, n) { !0 === n ? Object(T.removeToolState)(o, this.name, e) : e.text = t, e.active = !1, v.default.cornerstone.updateImage(o) } var l = this.configuration, s = i.canvas, u = Object(T.getToolState)(o, this.name); if (u) { for (var d = 0; d < u.data.length; d++)if (n = u.data[d], this.pointNearTool(o, n, s)) { n.active = !0, v.default.cornerstone.updateImage(o), l.changeTextCallback(n, a, r), t.stopImmediatePropagation(), t.preventDefault(), t.stopPropagation(); return } } } }]), t }(h.default), C = function e(t, n, a) { a(t, prompt("Change your annotation:")) } }, "./tools/annotation/bidirectionalTool/addNewMeasurement.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../../externalModules.js */ "./externalModules.js"), o = n(/*! ./../../../events.js */ "./events.js"), i = n(/*! ./../../../manipulators/index.js */ "./manipulators/index.js"), r = n(/*! ./../../../manipulators/anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), l = n(/*! ./../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), s = n(/*! ../../../util/triggerEvent.js */ "./util/triggerEvent.js"), u = n(/*! ../../../util/getActiveTool */ "./util/getActiveTool.js"), d = n(/*! ../BidirectionalTool */ "./tools/annotation/BidirectionalTool.js"), c = n(/*! ./utils/updatePerpendicularLineHandles.js */ "./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js"); t.default = function (e, t) { var n = this, g = e.detail, m = g.element, h = g.image, v = g.buttons, p = this.configuration; if (!f(h)) { var x = this.createNewMeasurement(g), $ = function e() { x.active = !1, a.default.cornerstone.updateImage(m) }; Object(l.addToolState)(m, this.name, x), a.default.cornerstone.updateImage(m); var y = new Date().getTime(), T = x.handles, b = T.end, _ = T.perpendicularStart; Object(i.moveNewHandle)(g, this.name, x, b, {}, t, function (e) { if (!e) { Object(l.removeToolState)(m, n.name, x); return } var i = x.handles, f = x.longestDiameter, T = x.shortestDiameter, b = Object(r.default)(g, i), C = parseFloat(f) || 0, j = parseFloat(T) || 0, S = new Date().getTime() - y < 150; b || C < 1 || j < 1 || S ? (x.cancelled = !0, Object(l.removeToolState)(m, n.name, x)) : p.getMeasurementLocationCallback(x, g, $), Object(c.default)(g, x), _.locked = !1, x.invalidated = !0, a.default.cornerstone.updateImage(m); var w = Object(u.default)(m, v, t); w instanceof d.default && w.updateCachedStats(h, m, x); var M = { toolName: n.name, toolType: n.name, element: m, measurementData: x }; Object(s.default)(m, o.default.MEASUREMENT_MODIFIED, M), Object(s.default)(m, o.default.MEASUREMENT_COMPLETED, M) }) } }; var f = function e(t) { var n = a.default.cornerstone.metaData.get("imagePlaneModule", t.imageId), o = t.rowPixelSpacing, i = t.columnPixelSpacing; return n && (o = n.rowPixelSpacing || n.rowImagePixelSpacing, i = n.columnPixelSpacing || n.colImagePixelSpacing), !o || !i } }, "./tools/annotation/bidirectionalTool/createNewMeasurement.js": function (e, t, n) { "use strict"; n.r(t); var a = function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {}; return Object.assign({ x: t, y: n, index: a, drawnIndependently: !1, allowedOutsideImage: !1, highlight: !0, active: !1 }, o) }; t.default = function (e) { var t = e.currentPoints.image, n = t.x, o = t.y; return { toolName: this.name, toolType: this.name, isCreating: !0, visible: !0, active: !0, invalidated: !0, handles: { start: a(n, o, 0), end: a(n, o, 1, { active: !0 }), perpendicularStart: a(n, o, 2, { locked: !0 }), perpendicularEnd: a(n, o, 3), textBox: a(n - 50, o - 70, null, { highlight: !1, hasMoved: !0, active: !1, movesIndependently: !1, drawnIndependently: !0, allowedOutsideImage: !0, hasBoundingBox: !0 }) }, longestDiameter: 0, shortestDiameter: 0 } } }, "./tools/annotation/bidirectionalTool/handleSelectedCallback.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { var a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse"; "touch" === a ? this.handleSelectedTouchCallback(e) : this.handleSelectedMouseCallback(e) } }, "./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = n(/*! ./../../../externalModules.js */ "./externalModules.js"), r = n(/*! ./../../../events.js */ "./events.js"), l = n(/*! ./../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), s = n(/*! ./../../../manipulators/anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), u = n(/*! ./../../../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), d = n(/*! ./../../../manipulators/index.js */ "./manipulators/index.js"), c = n(/*! ./moveHandle/moveHandle.js */ "./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js"), f = n(/*! ./invertHandles.js */ "./tools/annotation/bidirectionalTool/invertHandles.js"), g = n(/*! ../../../store/setToolCursor.js */ "./store/setToolCursor.js"), m = n(/*! ../../../util/getProximityThreshold.js */ "./util/getProximityThreshold.js"); t.default = function (e) { var t, n = this, a = e.detail, x = a.element, $ = Object(m.default)("mouse", this.name), y = function e(o) { t.invalidated = !0, Object(s.default)(a, t.handles) && Object(l.removeToolState)(x, n.name, t), o && (o.moving = !1, o.selected = !0), Object(g.setToolCursor)(n.element, n.svgCursor), i.default.cornerstone.updateImage(x), x.addEventListener(r.default.MOUSE_MOVE, n._moveCallback), x.addEventListener(r.default.TOUCH_START, n._moveCallback) }, T = a.startPoints.canvas, b = Object(l.getToolState)(e.currentTarget, this.name); if (b) { for (var _ = function o(i) { var l = [x, (t = b.data[i]).handles, T, $], s = u.default.apply(void 0, l); if (s) return x.removeEventListener(r.default.MOUSE_MOVE, n._moveCallback), x.removeEventListener(r.default.TOUCH_START, n._moveCallback), t.active = !0, h(t.handles), s.moving = !0, (s = Object(f.default)(a, t, s)).hasBoundingBox || Object(g.hideToolCursor)(n.element), Object(c.default)(a, n.name, t, s, function () { return y(s) }), p(e), { v: !0 } }, C = 0; C < b.data.length; C++) { var j = _(C); if ("object" === o()(j)) return j.v } for (var S = function e(t) { return function () { v(t, !1), y() } }, C = 0; C < b.data.length; C++)if (t = b.data[C], this.pointNearTool(x, t, T, "mouse")) { x.removeEventListener(r.default.MOUSE_MOVE, this._moveCallback), x.removeEventListener(r.default.TOUCH_START, this._moveCallback), t.active = !0, h(t.handles), v(t.handles, !0); var w = S(t.handles); return Object(d.moveAllHandles)(a, this.name, t, null, { deleteIfHandleOutsideImage: !0, preventHandleOutsideImage: !1 }, "mouse", w), p(e), !0 } } }; var h = function e(t) { var n = !1; return Object.keys(t).forEach(function (e) { "textBox" !== e && (t[e].selected = !1, n = t[e].active || n, t[e].active = !1) }), n }, v = function e(t, n) { Object.keys(t).forEach(function (e) { "textBox" !== e && (t[e].moving = n) }) }, p = function e(t) { t.stopImmediatePropagation(), t.stopPropagation(), t.preventDefault() } }, "./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = n(/*! ./../../../externalModules.js */ "./externalModules.js"), r = n(/*! ../../../store/index.js */ "./store/index.js"), l = n(/*! ./../../../events.js */ "./events.js"), s = n(/*! ./../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), u = n(/*! ./../../../manipulators/anyHandlesOutsideImage.js */ "./manipulators/anyHandlesOutsideImage.js"), d = n(/*! ./../../../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), c = n(/*! ./../../../manipulators/index.js */ "./manipulators/index.js"), f = n(/*! ./moveHandle/touchMoveHandle.js */ "./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js"); t.default = function (e) { var t, n = this, a = e.detail, v = a.element, p = r.state.touchProximity, x = function e(o) { t.invalidated = !0, Object(u.default)(a, t.handles) && Object(s.removeToolState)(v, n.name, t), o && (o.moving = !1, o.selected = !0), i.default.cornerstone.updateImage(v), v.addEventListener(l.default.TOUCH_DRAG, n._moveCallback) }, $ = a.startPoints.canvas, y = Object(s.getToolState)(e.currentTarget, this.name); if (y) { for (var T = function o(i) { var r = [v, (t = y.data[i]).handles, $, p], s = d.default.apply(void 0, r); if (s) return v.removeEventListener(l.default.TOUCH_DRAG, n._moveCallback), t.active = !0, g(t.handles), s.moving = !0, Object(f.default)(a, n.name, t, s, function () { return x(s) }), h(e), { v: !0 } }, b = 0; b < y.data.length; b++) { var _ = T(b); if ("object" === o()(_)) return _.v } for (var C = function e(t) { return function () { m(t, !1), x() } }, b = 0; b < y.data.length; b++)if (t = y.data[b], this.pointNearTool(v, t, $, "touch")) { v.removeEventListener(l.default.TOUCH_DRAG, this._moveCallback), t.active = !0, g(t.handles), m(t.handles, !0); var j = C(t.handles); return Object(c.moveAllHandles)(a, this.name, t, null, { deleteIfHandleOutsideImage: !0, preventHandleOutsideImage: !1 }, "touch", j), h(e), !0 } } }; var g = function e(t) { var n = !1; return Object.keys(t).forEach(function (e) { "textBox" !== e && (t[e].selected = !1, n = t[e].active || n, t[e].active = !1) }), n }, m = function e(t, n) { Object.keys(t).forEach(function (e) { "textBox" !== e && (t[e].moving = n) }) }, h = function e(t) { t.stopImmediatePropagation(), t.stopPropagation(), t.preventDefault() } }, "./tools/annotation/bidirectionalTool/invertHandles.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = function e(t, n, a) { var o = t[a], i = n[a]; t[a] = i, n[a] = o }, o = function e(t, n) { a(t, n, "x"), a(t, n, "y"), a(t, n, "moving"), a(t, n, "hover"), a(t, n, "active"), a(t, n, "selected") }; function i(e, t, n) { var a = e.image, i = a.rowPixelSpacing, r = a.columnPixelSpacing, l = t.handles, s = l.start, u = l.end, d = l.perpendicularStart, c = l.perpendicularEnd, f = (s.x - u.x) * (r || 1), g = (s.y - u.y) * (i || 1), m = (d.x - c.x) * (r || 1), h = (d.y - c.y) * (i || 1); return (Math.sqrt(m * m + h * h) || 0) > Math.sqrt(f * f + g * g) ? (o(s, u), o(s, d), o(u, c), Object.values(l).find(function (e) { return !0 === e.moving })) : n } }, "./tools/annotation/bidirectionalTool/mouseMoveCallback.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../../externalModules.js */ "./externalModules.js"), o = n(/*! ./../../../stateManagement/toolCoordinates.js */ "./stateManagement/toolCoordinates.js"), i = n(/*! ./../../../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), r = n(/*! ./../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), l = function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 6, r = Object(i.default)(t, n, a, o), l = !1; return Object.keys(n).forEach(function (e) { if ("textBox" !== e) { var t = n[e], a = t === r; t.active !== a && (l = !0), t.active = a } }), l }; t.default = function (e) { var t = this, n = e.detail, i = n.element; o.default.setCoords(n); var s = Object(r.getToolState)(i, this.name); if (s) { for (var u = !1, d = 0; d < s.data.length; d++)!function e(a) { var o = n.currentPoints.canvas, r = s.data[a], d = l(i, r.handles, o); Object.keys(r.handles).forEach(function (e) { if ("textBox" !== e) { var t = r.handles[e]; t.hover = t.active } }), d && (u = !0); var c = t.pointNearTool(i, r, o, "mouse"), f = c && !r.active, g = !c && r.active; (f || g) && (r.active = !r.active, u = !0) }(d); !0 === u && a.default.cornerstone.updateImage(i) } } }, "./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return r }); var a = n(/*! ../../../../externalModules.js */ "./externalModules.js"), o = n(/*! ../utils/getDistanceWithPixelSpacing.js */ "./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"); function i(e, t) { return { start: e, end: t } } function r(e, t, n) { var r = a.default.cornerstoneMath.lineSegment, l = e.handles, s = l.start, u = l.end, d = l.perpendicularStart, c = l.perpendicularEnd, f = t.image, g = f.columnPixelSpacing, m = void 0 === g ? 1 : g, h = f.rowPixelSpacing, v = void 0 === h ? 1 : h, p = i(s, u), x = i(d, c), $ = r.intersectLine(p, x), y = Object(o.default)(m, v, n, $); return { columnPixelSpacing: m, rowPixelSpacing: v, start: s, end: u, perpendicularStart: d, perpendicularEnd: c, longLine: p, intersection: $, distanceToFixed: y, fixedPoint: n } } }, "./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../../../externalModules.js */ "./externalModules.js"), o = n(/*! ../../../../store/index.js */ "./store/index.js"), i = n(/*! ./../../../../events.js */ "./events.js"), r = n(/*! ./setHandlesPosition.js */ "./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"), l = n(/*! ../../../../util/getActiveTool */ "./util/getActiveTool.js"), s = n(/*! ../../../base/BaseAnnotationTool */ "./tools/base/BaseAnnotationTool.js"); t.default = function (e, t, n, u, d, c) { var f = e.element, g = e.image, m = e.buttons, h = { x: u.x - e.currentPoints.image.x, y: u.y - e.currentPoints.image.y }, v = function e(o) { var d = o.detail; u.hasMoved = !0, void 0 === u.index || null === u.index ? (u.x = d.currentPoints.image.x + h.x, u.y = d.currentPoints.image.y + h.y) : Object(r.default)(u, d, n, h), c && (u.x = Math.max(u.x, 0), u.x = Math.min(u.x, d.image.width), u.y = Math.max(u.y, 0), u.y = Math.min(u.y, d.image.height)), n.invalidated = !0, a.default.cornerstone.updateImage(f); var v = Object(l.default)(f, m, "mouse"); v instanceof s.default && v.updateCachedStats(g, f, n), a.default.cornerstone.triggerEvent(f, i.default.MEASUREMENT_MODIFIED, { toolName: t, toolType: t, element: f, measurementData: n }) }; u.active = !0, u.moving = !0, o.state.isToolLocked = !0, f.addEventListener(i.default.MOUSE_DRAG, v), f.addEventListener(i.default.TOUCH_DRAG, v); var p = a.default.cornerstone.getImage(f), x = function e() { a.default.cornerstone.getImage(f).imageId !== p.imageId && $() }; f.addEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED, x); var $ = function e() { u.active = !1, o.state.isToolLocked = !1, f.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED, x), f.removeEventListener(i.default.MOUSE_DRAG, v), f.removeEventListener(i.default.MOUSE_UP, e), f.removeEventListener(i.default.MOUSE_CLICK, e), f.removeEventListener(i.default.TOUCH_DRAG, v), f.removeEventListener(i.default.TOUCH_DRAG_END, e), f.removeEventListener(i.default.TAP, e), a.default.cornerstone.updateImage(f), "function" == typeof d && d() }; f.addEventListener(i.default.MOUSE_UP, $), f.addEventListener(i.default.MOUSE_CLICK, $), f.addEventListener(i.default.TOUCH_DRAG_END, $), f.addEventListener(i.default.TAP, $) } }, "./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return r }); var a = n(/*! ../../utils/getDistanceWithPixelSpacing.js */ "./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"), o = n(/*! ../getBaseData.js */ "./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"), i = n(/*! ./updatePerpendicularLine.js */ "./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js"); function r(e, t, n, r) { var l = Object(o.default)(t, n, r), s = l.columnPixelSpacing, u = l.rowPixelSpacing, d = l.distanceToFixed, c = Object(a.default)(s, u, r, e); if (c <= d) return !1; var f = d / c, g = { x: r.x + (e.x - r.x) * f, y: r.y + (e.y - r.y) * f }, m = Object(i.default)(l, g); return t.handles.perpendicularStart.x = m.start.x, t.handles.perpendicularStart.y = m.start.y, t.handles.perpendicularEnd.x = m.end.x, t.handles.perpendicularEnd.y = m.end.y, !0 } }, "./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! ../../utils/getLineVector */ "./tools/annotation/bidirectionalTool/utils/getLineVector.js"), o = n(/*! ../../utils/getDistanceWithPixelSpacing */ "./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"); function i(e, t) { var n = e.columnPixelSpacing, i = e.rowPixelSpacing, r = e.start, l = e.perpendicularStart, s = e.perpendicularEnd, u = e.intersection, d = e.fixedPoint, c = Object(o.default)(n, i, l, u), f = Object(o.default)(n, i, s, u), g = Object(a.default)(n, i, d, t), m = d === r ? 1 : -1, h = m * i, v = m * n; return { start: { x: t.x + g.y * c * h, y: t.y + -(g.x * c * v * 1) }, end: { x: t.x + -(g.y * f * h * 1), y: t.y + g.x * f * v } } } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ./isPerpendicularEndFixed.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js"); function o(e, t) { return Object(a.default)(e, t) ? -1 : 1 } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ./getDirectionMultiplier */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js"); function o(e, t, n) { var o = e.columnPixelSpacing, i = e.rowPixelSpacing, r = e.perpendicularEnd, l = e.fixedPoint, s = Number.MAX_SAFE_INTEGER, u = Object(a.default)(l, r) * s; return { start: t, end: { x: t.x + n.y * i * u, y: t.y + -(n.x * o * u * 1) } } } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ./isPerpendicularEndFixed.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js"); function o(e, t, n) { return Object(a.default)(e, n) ? t : n } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js": function (e, t, n) { "use strict"; function a(e, t) { return e === t } n.r(t), n.d(t, "default", function () { return a }) }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../../utils/getDistanceWithPixelSpacing */ "./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"); function o(e, t, n) { return 0 !== Object(a.default)(e, t, n.start, n.end) } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return u }); var a = n(/*! ./../../../../../externalModules.js */ "./externalModules.js"), o = n(/*! ../../utils/getLineVector.js */ "./tools/annotation/bidirectionalTool/utils/getLineVector.js"), i = n(/*! ../getBaseData.js */ "./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"), r = n(/*! ./lineHasLength.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js"), l = n(/*! ./getHelperLine.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js"), s = n(/*! ./updatePerpendicularLine.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js"); function u(e, t, n, u) { var d = a.default.cornerstoneMath.lineSegment, c = Object(i.default)(t, n, u), f = c.columnPixelSpacing, g = c.rowPixelSpacing, m = c.start, h = c.longLine, v = c.intersection; if (!Object(r.default)(f, g, h)) return !1; var p = Object(o.default)(f, g, m, v), x = Object(l.default)(c, e, p), $ = d.intersectLine(h, x); if (!$) return !1; var y = Object(s.default)(c, $, x, p); return t.handles.perpendicularStart.x = y.start.x, t.handles.perpendicularStart.y = y.start.y, t.handles.perpendicularEnd.x = y.end.x, t.handles.perpendicularEnd.y = y.end.y, !0 } }, "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return l }); var a = n(/*! @babel/runtime/helpers/defineProperty */ "../node_modules/@babel/runtime/helpers/defineProperty.js"), o = n.n(a), i = n(/*! ./getDirectionMultiplier */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js"), r = n(/*! ./getMovingPoint */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js"); function l(e, t, n, a) { var l, s = e.columnPixelSpacing, u = e.rowPixelSpacing, d = e.fixedPoint, c = e.perpendicularStart, f = e.perpendicularEnd, g = e.distanceToFixed, m = Object(i.default)(d, f) * g, h = Object(r.default)(d, c, f) === c; return l = {}, o()(l, h ? "start" : "end", { x: n.start.x, y: n.start.y }), o()(l, h ? "end" : "start", { x: t.x + a.y * u * m, y: t.y + -(a.x * s * m * 1) }), l } }, "./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../../../externalModules.js */ "./externalModules.js"), o = n(/*! ./moveLongLine/moveLongLine.js */ "./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js"), i = n(/*! ./movePerpendicularLine/movePerpendicularLine.js */ "./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js"); t.default = function (e, t, n, r) { var l, s, u, d, c, f, g = {}, m = {}, h = { x: t.currentPoints.image.x + r.x, y: t.currentPoints.image.y + r.y }; 0 === e.index ? (u = Object(o.default)(h, n, t, n.handles.end)) ? (e.x = h.x, e.y = h.y) : (t.currentPoints.image.x = e.x, t.currentPoints.image.y = e.y) : 1 === e.index ? (u = Object(o.default)(h, n, t, n.handles.start)) ? (e.x = h.x, e.y = h.y) : (t.currentPoints.image.x = e.x, t.currentPoints.image.y = e.y) : 2 === e.index ? (s = !1, g.start = { x: n.handles.start.x, y: n.handles.start.y }, g.end = { x: n.handles.end.x, y: n.handles.end.y }, m.start = { x: n.handles.perpendicularEnd.x, y: n.handles.perpendicularEnd.y }, m.end = { x: h.x, y: h.y }, (d = a.default.cornerstoneMath.lineSegment.intersectLine(g, m)) || (m.end = { x: n.handles.perpendicularStart.x, y: n.handles.perpendicularStart.y }, d = a.default.cornerstoneMath.lineSegment.intersectLine(g, m), c = a.default.cornerstoneMath.point.distance(d, n.handles.start), f = a.default.cornerstoneMath.point.distance(d, n.handles.end), (!d || c < 3 || f < 3) && (s = !0)), l = !1, s || (l = Object(i.default)(h, n, t, n.handles.perpendicularEnd)) || (t.currentPoints.image.x = n.handles.perpendicularStart.x, t.currentPoints.image.y = n.handles.perpendicularStart.y)) : 3 !== e.index || (s = !1, g.start = { x: n.handles.start.x, y: n.handles.start.y }, g.end = { x: n.handles.end.x, y: n.handles.end.y }, m.start = { x: n.handles.perpendicularStart.x, y: n.handles.perpendicularStart.y }, m.end = { x: h.x, y: h.y }, (d = a.default.cornerstoneMath.lineSegment.intersectLine(g, m)) || (m.end = { x: n.handles.perpendicularEnd.x, y: n.handles.perpendicularEnd.y }, d = a.default.cornerstoneMath.lineSegment.intersectLine(g, m), c = a.default.cornerstoneMath.point.distance(d, n.handles.start), f = a.default.cornerstoneMath.point.distance(d, n.handles.end), (!d || c < 3 || f < 3) && (s = !0)), l = !1, s || (l = Object(i.default)(h, n, t, n.handles.perpendicularStart)) || (t.currentPoints.image.x = n.handles.perpendicularEnd.x, t.currentPoints.image.y = n.handles.perpendicularEnd.y)) } }, "./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../../../externalModules.js */ "./externalModules.js"), o = n(/*! ../../../../store/index.js */ "./store/index.js"), i = n(/*! ./../../../../events.js */ "./events.js"), r = n(/*! ./setHandlesPosition.js */ "./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"), l = n(/*! ../../../../util/getActiveTool */ "./util/getActiveTool.js"), s = n(/*! ../../../base/BaseAnnotationTool */ "./tools/base/BaseAnnotationTool.js"), u = [i.default.TOUCH_END, i.default.TOUCH_DRAG_END, i.default.TOUCH_PINCH, i.default.TOUCH_PRESS, i.default.TAP]; t.default = function (e, t, n, d, c, f) { var g = e.element, m = e.image, h = e.buttons, v = { x: d.x - e.currentPoints.image.x, y: d.y - e.currentPoints.image.y }, p = function e(o) { var u = o.detail; d.hasMoved = !0, void 0 === d.index || null === d.index ? (d.x = u.currentPoints.image.x + v.x, d.y = u.currentPoints.image.y + v.y) : Object(r.default)(d, u, n, v), f && (d.x = Math.max(d.x, 0), d.x = Math.min(d.x, u.image.width), d.y = Math.max(d.y, 0), d.y = Math.min(d.y, u.image.height)), n.invalidated = !0, a.default.cornerstone.updateImage(g); var c = Object(l.default)(g, h, "touch"); c instanceof s.default && c.updateCachedStats(m, g, n), a.default.cornerstone.triggerEvent(g, i.default.MEASUREMENT_MODIFIED, { toolName: t, toolType: t, element: g, measurementData: n }) }; d.active = !0, o.state.isToolLocked = !0, g.addEventListener(i.default.TOUCH_DRAG, p); var x = function e() { d.active = !1, o.state.isToolLocked = !1, g.removeEventListener(i.default.TOUCH_DRAG, p), u.forEach(function (t) { g.removeEventListener(t, e) }), a.default.cornerstone.updateImage(g), "function" == typeof c && c() }; u.forEach(function (e) { g.addEventListener(e, x) }) } }, "./tools/annotation/bidirectionalTool/pointNearTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../../util/getProximityThreshold.js */ "./util/getProximityThreshold.js"), o = n(/*! ./../../../externalModules.js */ "./externalModules.js"), i = n(/*! ./../../../util/pointInsideBoundingBox.js */ "./util/pointInsideBoundingBox.js"), r = function e(t, n, a, i) { var r = o.default.cornerstone, l = o.default.cornerstoneMath, s = { start: r.pixelToCanvas(t, n.perpendicularStart), end: r.pixelToCanvas(t, n.perpendicularEnd) }; return l.lineSegment.distanceToPoint(s, a) < i }; t.default = function (e, t, n) { var l = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse", s = o.default.cornerstone, u = o.default.cornerstoneMath, d = t.handles, c = { start: s.pixelToCanvas(e, d.start), end: s.pixelToCanvas(e, d.end) }, f = u.lineSegment.distanceToPoint(c, n); if (Object(i.default)(d.textBox, n)) return !0; var g = Object(a.default)(l, "Bidirectional"); return !!r(e, d, n, g) || f < g } }, "./tools/annotation/bidirectionalTool/renderToolData.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ./../../../drawing/drawHandles.js */ "./drawing/drawHandles.js"), r = n(/*! ./utils/updatePerpendicularLineHandles.js */ "./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js"), l = n(/*! ../../../store/index */ "./store/index.js"), s = n(/*! ./../../../stateManagement/toolStyle.js */ "./stateManagement/toolStyle.js"), u = n(/*! ./../../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), d = n(/*! ./../../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), c = n(/*! ./../../../drawing/index.js */ "./drawing/index.js"), f = n(/*! ./../../../drawing/drawLinkedTextBox.js */ "./drawing/drawLinkedTextBox.js"), g = n(/*! ../../../util/getPixelSpacing */ "./util/getPixelSpacing.js"); t.default = function (e) { var t, n = this, a = e.detail, o = a.element, h = a.canvasContext, v = a.image, p = this.configuration, x = p.handleRadius, $ = p.drawHandlesOnHover, y = p.hideHandlesIfMoving, T = p.renderDashed, b = Object(l.getModule)("globalConfiguration").configuration.lineDash, _ = Object(d.getToolState)(o, this.name); if (_) { var C = Object(g.default)(v), j = C.rowPixelSpacing, S = C.colPixelSpacing; if (j && S) { for (var w = Object(c.getNewContext)(h.canvas), M = u.default.getActiveColor(), E = s.default.getToolWidth(), I = 0; I < _.data.length; I++)if ("continue" === function e(l) { var s = _.data[l]; if (!1 === s.visible) return "continue"; t = s.active ? M : u.default.getToolColor(), !0 === s.invalidated && (s.longestDiameter && s.shortestDiameter ? n.throttledUpdateCachedStats(v, o, s) : n.updateCachedStats(v, o, s)), Object(c.draw)(w, function (e) { Object(c.setShadow)(e, n.configuration); var l = s.handles, u = l.start, d = l.end, g = l.perpendicularStart, h = l.perpendicularEnd, v = l.textBox, p = { color: t }, _ = { color: t, strokeWidth: C }; T && (p.lineDash = b, _.lineDash = b), Object(c.drawLine)(e, o, u, d, p); var C = E; Object(r.default)(a, s), Object(c.drawLine)(e, o, g, h, _); var w = { color: t, handleRadius: x, drawHandlesIfActive: $, hideHandlesIfMoving: y }; n.configuration.drawHandles && Object(i.default)(e, a, s.handles, w); var M = function e(t) { return [t.start, t.end, t.perpendicularStart, t.perpendicularEnd] }, I = m(s, j, S); Object(f.default)(e, o, v, I, s.handles, M, t, E, 10, !0) }) }(I)) continue } } }; var m = function e(t, n, a) { var i = " mm"; n && a || (i = " pixels"); var r = " L ".concat(t.longestDiameter).concat(i), l = " W ".concat(t.shortestDiameter).concat(i), s = t.labels; return s && Array.isArray(s) ? [].concat(o()(s), [r, l]) : [r, l] } }, "./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js": function (e, t, n) { "use strict"; function a(e, t) { var n = t.rowPixelSpacing, a = t.colPixelSpacing, o = e.handles, i = o.start, r = o.end, l = o.perpendicularStart, s = o.perpendicularEnd, u = (i.x - r.x) * (a || 1), d = (i.y - r.y) * (n || 1), c = Math.sqrt(u * u + d * d), f = (l.x - s.x) * (a || 1), g = (l.y - s.y) * (n || 1), m = Math.sqrt(f * f + g * g); if (m || (m = 0), m > c) { var h = c; c = m, m = h } return { longestDiameter: c.toFixed(1), shortestDiameter: m.toFixed(1) } } n.r(t), n.d(t, "default", function () { return a }) }, "./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js": function (e, t, n) { "use strict"; function a(e, t, n, a) { var o = (n.x - a.x) / t, i = (n.y - a.y) / e; return Math.sqrt(o * o + i * i) } n.r(t), n.d(t, "default", function () { return a }) }, "./tools/annotation/bidirectionalTool/utils/getLineVector.js": function (e, t, n) { "use strict"; function a(e, t, n, a) { var o = (n.x - a.x) * e, i = (n.y - a.y) * t, r = Math.sqrt(o * o + i * i); return { x: o / r, y: i / r, length: r } } n.r(t), n.d(t, "default", function () { return a }) }, "./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ./getLineVector */ "./tools/annotation/bidirectionalTool/utils/getLineVector.js"); function o(e, t) { if (!t.handles.perpendicularStart.locked) return !1; var n, o, i, r, l = t.handles, s = l.start, u = l.end, d = e.image, c = d.columnPixelSpacing, f = void 0 === c ? 1 : c, g = d.rowPixelSpacing, m = void 0 === g ? 1 : g; if (s.x === u.x && s.y === u.y) n = s.x, o = s.y, i = u.x, r = u.y; else { var h = { x: (s.x + u.x) / 2, y: (s.y + u.y) / 2 }, v = Object(a.default)(f, m, s, u), p = v.length / 2, x = p / (2 * m), $ = p / (2 * f); n = h.x + $ * v.y, o = h.y - x * v.x, i = h.x - $ * v.y, r = h.y + x * v.x } return t.handles.perpendicularStart.x = n, t.handles.perpendicularStart.y = o, t.handles.perpendicularEnd.x = i, t.handles.perpendicularEnd.y = r, !0 } }, "./tools/annotation/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./AngleTool.js */ "./tools/annotation/AngleTool.js"), o = n(/*! ./ArrowAnnotateTool.js */ "./tools/annotation/ArrowAnnotateTool.js"), i = n(/*! ./BidirectionalTool.js */ "./tools/annotation/BidirectionalTool.js"), r = n(/*! ./CircleRoiTool.js */ "./tools/annotation/CircleRoiTool.js"), l = n(/*! ./CobbAngleTool.js */ "./tools/annotation/CobbAngleTool.js"), s = n(/*! ./EllipticalRoiTool.js */ "./tools/annotation/EllipticalRoiTool.js"), u = n(/*! ./FreehandRoiTool.js */ "./tools/annotation/FreehandRoiTool.js"), d = n(/*! ./LengthTool.js */ "./tools/annotation/LengthTool.js"), c = n(/*! ./ProbeTool.js */ "./tools/annotation/ProbeTool.js"), f = n(/*! ./RectangleRoiTool.js */ "./tools/annotation/RectangleRoiTool.js"), g = n(/*! ./TextMarkerTool.js */ "./tools/annotation/TextMarkerTool.js"); n.d(t, "AngleTool", function () { return a.default }), n.d(t, "ArrowAnnotateTool", function () { return o.default }), n.d(t, "BidirectionalTool", function () { return i.default }), n.d(t, "CircleRoiTool", function () { return r.default }), n.d(t, "CobbAngleTool", function () { return l.default }), n.d(t, "EllipticalRoiTool", function () { return s.default }), n.d(t, "FreehandRoiTool", function () { return u.default }), n.d(t, "LengthTool", function () { return d.default }), n.d(t, "ProbeTool", function () { return c.default }), n.d(t, "RectangleRoiTool", function () { return f.default }), n.d(t, "TextMarkerTool", function () { return g.default }), t.default = { AngleTool: a.default, ArrowAnnotateTool: o.default, BidirectionalTool: i.default, CircleRoiTool: r.default, CobbAngleTool: l.default, EllipticalRoiTool: s.default, FreehandRoiTool: u.default, LengthTool: d.default, ProbeTool: c.default, RectangleRoiTool: f.default, TextMarkerTool: g.default } }, "./tools/base/BaseAnnotationTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), f = n.n(c), g = n(/*! ./BaseTool.js */ "./tools/base/BaseTool.js"), m = n(/*! ./../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), h = n(/*! ./../../manipulators/handleActivator.js */ "./manipulators/handleActivator.js"), v = n(/*! ./../../util/findAndMoveHelpers.js */ "./util/findAndMoveHelpers.js"), p = Object(n(/*! ../../util/logger */ "./util/logger.js").getLogger)("baseAnnotationTool"), x = function (e) { function t() { return o()(this, t), s()(this, d()(t).apply(this, arguments)) } return f()(t, e), r()(t, [{ key: "createNewMeasurement", value: function e(t) { throw Error("Method createNewMeasurement not implemented for ".concat(this.name, ".")) } }, { key: "pointNearTool", value: function e(t, n, a) { throw arguments.length > 3 && void 0 !== arguments[3] && arguments[3], Error("Method pointNearTool not implemented for ".concat(this.name, ".")) } }, { key: "distanceFromPoint", value: function e(t, n, a) { throw Error("Method distanceFromPoint not implemented for ".concat(this.name, ".")) } }, { key: "renderToolData", value: function e(t) { throw Error("renderToolData not implemented for ".concat(this.name, ".")) } }, { key: "mouseMoveCallback", value: function e(t) { for (var n = t.detail, a = n.element, o = n.currentPoints.canvas, i = Object(m.getToolState)(a, this.name), r = !1, l = 0; l < i.data.length; l++) { var s = i.data[l]; !0 === Object(h.default)(a, s.handles, o) && (r = !0); var u = this.pointNearTool(a, s, o, "mouse") && !s.active, d = !this.pointNearTool(a, s, o, "mouse") && s.active; (u || d) && (s.active = !s.active, r = !0) } return r } }, { key: "handleSelectedCallback", value: function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse"; Object(v.moveHandleNearImagePoint)(t, this, n, a, o) } }, { key: "toolSelectedCallback", value: function e(t, n) { var a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "mouse"; Object(v.moveAnnotation)(t, this, n, a) } }, { key: "updateCachedStats", value: function e(t, n, a) { p.warn("updateCachedStats not implemented for ".concat(this.name, ".")) } }]), t }(g.default); t.default = x }, "./tools/base/BaseBrushTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./BaseTool.js */ "./tools/base/BaseTool.js"), v = n(/*! ./../../events.js */ "./events.js"), p = n(/*! ./../../externalModules.js */ "./externalModules.js"), x = n(/*! ./../../store/isToolActiveForElement.js */ "./store/isToolActiveForElement.js"), $ = n(/*! ./../../store/index.js */ "./store/index.js"), y = n(/*! ../../util/segmentation */ "./util/segmentation/index.js"), T = Object($.getModule)("segmentation"), b = function (e) { function t(e) { var n, a = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; return o()(this, t), a.configuration || (a.configuration = { alwaysEraseOnClick: !1 }), (n = s()(this, d()(t).call(this, e, a))).updateOnMouseMove = !0, n.hideDefaultCursor = !0, n._drawing = !1, n._drawingMouseUpCallback = n._drawingMouseUpCallback.bind(f()(n)), n } return m()(t, e), r()(t, [{ key: "renderBrush", value: function e(t) { throw Error("Method renderBrush not implemented for ".concat(this.name, ".")) } }, { key: "_paint", value: function e(t) { throw Error("Method _paint not implemented for ".concat(this.name, ".")) } }, { key: "mouseDragCallback", value: function e(t) { var n = t.detail.currentPoints; this._lastImageCoords = n.image, this._drawing && this._paint(t) } }, { key: "preMouseDownCallback", value: function e(t) { var n = t.detail, a = n.element, o = n.currentPoints; return this._startPainting(t), this._lastImageCoords = o.image, this._drawing = !0, this._startListeningForMouseUp(a), this._paint(t), !0 } }, { key: "_startPainting", value: function e(t) { var n = t.detail, a = n.element, o = T.configuration, i = T.getters.labelmap2D(a), r = i.labelmap2D, l = i.labelmap3D, s = i.currentImageIdIndex, u = i.activeLabelmapIndex, d = this._isCtrlDown(n) || this.configuration.alwaysEraseOnClick; if (this.paintEventData = { labelmap2D: r, labelmap3D: l, currentImageIdIndex: s, activeLabelmapIndex: u, shouldErase: d }, o.storeHistory) { var c = r.pixelData.slice(); this.paintEventData.previousPixelData = c } } }, { key: "_endPainting", value: function e(t) { for (var n = T.configuration, a = T.setters, o = this.paintEventData, i = o.labelmap2D, r = o.currentImageIdIndex, l = new Set(i.pixelData).values(), s = [], u = !1; !u;) { var d = l.next(); (u = d.done) || s.push(d.value) } if (i.segmentsOnLabelmap = s, n.storeHistory) { var c = this.paintEventData.previousPixelData, f = i.pixelData, g = { imageIdIndex: r, diff: Object(y.getDiffBetweenPixelData)(c, f) }; a.pushState(this.element, [g]) } Object(y.triggerLabelmapModifiedEvent)(this.element) } }, { key: "mouseMoveCallback", value: function e(t) { var n = t.detail.currentPoints; this._lastImageCoords = n.image } }, { key: "renderToolData", value: function e(t) { var n = t.detail.element; Object(x.default)(n, this.name) && this.renderBrush(t) } }, { key: "passiveCallback", value: function e(t) { try { p.default.cornerstone.updateImage(this.element) } catch (n) { return } } }, { key: "_drawingMouseUpCallback", value: function e(t) { var n = t.detail.element; this._endPainting(t), this._drawing = !1, this._mouseUpRender = !0, this._stopListeningForMouseUp(n) } }, { key: "newImageCallback", value: function e(t) { this._drawing && (this._endPainting(t), this._startPainting(t)) } }, { key: "_startListeningForMouseUp", value: function e(t) { t.removeEventListener(v.default.MOUSE_UP, this._drawingMouseUpCallback), t.removeEventListener(v.default.MOUSE_CLICK, this._drawingMouseUpCallback), t.addEventListener(v.default.MOUSE_UP, this._drawingMouseUpCallback), t.addEventListener(v.default.MOUSE_CLICK, this._drawingMouseUpCallback), p.default.cornerstone.updateImage(t) } }, { key: "_stopListeningForMouseUp", value: function e(t) { t.removeEventListener(v.default.MOUSE_UP, this._drawingMouseUpCallback), t.removeEventListener(v.default.MOUSE_CLICK, this._drawingMouseUpCallback), p.default.cornerstone.updateImage(t) } }, { key: "increaseBrushSize", value: function e() { var t = T.configuration, n = T.setters, a = t.radius, o = Math.floor(1.2 * a); o === a && (o += 1), n.radius(o) } }, { key: "decreaseBrushSize", value: function e() { var t = T.configuration, n = T.setters, a = t.radius; n.radius(Math.floor(.8 * a)) } }, { key: "_isCtrlDown", value: function e(t) { return t.event && t.event.ctrlKey || t.ctrlKey } }]), t }(h.default); t.default = b }, "./tools/base/BaseTool.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), s = n.n(l), u = n(/*! ./../../mixins/index.js */ "./mixins/index.js"), d = n(/*! ../../util/logger.js */ "./util/logger.js"), c = n(/*! ./../../util/deepmerge.js */ "./util/deepmerge.js"), f = n(/*! ../../store/setToolCursor.js */ "./store/setToolCursor.js"), g = n(/*! ../../store */ "./store/index.js"), m = Object(d.getLogger)("tools:base:BaseTool"), h = Object(g.getModule)("globalConfiguration"), v = function () { function e(t, n) { r()(this, e), this.initialConfiguration = Object(c.default)(n, t); var a = this.initialConfiguration, o = a.name, i = a.strategies, l = a.defaultStrategy, s = a.configuration, u = a.supportedInteractionTypes, d = a.mixins, f = a.svgCursor; this.name = o, this.mode = "disabled", this.element = void 0, this.supportedInteractionTypes = u || [], this.strategies = i || {}, this.defaultStrategy = l || Object.keys(this.strategies)[0] || void 0, this.activeStrategy = this.defaultStrategy, f && (this.svgCursor = f), this._options = {}, this._configuration = Object.assign({}, s), this.updateOnMouseMove = !1, this.hideDefaultCursor = !1, d && d.length && this._applyMixins(d), this._cursors = Object.assign({}, this.initialConfiguration.cursors); var g = this.defaultStrategy && this._cursors[this.activeStrategy]; g && (this.svgCursor = g) } return s()(e, [{ key: "mergeOptions", value: function e(t) { this._options = Object.assign({}, this._options, t) } }, { key: "clearOptions", value: function e() { this._options = {} } }, { key: "applyActiveStrategy", value: function e(t, n) { return this.strategies[this.activeStrategy].call(this, t, n) } }, { key: "_applyMixins", value: function e(t) { for (var n = 0; n < t.length; n++) { var a = u.default["".concat(t[n])]; "object" === o()(a) ? (Object.assign(this, a), "function" == typeof this.initializeMixin && this.initializeMixin()) : m.warn("".concat(this.name, ": mixin ").concat(u.default[n], " does not exist.")) } "function" === this.initializeMixin && delete this.initializeMixin } }, { key: "setActiveStrategy", value: function e(t) { this.activeStrategy = t, h.configuration.showSVGCursors && this.changeCursor(this.element, t) } }, { key: "changeCursor", value: function e(t, n) { if (t) { var a = this._cursors[n]; a && (this.svgCursor = a, "active" === this.mode && Object(f.setToolCursor)(t, a)) } } }, { key: "configuration", get: function e() { return this._configuration }, set: function e(t) { this._configuration = t } }, { key: "options", get: function e() { return this._options } }], [{ key: "configuration", get: function e() { } }]), e }(); t.default = v }, "./tools/base/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./BaseAnnotationTool.js */ "./tools/base/BaseAnnotationTool.js"), o = n(/*! ./BaseTool.js */ "./tools/base/BaseTool.js"), i = n(/*! ./BaseBrushTool.js */ "./tools/base/BaseBrushTool.js"); n.d(t, "BaseAnnotationTool", function () { return a.default }), n.d(t, "BaseBrushTool", function () { return i.default }), n.d(t, "BaseTool", function () { return o.default }), t.default = { BaseAnnotationTool: a.default, BaseBrushTool: i.default, BaseTool: o.default } }, "./tools/cursors/MouseCursor.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return u }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! ../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), s = n(/*! ../../store/index.js */ "./store/index.js").modules.cursor, u = function () { function e(t, n) { o()(this, e), this.iconGroupString = t, this.options = Object.assign({}, s.getters.defaultOptions(), n) } return r()(e, [{ key: "getIconSVG", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = this._generateIconSVGString(t); return new Blob([n], { type: "image/svg+xml" }) } }, { key: "getIconSVGString", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return this._generateIconSVGString(t) } }, { key: "getIconWithPointerSVG", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = this._generateIconWithPointerSVGString(t); return new Blob([n], { type: "image/svg+xml" }) } }, { key: "getIconWithPointerString", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return this._generateIconWithPointerSVGString(t) } }, { key: "_generateIconWithPointerSVGString", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = Object.assign({}, this.options, t), a = n.mousePointerGroupString, o = n.iconSize, i = n.viewBox, r = o / Math.max(i.x, i.y), l = 16 + o, s = '\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(l, '" height="').concat(l, '" viewBox="0 0 ').concat(l, " ").concat(l, '"\n      >\n        <g>\n          ').concat(a, '\n        </g>\n        <g transform="translate(16, 16) scale(').concat(r, ')">\n          ').concat(this.iconGroupString, "\n        </g>\n      </svg>"); return this._injectColors(s, n) } }, { key: "_generateIconSVGString", value: function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = Object.assign({}, this.options, t), a = n.iconSize, o = n.viewBox, i = '\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(a, '" height="').concat(a, '" viewBox="0 0\n        ').concat(o.x, " ").concat(o.y, '"\n      >\n        ').concat(this.iconGroupString, "\n      </svg>"); return this._injectColors(i, n) } }, { key: "_injectColors", value: function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, a = n.activeColor || l.default.getActiveColor(), o = n.toolColor || l.default.getToolColor(), i = n.fillColor || l.default.getFillColor(); return t.replace(/ACTIVE_COLOR/g, "".concat(a)).replace(/TOOL_COLOR/g, "".concat(o)).replace(/FILL_COLOR/g, "".concat(i)) } }, { key: "mousePoint", get: function e() { var t = this.options.mousePoint; return "".concat(t.x, " ").concat(t.y) } }]), e }() }, "./tools/cursors/index.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "angleCursor", function () { return o }), n.d(t, "arrowAnnotateCursor", function () { return i }), n.d(t, "bidirectionalCursor", function () { return r }), n.d(t, "cobbAngleCursor", function () { return l }), n.d(t, "circleRoiCursor", function () { return s }), n.d(t, "ellipticalRoiCursor", function () { return u }), n.d(t, "freehandRoiCursor", function () { return d }), n.d(t, "freehandRoiSculptorCursor", function () { return c }), n.d(t, "lengthCursor", function () { return f }), n.d(t, "probeCursor", function () { return g }), n.d(t, "rectangleRoiCursor", function () { return m }), n.d(t, "textMarkerCursor", function () { return h }), n.d(t, "crosshairsCursor", function () { return v }), n.d(t, "eraserCursor", function () { return p }), n.d(t, "magnifyCursor", function () { return x }), n.d(t, "panCursor", function () { return $ }), n.d(t, "rotateCursor", function () { return y }), n.d(t, "stackScrollCursor", function () { return T }), n.d(t, "wwwcRegionCursor", function () { return b }), n.d(t, "wwwcCursor", function () { return _ }), n.d(t, "zoomCursor", function () { return C }), n.d(t, "freehandEraseInsideCursor", function () { return P }), n.d(t, "freehandFillInsideCursor", function () { return k }), n.d(t, "freehandEraseOutsideCursor", function () { return D }), n.d(t, "freehandFillOutsideCursor", function () { return L }), n.d(t, "segRectangleEraseInsideCursor", function () { return O }), n.d(t, "segRectangleFillInsideCursor", function () { return A }), n.d(t, "segRectangleEraseOutsideCursor", function () { return H }), n.d(t, "segRectangleFillOutsideCursor", function () { return R }), n.d(t, "segCircleEraseInsideCursor", function () { return B }), n.d(t, "segCircleFillInsideCursor", function () { return F }), n.d(t, "segCircleEraseOutsideCursor", function () { return U }), n.d(t, "segCircleFillOutsideCursor", function () { return N }); var a = n(/*! ./MouseCursor.js */ "./tools/cursors/MouseCursor.js"), o = new a.default('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />', { viewBox: { x: 1792, y: 1792 } }), i = new a.default('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>', { viewBox: { x: 24, y: 24 } }), r = new a.default('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>', { viewBox: { x: 48, y: 48 } }), l = new a.default('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>', { viewBox: { x: 32, y: 32 } }), s = new a.default('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />', { viewBox: { x: 32, y: 32 } }), u = new a.default('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />', { viewBox: { x: 32, y: 32 } }), d = new a.default('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>', { viewBox: { x: 18, y: 18 } }), c = new a.default('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>', { viewBox: { x: 18, y: 18 } }), f = new a.default('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>', { viewBox: { x: 24, y: 24 } }), g = new a.default('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />', { viewBox: { x: 1792, y: 1792 } }), m = new a.default('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />', { viewBox: { x: 1792, y: 1792 } }), h = new a.default('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />', { viewBox: { x: 1792, y: 1792 } }), v = new a.default('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />', { viewBox: { x: 1792, y: 1792 } }), p = new a.default('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />', { viewBox: { x: 2048, y: 1792 } }), x = new a.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />', { viewBox: { x: 512, y: 512 } }), $ = new a.default('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />', { viewBox: { x: 1792, y: 1792 } }), y = new a.default('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />', { viewBox: { x: 1792, y: 1792 } }), T = new a.default('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />', { viewBox: { x: 24, y: 28 } }), b = new a.default('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />', { viewBox: { x: 1792, y: 1792 } }), _ = new a.default('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />', { viewBox: { x: 18, y: 18 } }), C = new a.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />', { viewBox: { x: 640, y: 512 } }), j = { x: 127, y: 60 }, S = function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "ACTIVE_COLOR"; return '<rect fill="'.concat(t, '" x="80.19" y="25.03" width="47.14" height="15.85"/>') }, w = function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "ACTIVE_COLOR"; return '<rect fill="'.concat(t, '" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(t, '" x="95.84" y="9.38" width="15.85" height="47.14"/>') }, M = '<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>', E = '<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>', I = '<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>', P = new a.default("".concat(M, " ").concat(S()), { viewBox: j }), k = new a.default("".concat(M, " ").concat(w()), { viewBox: j }), D = new a.default("".concat(M, " ").concat(S()), { viewBox: j }), L = new a.default("".concat(M, " ").concat(w()), { viewBox: j }), O = new a.default("".concat(E, " ").concat(S()), { viewBox: j }), A = new a.default("".concat(E, " ").concat(w()), { viewBox: j }), H = new a.default("".concat(E, " ").concat(S()), { viewBox: j }), R = new a.default("".concat(E, " ").concat(w()), { viewBox: j }), B = new a.default("".concat(I, " ").concat(S()), { viewBox: j }), F = new a.default("".concat(I, " ").concat(w()), { viewBox: j }), U = new a.default("".concat(I, " ").concat(S()), { viewBox: j }), N = new a.default("".concat(I, " ").concat(w()), { viewBox: j }) }, "./tools/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./CrosshairsTool.js */ "./tools/CrosshairsTool.js"); n.d(t, "CrosshairsTool", function () { return a.default }); var o = n(/*! ./DoubleTapFitToWindowTool.js */ "./tools/DoubleTapFitToWindowTool.js"); n.d(t, "DoubleTapFitToWindowTool", function () { return o.default }); var i = n(/*! ./DragProbeTool.js */ "./tools/DragProbeTool.js"); n.d(t, "DragProbeTool", function () { return i.default }); var r = n(/*! ./EraserTool.js */ "./tools/EraserTool.js"); n.d(t, "EraserTool", function () { return r.default }); var l = n(/*! ./FreehandRoiSculptorTool.js */ "./tools/FreehandRoiSculptorTool.js"); n.d(t, "FreehandRoiSculptorTool", function () { return l.default }); var s = n(/*! ./MagnifyTool.js */ "./tools/MagnifyTool.js"); n.d(t, "MagnifyTool", function () { return s.default }); var u = n(/*! ./OverlayTool.js */ "./tools/OverlayTool.js"); n.d(t, "OverlayTool", function () { return u.default }); var d = n(/*! ./OrientationMarkersTool.js */ "./tools/OrientationMarkersTool.js"); n.d(t, "OrientationMarkersTool", function () { return d.default }); var c = n(/*! ./PanMultiTouchTool.js */ "./tools/PanMultiTouchTool.js"); n.d(t, "PanMultiTouchTool", function () { return c.default }); var f = n(/*! ./PanTool.js */ "./tools/PanTool.js"); n.d(t, "PanTool", function () { return f.default }); var g = n(/*! ./ReferenceLinesTool.js */ "./tools/ReferenceLinesTool.js"); n.d(t, "ReferenceLinesTool", function () { return g.default }); var m = n(/*! ./RotateTool.js */ "./tools/RotateTool.js"); n.d(t, "RotateTool", function () { return m.default }); var h = n(/*! ./RotateTouchTool.js */ "./tools/RotateTouchTool.js"); n.d(t, "RotateTouchTool", function () { return h.default }); var v = n(/*! ./ScaleOverlayTool.js */ "./tools/ScaleOverlayTool.js"); n.d(t, "ScaleOverlayTool", function () { return v.default }); var p = n(/*! ./StackScrollMouseWheelTool.js */ "./tools/StackScrollMouseWheelTool.js"); n.d(t, "StackScrollMouseWheelTool", function () { return p.default }); var x = n(/*! ./StackScrollMultiTouchTool.js */ "./tools/StackScrollMultiTouchTool.js"); n.d(t, "StackScrollMultiTouchTool", function () { return x.default }); var $ = n(/*! ./StackScrollTool.js */ "./tools/StackScrollTool.js"); n.d(t, "StackScrollTool", function () { return $.default }); var y = n(/*! ./WwwcRegionTool.js */ "./tools/WwwcRegionTool.js"); n.d(t, "WwwcRegionTool", function () { return y.default }); var T = n(/*! ./WwwcTool.js */ "./tools/WwwcTool.js"); n.d(t, "WwwcTool", function () { return T.default }); var b = n(/*! ./ZoomMouseWheelTool.js */ "./tools/ZoomMouseWheelTool.js"); n.d(t, "ZoomMouseWheelTool", function () { return b.default }); var _ = n(/*! ./ZoomTool.js */ "./tools/ZoomTool.js"); n.d(t, "ZoomTool", function () { return _.default }); var C = n(/*! ./ZoomTouchPinchTool.js */ "./tools/ZoomTouchPinchTool.js"); n.d(t, "ZoomTouchPinchTool", function () { return C.default }), t.default = { CrosshairsTool: a.default, DoubleTapFitToWindowTool: o.default, DragProbeTool: i.default, EraserTool: r.default, FreehandRoiSculptorTool: l.default, MagnifyTool: s.default, OverlayTool: u.default, OrientationMarkersTool: d.default, PanMultiTouchTool: c.default, PanTool: f.default, ReferenceLinesTool: g.default, RotateTool: m.default, RotateTouchTool: h.default, ScaleOverlayTool: v.default, StackScrollMouseWheelTool: p.default, StackScrollMultiTouchTool: x.default, StackScrollTool: $.default, WwwcRegionTool: y.default, WwwcTool: T.default, ZoomMouseWheelTool: b.default, ZoomTool: _.default, ZoomTouchPinchTool: C.default } }, "./tools/referenceLines/calculateReferenceLine.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../util/pointProjector.js */ "./util/pointProjector.js"); t.default = function (e, t) { var n = Object(a.planePlaneIntersection)(e, t); if (n) return { start: Object(a.projectPatientPointToImagePlane)(n.start, e), end: Object(a.projectPatientPointToImagePlane)(n.end, e) } } }, "./tools/referenceLines/renderActiveReferenceLine.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./../../externalModules.js */ "./externalModules.js"), o = n(/*! ./calculateReferenceLine.js */ "./tools/referenceLines/calculateReferenceLine.js"), i = n(/*! ./../../stateManagement/toolColors.js */ "./stateManagement/toolColors.js"), r = n(/*! ./../../util/convertToVector3.js */ "./util/convertToVector3.js"), l = n(/*! ./../../drawing/index.js */ "./drawing/index.js"); t.default = function (e, t, n, s) { var u = a.default.cornerstone, d = u.getEnabledElement(n).image, c = u.getEnabledElement(s).image; if (d && c) { var f = u.metaData.get("imagePlaneModule", d.imageId), g = u.metaData.get("imagePlaneModule", c.imageId); if (f && g && f.rowCosines && f.columnCosines && f.imagePositionPatient && g.rowCosines && g.columnCosines && g.imagePositionPatient && f.frameOfReferenceUID === g.frameOfReferenceUID) { f.rowCosines = Object(r.default)(f.rowCosines), f.columnCosines = Object(r.default)(f.columnCosines), f.imagePositionPatient = Object(r.default)(f.imagePositionPatient), g.rowCosines = Object(r.default)(g.rowCosines), g.columnCosines = Object(r.default)(g.columnCosines), g.imagePositionPatient = Object(r.default)(g.imagePositionPatient); var m = f.rowCosines.clone().cross(f.columnCosines), h = g.rowCosines.clone().cross(g.columnCosines), v = m.angleTo(h); if (!((v = Math.abs(v)) < .5)) { var p = Object(o.default)(f, g); if (p) { var x = i.default.getActiveColor(); e.setTransform(1, 0, 0, 1, 0, 0), Object(l.draw)(e, function (e) { Object(l.drawLine)(e, t.element, p.start, p.end, { color: x }) }) } } } } } }, "./tools/segmentation/BrushTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return y }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./../../externalModules.js */ "./externalModules.js"), v = n(/*! ../base */ "./tools/base/index.js"), p = n(/*! ./../../store/index.js */ "./store/index.js"), x = n(/*! ../../util/segmentation/index.js */ "./util/segmentation/index.js"); Object(n(/*! ../../util/logger.js */ "./util/logger.js").getLogger)("tools:BrushTool"); var $ = Object(p.getModule)("segmentation"), y = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), (e = s()(this, d()(t).call(this, n, { name: "Brush", supportedInteractionTypes: ["Mouse", "Touch"], configuration: {}, mixins: ["renderBrushMixin"] }))).touchDragCallback = e._paint.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_paint", value: function e(t) { var n = $.configuration, a = t.detail; a.element; var o = a.image, i = o.rows, r = o.columns, l = a.currentPoints.image, s = l.x, u = l.y; if (!(s < 0) && !(s > r) && !(u < 0) && !(u > i)) { var d = n.radius, c = Object(x.getCircle)(d, i, r, s, u), f = this.paintEventData, g = f.labelmap2D, m = f.labelmap3D, v = f.shouldErase; Object(x.drawBrushPixels)(c, g.pixelData, m.activeSegmentIndex, r, v), h.default.cornerstone.updateImage(t.detail.element) } } }]), t }(v.BaseBrushTool) }, "./tools/segmentation/CircleScissorsTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return m }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), d = n.n(u), c = n(/*! ../base */ "./tools/base/index.js"), f = n(/*! ./strategies */ "./tools/segmentation/strategies/index.js"), g = n(/*! ../cursors */ "./tools/cursors/index.js"), m = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "CircleScissors", strategies: { FILL_INSIDE: f.fillInsideCircle, FILL_OUTSIDE: f.fillOutsideCircle, ERASE_OUTSIDE: f.eraseOutsideCircle, ERASE_INSIDE: f.eraseInsideCircle }, cursors: { FILL_INSIDE: g.segCircleFillInsideCursor, FILL_OUTSIDE: g.segCircleFillOutsideCursor, ERASE_OUTSIDE: g.segCircleEraseOutsideCursor, ERASE_INSIDE: g.segCircleEraseInsideCursor }, defaultStrategy: "FILL_INSIDE", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: g.segCircleFillInsideCursor, mixins: ["circleSegmentationMixin"] }; return r()(this, s()(t).call(this, e, n)) } return d()(t, e), t }(c.BaseTool) }, "./tools/segmentation/CorrectionScissorsTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return m }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), d = n.n(u), c = n(/*! ../base */ "./tools/base/index.js"), f = n(/*! ../cursors */ "./tools/cursors/index.js"), g = n(/*! ./strategies */ "./tools/segmentation/strategies/index.js"), m = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "CorrectionScissors", strategies: { CORRECTION: g.correction }, cursors: { CORRECTION: f.freehandFillInsideCursor }, defaultStrategy: "CORRECTION", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: f.freehandFillInsideCursor, mixins: ["polylineSegmentationMixin"] }; return r()(this, s()(t).call(this, e, n)) } return d()(t, e), t }(c.BaseTool) }, "./tools/segmentation/FreehandScissorsTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return g }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), d = n.n(u), c = n(/*! ../cursors */ "./tools/cursors/index.js"), f = n(/*! ./strategies */ "./tools/segmentation/strategies/index.js"), g = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "FreehandScissors", strategies: { FILL_INSIDE: f.fillInsideFreehand, FILL_OUTSIDE: f.fillOutsideFreehand, ERASE_OUTSIDE: f.eraseOutsideFreehand, ERASE_INSIDE: f.eraseInsideFreehand }, cursors: { FILL_INSIDE: c.freehandFillInsideCursor, FILL_OUTSIDE: c.freehandFillOutsideCursor, ERASE_OUTSIDE: c.freehandEraseOutsideCursor, ERASE_INSIDE: c.freehandEraseInsideCursor }, defaultStrategy: "FILL_INSIDE", supportedInteractionTypes: ["Mouse", "Touch"], svgCursor: c.freehandFillInsideCursor, mixins: ["freehandSegmentationMixin"] }; return r()(this, s()(t).call(this, e, n)) } return d()(t, e), t }(n(/*! ../base */ "./tools/base/index.js").BaseTool) }, "./tools/segmentation/RectangleScissorsTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return m }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), d = n.n(u), c = n(/*! ../base */ "./tools/base/index.js"), f = n(/*! ./strategies */ "./tools/segmentation/strategies/index.js"), g = n(/*! ../cursors */ "./tools/cursors/index.js"), m = function (e) { function t() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; o()(this, t); var n = { name: "RectangleScissors", strategies: { FILL_INSIDE: f.fillInsideRectangle, FILL_OUTSIDE: f.fillOutsideRectangle, ERASE_OUTSIDE: f.eraseOutsideRectangle, ERASE_INSIDE: f.eraseInsideRectangle }, cursors: { FILL_INSIDE: g.segRectangleFillInsideCursor, FILL_OUTSIDE: g.segRectangleFillOutsideCursor, ERASE_OUTSIDE: g.segRectangleEraseOutsideCursor, ERASE_INSIDE: g.segRectangleEraseInsideCursor }, defaultStrategy: "FILL_INSIDE", supportedInteractionTypes: ["Mouse", "Touch"], mixins: ["rectangleSegmentationMixin"] }; return r()(this, s()(t).call(this, e, n)) } return d()(t, e), t }(c.BaseTool) }, "./tools/segmentation/SphericalBrushTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return _ }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! @babel/runtime/helpers/possibleConstructorReturn */ "../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"), s = n.n(l), u = n(/*! @babel/runtime/helpers/getPrototypeOf */ "../node_modules/@babel/runtime/helpers/getPrototypeOf.js"), d = n.n(u), c = n(/*! @babel/runtime/helpers/assertThisInitialized */ "../node_modules/@babel/runtime/helpers/assertThisInitialized.js"), f = n.n(c), g = n(/*! @babel/runtime/helpers/inherits */ "../node_modules/@babel/runtime/helpers/inherits.js"), m = n.n(g), h = n(/*! ./../../externalModules.js */ "./externalModules.js"), v = n(/*! ./../base/BaseBrushTool.js */ "./tools/base/BaseBrushTool.js"), p = n(/*! ./../../store/index.js */ "./store/index.js"), x = n(/*! ./../../util/segmentation */ "./util/segmentation/index.js"), $ = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), y = n(/*! ../../util/logger.js */ "./util/logger.js"), T = Object(y.getLogger)("tools:SphericalBrushTool"), b = Object(p.getModule)("segmentation"), _ = function (e) { function t() { var e, n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return o()(this, t), (e = s()(this, d()(t).call(this, n, { name: "SphericalBrush", supportedInteractionTypes: ["Mouse", "Touch"], configuration: { alwaysEraseOnClick: !1 }, mixins: ["renderBrushMixin"] }))).touchDragCallback = e._paint.bind(f()(e)), e } return m()(t, e), r()(t, [{ key: "_startPainting", value: function e(t) { var n, a = b.configuration, o = b.getters, i = t.detail, r = i.element, l = i.image, s = h.default.cornerstone, u = a.radius, d = l.rows, c = l.columns, f = Math.max(l.rowPixelSpacing, l.columnPixelSpacing), g = Object($.getToolState)(r, "stack").data[0].imageIds, m = o.labelmap2D(r), v = m.labelmap2D, p = m.labelmap3D, x = m.currentImageIdIndex, y = m.activeLabelmapIndex, _ = this._isCtrlDown(i) || this.configuration.alwaysEraseOnClick, C = s.metaData.get("imagePlaneModule", l.imageId); if (C) { var j = C.imagePositionPatient; n = this._getImagesInRange(x, j, g, u, f) } else T.warn("No imagePlane metadata found for image, defaulting to circle brush application."), n = [{ imageIdIndex: x, radiusOnImage: u }]; if (this.paintEventData = { labelmap2D: v, labelmap3D: p, currentImageIdIndex: x, activeLabelmapIndex: y, shouldErase: _, imagesInRange: n }, a.storeHistory) { for (var S = [], w = 0; w < n.length; w++) { var M = n[w].imageIdIndex, E = o.labelmap2DByImageIdIndex(p, M, d, c).pixelData.slice(); S.push(E) } this.paintEventData.previousPixeldataForImagesInRange = S } } }, { key: "_paint", value: function e(t) { var n = b.getters, a = t.detail; a.element; var o = a.image, i = o.rows, r = o.columns, l = a.currentPoints.image, s = l.x, u = l.y; if (!(s < 0) && !(s > r) && !(u < 0) && !(u > i)) { for (var d = this.paintEventData, c = d.labelmap3D, f = d.imagesInRange, g = d.shouldErase, m = 0; m < f.length; m++) { var v = f[m], p = v.imageIdIndex, $ = v.radiusOnImage, y = Object(x.getCircle)($, i, r, s, u), T = n.labelmap2DByImageIdIndex(c, p, i, r); Object(x.drawBrushPixels)(y, T.pixelData, c.activeSegmentIndex, r, g) } h.default.cornerstone.updateImage(t.detail.element) } } }, { key: "_getImagesInRange", value: function e(t, n, a, o, i) { for (var r = o * i, l = [{ imageIdIndex: t, radiusOnImage: o }], s = t + 1; s < a.length; s++) { var u = this._getRadiusOnImage(a[s], n, r, i); if (!u) break; l.push({ imageIdIndex: s, radiusOnImage: u }) } for (var d = t - 1; d >= 0; d--) { var c = this._getRadiusOnImage(a[d], n, r, i); if (!c) break; l.push({ imageIdIndex: d, radiusOnImage: c }) } return l } }, { key: "_getRadiusOnImage", value: function e(t, n, a, o) { var i = h.default.cornerstone.metaData.get("imagePlaneModule", t); if (!i) { T.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(t, ",")); return } var r = i.imagePositionPatient, l = Math.sqrt(Math.pow(r[0] - n[0], 2) + Math.pow(r[1] - n[1], 2) + Math.pow(r[2] - n[2], 2)); if (!(l > a)) return Math.floor(Math.sqrt(Math.pow(a, 2) - Math.pow(l, 2)) / o) } }, { key: "_endPainting", value: function e(t) { for (var n = this.paintEventData, a = n.labelmap3D, o = n.imagesInRange, i = [], r = b.configuration, l = b.setters, s = 0; s < o.length; s++) { for (var u = o[s].imageIdIndex, d = a.labelmaps2D[u], c = new Set(d.pixelData).values(), f = [], g = !1; !g;) { var m = c.next(); (g = m.done) || f.push(m.value) } if (d.segmentsOnLabelmap = f, r.storeHistory) { var h = this.paintEventData.previousPixeldataForImagesInRange[s], v = a.labelmaps2D[u].pixelData; i.push({ imageIdIndex: u, diff: Object(x.getDiffBetweenPixelData)(h, v) }) } } r.storeHistory && l.pushState(this.element, i), Object(x.triggerLabelmapModifiedEvent)(this.element) } }]), t }(v.default) }, "./tools/segmentation/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./BrushTool */ "./tools/segmentation/BrushTool.js"), o = n(/*! ./SphericalBrushTool */ "./tools/segmentation/SphericalBrushTool.js"), i = n(/*! ./FreehandScissorsTool */ "./tools/segmentation/FreehandScissorsTool.js"), r = n(/*! ./RectangleScissorsTool */ "./tools/segmentation/RectangleScissorsTool.js"), l = n(/*! ./CircleScissorsTool */ "./tools/segmentation/CircleScissorsTool.js"), s = n(/*! ./CorrectionScissorsTool */ "./tools/segmentation/CorrectionScissorsTool.js"); n.d(t, "BrushTool", function () { return a.default }), n.d(t, "SphericalBrushTool", function () { return o.default }), n.d(t, "FreehandScissorsTool", function () { return i.default }), n.d(t, "RectangleScissorsTool", function () { return r.default }), n.d(t, "CircleScissorsTool", function () { return l.default }), n.d(t, "CorrectionScissorsTool", function () { return s.default }), t.default = { BrushTool: a.default, SphericalBrushTool: o.default, CircleScissorsTool: l.default, CorrectionScissorsTool: s.default, FreehandScissorsTool: i.default, RectangleScissorsTool: r.default } }, "./tools/segmentation/strategies/correction.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return d }); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ./index.js */ "./tools/segmentation/strategies/index.js"), r = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), l = n(/*! ../../../util/clip */ "./util/clip.js"), s = n(/*! ../../../util/isPointInImage */ "./util/isPointInImage.js"), u = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("util:segmentation:operations:correction"); function d(e, t) { var n = t.pixelData, a = t.segmentIndex, d = t.segmentationMixinType; if ("freehandSegmentationMixin" !== d) { u.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(d)); return } var m = function e(t, n) { for (var a = n.pixelData, o = n.points, i = t.detail.image, r = i.width, s = i.height, u = [], d = 0; d < o.length; d++) { var c = o[d], f = Math.floor(c.x), g = Math.floor(c.y); f = Object(l.default)(f, 0, r - 1), g = Object(l.default)(g, 0, s - 1); var m = u[u.length - 1]; (!m || f !== m.x || g !== m.y) && u.push({ x: f, y: g, segment: a[g * r + f] }) } return u }(e, t), h = function e(t, n) { for (var a = !0, o = !0, i = 0; i < t.length && (t[i].segment === n ? o = !1 : a = !1, a || o); i++); return o ? { isScissorOperation: !0, operation: "fillInsideFreehand" } : a ? { isScissorOperation: !0, operation: "eraseInsideFreehand" } : { isScissorOperation: !1 } }(m, a); if (h.isScissorOperation) { "fillInsideFreehand" === h.operation ? (u.warn("The line never intersects a segment."), Object(i.fillInsideFreehand)(e, t)) : "eraseInsideFreehand" === h.operation && (u.warn("The line is only ever inside the segment."), Object(i.eraseInsideFreehand)(e, t)); return } var v = new Uint8Array(n.length); (function e(t, n) { var a = t[0].segment === n, o = []; o.push({ additive: !a, nodes: [] }); for (var i = 0, r = 0; r < t.length; r++) { var l = t[r]; a ? (o[i].nodes.push(l), l.segment !== n && (i++, a = !a, o.push({ additive: !0, nodes: [] }), o[i].nodes.push(t[r - 1]), o[i].nodes.push(l))) : (o[i].nodes.push(l), l.segment === n && (i++, a = !a, o.push({ additive: !1, nodes: [] }), o[i].nodes.push(t[r - 1]), o[i].nodes.push(l))) } return o.pop(), o.shift(), o })(m, a).forEach(function (t) { !function e(t, n, a, i, l) { var d = l.detail.image, m = d.width, h = d.height, v = t.nodes, p = t.additive, x = p ? 0 : 1, $ = function e(t) { return t.y * m + t.x }; p ? u.warn("additive operation...") : u.warn("subtractive operation..."); for (var y = function e(t) { for (var n = [], a = 0; a < t.length - 1; a++)n.push(t[a]), n.push.apply(n, o()(Object(r.getPixelPathBetweenPixels)(t[a], t[a + 1]))); n.push[t[t.length - 1]]; for (var i = [], l = [], s = 0; s < n.length - 1; s++) { var u = g(n[s], n[s + 1]), d = u.left, c = u.right; i.push(d), l.push(c) } return { pixelPath: n, leftPath: i, rightPath: l } }(v), T = y.pixelPath, b = y.leftPath, _ = y.rightPath, C = T[0], j = { xMin: C.x, xMax: C.x, yMin: C.y, yMax: C.y }, S = 0; S < a.length; S++)n[S] === i ? (c(j, { x: (F = S) % m, y: Math.floor(F / m) }), a[S] = 1) : a[S] = 0; for (var w = 0; w < T.length; w++) { var M = T[w]; a[$(M)] = 2, c(j, M) } H = j, R = h, B = m, H.xMax = Math.min(H.xMax + 2, B), H.xMin = Math.max(H.xMin - 2, 0), H.yMax = Math.min(H.yMax + 2, R), H.yMin = Math.max(H.yMin - 2, 0); var E = j.xMin, I = j.xMax, P = j.yMin, k = j.yMax; function D(e, t) { if (!(e >= I) && !(e < E) && !(t >= k) && !(t < P)) return a[t * m + e] } for (var L = 0, O = 0, A = 0; A < b.length; A++) { var H, R, B, F, U = b[A]; a[$(U)] === x && Object(s.default)(U, h, m) && (L += f(U, 3, a, D, m)); var N = _[A]; a[$(N)] === x && Object(s.default)(N, h, m) && (O += f(N, 4, a, D, m)) } if (0 !== L && 0 !== O) { for (var V = p ? i : 0, z = L < O ? 3 : 4, W = 0; W < a.length; W++)a[W] === z && (n[W] = V); if (V === i) for (var q = 0; q < T.length; q++)n[$(T[q])] = i; else for (var G = 0; G < T.length; G++) { var Y = $(T[G]); n[Y] === i && (n[Y] = 0) } } }(t, n, v, a, e) }) } function c(e, t) { var n = t.x, a = t.y; n < e.xMin && (e.xMin = n), n > e.xMax && (e.xMax = n), a < e.yMin && (e.yMin = a), a > e.yMax && (e.yMax = a) } function f(e, t, n, a, o) { for (var i = Object(r.floodFill)(a, [e.x, e.y]).flooded, l = 0; l < i.length; l++) { var s = i[l]; n[s[1] * o + s[0]] = t } return i.length } function g(e, t) { var n = { x: t.x - e.x, y: t.y - e.y }; if (-1 === n.x && 1 === n.y) return { left: { x: e.x - 1, y: e.y - 1 }, right: { x: e.x + 1, y: e.y + 1 } }; if (0 === n.x && 1 === n.y) return { left: { x: e.x - 1, y: e.y }, right: { x: e.x + 1, y: e.y } }; if (1 === n.x && 1 === n.y) return { left: { x: e.x - 1, y: e.y + 1 }, right: { x: e.x + 1, y: e.y - 1 } }; if (1 === n.x && 0 === n.y) return { left: { x: e.x, y: e.y + 1 }, right: { x: e.x, y: e.y - 1 } }; if (1 === n.x && -1 === n.y) return { left: { x: e.x + 1, y: e.y + 1 }, right: { x: e.x - 1, y: e.y - 1 } }; else if (0 === n.x && -1 === n.y) return { left: { x: e.x + 1, y: e.y }, right: { x: e.x - 1, y: e.y } }; else if (-1 === n.x && -1 === n.y) return { left: { x: e.x + 1, y: e.y - 1 }, right: { x: e.x - 1, y: e.y + 1 } }; else if (-1 === n.x && 0 === n.y) return { left: { x: e.x, y: e.y - 1 }, right: { x: e.x, y: e.y + 1 } }; u.error("Unable to find left and right paths for flood fill ", e, t, n) } }, "./tools/segmentation/strategies/eraseCircle.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "eraseInsideCircle", function () { return c }), n.d(t, "eraseOutsideCircle", function () { return f }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/ellipse */ "./util/ellipse/index.js"), r = n(/*! ../../../util/logger */ "./util/logger.js"), l = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), s = n(/*! ../../../util/getCircleCoords.js */ "./util/getCircleCoords.js"), u = Object(r.getLogger)("util:segmentation:operations:eraseInsideCircle"); function d(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.segmentationMixinType; if ("circleSegmentationMixin" !== a) { u.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(a)); return } var r = e.detail, d = Object(l.getBoundingBoxAroundCircle)(e), c = o()(d, 2), f = c[0], g = c[1], m = Object(s.default)(r.handles.start, r.handles.end); n ? Object(l.eraseInsideShape)(e, t, function (e) { return Object(i.pointInEllipse)(m, e) }, f, g) : Object(l.eraseOutsideShape)(e, t, function (e) { return Object(i.pointInEllipse)(m, e) }, f, g) } function c(e, t) { d(e, t, !0) } function f(e, t) { d(e, t, !1) } }, "./tools/segmentation/strategies/eraseFreehand.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "eraseInsideFreehand", function () { return u }), n.d(t, "eraseOutsideFreehand", function () { return d }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), r = n(/*! ../../../util/isPointInPolygon */ "./util/isPointInPolygon.js"), l = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("util:segmentation:operations:eraseInsideFreehand"); function s(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.points, s = t.segmentationMixinType; if ("freehandSegmentationMixin" !== s) { l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s)); return } var u = e.detail.image, d = a.map(function (e) { return [e.x, e.y] }), c = Object(i.getBoundingBoxAroundPolygon)(d, u), f = o()(c, 2), g = f[0], m = f[1]; n ? Object(i.eraseInsideShape)(e, t, function (e) { return Object(r.default)([e.x, e.y], d) }, g, m) : Object(i.eraseOutsideShape)(e, t, function (e) { return Object(r.default)([e.x, e.y], d) }, g, m) } function u(e, t) { s(e, t, !0) } function d(e, t) { s(e, t, !1) } }, "./tools/segmentation/strategies/eraseRectangle.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "eraseInsideRectangle", function () { return u }), n.d(t, "eraseOutsideRectangle", function () { return d }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/logger */ "./util/logger.js"), r = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), l = Object(i.getLogger)("util:segmentation:operations:eraseInsideRectangle"); function s(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.points, i = t.segmentationMixinType; if ("rectangleSegmentationMixin" !== i) { l.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(i)); return } var s = e.detail.image, u = a.map(function (e) { return [e.x, e.y] }), d = Object(r.getBoundingBoxAroundPolygon)(u, s), c = o()(d, 2), f = c[0], g = c[1]; n ? Object(r.eraseInsideShape)(e, t, function () { return !0 }, f, g) : Object(r.eraseOutsideBoundingBox)(e, t, f, g) } function u(e, t) { s(e, t, !0) } function d(e, t) { s(e, t, !1) } }, "./tools/segmentation/strategies/fillCircle.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "fillInsideCircle", function () { return d }), n.d(t, "fillOutsideCircle", function () { return c }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), r = n(/*! ../../../util/ellipse */ "./util/ellipse/index.js"), l = n(/*! ../../../util/getCircleCoords */ "./util/getCircleCoords.js"), s = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("util:segmentation:operations:fillCircle"); function u(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.segmentationMixinType; if ("circleSegmentationMixin" !== a) { s.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(a)); return } var u = e.detail, d = Object(i.getBoundingBoxAroundCircle)(e), c = o()(d, 2), f = c[0], g = c[1], m = Object(l.default)(u.handles.start, u.handles.end); n ? Object(i.fillInsideShape)(e, t, function (e) { return Object(r.pointInEllipse)(m, e) }, f, g) : Object(i.fillOutsideShape)(e, t, function (e) { return Object(r.pointInEllipse)(m, e) }, f, g) } function d(e, t) { u(e, t, !0) } function c(e, t) { u(e, t, !1) } }, "./tools/segmentation/strategies/fillFreehand.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "fillInsideFreehand", function () { return u }), n.d(t, "fillOutsideFreehand", function () { return d }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), r = n(/*! ../../../util/isPointInPolygon */ "./util/isPointInPolygon.js"), l = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("util:segmentation:operations:fillInsideFreehand"); function s(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.points, s = t.segmentationMixinType; if ("freehandSegmentationMixin" !== s) { l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s)); return } var u = e.detail.image, d = a.map(function (e) { return [e.x, e.y] }), c = Object(i.getBoundingBoxAroundPolygon)(d, u), f = o()(c, 2), g = f[0], m = f[1]; n ? Object(i.fillInsideShape)(e, t, function (e) { return Object(r.default)([e.x, e.y], d) }, g, m) : Object(i.fillOutsideShape)(e, t, function (e) { return Object(r.default)([e.x, e.y], d) }, g, m) } function u(e, t) { s(e, t, !0) } function d(e, t) { s(e, t, !1) } }, "./tools/segmentation/strategies/fillRectangle.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "fillInsideRectangle", function () { return s }), n.d(t, "fillOutsideRectangle", function () { return u }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ../../../util/segmentation */ "./util/segmentation/index.js"), r = Object(n(/*! ../../../util/logger */ "./util/logger.js").getLogger)("util:segmentation:operations:fillInsideRectangle"); function l(e, t) { var n = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2], a = t.points, l = t.segmentationMixinType; if ("rectangleSegmentationMixin" !== l) { r.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(l)); return } var s = e.detail.image, u = a.map(function (e) { return [e.x, e.y] }), d = Object(i.getBoundingBoxAroundPolygon)(u, s), c = o()(d, 2), f = c[0], g = c[1]; n ? Object(i.fillInsideShape)(e, t, function () { return !0 }, f, g) : Object(i.fillOutsideBoundingBox)(e, t, f, g) } function s(e, t) { l(e, t, !0) } function u(e, t) { l(e, t, !1) } }, "./tools/segmentation/strategies/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./correction */ "./tools/segmentation/strategies/correction.js"); n.d(t, "correction", function () { return a.default }); var o = n(/*! ./eraseFreehand */ "./tools/segmentation/strategies/eraseFreehand.js"); n.d(t, "eraseInsideFreehand", function () { return o.eraseInsideFreehand }), n.d(t, "eraseOutsideFreehand", function () { return o.eraseOutsideFreehand }); var i = n(/*! ./eraseRectangle.js */ "./tools/segmentation/strategies/eraseRectangle.js"); n.d(t, "eraseInsideRectangle", function () { return i.eraseInsideRectangle }), n.d(t, "eraseOutsideRectangle", function () { return i.eraseOutsideRectangle }); var r = n(/*! ./fillFreehand */ "./tools/segmentation/strategies/fillFreehand.js"); n.d(t, "fillInsideFreehand", function () { return r.fillInsideFreehand }), n.d(t, "fillOutsideFreehand", function () { return r.fillOutsideFreehand }); var l = n(/*! ./fillRectangle */ "./tools/segmentation/strategies/fillRectangle.js"); n.d(t, "fillInsideRectangle", function () { return l.fillInsideRectangle }), n.d(t, "fillOutsideRectangle", function () { return l.fillOutsideRectangle }); var s = n(/*! ./fillCircle */ "./tools/segmentation/strategies/fillCircle.js"); n.d(t, "fillInsideCircle", function () { return s.fillInsideCircle }), n.d(t, "fillOutsideCircle", function () { return s.fillOutsideCircle }); var u = n(/*! ./eraseCircle */ "./tools/segmentation/strategies/eraseCircle.js"); n.d(t, "eraseInsideCircle", function () { return u.eraseInsideCircle }), n.d(t, "eraseOutsideCircle", function () { return u.eraseOutsideCircle }) }, "./util/SaveAs.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "image/png", a = e.querySelector("canvas"); if (a.msToBlob) { var o = a.msToBlob(); return window.navigator.msSaveBlob(o, t) } var i = document.createElement("a"); if (i.download = t, i.href = a.toDataURL(n, 1), document.createEvent) { var r = document.createEvent("MouseEvents"); r.initMouseEvent("click", !0, !0, window, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null), i.dispatchEvent(r) } else i.fireEvent && i.fireEvent("onclick") } }, "./util/angleBetweenPoints.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { var a, o = Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2)), i = Math.sqrt(Math.pow(e.x - n.x, 2) + Math.pow(e.y - n.y, 2)); return { angle: 180 * Math.acos((Math.pow(o, 2) + Math.pow(i, 2) - Math.pow(Math.sqrt(Math.pow(t.x - n.x, 2) + Math.pow(t.y - n.y, 2)), 2)) / (2 * o * i)) / Math.PI, direction: (t.x - e.x) * (n.y - e.y) - (t.y - e.y) * (n.x - e.x) } } }, "./util/calculateSUV.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); function o(e) { return parseFloat(".".concat(e)) } t.default = function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], i = a.default.cornerstone, r = i.metaData.get("patientStudyModule", e.imageId), l = i.metaData.get("generalSeriesModule", e.imageId); if (r && l && "PT" === l.modality) { var s = n ? t : t * e.slope + e.intercept, u = r.patientWeight; if (u) { var d = i.metaData.get("petIsotopeModule", e.imageId); if (d) { var c = d.radiopharmaceuticalInfo, f = c.radiopharmaceuticalStartTime, g = c.radionuclideTotalDose, m = c.radionuclideHalfLife, h = l.seriesTime; if (f && g && m && h) { var v = o(h.fractionalSeconds || 0) + h.seconds + 60 * h.minutes + 3600 * h.hours, p = o(f.fractionalSeconds || 0) + f.seconds + 60 * f.minutes + 3600 * f.hours; return s * u / (g * Math.exp(-(v - p) * Math.log(2) / m)) * 1e3 } } } } } }, "./util/clip.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "clip", function () { return r }), n.d(t, "clipToBox", function () { return l }), n.d(t, "clipBoxToDisplayedArea", function () { return d }); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ../externalModules.js */ "./externalModules.js"); function r(e, t, n) { return Math.min(Math.max(t, e), n) } function l(e, t) { var n = t.left || 0, a = t.top || 0; e.x = r(e.x, n, n + t.width), e.y = r(e.y, a, a + t.height) } var s = function e(t, n) { var a = function e(n) { return i.default.cornerstone.canvasToPixel(t, n) }, r = n.top, l = n.left, s = n.width, u = n.height, d = a({ x: l, y: r }), c = a({ x: l + s, y: r }), f = a({ x: l, y: r + u }), g = a({ x: l + s, y: r + u }), m = [d, c, f, g], h = m.map(function (e) { return e.x }), v = m.map(function (e) { return e.y }); return { minX: Math.min.apply(Math, o()(h)), minY: Math.min.apply(Math, o()(v)), maxX: Math.max.apply(Math, o()(h)), maxY: Math.max.apply(Math, o()(v)) } }, u = function e(t, n, a, o, i, r) { r - i < o - a ? (t[n] += i - a, t[n] += (r - i) / 2, t[n] -= (o - a) / 2) : a < i ? t[n] += i - a : o > r && (t[n] -= o - r) }; function d(e, t) { var n = i.default.cornerstone, a = n.pixelToCanvas, o = n.canvasToPixel, r = n.getViewport, l = n.getEnabledElement, d = n.getDisplayedArea, c = o(e, { x: t.left, y: t.top }), f = s(e, t), g = f.minX, m = f.minY, h = f.maxX, v = f.maxY, p = r(e), x = l(e), $ = d(x.image, p), y = p.displayedArea ? p.displayedArea : $, T = y.tlhc, b = y.brhc, _ = T.y - 1, C = T.x - 1, j = b.y, S = b.x; u(c, "y", m, v, _, j), u(c, "x", g, h, C, S); var w = a(e, c); t.top = w.y, t.left = w.x } t.default = r }, "./util/convertToVector3.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../externalModules.js */ "./externalModules.js"); function o(e) { var t = a.default.cornerstoneMath; if (e instanceof t.Vector3) return e; var n = Object.keys(e); return n.includes("x") && n.includes("y") && n.includes("z") ? new t.Vector3(e.x, e.y, e.z) : new t.Vector3(e[0], e[1], e[2]) } }, "./util/copyPoints.js": function (e, t, n) { "use strict"; function a() { var e, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return { x: t.x, y: t.y } } n.r(t), t.default = function (e) { var t = a(e.page), n = a(e.image), o = a(e.client), i = a(e.canvas); return { page: t, image: n, client: o, canvas: i } } }, "./util/debounce.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./isObject.js */ "./util/isObject.js"); t.default = function e(t, n, o) { var i, r, l, s, u, d, c = 0, f = !1, g = !1, m = !0, h = !n && 0 !== n && "function" == typeof window.requestAnimationFrame; if ("function" != typeof t) throw TypeError("Expected a function"); function v(e) { var n = i, a = r; return i = r = void 0, c = e, s = t.apply(a, n) } function p(e, t) { return h ? window.requestAnimationFrame(e) : setTimeout(e, t) } function x(e) { var t = e - d, a = e - c; return void 0 === d || t >= n || t < 0 || g && a >= l } function $() { var e, t, a, o, i = Date.now(); if (x(i)) return y(i); u = p($, (t = (e = i) - d, a = e - c, o = n - t, g ? Math.min(o, l - a) : o)) } function y(e) { return (u = void 0, m && i) ? v(e) : (i = r = void 0, s) } function T() { for (var e, t = Date.now(), a = x(t), o = arguments.length, l = Array(o), m = 0; m < o; m++)l[m] = arguments[m]; if (i = l, r = this, d = t, a) { if (void 0 === u) return c = e = d, u = p($, n), f ? v(e) : s; if (g) return u = p($, n), v(d) } return void 0 === u && (u = p($, n)), s } return n = Number(n) || 0, Object(a.default)(o) && (f = Boolean(o.leading), l = (g = "maxWait" in o) ? Math.max(Number(o.maxWait) || 0, n) : l, m = "trailing" in o ? Boolean(o.trailing) : m), T.cancel = function e() { void 0 !== u && function e(t) { if (h) return window.cancelAnimationFrame(t); clearTimeout(t) }(u), c = 0, i = d = r = u = void 0 }, T.flush = function e() { return void 0 === u ? s : y(Date.now()) }, T.pending = function e() { return void 0 !== u }, T } }, "./util/debugLib/common.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a); t.default = function e(t) { function a(e) { for (var t = 0, n = 0; n < e.length; n++)t = (t << 5) - t + e.charCodeAt(n), t |= 0; return i.colors[Math.abs(t) % i.colors.length] } function i(e) { var t; function n() { for (var e = arguments.length, a = Array(e), o = 0; o < e; o++)a[o] = arguments[o]; if (n.enabled) { var r = n, l = Number(new Date), s = l - (t || l); r.diff = s, r.prev = t, r.curr = l, t = l, a[0] = i.coerce(a[0]), "string" != typeof a[0] && a.unshift("%O"); var u = 0; a[0] = a[0].replace(/%([a-zA-Z%])/g, function (e, t) { if ("%%" === e) return e; u++; var n = i.formatters[t]; if ("function" == typeof n) { var o = a[u]; e = n.call(r, o), a.splice(u, 1), u-- } return e }), i.formatArgs.call(r, a), (r.log || i.log).apply(r, a) } } return n.namespace = e, n.enabled = i.enabled(e), n.useColors = i.useColors(), n.color = a(e), n.destroy = r, n.extend = l, "function" == typeof i.init && i.init(n), i.instances.push(n), n } function r() { var e = i.instances.indexOf(this); return -1 !== e && (i.instances.splice(e, 1), !0) } function l(e, t) { var n = i(this.namespace + (void 0 === t ? ":" : t) + e); return n.log = this.log, n } function s(e) { return e.toString().substring(2, e.toString().length - 2).replace(/\.\*\?$/, "*") } return i.debug = i, i.default = i, i.coerce = function e(t) { return t instanceof Error ? t.stack || t.message : t }, i.disable = function e() { var t = [].concat(o()(i.names.map(s)), o()(i.skips.map(s).map(function (e) { return "-".concat(e) }))).join(","); return i.enable(""), t }, i.enable = function e(t) { i.save(t), i.names = [], i.skips = []; var n, a = ("string" == typeof t ? t : "").split(/[\s,]+/), o = a.length; for (n = 0; n < o; n++)a[n] && ("-" === (t = a[n].replace(/\*/g, ".*?"))[0] ? i.skips.push(RegExp("^".concat(t.substr(1), "$"))) : i.names.push(RegExp("^".concat(t, "$")))); for (n = 0; n < i.instances.length; n++) { var r = i.instances[n]; r.enabled = i.enabled(r.namespace) } }, i.enabled = function e(t) { var n, a; if ("*" === t[t.length - 1]) return !0; for (n = 0, a = i.skips.length; n < a; n++)if (i.skips[n].test(t)) return !1; for (n = 0, a = i.names.length; n < a; n++)if (i.names[n].test(t)) return !0; return !1 }, i.humanize = n(/*! ms */ "../node_modules/ms/index.js"), Object.keys(t).forEach(function (e) { i[e] = t[e] }), i.instances = [], i.names = [], i.skips = [], i.formatters = {}, i.selectColor = a, i.enable(i.load()), i } }, "./util/debugLib/index.js": function (e, t, n) { "use strict"; n.r(t), (function (e) { var a, o = n(/*! ./common.js */ "./util/debugLib/common.js"), i = { formatArgs: function e(t) { if (t[0] = "".concat((this.useColors ? "%c" : "") + this.namespace + (this.useColors ? " %c" : " ") + t[0] + (this.useColors ? "%c " : " "), "+").concat(r.humanize(this.diff)), this.useColors) { var n = "color: ".concat(this.color); t.splice(1, 0, n, "color: inherit"); var a = 0, o = 0; t[0].replace(/%[a-zA-Z%]/g, function (e) { "%%" !== e && (a++, "%c" === e && (o = a)) }), t.splice(o, 0, n) } }, save: function e(t) { try { t ? i.storage.setItem("debug", t) : i.storage.removeItem("debug") } catch (n) { } }, load: function t() { var n; try { n = i.storage.getItem("debug") } catch (a) { console.warn(a) } return !n && void 0 !== e && "env" in e && (n = e.env.DEBUG), n }, useColors: function e() { return "undefined" != typeof window && !!window.process && ("renderer" === window.process.type || !!window.process.__nwjs) || !("undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) && ("undefined" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || "undefined" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)) }, storage: function e() { try { return localStorage } catch (t) { } }() }; i.colors = ["#0000CC", "#0000FF", "#0033CC", "#0033FF", "#0066CC", "#0066FF", "#0099CC", "#0099FF", "#00CC00", "#00CC33", "#00CC66", "#00CC99", "#00CCCC", "#00CCFF", "#3300CC", "#3300FF", "#3333CC", "#3333FF", "#3366CC", "#3366FF", "#3399CC", "#3399FF", "#33CC00", "#33CC33", "#33CC66", "#33CC99", "#33CCCC", "#33CCFF", "#6600CC", "#6600FF", "#6633CC", "#6633FF", "#66CC00", "#66CC33", "#9900CC", "#9900FF", "#9933CC", "#9933FF", "#99CC00", "#99CC33", "#CC0000", "#CC0033", "#CC0066", "#CC0099", "#CC00CC", "#CC00FF", "#CC3300", "#CC3333", "#CC3366", "#CC3399", "#CC33CC", "#CC33FF", "#CC6600", "#CC6633", "#CC9900", "#CC9933", "#CCCC00", "#CCCC33", "#FF0000", "#FF0033", "#FF0066", "#FF0099", "#FF00CC", "#FF00FF", "#FF3300", "#FF3333", "#FF3366", "#FF3399", "#FF33CC", "#FF33FF", "#FF6600", "#FF6633", "#FF9900", "#FF9933", "#FFCC00", "#FFCC33"], i.log = console.debug || console.log || function () { }; var r = Object(o.default)(i); r.formatters.j = function (e) { try { return JSON.stringify(e) } catch (t) { return "[UnexpectedJSONParseError]: ".concat(t.message) } }, t.default = r }).call(this, n(/*! ./../../../node_modules/process/browser.js */ "../node_modules/process/browser.js")) }, "./util/deepmerge.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a), i = function e(t) { return t && "object" === o()(t) && "[object RegExp]" !== Object.prototype.toString.call(t) && "[object Date]" !== Object.prototype.toString.call(t) }, r = function e(t, n) { var a; return n && !0 === n.clone && i(t) ? u((a = t, Array.isArray(a) ? [] : {}), t, n) : t }, l = function e(t, n, a) { var o = t.slice(); return n.forEach(function (e, n) { void 0 === o[n] ? o[n] = r(e, a) : i(e) ? o[n] = u(t[n], e, a) : -1 === t.indexOf(e) && o.push(r(e, a)) }), o }, s = function e(t, n, a) { var o = {}; return i(t) && Object.keys(t).forEach(function (e) { o[e] = r(t[e], a) }), Object.keys(n).forEach(function (e) { i(n[e]) && t[e] ? o[e] = u(t[e], n[e], a) : o[e] = r(n[e], a) }), o }, u = function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, a = arguments.length > 2 ? arguments[2] : void 0, o = Array.isArray(n), i = (a || { arrayMerge: l }).arrayMerge || l; if (o) return Array.isArray(t) ? i(t, n, a) : r(n, a); var u = s(t, n, a); return Object.getPrototypeOf(t) !== Object.prototype && Object.setPrototypeOf(u, Object.getPrototypeOf(t)), u }; t.default = u }, "./util/ellipse/calculateEllipseStatistics.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./pointInEllipse.js */ "./util/ellipse/pointInEllipse.js"); t.default = function (e, t) { for (var n = 0, o = 0, i = 0, r = 0, l = null, s = null, u = t.top; u < t.top + t.height; u++)for (var d = t.left; d < t.left + t.width; d++) { var c = { x: d, y: u }; Object(a.default)(t, c) && (null === l && (l = e[r], s = e[r]), n += e[r], o += e[r] * e[r], l = Math.min(l, e[r]), s = Math.max(s, e[r]), i++), r++ } if (0 === i) return { count: i, mean: 0, variance: 0, stdDev: 0, min: 0, max: 0 }; var f = n / i, g = o / i - f * f; return { count: i, mean: f, variance: g, stdDev: Math.sqrt(g), min: l, max: s } } }, "./util/ellipse/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./calculateEllipseStatistics.js */ "./util/ellipse/calculateEllipseStatistics.js"); n.d(t, "calculateEllipseStatistics", function () { return a.default }); var o = n(/*! ./pointInEllipse.js */ "./util/ellipse/pointInEllipse.js"); n.d(t, "pointInEllipse", function () { return o.default }), t.default = { calculateEllipseStatistics: a.default, pointInEllipse: o.default } }, "./util/ellipse/pointInEllipse.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { var n = e.width / 2, a = e.height / 2; if (n <= 0 || a <= 0) return !1; var o = { x: e.left + n, y: e.top + a }, i = { x: t.x - o.x, y: t.y - o.y }; return i.x * i.x / (n * n) + i.y * i.y / (a * a) <= 1 } }, "./util/findAndMoveHelpers.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "moveHandleNearImagePoint", function () { return f }), n.d(t, "findHandleDataNearImagePoint", function () { return g }), n.d(t, "moveAnnotation", function () { return m }); var a = n(/*! @babel/runtime/helpers/defineProperty */ "../node_modules/@babel/runtime/helpers/defineProperty.js"), o = n.n(a), i = n(/*! ../store/index.js */ "./store/index.js"), r = n(/*! ../manipulators/getHandleNearImagePoint.js */ "./manipulators/getHandleNearImagePoint.js"), l = n(/*! ./../manipulators/index.js */ "./manipulators/index.js"), s = n(/*! ./getProximityThreshold.js */ "./util/getProximityThreshold.js"), u = n(/*! ../events */ "./events.js"), d = n(/*! ./triggerEvent */ "./util/triggerEvent.js"); function c(e, t) { var n = Object.keys(e); if (Object.getOwnPropertySymbols) { var a = Object.getOwnPropertySymbols(e); t && (a = a.filter(function (t) { return Object.getOwnPropertyDescriptor(e, t).enumerable })), n.push.apply(n, a) } return n } var f = function e(t, n, a, r, s) { a.active = !0, i.state.isToolLocked = !0; var f = function e(n) { var i = t.detail.element, r = a.toolType || a.toolName, l = { toolName: r, toolType: r, element: i, measurementData: function e(t) { for (var n = 1; n < arguments.length; n++) { var a = null != arguments[n] ? arguments[n] : {}; n % 2 ? c(a, !0).forEach(function (e) { o()(t, e, a[e]) }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(a)) : c(a).forEach(function (e) { Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(a, e)) }) } return t }({}, a, { active: !1 }) }; Object(d.default)(i, u.default.MEASUREMENT_COMPLETED, l) }; Object(l.moveHandle)(t.detail, n.name, a, r, n.options, s, f), t.stopImmediatePropagation(), t.stopPropagation(), t.preventDefault() }, g = function e(t, n, a, o) { for (var i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : "mouse", l = 0; l < n.data.length; l++) { var u = n.data[l], d = Object(r.default)(t, u.handles, o, Object(s.default)(i, a)); if (d) return { handle: d, data: u } } }, m = function e(t, n, a) { var o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "mouse"; a.active = !0, i.state.isToolLocked = !0, Object(l.moveAllHandles)(t.detail, n.name, a, null, n.options, o, function () { a.active = !1, i.state.isToolLocked = !1 }), t.stopImmediatePropagation(), t.stopPropagation(), t.preventDefault() } }, "./util/freehand/ClickedLineData.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = function e(t, n) { o()(this, e), this.toolIndex = t, this.handleIndexArray = n } }, "./util/freehand/FreehandHandleData.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = function e(t) { var n = !(arguments.length > 1) || void 0 === arguments[1] || arguments[1], a = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2]; o()(this, e), this.x = t.x, this.y = t.y, this.highlight = n, this.active = a, this.lines = [] } }, "./util/freehand/FreehandLineFinder.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return d }); var a = n(/*! @babel/runtime/helpers/classCallCheck */ "../node_modules/@babel/runtime/helpers/classCallCheck.js"), o = n.n(a), i = n(/*! @babel/runtime/helpers/createClass */ "../node_modules/@babel/runtime/helpers/createClass.js"), r = n.n(i), l = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), s = n(/*! ../../externalModules.js */ "./externalModules.js"), u = n(/*! ./ClickedLineData.js */ "./util/freehand/ClickedLineData.js"), d = function () { function e(t, n) { o()(this, e), this._eventData = t, this._toolName = n } return r()(e, [{ key: "findLine", value: function e() { var t = this.findTool(); if (null === t) return null; var n = this._getCloseLinesInTool(t); return n ? this._findCorrectLine(t, n) : null } }, { key: "findTool", value: function e() { return (this._toolData = Object(l.getToolState)(this._eventData.element, this._toolName), this._mousePoint = this._eventData.currentPoints.canvas, this._toolData) ? (0, this._nearestHandleToPointAllTools().toolIndex) : null } }, { key: "_nearestHandleToPointAllTools", value: function e() { for (var t = this._toolData, n = { toolIndex: null, handleIndex: null, distance: 1 / 0 }, a = 0; a < t.data.length; a++) { var o = this._nearestHandleToPoint(a); null !== o && o.distance < n.distance && (n = o) } return n } }, { key: "_nearestHandleToPoint", value: function e(t) { var n = this._eventData, a = this._toolData.data[t], o = a.handles.points; if (void 0 === o || !1 === a.visible) return null; for (var i = { toolIndex: t, handleIndex: null, distance: 1 / 0 }, r = 0; r < o.length; r++) { var l = s.default.cornerstone.pixelToCanvas(n.element, o[r]), u = s.default.cornerstoneMath.point.distance(l, this._mousePoint); u < i.distance && (i.handleIndex = r, i.distance = u) } return i } }, { key: "_getCloseLinesInTool", value: function t(n) { for (var a = this._toolData.data[n].handles.points, o = [], i = 0; i < a.length; i++) { var r = e.getNextHandleIndex(i, a.length); 10 > this._distanceOfPointfromLine(a[i], a[r]) && o.push([i, r]) } return o } }, { key: "_findCorrectLine", value: function e(t, n) { for (var a = 0; a < n.length; a++)if (this._pointProjectsToLineSegment(t, n[a])) return new u.default(t, n[a]); return null } }, { key: "_pointProjectsToLineSegment", value: function t(n, a) { var o = this._eventData, i = this._toolData.data[n], r = i.handles.points; if (void 0 !== i.handles.points) { if (!1 === i.visible) return !1; var l = r[a[0]], s = r[a[1]], u = e.getCanvasPointsFromHandles(l, s, o.element), d = e.getLineAsVector(u), c = this._getLineOriginToMouseAsVector(u), f = (c[0] * d[0] + c[1] * d[1]) / d.magnitude; return !!(f > 0) && !!(f < d.magnitude) } } }, { key: "_getLineOriginToMouseAsVector", value: function e(t) { return [this._mousePoint.x - t[0].x, this._mousePoint.y - t[0].y] } }, { key: "_distanceOfPointfromLine", value: function e(t, n) { var a, o = this._eventData, i = s.default.cornerstone.pixelToCanvas(o.element, t), r = s.default.cornerstone.pixelToCanvas(o.element, n), l = this._mousePoint, u = Math.abs((r.y - i.y) * l.x - (r.x - i.x) * l.y + r.x * i.y - r.y * i.x); return u / s.default.cornerstoneMath.point.distance(i, r) } }], [{ key: "getCanvasPointsFromHandles", value: function e(t, n, a) { var o = []; return t.x < n.x ? (o.push(s.default.cornerstone.pixelToCanvas(a, t)), o.push(s.default.cornerstone.pixelToCanvas(a, n))) : (o.push(s.default.cornerstone.pixelToCanvas(a, n)), o.push(s.default.cornerstone.pixelToCanvas(a, t))), o } }, { key: "getLineAsVector", value: function e(t) { var n = [t[1].x - t[0].x, t[1].y - t[0].y]; return n.magnitude = s.default.cornerstoneMath.point.distance(t[0], t[1]), n } }, { key: "getNextHandleIndex", value: function e(t, n) { var a; return t < n - 1 ? t + 1 : 0 } }]), e }() }, "./util/freehand/addLine.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { t === e.length - 1 ? e[t].lines.push(e[0]) : e[t].lines.push(e[t + 1]) } }, "./util/freehand/calculateFreehandStatistics.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./pointInFreehand.js */ "./util/freehand/pointInFreehand.js"); function o(e, t, n, o) { Object(a.default)(e, t) && (n.value += o, n.squared += o * o, n.count++) } t.default = function (e, t, n) { var a = { count: 0, mean: 0, variance: 0, stdDev: 0 }, i = function e(t, n, a) { for (var i = { value: 0, squared: 0, count: 0 }, r = 0, l = n.top; l < n.top + n.height; l++)for (var s = n.left; s < n.left + n.width; s++)o(a, { x: s, y: l }, i, t[r]), r++; return i }(e, t, n); return 0 === i.count || (a.count = i.count, a.mean = i.value / i.count, a.variance = i.squared / i.count - a.mean * a.mean, a.stdDev = Math.sqrt(a.variance)), a } }, "./util/freehand/freehandArea.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { var n = 0, a = e.length - 1; t = t || 1; for (var o = 0; o < e.length; o++)n += (e[a].x + e[o].x) * (e[a].y - e[o].y), a = o; return Math.abs(n * t / 2) } }, "./util/freehand/freehandIntersect.js": function (e, t, n) { "use strict"; function a(e, t, n, a) { for (var r = e.length - 1, l = 0; l < e.length; l++) { if (-1 !== a.indexOf(l) || -1 !== a.indexOf(r)) { r = l; continue } var s = i(e[r]), u = i(e[l]); if (o(t, n, s, u)) return !0; r = l } return !1 } function o(e, t, n, a) { var o = !1, i = [r(e, t, n), r(e, t, a), r(n, a, e), r(n, a, t)]; return i[0] !== i[1] && i[2] !== i[3] || (0 === i[0] && l(e, n, t) ? o = !0 : 0 === i[1] && l(e, a, t) ? o = !0 : 0 === i[2] && l(n, e, a) ? o = !0 : 0 === i[3] && l(n, t, a) && (o = !0), o) } function i(e) { return { x: e.x, y: e.y } } function r(e, t, n) { var a = (t.y - e.y) * (n.x - t.x) - (t.x - e.x) * (n.y - t.y); return 0 === a ? 0 : a > 0 ? 1 : 2 } function l(e, t, n) { return !!(t.x <= Math.max(e.x, n.x) && t.x >= Math.min(e.x, n.x) && t.y <= Math.max(e.y, n.y) && t.y >= Math.min(e.y, n.y)) } n.r(t), t.default = { newHandle: function e(t, n) { var o = n.length - 1, r = i(n[o]), l = i(t); return a(n, r, l, [o]) }, end: function e(t) { var n = t.length - 1, o = i(t[n]), r = i(t[0]); return a(t, o, r, [n, 0]) }, modify: function e(t, n) { var o = i(t[n]), r = n - 1; 0 === n && (r = t.length - 1); var l = i(t[r]); return !!a(t, o, l, [n, r]) || (l = i(t[r = n === t.length - 1 ? 0 : n + 1]), a(t, o, l, [n, r])) } } }, "./util/freehand/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./calculateFreehandStatistics.js */ "./util/freehand/calculateFreehandStatistics.js"), o = n(/*! ./ClickedLineData.js */ "./util/freehand/ClickedLineData.js"), i = n(/*! ./freehandArea.js */ "./util/freehand/freehandArea.js"), r = n(/*! ./FreehandHandleData.js */ "./util/freehand/FreehandHandleData.js"), l = n(/*! ./freehandIntersect.js */ "./util/freehand/freehandIntersect.js"), s = n(/*! ./FreehandLineFinder.js */ "./util/freehand/FreehandLineFinder.js"), u = n(/*! ./insertOrDelete.js */ "./util/freehand/insertOrDelete.js"), d = n(/*! ./pointInFreehand.js */ "./util/freehand/pointInFreehand.js"), c = n(/*! ./addLine.js */ "./util/freehand/addLine.js"); t.default = { calculateFreehandStatistics: a.default, ClickedLineData: o.default, freehandArea: i.default, FreehandHandleData: r.default, freehandIntersect: l.default, FreehandLineFinder: s.default, insertOrDelete: u.default, pointInFreehand: d.default, addLine: c.default } }, "./util/freehand/insertOrDelete.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./FreehandLineFinder.js */ "./util/freehand/FreehandLineFinder.js"), o = n(/*! ./FreehandHandleData.js */ "./util/freehand/FreehandHandleData.js"), i = n(/*! ../../stateManagement/toolState.js */ "./stateManagement/toolState.js"), r = n(/*! ../../externalModules.js */ "./externalModules.js"), l = n(/*! ./addLine.js */ "./util/freehand/addLine.js"); function s(e, t) { var n = Object(i.getToolState)(e.element, this.name); if (void 0 !== n) { var a = t.handleIndex, o = t.toolIndex, l = n.data[o], s = l.handles.points; !(s.length <= 3) && (a === s.length - 1 ? (s[a - 1].lines.pop(), s[a - 1].lines.push(s[0])) : 0 === a ? (s[s.length - 1].lines.pop(), s[s.length - 1].lines.push(s[a + 1])) : (s[a - 1].lines.pop(), s[a - 1].lines.push(s[a + 1])), s.splice(a, 1), l.invalidated = !0, l.active = !0, l.highlight = !0, r.default.cornerstone.updateImage(e.element)) } } function u(e, t) { var n = Object(i.getToolState)(e.element, this.name); if (void 0 !== n) { var a = n.data[t.toolIndex], s = function e(t) { for (var n = t.handleIndexArray, a = 1 / 0, o = n.includes(0), i = 0; i < n.length; i++) { var r = n[i]; 0 !== r && r < a && (a = r) } return o && 1 === a && (a = 0), ++a }(t); if (s !== 1 / 0) { var u = new o.default(e.currentPoints.image), d = a.handles.points; d.splice(s, 0, u), d[s - 1].lines.pop(), d[s - 1].lines.push(e.currentPoints.image), Object(l.default)(d, s), a.active = !0, a.highlight = !0, a.invalidated = !0, r.default.cornerstone.updateImage(e.element) } } } t.default = function (e, t) { var n = e.detail; if (t && null !== t.handleNearby) { var o = { toolIndex: t.toolIndex, handleIndex: t.handleNearby }; s.call(this, n, o) } else { var i = new a.default(n, this.name).findLine(); i && u.call(this, n, i) } } }, "./util/freehand/pointInFreehand.js": function (e, t, n) { "use strict"; function a(e, t, n) { var a, o, i; return a = e.y, o = t.y, i = n.y, !!((o < a && a < i || i < a && a < o) && function e(t, n, a) { if (n.x > t.x && a.x > t.x) return !0; if (n.x === a.x) return t.x < n.x; if (n.x > a.x) { var o = n; n = a, a = o } var i, r, l, s, u = (i = t, r = n, l = a, s = (l.y - r.y) / (l.x - r.x), { value: r.y + s * (i.x - r.x), gradient: s }); return Math.sign(u.gradient) * t.y > Math.sign(u.gradient) * u.value }(e, t, n)) } n.r(t), t.default = function (e, t) { for (var n = !1, o = e.length - 1, i = 0; i < e.length; i++)a(t, e[i], e[o]) && (n = !n), o = i; return n } }, "./util/getActiveTool.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return r }); var a = n(/*! ../store */ "./store/index.js"), o = n(/*! ../store/getActiveToolsForElement */ "./store/getActiveToolsForElement.js"), i = n(/*! ../store/filterToolsUsableWithMultiPartTools */ "./store/filterToolsUsableWithMultiPartTools.js"); function r(e, t) { var n, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "mouse"; if ("touch" === r ? n = (n = Object(o.default)(e, a.getters.touchTools())).filter(function (e) { return e.options.isTouchActive }) : (n = (n = Object(o.default)(e, a.getters.mouseTools())).filter(function (e) { return Array.isArray(e.options.mouseButtonMask) && t && e.options.mouseButtonMask.includes(t) && e.options.isMouseActive }), a.state.isMultiPartToolActive && (n = Object(i.default)(n))), 0 !== n.length) return n[0] } }, "./util/getCircleCoords.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../externalModules */ "./externalModules.js"); function o(e, t) { var n = (0, a.default.cornerstoneMath.point.distance)(e, t); return { left: Math.floor(Math.min(e.x - n, t.x)), top: Math.floor(Math.min(e.y - n, t.y)), width: 2 * n, height: 2 * n } } }, "./util/getDefault.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { return void 0 === e ? t : e } }, "./util/getKeyPressData.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return i }); var a = n(/*! ../store/ */ "./store/index.js"), o = n(/*! ../externalModules */ "./externalModules.js"); function i(e) { var t = o.default.cornerstone, n = e.currentTarget, i = t.getEnabledElement(n); if (i && i.image) { var r = a.default.state.mousePositionImage; return { event: window.event || e, element: n, viewport: t.getViewport(n), image: i.image, currentPoints: { image: r, canvas: t.pixelToCanvas(n, r) }, keyCode: e.keyCode, which: e.which } } } }, "./util/getLuminance.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n, o, i) { if (!e) throw Error("getLuminance: parameter element must not be undefined"); t = Math.round(t), n = Math.round(n); var r, l, s, u = a.default.cornerstone.getEnabledElement(e).image, d = [], c = 0, f = u.getPixelData(); if (u.color) for (l = 0; l < i; l++)for (s = 0; s < o; s++) { var g = f[r = ((l + n) * u.columns + (s + t)) * 4], m = f[r + 1], h = f[r + 2]; d[c++] = .2126 * g + .7152 * m + .0722 * h } else for (l = 0; l < i; l++)for (s = 0; s < o; s++)r = (l + n) * u.columns + (s + t), d[c++] = f[r] * u.slope + u.intercept; return d } }, "./util/getMaxSimultaneousRequests.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getDefaultSimultaneousRequests", function () { return s }), n.d(t, "getMaxSimultaneousRequests", function () { return l }), n.d(t, "setMaxSimultaneousRequests", function () { return r }), n.d(t, "getBrowserInfo", function () { return i }), n.d(t, "isMobileDevice", function () { return u }); var a, o = { default: 6, IE: { 9: 6, 10: 8, default: 8 }, Firefox: { default: 6 }, Opera: { 10: 8, 11: 6, 12: 6, default: 6 }, Chrome: { default: 6 }, Safari: { default: 6 } }; function i() { var e, t = navigator.userAgent, n = t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || []; return /trident/i.test(n[1]) ? (e = /\brv[ :]+(\d+)/g.exec(t) || [], "IE ".concat(e[1] || "")) : "Chrome" === n[1] && null !== (e = t.match(/\b(OPR|Edge)\/(\d+)/)) ? e.slice(1).join(" ").replace("OPR", "Opera") : (n = n[2] ? [n[1], n[2]] : [navigator.appName, navigator.appVersion, "-?"], null !== (e = t.match(/version\/(\d+)/i)) && n.splice(1, 1, e[1]), n.join(" ")) } function r(e) { a = e } function l() { return a || s() } function s() { var e = i().split(" "), t = e[0], n = e[1], a = o[t]; return a ? a[n] ? a[n] : a.default : o.default } function u() { return RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent) } }, "./util/getPixelSpacing.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../externalModules */ "./externalModules.js"); function o(e) { var t = a.default.cornerstone.metaData.get("imagePlaneModule", e.imageId); return t ? { rowPixelSpacing: t.rowPixelSpacing || t.rowImagePixelSpacing, colPixelSpacing: t.columnPixelSpacing || t.colImagePixelSpacing } : { rowPixelSpacing: e.rowPixelSpacing, colPixelSpacing: e.columnPixelSpacing } } }, "./util/getProximityThreshold.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../store */ "./store/index.js"); function o(e, t) { var n = a.state.clickProximity, o = a.state.touchProximity, i = a.state.tools.find(function (e) { return e.name === t }); return i && i.configuration && (n = i.configuration.clickProximity || n, o = i.configuration.touchProximity || o), "mouse" === e ? n : o } }, "./util/getRGBPixels.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n, o, i) { if (!e) throw Error("getRGBPixels: parameter element must not be undefined"); t = Math.round(t), n = Math.round(n); var r, l, s, u = a.default.cornerstone.getEnabledElement(e), d = [], c = 0, f = u.image.getPixelData(); if (u.image.color) for (l = 0; l < i; l++)for (s = 0; s < o; s++) { var g = f[r = ((l + n) * u.image.columns + (s + t)) * 4], m = f[r + 1], h = f[r + 2], v = f[r + 3]; d[c++] = g, d[c++] = m, d[c++] = h, d[c++] = v } return d } }, "./util/getROITextBoxCoords.js": function (e, t, n) { "use strict"; function a(e, t) { var n, a, o, i, r, l, s = (n = t, a = [n.start, n.end].sort(function e(t, n) { return t.x < n.x ? -1 : 1 }), o = [n.start, n.end].sort(function e(t, n) { return t.y < n.y ? -1 : 1 }), i = a[0], r = a[a.length - 1], { top: o[0], left: i, bottom: o[o.length - 1], right: r }), u = (s.left.x + s.right.x) / 2, d = (s.top.y + s.bottom.y) / 2, c = {}; return e.rotation >= 0 && e.rotation < 90 && (c.x = e.hflip ? s.left.x : s.right.x, c.y = d), e.rotation >= 90 && e.rotation < 180 && (c.x = u, c.y = e.vflip ? s.bottom.y : s.top.y), e.rotation >= 180 && e.rotation < 270 && (c.x = e.hflip ? s.right.x : s.left.x, c.y = d), e.rotation >= 270 && e.rotation < 360 && (c.x = u, c.y = e.vflip ? s.top.y : s.bottom.y), c } n.r(t), n.d(t, "default", function () { return a }) }, "./util/isEmptyObject.js": function (e, t, n) { "use strict"; n.r(t); var a = function e(t) { return 0 === Object.keys(t).length && t.constructor === Object }; t.default = a }, "./util/isObject.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/typeof */ "../node_modules/@babel/runtime/helpers/typeof.js"), o = n.n(a); t.default = function e(t) { var n = o()(t); return null !== t && ("object" === n || "function" === n) } }, "./util/isPointInImage.js": function (e, t, n) { "use strict"; function a(e, t, n) { var a = e.x, o = e.y; return a < n && a >= 0 && o < t && o >= 0 } n.r(t), n.d(t, "default", function () { return a }) }, "./util/isPointInPolygon.js": function (e, t, n) { "use strict"; function a(e, t) { for (var n = e[0], a = e[1], o = !1, i = 0, r = t.length - 1; i < t.length; r = i++) { var l = t[i][0], s = t[i][1], u = t[r][0], d = t[r][1]; s > a != d > a && n < (u - l) * (a - s) / (d - s) + l && (o = !o) } return o } n.r(t), n.d(t, "default", function () { return a }) }, "./util/lineSegDistance.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n, o) { var i = a.default.cornerstone, r = { start: i.pixelToCanvas(e, t), end: i.pixelToCanvas(e, n) }; return a.default.cornerstoneMath.lineSegment.distanceToPoint(r, o) } }, "./util/logger.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "getLogger", function () { return r }), n.d(t, "enable", function () { return l }), n.d(t, "disable", function () { return s }); var a = n(/*! ./debugLib/index.js */ "./util/debugLib/index.js"), o = "cornerstoneTools", i = Object(a.default)(o); i.enabled || (console.log("%cCornerstone Tools", "background: #339955; padding: 4px; font-weight: bold; color: white"), console.info('run %clocalStorage.setItem("debug", "cornerstoneTools")%c to see console output', "background: #eaeaea; color: #333; font-family: monospace", "")); var r = function e(t) { var n; return { log: i.extend(t), warn: console.warn.bind(console), error: console.error.bind(console) } }, l = function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "".concat(o, ":*"); return a.default.enable(t) }, s = function e() { return a.default.disable() } }, "./util/makeUnselectable.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { e.style.webkitUserSelect = "none", e.style.webkitTouchCallout = "none", e.style.mozUserSelect = "none", e.style.msUserSelect = "none", e.style.oUserSelect = "none", e.style.khtmlUserSelect = "none", e.style.userSelect = "none", e.unselectable = "on", e.oncontextmenu = function () { return !1 }, !0 === t && (e.style.pointerEvents = "none") } }, "./util/numbersWithCommas.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e) { var t = e.toString().split("."); return t[0] = t[0].replace(/\B(?=(\d{3})+(?!\d))/g, ","), t.join(".") } }, "./util/pointInsideBoundingBox.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t) { if (e.boundingBox) return a.default.cornerstoneMath.point.insideRect(t, e.boundingBox) } }, "./util/pointProjector.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "projectPatientPointToImagePlane", function () { return i }), n.d(t, "imagePointToPatientPoint", function () { return r }), n.d(t, "planePlaneIntersection", function () { return l }), n.d(t, "rotatePoint", function () { return s }); var a = n(/*! ../externalModules.js */ "./externalModules.js"), o = n(/*! ../util/convertToVector3.js */ "./util/convertToVector3.js"); function i(e, t) { var n = Object(o.default)(t.rowCosines), a = Object(o.default)(t.columnCosines), i = Object(o.default)(t.imagePositionPatient), r = e.clone().sub(i), l = n.dot(r) / t.columnPixelSpacing, s = a.dot(r) / t.rowPixelSpacing; return { x: l, y: s } } function r(e, t) { var n = Object(o.default)(t.rowCosines), a = Object(o.default)(t.columnCosines), i = Object(o.default)(t.imagePositionPatient), r = n.clone().multiplyScalar(e.x); r.multiplyScalar(t.columnPixelSpacing); var l = a.clone().multiplyScalar(e.y); l.multiplyScalar(t.rowPixelSpacing); var s = r.add(l); return s.add(i), s } function l(e, t) { var n = Object(o.default)(e.rowCosines), i = Object(o.default)(e.columnCosines), l = Object(o.default)(e.imagePositionPatient), s = Object(o.default)(t.rowCosines), u = Object(o.default)(t.columnCosines), d = Object(o.default)(t.imagePositionPatient), c = n.clone().cross(i), f = new a.default.cornerstoneMath.Plane; f.setFromNormalAndCoplanarPoint(c, l); var g = s.clone().cross(u), m = new a.default.cornerstoneMath.Plane; m.setFromNormalAndCoplanarPoint(g, d); var h, v, p, x, $, y = m.clone().intersectPlane(f), T = y.origin, b = y.direction, _ = r({ x: t.columns, y: t.rows }, t), C = d.distanceTo(_), j = new a.default.cornerstoneMath.Line3; j.start = T, j.end = T.clone().add(b.multiplyScalar(C)); var S, w, M, E = (h = t, v = r({ x: 0, y: 0 }, h), p = r({ x: h.columns, y: 0 }, h), x = r({ x: 0, y: h.rows }, h), $ = r({ x: h.columns, y: h.rows }, h), { top: new a.default.cornerstoneMath.Line3(v, p), left: new a.default.cornerstoneMath.Line3(v, x), right: new a.default.cornerstoneMath.Line3(p, $), bottom: new a.default.cornerstoneMath.Line3(x, $) }), I = (S = j, w = E, M = [], Object.keys(w).forEach(function (e) { var t = w[e], n = S.intersectLine(t); n && M.push(n) }), M); if (2 === I.length) return { start: I[0], end: I[1] } } function s(e, t, n) { var a = n * (Math.PI / 180), o = Math.cos(a) * (e.x - t.x) - Math.sin(a) * (e.y - t.y) + t.x, i = Math.sin(a) * (e.x - t.x) + Math.cos(a) * (e.y - t.y) + t.y; return { x: o, y: i } } }, "./util/roundToDecimal.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { var n = Math.pow(10, t); return Math.round(e * n) / n } }, "./util/scroll.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./scrollToIndex.js */ "./util/scrollToIndex.js"), o = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), i = n(/*! ./clip.js */ "./util/clip.js"), r = n(/*! ./../externalModules.js */ "./externalModules.js"); t.default = function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], l = !(arguments.length > 3) || void 0 === arguments[3] || arguments[3], s = Object(o.getToolState)(e, "stack"); if (s && s.data && s.data.length) { var u = s.data[0]; u.pending || (u.pending = []); var d = u.currentImageIdIndex + t; if (n ? d %= u.imageIds.length : d = Object(i.default)(d, 0, u.imageIds.length - 1), l) Object(a.default)(e, d); else { var c = { index: d }; u.pending.push(c), function e(t, n, o) { if (t.pending[0] === n) { if (t.currentImageIdIndex === n.index) { t.pending.splice(t.pending.indexOf(n), 1), t.pending.length > 0 && e(t, t.pending[0], o); return } var i = function a(i) { t.imageIds.indexOf(i.detail.image.imageId) === n.index && (t.pending.splice(t.pending.indexOf(n), 1), o.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE, a), t.pending.length > 0 && e(t, t.pending[0], o)) }; o.addEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE, i), Object(a.default)(o, n.index) } }(u, c, e) } } } }, "./util/scrollToIndex.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../events.js */ "./events.js"), o = n(/*! ../externalModules.js */ "./externalModules.js"), i = n(/*! ../stateManagement/toolState.js */ "./stateManagement/toolState.js"), r = n(/*! ../stateManagement/loadHandlerManager.js */ "./stateManagement/loadHandlerManager.js"), l = n(/*! ../util/triggerEvent.js */ "./util/triggerEvent.js"); t.default = function (e, t) { var n, s, u = Object(i.getToolState)(e, "stack"); if (u && u.data && u.data.length) { var d = o.default.cornerstone; if (u.data.length > 1) { var c = Object(i.getToolState)(e, "stackRenderer"); c && c.data && c.data.length && (n = c.data[0]) } var f = u.data[0]; t < 0 && (t += f.imageIds.length); var g = r.default.getStartLoadHandler(e), m = r.default.getEndLoadHandler(e), h = r.default.getErrorLoadingHandler(e); if (t !== f.currentImageIdIndex) { g && g(e); var v = { newImageIdIndex: t, direction: t - f.currentImageIdIndex }; f.currentImageIdIndex = t; var p = f.imageIds[t]; (s = Boolean(f.preventCache) ? d.loadImage(p) : d.loadAndCacheImage(p)).then(function a(o) { if (f.currentImageIdIndex === t) { try { d.getEnabledElement(e) } catch (i) { return } n ? (n.currentImageIdIndex = t, n.render(e, u.data)) : d.displayImage(e, o), m && m(e, o) } }, function n(a) { var o = f.imageIds[t]; h && h(e, o, a) }), Object(l.default)(e, a.default.STACK_SCROLL, v) } } } }, "./util/segmentation/drawBrush.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "drawBrushPixels", function () { return r }); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a), i = n(/*! ./eraseIfSegmentIndex.js */ "./util/segmentation/eraseIfSegmentIndex.js"); function r(e, t, n, a) { var r = arguments.length > 4 && void 0 !== arguments[4] && arguments[4], l = function e(t, n) { return n * a + t }; e.forEach(function (e) { var a = l.apply(void 0, o()(e)); r ? Object(i.default)(a, t, n) : t[a] = n }) } }, "./util/segmentation/eraseIfSegmentIndex.js": function (e, t, n) { "use strict"; function a(e, t, n) { t[e] === n && (t[e] = 0) } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/eraseOutsideBoundingBox.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ./eraseIfSegmentIndex */ "./util/segmentation/eraseIfSegmentIndex.js"); function o(e, t, n, o) { for (var i = e.detail, r = t.pixelData, l = t.segmentIndex, s = i.image, u = s.width, d = s.height, c = 0; c < u; c++)for (var f = 0; f < n[1]; f++)Object(a.default)(f * u + c, r, l); for (var g = 0; g < n[0]; g++)for (var m = n[1]; m < o[1]; m++)Object(a.default)(m * u + g, r, l); for (var h = o[0]; h < u; h++)for (var v = n[1]; v < o[1]; v++)Object(a.default)(v * u + h, r, l); for (var p = 0; p < u; p++)for (var x = o[1]; x < d; x++)Object(a.default)(x * u + p, r, l) } }, "./util/segmentation/eraseShape.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "eraseInsideShape", function () { return s }), n.d(t, "eraseOutsideShape", function () { return u }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ./eraseOutsideBoundingBox */ "./util/segmentation/eraseOutsideBoundingBox.js"), r = n(/*! ./isSameSegment.js */ "./util/segmentation/isSameSegment.js"); function l(e, t, n, a, l) { var s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "inside", u = e.detail.image.width, d = t.pixelData, c = t.segmentIndex, f = o()(a, 2), g = f[0], m = f[1], h = o()(l, 2), v = h[0], p = h[1]; "outside" === s && Object(i.default)(e, t, a, l); for (var x = g; x < v; x++)for (var $ = m; $ < p; $++) { var y = $ * u + x; Object(r.default)(y, d, c) && n({ x: x, y: $ }) && (d[y] = 0) } } function s(e, t, n, a, o) { l(e, t, n, a, o, "inside") } function u(e, t, n, a, o) { l(e, t, function (e) { return !n(e) }, a, o, "outside") } Object(n(/*! ../logger.js */ "./util/logger.js").getLogger)("util:segmentation:operations:eraseOutsideCircle") }, "./util/segmentation/fillOutsideBoundingBox.js": function (e, t, n) { "use strict"; function a(e, t, n, a) { for (var o = t.pixelData, i = t.segmentIndex, r = e.detail.image, l = r.width, s = r.height, u = 0; u < l; u++)for (var d = 0; d < n[1]; d++)o[d * l + u] = i; for (var c = 0; c < n[0]; c++)for (var f = n[1]; f < a[1]; f++)o[f * l + c] = i; for (var g = a[0]; g < l; g++)for (var m = n[1]; m < a[1]; m++)o[m * l + g] = i; for (var h = 0; h < l; h++)for (var v = a[1]; v < s; v++)o[v * l + h] = i } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/fillShape.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "fillInsideShape", function () { return s }), n.d(t, "fillOutsideShape", function () { return u }); var a = n(/*! @babel/runtime/helpers/slicedToArray */ "../node_modules/@babel/runtime/helpers/slicedToArray.js"), o = n.n(a), i = n(/*! ./fillOutsideBoundingBox */ "./util/segmentation/fillOutsideBoundingBox.js"), r = Object(n(/*! ../logger.js */ "./util/logger.js").getLogger)("util:segmentation:operations:helpers:fillShape"); function l(e, t, n, a, l) { var s = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : "inside", u = t.pixelData, d = t.segmentIndex; if (void 0 === u || void 0 === d) { r.error("fillInsideShape requires operationData to contain pixelData and segmentIndex"); return } var c = e.detail.image.width, f = o()(a, 2), g = f[0], m = f[1], h = o()(l, 2), v = h[0], p = h[1]; "outside" === s && Object(i.default)(e, t, a, l); for (var x = g; x < v; x++)for (var $ = m; $ < p; $++) { var y = $ * c + x; n({ x: x, y: $ }) && (u[y] = d) } } function s(e, t, n, a, o) { l(e, t, n, a, o, "inside") } function u(e, t, n, a, o) { l(e, t, function (e) { return !n(e) }, a, o, "outside") } }, "./util/segmentation/floodFill.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! @babel/runtime/helpers/toConsumableArray */ "../node_modules/@babel/runtime/helpers/toConsumableArray.js"), o = n.n(a); function i(e, t) { return e === t } function r(e, t, n) { return (Array(n + 1).join(t) + e).slice(-n) } t.default = function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, a = n.onFlood || function () { }, l = n.onBoundary || function () { }, s = n.equals || i, u = n.diagonals || !1, d = p(t), c = (function e(t) { for (var n = [], a = 0; a < Math.pow(3, t); a += 1) { var o, i = r(a.toString(3), "0", t); n.push((o = i).split("").map(function (e) { return parseInt(e, 10) - 1 })) } return n })(t.length).filter(function (e) { var t = function e(t) { for (var n = 0, a = 0; a < t.length; a += 1)0 !== t[a] && (n += 1); return n }(e); return 0 !== t && (1 === t || u) }), f = [], g = [], m = {}, h = {}; for (f.push({ currentArgs: t }); f.length > 0;)v(f.pop()); return { flooded: g, boundaries: function e() { var t = []; for (var n in h) h.hasOwnProperty(n) && t.unshift(h[n]); return t }() }; function v(e) { var t, n, i, r, u, v, $ = e.currentArgs, y = e.previousArgs; if (v = $, !0 !== m[v]) { m[t = $] = !0, (n = $, i = x(p, [n]), x(s, [i, d])) ? (r = $, g.push(r), a.apply(void 0, o()(r)), function e(t) { for (var n = 0; n < c.length; n += 1) { for (var a = c[n], o = t.slice(0), i = 0; i < t.length; i += 1)o[i] += a[i]; f.push({ currentArgs: o, previousArgs: t }) } }($)) : (u = y, h[u] = u, l.apply(void 0, o()(u))) } } function p(t) { return e.apply(void 0, o()(t)) } function x(e, t) { try { return e.apply(void 0, o()(t)) } catch (n) { return } } } }, "./util/segmentation/getBoundingBoxAroundCircle.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return o }); var a = n(/*! ../getCircleCoords */ "./util/getCircleCoords.js"); function o(e) { var t = e.detail.handles, n = e.detail.image, o = n.width, i = n.height, r = Object(a.default)(t.start, t.end), l = r.width + r.left, s = r.left, u = r.top + r.height, d = r.top; return s = Math.floor(s), d = Math.floor(d), l = Math.floor(l), u = Math.floor(u), l = Math.min(o, l), s = Math.max(0, s), u = Math.min(i, u), [[s, d = Math.max(0, d)], [l, u]] } }, "./util/segmentation/getBoundingBoxAroundPolygon.js": function (e, t, n) { "use strict"; function a(e, t) { var n = 1 / 0, a = 0, o = 1 / 0, i = 0, r = t.width, l = t.height; return e.forEach(function (e) { n = Math.min(e[0], n), a = Math.max(e[0], a), o = Math.min(e[1], o), i = Math.max(e[1], i) }), n = Math.floor(n), o = Math.floor(o), a = Math.floor(a), i = Math.floor(i), a = Math.min(r, a), n = Math.max(0, n), i = Math.min(l, i), [[n, o = Math.max(0, o)], [a, i]] } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/getCircle.js": function (e, t, n) { "use strict"; function a(e, t, n) { var a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0, o = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0, i = Math.floor(a), r = Math.floor(o); if (1 === e) return [[i, r]]; for (var l = [], s = 0, u = -e; u <= e; u++) { var d = r + u; if (!(d > t) && !(d < 0)) for (var c = -e; c <= e; c++) { var f = i + c; !(f >= n) && !(f < 0) && c * c + u * u < e * e && (l[s++] = [i + c, r + u]) } } return l } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/getDiffBetweenPixelData.js": function (e, t, n) { "use strict"; function a(e, t) { for (var n = [], a = 0; a < e.length; a++)e[a] !== t[a] && n.push([a, e[a], t[a]]); return n } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/getPixelPathBetweenPixels.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../../externalModules.js */ "./externalModules.js"), o = 1 / Math.sqrt(2), i = { up: { x: 0, y: 1 }, upRight: { x: o, y: o }, right: { x: 1, y: 0 }, downRight: { x: o, y: -o }, down: { x: 0, y: 1 }, downLeft: { x: -o, y: -o }, left: { x: -1, y: 0 }, upLeft: { x: -o, y: o } }; function r(e, t) { var n = d(e, t), a = [c(n, i.up), c(n, i.right), c(n, i.upRight)], o = f(a); switch (o) { case 0: e.y++; break; case 1: e.x++; break; case 2: e.y++, e.x++ } } function l(e, t) { var n = d(e, t), a = [c(n, i.up), c(n, i.left), c(n, i.upLeft)], o = f(a); switch (o) { case 0: e.y++; break; case 1: e.x--; break; case 2: e.y++, e.x-- } } function s(e, t) { var n = d(e, t), a = [c(n, i.down), c(n, i.right), c(n, i.downRight)], o = f(a); switch (o) { case 0: e.y--; break; case 1: e.x++; break; case 2: e.y--, e.x++ } } function u(e, t) { var n = d(e, t), a = [c(n, i.down), c(n, i.left), c(n, i.downLeft)], o = f(a); switch (o) { case 0: e.y--; break; case 1: e.x--; break; case 2: e.y--, e.x-- } } function d(e, t) { var n = a.default.cornerstoneMath.point.distance(e, t); return { x: (t.x - e.x) / n, y: (t.y - e.y) / n } } function c(e, t) { return e.x * t.x + e.y * t.y } function f(e) { var t = e[0] > e[1] ? 0 : 1; return e[2] > e[t] && (t = 2), t } t.default = function (e, t) { for (var n = { x: e.x, y: e.y }, a = []; t.x !== n.x || t.y !== n.y;)t.x === n.x ? t.y > n.y ? n.y++ : n.y-- : t.y === n.y ? t.x > n.x ? n.x++ : n.x-- : t.y > n.y ? t.x > n.x ? r(n, t) : l(n, t) : t.x > n.x ? s(n, t) : u(n, t), a.push({ x: n.x, y: n.y }); return a.pop(), a } }, "./util/segmentation/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./drawBrush */ "./util/segmentation/drawBrush.js"); n.d(t, "drawBrushPixels", function () { return a.drawBrushPixels }); var o = n(/*! ./eraseIfSegmentIndex */ "./util/segmentation/eraseIfSegmentIndex.js"); n.d(t, "eraseIfSegmentIndex", function () { return o.default }); var i = n(/*! ./eraseOutsideBoundingBox */ "./util/segmentation/eraseOutsideBoundingBox.js"); n.d(t, "eraseOutsideBoundingBox", function () { return i.default }); var r = n(/*! ./eraseShape */ "./util/segmentation/eraseShape.js"); n.d(t, "eraseInsideShape", function () { return r.eraseInsideShape }), n.d(t, "eraseOutsideShape", function () { return r.eraseOutsideShape }); var l = n(/*! ./fillOutsideBoundingBox */ "./util/segmentation/fillOutsideBoundingBox.js"); n.d(t, "fillOutsideBoundingBox", function () { return l.default }); var s = n(/*! ./fillShape */ "./util/segmentation/fillShape.js"); n.d(t, "fillInsideShape", function () { return s.fillInsideShape }), n.d(t, "fillOutsideShape", function () { return s.fillOutsideShape }); var u = n(/*! ./floodFill */ "./util/segmentation/floodFill.js"); n.d(t, "floodFill", function () { return u.default }); var d = n(/*! ./getBoundingBoxAroundCircle */ "./util/segmentation/getBoundingBoxAroundCircle.js"); n.d(t, "getBoundingBoxAroundCircle", function () { return d.default }); var c = n(/*! ./getBoundingBoxAroundPolygon */ "./util/segmentation/getBoundingBoxAroundPolygon.js"); n.d(t, "getBoundingBoxAroundPolygon", function () { return c.default }); var f = n(/*! ./getCircle */ "./util/segmentation/getCircle.js"); n.d(t, "getCircle", function () { return f.default }); var g = n(/*! ./getPixelPathBetweenPixels */ "./util/segmentation/getPixelPathBetweenPixels.js"); n.d(t, "getPixelPathBetweenPixels", function () { return g.default }); var m = n(/*! ./isSameSegment */ "./util/segmentation/isSameSegment.js"); n.d(t, "isSameSegment", function () { return m.default }); var h = n(/*! ./triggerLabelmapModifiedEvent */ "./util/segmentation/triggerLabelmapModifiedEvent.js"); n.d(t, "triggerLabelmapModifiedEvent", function () { return h.default }); var v = n(/*! ./getDiffBetweenPixelData */ "./util/segmentation/getDiffBetweenPixelData.js"); n.d(t, "getDiffBetweenPixelData", function () { return v.default }) }, "./util/segmentation/isSameSegment.js": function (e, t, n) { "use strict"; function a(e, t, n) { return t[e] === n } n.r(t), n.d(t, "default", function () { return a }) }, "./util/segmentation/triggerLabelmapModifiedEvent.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "default", function () { return r }); var a = n(/*! ../../externalModules */ "./externalModules.js"), o = n(/*! ../../events.js */ "./events.js"), i = n(/*! ../../store */ "./store/index.js"); function r(e, t) { var n = Object(i.getModule)("segmentation").getters; t = void 0 === t ? n.activeLabelmapIndex(e) : t, a.default.cornerstone.triggerEvent(e, o.default.LABELMAP_MODIFIED, { labelmapIndex: t }) } }, "./util/setContextToDisplayFontSize.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ../externalModules.js */ "./externalModules.js"); t.default = function (e, t, n) { var o; return a.default.cornerstone.setToPixelCoordinateSystem(e, t, .1), { fontSize: n / e.viewport.scale / .1, lineHeight: n / e.viewport.scale / .1, fontScale: .1 } } }, "./util/throttle.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./debounce.js */ "./util/debounce.js"), o = n(/*! ./isObject.js */ "./util/isObject.js"); t.default = function e(t, n, i) { var r = !0, l = !0; if ("function" != typeof t) throw TypeError("Expected a function"); return Object(o.default)(i) && (r = "leading" in i ? Boolean(i.leading) : r, l = "trailing" in i ? Boolean(i.trailing) : l), Object(a.default)(t, n, { leading: r, trailing: l, maxWait: n }) } }, "./util/triggerEvent.js": function (e, t, n) { "use strict"; function a(e, t) { var n, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return "function" == typeof window.CustomEvent ? n = new CustomEvent(t, { detail: a, cancelable: !0 }) : (n = document.createEvent("CustomEvent")).initCustomEvent(t, !0, !0, a), e.dispatchEvent(n) } n.r(t), n.d(t, "default", function () { return a }) }, "./util/uuidv4.js": function (e, t, n) { "use strict"; function a() { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (e) { var t = 16 * Math.random() | 0; return ("x" === e ? t : 3 & t | 8).toString(16) }) } n.r(t), n.d(t, "default", function () { return a }) }, "./util/wait.js": function (e, t, n) { "use strict"; n.r(t), n.d(t, "wait", function () { return o }), n.d(t, "waitForEnabledElementImageToLoad", function () { return function e(t) { try { var n = a.default.cornerstone.getEnabledElement(t); if (!n.image) return o(250).then(function () { return e(t) }); return n } catch (i) { return null } } }); var a = n(/*! ./../externalModules.js */ "./externalModules.js"), o = function e(t) { return new Promise(function (e) { return setTimeout(e, t) }) }; t.default = o }, "./util/zoom/changeViewportScale.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t, n) { var a, o = n.maxScale, i = n.minScale, r = Math.pow(1.7, Math.log(e.scale) / Math.log(1.7) + t); return o && r > o ? e.scale = o : i && r < i ? e.scale = i : e.scale = r, e } }, "./util/zoom/correctShift.js": function (e, t, n) { "use strict"; n.r(t), t.default = function (e, t) { var n = t.hflip, a = t.vflip, o = t.rotation; if (e.x *= n ? -1 : 1, e.y *= a ? -1 : 1, 0 !== o) { var i = o * Math.PI / 180, r = Math.cos(i), l = Math.sin(i), s = e.x * r - e.y * l, u = e.x * l + e.y * r; e.x = s, e.y = u } return e } }, "./util/zoom/index.js": function (e, t, n) { "use strict"; n.r(t); var a = n(/*! ./changeViewportScale.js */ "./util/zoom/changeViewportScale.js"); n.d(t, "changeViewportScale", function () { return a.default }); var o = n(/*! ./correctShift.js */ "./util/zoom/correctShift.js"); n.d(t, "correctShift", function () { return o.default }), t.default = { changeViewportScale: a.default, correctShift: o.default } }, "./version.js": function (e, t, n) { "use strict"; n.r(t), t.default = "6.0.6" } }) });